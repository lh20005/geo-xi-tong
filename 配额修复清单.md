# 配额系统修复清单

## 修复项目

### 1. distillation.ts ❌
- [ ] 导入 usageTrackingService
- [ ] 添加配额检查（蒸馏前）
- [ ] 添加配额记录（蒸馏成功后）
- [ ] 测试：蒸馏后配额减少
- [ ] 测试：配额不足时拒绝蒸馏

### 2. platformAccounts.ts ❌
- [ ] 导入 usageTrackingService
- [ ] 添加配额检查（添加账号前）
- [ ] 添加配额记录（添加成功后）
- [ ] 添加配额减少（删除账号后）
- [ ] 测试：添加账号后配额减少
- [ ] 测试：删除账号后配额增加
- [ ] 测试：配额不足时拒绝添加

### 3. publishingTasks.ts ❌
- [ ] 确认已导入 usageTrackingService
- [ ] 添加配额记录（发布成功后）
- [ ] 测试：发布后配额减少
- [ ] 测试：配额不足时拒绝发布

## 验证清单

### 功能测试
- [ ] 文章生成：配额检查 ✅ 配额记录 ✅
- [ ] 关键词蒸馏：配额检查 ❌ 配额记录 ❌
- [ ] 平台账号：配额检查 ❌ 配额记录 ❌
- [ ] 发布任务：配额检查 ✅ 配额记录 ❌
- [ ] 存储空间：配额检查 ✅ 配额记录 ✅

### 集成测试
- [ ] 生成文章 -> 配额减少 -> 配额显示正确
- [ ] 蒸馏关键词 -> 配额减少 -> 配额显示正确
- [ ] 添加账号 -> 配额减少 -> 配额显示正确
- [ ] 删除账号 -> 配额增加 -> 配额显示正确
- [ ] 发布文章 -> 配额减少 -> 配额显示正确
- [ ] 上传图片 -> 存储减少 -> 存储显示正确

### 边界测试
- [ ] 配额为 0 时无法操作
- [ ] 配额不足时显示正确错误信息
- [ ] 配额重置后恢复正常
- [ ] 多个操作并发时配额正确

## 完成标准

所有 ❌ 变为 ✅，所有测试通过。
