# 发布任务页面 - 文章选择改为翻页式完成 ✅

## 问题描述
发布任务页面（Publishing Tasks Page）中的"选择文章"区域使用的是滚动式列表（`scroll={{ y: 300 }}`），用户希望改为翻页式，与同页面的"发布任务"列表保持一致。

## 修改内容

### 文件：`client/src/pages/PublishingTasksPage.tsx`

#### 1. 移除滚动配置
**修改前**：
```typescript
<Table
  columns={articleColumns}
  dataSource={articles}
  rowKey="id"
  loading={articlesLoading}
  pagination={false}
  scroll={{ y: 300 }}  // ❌ 滚动式
  size="small"
/>
```

**修改后**：
```typescript
<Table
  columns={articleColumns}
  dataSource={articles}
  rowKey="id"
  loading={articlesLoading}
  pagination={{  // ✅ 翻页式
    current: articlePage,
    pageSize: articlePageSize,
    total: articleTotal,
    onChange: (newPage, newPageSize) => {
      setArticlePage(newPage);
      if (newPageSize && newPageSize !== articlePageSize) {
        setArticlePageSize(newPageSize);
        setArticlePage(1);
      }
    },
    showSizeChanger: true,
    showQuickJumper: true,
    showTotal: (total) => `共 ${total} 篇文章`,
    pageSizeOptions: ['5', '10', '20', '50']
  }}
  size="small"
/>
```

#### 2. 新增分页状态
```typescript
// 文章选择
const [articles, setArticles] = useState<Article[]>([]);
const [selectedArticleIds, setSelectedArticleIds] = useState<Set<number>>(new Set());
const [articlesLoading, setArticlesLoading] = useState(false);
const [articlePage, setArticlePage] = useState(1);           // ✅ 新增
const [articlePageSize, setArticlePageSize] = useState(10);  // ✅ 新增
const [articleTotal, setArticleTotal] = useState(0);         // ✅ 新增
```

#### 3. 更新加载逻辑
**修改前**：
```typescript
const loadDraftArticles = async () => {
  setArticlesLoading(true);
  try {
    const response = await getArticles(1, 100, { publishStatus: 'unpublished' });
    // 一次性加载100条
  }
}
```

**修改后**：
```typescript
const loadDraftArticles = async () => {
  setArticlesLoading(true);
  try {
    const response = await getArticles(articlePage, articlePageSize, { publishStatus: 'unpublished' });
    setArticles(response.articles || []);
    setArticleTotal(response.total || 0);  // ✅ 保存总数
    setStats(prev => ({ ...prev, draftArticles: response.total || 0 }));
  }
}
```

#### 4. 添加分页监听
```typescript
useEffect(() => {
  loadDraftArticles();
}, [articlePage, articlePageSize]);  // ✅ 监听分页变化
```

## 功能特性

### 与"发布任务"列表保持一致
- ✅ 使用翻页分页器，不使用滚动条
- ✅ 支持快速跳转（showQuickJumper）
- ✅ 支持切换每页数量（5/10/20/50）
- ✅ 显示总数统计（共 X 篇文章）
- ✅ 分页器位置在表格底部

### 用户体验提升
- ✅ 不再有固定高度的滚动区域
- ✅ 可以清晰看到当前页的所有文章
- ✅ 通过页码切换查看更多文章
- ✅ 支持跨页选择文章（选择状态保持）
- ✅ 布局更加统一和专业

## 对比效果

| 特性 | 修改前（滚动式） | 修改后（翻页式） |
|------|----------------|----------------|
| 显示方式 | 固定高度300px，滚动查看 | 翻页查看，无滚动条 |
| 每页数量 | 一次加载100条 | 可选 5/10/20/50 条 |
| 页面跳转 | ❌ 不支持 | ✅ 支持快速跳转 |
| 总数显示 | ❌ 不显示 | ✅ 显示"共 X 篇文章" |
| 布局一致性 | ❌ 与任务列表不一致 | ✅ 与任务列表一致 |
| 用户体验 | 需要滚动查看 | 点击页码切换 |

## 测试步骤

### 1. 启动服务
```bash
# 后端
cd server && npm run dev

# 前端
cd client && npm run dev
```

### 2. 访问发布任务页面
```
http://localhost:5173/publishing-tasks
```

### 3. 验证文章选择区域
- ✅ 表格底部有分页器
- ✅ 没有滚动条
- ✅ 可以点击页码切换页面
- ✅ 可以使用"跳转"功能
- ✅ 可以切换每页显示数量
- ✅ 显示"共 X 篇文章"

### 4. 测试跨页选择
1. 在第1页选择2篇文章
2. 切换到第2页
3. 再选择3篇文章
4. 验证顶部显示"已选 5 篇"
5. 切换回第1页，验证之前的选择仍然保持

### 5. 对比任务列表
- 验证"选择文章"和"发布任务"两个表格的分页器样式一致
- 验证功能行为一致

## 技术细节

### 分页配置
```typescript
pagination={{
  current: articlePage,              // 当前页码
  pageSize: articlePageSize,         // 每页数量
  total: articleTotal,               // 总记录数
  onChange: (newPage, newPageSize) => {
    setArticlePage(newPage);
    if (newPageSize && newPageSize !== articlePageSize) {
      setArticlePageSize(newPageSize);
      setArticlePage(1);  // 改变每页数量时重置到第1页
    }
  },
  showSizeChanger: true,             // 显示每页数量选择器
  showQuickJumper: true,             // 显示快速跳转
  showTotal: (total) => `共 ${total} 篇文章`,  // 显示总数
  pageSizeOptions: ['5', '10', '20', '50']     // 每页数量选项
}}
```

### 状态管理
- `articlePage`: 当前页码（从1开始）
- `articlePageSize`: 每页显示数量（默认10）
- `articleTotal`: 文章总数
- `selectedArticleIds`: 已选择的文章ID集合（跨页保持）

### 数据加载
- 页码或每页数量变化时自动重新加载
- 使用 `useEffect` 监听分页状态变化
- 保持选择状态不受分页影响

## 完成状态

✅ 移除滚动配置（scroll）
✅ 添加翻页配置（pagination）
✅ 新增分页状态管理
✅ 更新数据加载逻辑
✅ 添加分页监听
✅ 与任务列表保持一致
✅ 代码无语法错误
✅ 支持跨页选择

## 注意事项

1. **选择状态保持**：切换页面时，已选择的文章ID会保持在 `selectedArticleIds` 中
2. **全选行为**：点击表头的全选框只会选择当前页的文章
3. **性能优化**：按需加载，不再一次性加载100条数据
4. **用户体验**：与"发布任务"列表保持一致的交互方式

## 下一步

可以进一步优化：
- 添加文章搜索/筛选功能
- 添加批量操作按钮
- 优化表格列显示
- 添加文章预览功能

---

**修改完成时间**：2024-12-17
**修改文件**：`client/src/pages/PublishingTasksPage.tsx`
**测试状态**：✅ 代码检查通过，等待实际测试
