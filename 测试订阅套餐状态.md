# 测试订阅套餐状态显示

## 快速测试指南

### 启动系统

```bash
# 启动前端和后端
npm run dev
```

### 测试步骤

#### 1. 测试未购买用户

1. 注册一个新用户或使用未购买套餐的账号登录
2. 进入"个人中心" → "订阅管理"标签
3. **验证点**：
   - ✅ 订阅信息卡片显示"您还没有订阅任何套餐"
   - ✅ 显示大号皇冠图标和引导文案
   - ✅ 有"立即订阅"和"查看套餐详情"两个按钮
4. 点击"立即订阅"或"查看套餐详情"
5. **验证点**：
   - ✅ 弹出套餐选择对话框
   - ✅ 所有套餐显示紫色"推荐"标签
   - ✅ 所有套餐按钮显示"立即购买"
   - ✅ 所有按钮都可点击（蓝色主按钮）

#### 2. 测试已购买体验版用户

1. 使用已购买体验版的账号登录
2. 进入"个人中心" → "订阅管理"标签
3. **验证点**：
   - ✅ 订阅信息卡片显示当前套餐信息
   - ✅ 显示套餐名称、到期时间、订阅状态、自动续费状态
   - ✅ 有"升级套餐"和"自动续费"按钮
4. 点击"升级套餐"
5. **验证点**：
   - ✅ 体验版卡片：蓝色边框 + 阴影，蓝色"当前套餐"标签，灰色"已购买"按钮（禁用）
   - ✅ 专业版卡片：绿色"可升级"标签，蓝色"立即升级"按钮，显示升级提示文字
   - ✅ 企业版卡片：绿色"可升级"标签，蓝色"立即升级"按钮，显示升级提示文字
6. 点击专业版的"立即升级"按钮
7. **验证点**：
   - ✅ 跳转到支付页面
   - ✅ 显示升级订单信息

#### 3. 测试已购买专业版用户

1. 使用已购买专业版的账号登录（如 lzc2005）
2. 进入"个人中心" → "订阅管理"标签
3. 点击"升级套餐"
4. **验证点**：
   - ✅ 体验版卡片：蓝色"已购买"标签，灰色"已购买"按钮（禁用）
   - ✅ 专业版卡片：蓝色边框 + 阴影，蓝色"当前套餐"标签，灰色"已购买"按钮（禁用）
   - ✅ 企业版卡片：绿色"可升级"标签，蓝色"立即升级"按钮
5. 点击企业版的"立即升级"按钮
6. **验证点**：
   - ✅ 跳转到支付页面
   - ✅ 显示升级订单信息

#### 4. 测试已购买企业版用户

1. 使用已购买企业版的账号登录
2. 进入"个人中心" → "订阅管理"标签
3. 点击"升级套餐"
4. **验证点**：
   - ✅ 体验版卡片：蓝色"已购买"标签，灰色"已购买"按钮（禁用）
   - ✅ 专业版卡片：蓝色"已购买"标签，灰色"已购买"按钮（禁用）
   - ✅ 企业版卡片：蓝色边框 + 阴影，蓝色"当前套餐"标签，灰色"已购买"按钮（禁用）

#### 5. 测试即将到期提醒

1. 使用订阅即将到期（7天内）的账号登录
2. 进入"个人中心" → "订阅管理"标签
3. **验证点**：
   - ✅ 到期时间显示为红色
   - ✅ 显示橙色警告标签："⚠️ 还有 X 天到期"

## 视觉效果检查

### 套餐卡片样式

- **当前套餐**：
  - 边框：2px 蓝色实线
  - 阴影：淡蓝色阴影效果
  - 标签：蓝色"当前套餐"
  
- **可升级套餐**：
  - 边框：1px 灰色实线
  - 悬停：有悬停效果
  - 标签：绿色"可升级"
  - 提示：绿色小字提示升级说明
  
- **较低套餐（已购买）**：
  - 边框：1px 灰色实线
  - 无悬停效果
  - 标签：蓝色"已购买"
  - 说明：因为已购买更高级套餐，低级套餐功能已包含

### 响应式检查

- 对话框宽度：900px
- 三列布局，每列占 8/24
- 卡片高度自适应，保持一致

## 常见问题排查

### 问题1：套餐状态显示不正确

**可能原因**：
- 用户订阅数据未正确加载
- 套餐价格比较逻辑错误

**排查方法**：
```javascript
// 在浏览器控制台查看
console.log('当前订阅:', subscription);
console.log('套餐列表:', plans);
```

### 问题2：按钮点击无响应

**可能原因**：
- 按钮被禁用
- handleUpgrade 函数未正确绑定

**排查方法**：
- 检查按钮的 disabled 属性
- 检查控制台是否有错误信息

### 问题3：样式显示异常

**可能原因**：
- CSS 样式冲突
- Ant Design 版本问题

**排查方法**：
- 检查浏览器开发者工具中的样式
- 确认 Ant Design 版本为 5.x

## 数据库验证

### 查看用户订阅信息

```sql
-- 查看用户当前订阅
SELECT 
  u.username,
  s.status,
  p.plan_name,
  p.price,
  s.start_date,
  s.end_date,
  s.auto_renew
FROM user_subscriptions s
JOIN users u ON s.user_id = u.id
JOIN subscription_plans p ON s.plan_id = p.id
WHERE s.status = 'active'
ORDER BY u.username;
```

### 查看套餐列表

```sql
-- 查看所有激活的套餐
SELECT 
  id,
  plan_code,
  plan_name,
  price,
  billing_cycle,
  is_active,
  display_order
FROM subscription_plans
WHERE is_active = true
ORDER BY display_order;
```

## 优化效果总结

### 用户体验提升

1. **清晰的状态识别**：用户可以立即识别当前套餐和可升级选项
2. **智能操作引导**：根据用户状态提供合适的操作按钮
3. **友好的视觉反馈**：通过颜色、标签、边框等视觉元素传达信息
4. **一致的交互逻辑**：所有状态下的交互保持一致性

### 业务价值

1. **提高转化率**：清晰的升级引导可能提高套餐升级率
2. **减少困惑**：用户不会对已购买的套餐感到困惑
3. **降低支持成本**：减少因状态不清晰导致的客服咨询

## 相关文档

- [订阅套餐状态优化](docs/02-功能说明/订阅套餐状态优化.md)
- [用户中心功能说明](docs/02-功能说明/用户中心.md)
- [订阅系统架构](docs/07-开发文档/订阅系统.md)
