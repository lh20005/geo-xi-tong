# 平台登录测试指南

## 快速测试命令

### 启动 Windows 登录管理器
```bash
cd windows-login-manager
npm run dev
```

## 测试顺序

建议按照以下顺序测试，从简单到复杂：

### 第一批：基础平台（URL 检测）
1. **头条号** - 已测试通过
2. **抖音号** - 已测试通过
3. **小红书** - 新创建，需要测试
4. **微信公众号** - 新创建，需要测试

### 第二批：需要鼠标事件
5. **百家号** - 新创建，需要测试（鼠标悬停）
6. **简书** - 新创建，需要测试（鼠标悬停+点击）

### 第三批：API 调用平台
7. **知乎** - 新创建，需要测试（API）
8. **CSDN** - 新创建，需要测试（API）
9. **哔哩哔哩** - 新创建，需要测试（API）

### 第四批：特殊解析
10. **企鹅号** - 新创建，需要测试
11. **搜狐号** - 新创建，需要测试
12. **网易号** - 新创建，需要测试（第3个元素）

## 测试步骤

### 1. 准备工作
```bash
# 确保后端服务运行
cd server
npm run dev

# 启动 Windows 登录管理器
cd windows-login-manager
npm run dev
```

### 2. 测试单个平台

#### 在前端界面操作：
1. 打开"账号管理"页面
2. 点击"添加账号"
3. 选择要测试的平台
4. 点击"登录"按钮
5. 在弹出的登录页面完成登录
6. 等待自动检测登录成功
7. 查看账号列表是否显示正确的用户名

#### 验证要点：
- [ ] 登录页面正确打开
- [ ] 登录成功后自动检测
- [ ] 用户名正确显示（真实用户名）
- [ ] 账号出现在列表中
- [ ] 可以设置为默认账号
- [ ] 可以删除账号

### 3. 查看日志

#### Electron 日志位置：
```bash
# macOS
~/Library/Logs/windows-login-manager/main.log

# Windows
%USERPROFILE%\AppData\Roaming\windows-login-manager\logs\main.log

# Linux
~/.config/windows-login-manager/logs/main.log
```

#### 查看实时日志：
```bash
# macOS/Linux
tail -f ~/Library/Logs/windows-login-manager/main.log

# 或在应用内查看
# 设置 -> 日志 -> 查看日志
```

### 4. 测试取消功能

1. 开始登录流程
2. 在登录页面点击"关闭"按钮
3. 验证 WebView 正确关闭
4. 验证没有残留进程

### 5. 测试多账号

1. 为同一平台添加多个账号
2. 验证账号正确隔离
3. 验证可以切换默认账号
4. 验证删除账号功能

## 常见问题排查

### 问题1：登录页面不显示
**可能原因**：
- WebView 创建失败
- URL 配置错误

**排查方法**：
```bash
# 查看日志
tail -f ~/Library/Logs/windows-login-manager/main.log | grep "WebView"
```

### 问题2：登录成功但未检测到
**可能原因**：
- 选择器配置错误
- 检查间隔太短
- 页面加载未完成

**排查方法**：
```bash
# 查看日志中的检测信息
tail -f ~/Library/Logs/windows-login-manager/main.log | grep "登录成功"
```

### 问题3：用户名提取失败
**可能原因**：
- 选择器不正确
- 页面结构变化
- API 返回格式变化

**排查方法**：
1. 检查日志中的错误信息
2. 在浏览器中验证选择器
3. 检查 API 返回数据

### 问题4：Cookie 未保存
**可能原因**：
- Session partition 配置错误
- Cookie 域名不匹配

**排查方法**：
```bash
# 查看 Cookie 捕获日志
tail -f ~/Library/Logs/windows-login-manager/main.log | grep "捕获"
```

## 测试检查清单

### 基础功能
- [ ] 所有平台登录页面可以打开
- [ ] 登录成功自动检测
- [ ] 用户名正确提取
- [ ] Cookie 正确保存
- [ ] 账号列表正确显示

### 高级功能
- [ ] 取消登录功能正常
- [ ] 多账号支持
- [ ] 默认账号切换
- [ ] 账号删除功能
- [ ] 测试登录功能

### 错误处理
- [ ] 网络错误处理
- [ ] 登录超时处理
- [ ] 用户取消处理
- [ ] 重复登录处理

### 性能
- [ ] 登录检测响应快速
- [ ] 资源正确清理
- [ ] 无内存泄漏
- [ ] 日志记录完整

## 测试报告模板

```markdown
## 平台：[平台名称]

### 测试时间
2025-12-31

### 测试结果
- [ ] 通过
- [ ] 失败

### 测试详情
1. 登录页面：✅/❌
2. 登录检测：✅/❌
3. 用户名提取：✅/❌
4. Cookie 保存：✅/❌
5. 账号显示：✅/❌

### 问题记录
- 问题1：[描述]
- 问题2：[描述]

### 日志摘要
```
[粘贴相关日志]
```

### 截图
[如有需要，添加截图]
```

## 批量测试脚本

创建一个测试脚本来自动化测试：

```bash
#!/bin/bash
# test-all-platforms.sh

platforms=(
  "toutiao"
  "douyin"
  "xiaohongshu"
  "wechat"
  "baijiahao"
  "jianshu"
  "zhihu"
  "qie"
  "souhu"
  "wangyi"
  "csdn"
  "bilibili"
)

for platform in "${platforms[@]}"; do
  echo "测试平台: $platform"
  # 这里添加自动化测试逻辑
  # 例如：使用 Playwright 或 Puppeteer
done
```

## 下一步

1. 按照测试顺序逐个测试平台
2. 记录测试结果
3. 修复发现的问题
4. 更新文档
5. 准备生产环境部署

## 参考资料

- `GEO应用脚本详细分析.md` - 原始实现参考
- `平台登录器创建进度.md` - 创建进度
- `🎉平台登录器全部完成.md` - 完成总结
