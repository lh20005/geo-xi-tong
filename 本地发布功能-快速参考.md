# 本地发布功能 - 快速参考卡片

## 🎯 一句话总结

**本地开发时可以看到浏览器操作过程，方便调试发布流程。**

**重要说明**：浏览器在后端进程中启动，本地开发时后端运行在本地，所以能看到浏览器窗口。**不需要迁移任何代码！**

---

## 🏗️ 架构说明

### 当前架构（无需改动）

```
前端 (localhost:5173)
  ↓ HTTP API
后端 (localhost:3000) ← 在本地运行！
  ↓ Playwright
浏览器窗口 ← 在本地显示！
```

### 为什么不需要迁移？

1. **本地开发时，后端就在本地运行**
2. **浏览器在后端进程中启动**
3. **可视化模式会在本地显示窗口**
4. **架构统一，代码相同**

---

## ⚡ 快速开始（3 步）

### 1️⃣ 启动开发环境
```bash
npm run dev
```

### 2️⃣ 打开发布任务页面
访问：`http://localhost:5173/publishing-tasks`

### 3️⃣ 切换浏览器模式
在"发布配置"区域，找到**浏览器模式**开关：
- 🔵 **静默模式**：后台运行（默认）
- 🟢 **可视化模式**：显示浏览器窗口

---

## 📊 两种模式对比

| 模式 | 浏览器窗口 | 适用场景 |
|------|-----------|---------|
| 🔇 静默 | ❌ 不显示 | 批量发布、生产环境 |
| 👁️ 可视化 | ✅ 显示 | 调试、开发新平台 |

---

## 🔧 技术实现（最小改动）

### 改动文件：仅 1 个
- `client/src/pages/PublishingTasksPage.tsx`

### 改动内容：约 30 行
```typescript
// 智能环境检测
const isLocalDev = window.location.hostname === 'localhost' 
  || window.location.hostname === '127.0.0.1';
const [headlessMode, setHeadlessMode] = useState<boolean>(!isLocalDev);

// UI 控制开关
<Switch
  checked={!headlessMode}
  onChange={(checked) => setHeadlessMode(!checked)}
  checkedChildren="可视化"
  unCheckedChildren="静默"
/>
```

### 后端改动：0 行
✅ 后端已完美支持，无需修改

---

## 🎨 用户界面预览

```
┌─────────────────────────────────────────┐
│ 浏览器模式：[可视化/静默] 🟢 可视化发布  │
│ 显示浏览器窗口，便于调试（仅本地开发）   │
└─────────────────────────────────────────┘
```

---

## 🌟 核心特性

### 1. 智能环境检测
- **本地**（localhost）→ 默认可视化
- **服务器**（生产环境）→ 自动静默

### 2. 用户可控
- 随时切换模式
- 设置实时生效

### 3. 安全保护
- 服务器环境强制静默
- 防止误配置

---

## 📚 完整文档

- **用户指南**：`docs/01-快速开始/本地发布调试指南.md`
- **技术文档**：`docs/07-开发文档/本地发布功能实现总结.md`
- **架构分析**：`docs/07-开发文档/本地发布架构分析.md` ⭐ 必读

---

## 🐛 常见问题

**Q: 可视化模式下浏览器没弹出？**  
A: 确认是本地环境（localhost），检查系统有显示器

**Q: 服务器能用可视化模式吗？**  
A: 不能，服务器自动强制静默模式（安全设计）

**Q: 如何调试发布流程？**  
A: 切换到可视化模式，观察浏览器操作过程

---

## ✅ 验证清单

- [x] 前端代码无语法错误
- [x] 智能环境检测正常
- [x] UI 控制开关可用
- [x] 服务器兼容性保证
- [x] 文档完整

---

## 🎉 实现效果

✅ 本地开发默认可视化  
✅ 用户可随时切换  
✅ 服务器自动静默  
✅ 零后端改动  
✅ 完全向后兼容  

**这是最小改动的最佳方案！**
