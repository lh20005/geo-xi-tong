# 系统脚本工具

本目录包含用于系统维护和诊断的实用脚本。

## 📋 脚本列表

### 1. 诊断脚本 (`diagnose.sh`)

**功能**：快速诊断系统常见问题

**使用方法**：
```bash
./scripts/diagnose.sh
```

**检查项目**：
- ✓ Node.js 和 npm 安装状态
- ✓ PostgreSQL 安装和服务状态
- ✓ 端口占用情况（3000, 5173）
- ✓ 配置文件（.env）
- ✓ 项目依赖安装状态
- ✓ 数据库和表的存在性

**使用场景**：
- 启动应用前的健康检查
- 排查应用无法启动的问题
- 验证开发环境配置

---

### 2. 数据库检查脚本 (`check-database.sh`)

**功能**：详细检查 PostgreSQL 数据库状态

**使用方法**：
```bash
./scripts/check-database.sh
```

**检查项目**：
- ✓ PostgreSQL 安装状态
- ✓ 数据库服务运行状态
- ✓ 数据库连接配置
- ✓ 数据库是否存在
- ✓ 数据库表列表
- ✓ 数据库连接测试

**使用场景**：
- 数据库连接问题排查
- 验证数据库迁移是否成功
- 检查数据库表结构

---

## 🚀 快速开始

### 首次使用

1. **赋予脚本执行权限**：
```bash
chmod +x scripts/*.sh
```

2. **运行系统诊断**：
```bash
./scripts/diagnose.sh
```

3. **如果发现问题，根据提示修复**

4. **启动应用**：
```bash
./start.command
```

---

## 🔧 常见问题解决

### PostgreSQL 未运行

**问题**：诊断显示 "PostgreSQL 服务未运行"

**解决方案**：
```bash
# macOS (Homebrew)
brew services start postgresql@14

# Linux (systemd)
sudo systemctl start postgresql

# 手动启动
pg_ctl -D /path/to/data start
```

---

### 端口被占用

**问题**：端口 3000 或 5173 被占用

**解决方案**：
```bash
# 查看占用端口的进程
lsof -i :3000
lsof -i :5173

# 停止进程（替换 <PID> 为实际进程ID）
kill -9 <PID>
```

---

### 数据库不存在

**问题**：数据库 'geo_system' 不存在

**解决方案**：
```bash
# 创建数据库
createdb geo_system

# 或使用 psql
psql -c "CREATE DATABASE geo_system;"
```

---

### 依赖未安装

**问题**：node_modules 目录不存在

**解决方案**：
```bash
# 安装所有依赖
npm run install:all

# 或分别安装
npm install
cd server && npm install
cd ../client && npm install
```

---

## 📊 诊断输出示例

### 正常状态
```
============================================
   GEO 系统诊断工具
============================================

▶ 检查 Node.js
✓ Node.js 已安装: v18.17.0
✓ npm 已安装: 9.6.7

▶ 检查 PostgreSQL
✓ PostgreSQL 已安装: 14.8
✓ PostgreSQL 服务正在运行

▶ 检查端口占用
✓ 端口 3000 空闲
✓ 端口 5173 空闲

▶ 检查配置文件
✓ .env 文件存在
✓ DATABASE_URL 已配置

▶ 检查项目依赖
✓ 根目录依赖已安装
✓ 服务端依赖已安装
✓ 客户端依赖已安装

▶ 检查数据库
✓ 数据库 'geo_system' 存在
✓ 数据库包含 8 个表

============================================
✓ 诊断完成！未发现问题
============================================

系统状态良好，可以启动应用：
  ./start.command
```

### 发现问题
```
============================================
   GEO 系统诊断工具
============================================

▶ 检查 PostgreSQL
✗ PostgreSQL 服务未运行
  启动: brew services start postgresql@14

▶ 检查端口占用
⚠ 端口 3000 被占用
  进程: node (PID: 12345)
  停止: kill -9 12345

============================================
⚠ 诊断完成！发现 2 个问题
============================================

请根据上方提示解决问题后再启动应用
```

---

## 💡 最佳实践

1. **定期运行诊断**：在遇到问题时首先运行诊断脚本
2. **启动前检查**：在启动应用前运行诊断确保环境正常
3. **保存输出**：如果需要技术支持，可以保存诊断输出
4. **自动化**：可以将诊断脚本集成到 CI/CD 流程中

---

## 🔗 相关文档

- [快速开始指南](../docs/快速开始.md)
- [部署指南](../docs/部署指南.md)
- [故障排除](../TROUBLESHOOTING.md)

---

## 📝 脚本维护

如需修改或扩展脚本功能，请参考：

- 脚本使用 Bash 编写
- 遵循 POSIX 标准以确保跨平台兼容性
- 使用颜色输出提高可读性
- 提供详细的错误信息和解决方案

---

## 🤝 贡献

如果你发现脚本有问题或有改进建议，欢迎提交 Issue 或 Pull Request。
