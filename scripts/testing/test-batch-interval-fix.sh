#!/bin/bash

echo "ğŸ“Š æ‰¹æ¬¡å®šæ—¶å‘å¸ƒé—´éš”æµ‹è¯•"
echo "================================"
echo ""

echo "1ï¸âƒ£ æŸ¥çœ‹æœ€è¿‘çš„æ‰¹æ¬¡ä»»åŠ¡æ‰§è¡Œæƒ…å†µ"
echo "--------------------------------"
node check-batch-intervals.js

echo ""
echo "2ï¸âƒ£ ç›‘æ§æœåŠ¡å™¨æ—¥å¿—ï¼ˆæ‰¹æ¬¡ç›¸å…³ï¼‰"
echo "--------------------------------"
echo "æç¤ºï¼šåˆ›å»ºæ–°çš„æ‰¹æ¬¡ä»»åŠ¡åï¼Œè§‚å¯Ÿæ—¥å¿—è¾“å‡º"
echo "å‘½ä»¤ï¼štail -f server.log | grep -E 'æ‰¹æ¬¡|ç­‰å¾…|é—´éš”|ä»»åŠ¡.*å®Œæˆ'"
echo ""

echo "3ï¸âƒ£ æµ‹è¯•æ­¥éª¤"
echo "--------------------------------"
echo "åœ¨Windowsç«¯æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š"
echo ""
echo "  1. æ‰“å¼€å‘å¸ƒä»»åŠ¡é¡µé¢"
echo "  2. é€‰æ‹© 2 ç¯‡æ–‡ç« "
echo "  3. é€‰æ‹© 2 ä¸ªå¹³å°ï¼ˆå…±4ä¸ªä»»åŠ¡ï¼‰"
echo "  4. è®¾ç½®é—´éš”æ—¶é—´ï¼š3 åˆ†é’Ÿ"
echo "  5. ç‚¹å‡»ã€Œåˆ›å»ºå‘å¸ƒä»»åŠ¡ã€"
echo ""
echo "  é¢„æœŸç»“æœï¼š"
echo "  - ä»»åŠ¡1ï¼šç«‹å³æ‰§è¡Œ"
echo "  - ä»»åŠ¡2ï¼šä»»åŠ¡1å®Œæˆåç­‰å¾…3åˆ†é’Ÿå†æ‰§è¡Œ"
echo "  - ä»»åŠ¡3ï¼šä»»åŠ¡2å®Œæˆåç­‰å¾…3åˆ†é’Ÿå†æ‰§è¡Œ"
echo "  - ä»»åŠ¡4ï¼šä»»åŠ¡3å®Œæˆåç­‰å¾…3åˆ†é’Ÿå†æ‰§è¡Œ"
echo ""

echo "4ï¸âƒ£ éªŒè¯æ–¹æ³•"
echo "--------------------------------"
echo "æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å®é™…é—´éš”ï¼š"
echo ""
echo "  node -e \""
echo "  const { pool } = require('./server/dist/db/database');"
echo "  async function check() {"
echo "    const result = await pool.query(\`"
echo "      SELECT id, batch_order, status, updated_at"
echo "      FROM publishing_tasks"
echo "      WHERE batch_id = (SELECT batch_id FROM publishing_tasks ORDER BY created_at DESC LIMIT 1)"
echo "      ORDER BY batch_order"
echo "    \`);"
echo "    console.log('ä»»åŠ¡æ‰§è¡Œæ—¶é—´ï¼š');"
echo "    result.rows.forEach((row, i) => {"
echo "      const time = new Date(row.updated_at).toLocaleTimeString('zh-CN');"
echo "      console.log(\`  ä»»åŠ¡\${i+1}: \${time} (\${row.status})\`);"
echo "      if (i > 0) {"
echo "        const prev = new Date(result.rows[i-1].updated_at);"
echo "        const curr = new Date(row.updated_at);"
echo "        const interval = (curr - prev) / 60000;"
echo "        console.log(\`    é—´éš”: \${interval.toFixed(2)}åˆ†é’Ÿ\`);"
echo "      }"
echo "    });"
echo "    await pool.end();"
echo "  }"
echo "  check();"
echo "  \""
echo ""

echo "5ï¸âƒ£ å®æ—¶ç›‘æ§å‘½ä»¤"
echo "--------------------------------"
echo "åœ¨å¦ä¸€ä¸ªç»ˆç«¯æ‰§è¡Œï¼š"
echo ""
echo "  tail -f server.log | grep --color=auto -E 'æ‰¹æ¬¡|ç­‰å¾…|é—´éš”|ä»»åŠ¡.*å®Œæˆ|â³|âœ…'"
echo ""

echo "================================"
echo "âœ… æµ‹è¯•å‡†å¤‡å®Œæˆ"
echo ""
