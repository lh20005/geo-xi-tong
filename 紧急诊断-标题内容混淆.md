# 紧急诊断 - 标题内容混淆问题

## 当前状态
用户反馈：标题和内容仍然混在一起，都被复制到内容里，标题没有被单独复制。

## 已添加的诊断日志

### 1. 标题输入部分
```typescript
console.log(`[头条号] ========== 开始输入标题 ==========`);
console.log(`[头条号] 标题内容: "${title}"`);
console.log(`[头条号] 标题长度: ${title.length} 个字符`);
console.log(`[头条号] 注意：只输入标题，不输入内容`);

// 使用两种方法输入标题
// 方法1：直接设置input.value
// 方法2：点击后输入

console.log(`[头条号] 验证方法1结果: "${inputValue}"`);
console.log('[头条号] ✅✅✅ 标题输入成功！');
// 或
console.log(`[头条号] ❌❌❌ 标题输入失败！`);
console.log(`[头条号] ========== 标题输入结束 ==========`);
```

### 2. 内容输入部分
```typescript
console.log('[头条号] ========== 开始输入内容 ==========');
console.log('[头条号] 注意：只输入内容，不包含标题');
console.log('[头条号] article.title = "' + article.title + '"');
console.log('[头条号] article.content 前100字符 = "' + article.content.substring(0, 100) + '"');
console.log('[头条号] 重要：只使用article.content，绝不使用article.title');
```

## 诊断步骤

### 步骤1：查看服务器控制台日志

1. 启动服务器：
```bash
cd server && npm run dev
```

2. 点击"执行"按钮

3. 查看控制台输出，重点关注：

```
[头条号] 文章标题: "XXX"
[头条号] 内容长度: XXX 个字符
[头条号] ========== 开始输入标题 ==========
[头条号] 标题内容: "XXX"
[头条号] ✅✅✅ 标题输入成功！
或
[头条号] ❌❌❌ 标题输入失败！
或
[头条号] ❌❌❌ 未找到标题输入框！！！

[头条号] ========== 开始输入内容 ==========
[头条号] article.title = "XXX"
[头条号] article.content 前100字符 = "XXX"
```

### 步骤2：根据日志判断问题

#### 情况A：标题输入框未找到
```
[头条号] ❌❌❌ 未找到标题输入框！！！
```
**原因**：页面结构变化，选择器失效
**解决**：需要在浏览器中检查实际的HTML结构

#### 情况B：标题输入失败
```
[头条号] ❌❌❌ 标题输入失败！期望: "XXX", 实际: ""
```
**原因**：输入框被禁用或有JavaScript拦截
**解决**：需要使用其他输入方法

#### 情况C：标题输入成功但仍然混淆
```
[头条号] ✅✅✅ 标题输入成功！
[头条号] article.content 前100字符 = "XXX标题XXX..."
```
**原因**：数据库中的content字段本身就包含了标题
**解决**：需要在文章生成时就分离标题和内容

### 步骤3：检查数据库

运行测试脚本：
```bash
./test-title-content-separation.sh
```

查看输出：
```
✅ 正常：content不包含title
或
❌ 警告：content包含title
```

如果content包含title，说明问题在文章生成阶段，不是发布阶段。

## 可能的根本原因

### 原因1：数据库中content字段包含标题
如果文章生成时，AI返回的内容本身就包含标题，例如：
```
content = "# 文章标题\n\n这是正文内容..."
```

那么即使我们只使用 `article.content`，也会包含标题。

**验证方法**：
```sql
SELECT title, LEFT(content, 200) as content_preview 
FROM articles 
ORDER BY id DESC 
LIMIT 1;
```

查看content的前200个字符是否包含title。

### 原因2：标题输入框根本没有被找到
如果标题输入框没有被找到，那么标题就没有输入，所有内容都进入了内容编辑器。

**验证方法**：查看日志中是否有 `❌❌❌ 未找到标题输入框！！！`

### 原因3：找到了错误的元素
可能我们找到的"标题输入框"实际上不是标题输入框，而是其他元素。

**验证方法**：在浏览器中手动检查元素

## 下一步行动

### 如果是原因1（content包含title）
需要修改文章生成服务，确保：
1. AI生成的内容不包含标题
2. 或者在保存前从content中移除标题

### 如果是原因2（未找到标题输入框）
需要：
1. 在浏览器中检查实际的HTML结构
2. 更新选择器
3. 可能需要等待更长时间让页面加载

### 如果是原因3（找错了元素）
需要：
1. 添加更多日志，输出找到的元素的HTML
2. 验证元素的placeholder、name等属性
3. 确保找到的是正确的input元素

## 临时解决方案

如果问题在数据库层面（content包含title），可以在发布前处理：

```typescript
// 从content中移除标题
let cleanContent = article.content;
if (cleanContent.startsWith(article.title)) {
  cleanContent = cleanContent.substring(article.title.length).trim();
}
// 或者移除第一行（如果第一行是标题）
cleanContent = cleanContent.split('\n').slice(1).join('\n').trim();
```

## 请用户提供的信息

1. **服务器控制台日志**：特别是带有 `========== 开始输入标题 ==========` 的部分
2. **浏览器截图**：显示标题框和内容框的状态
3. **数据库查询结果**：运行 `./test-title-content-separation.sh` 的输出

有了这些信息，我们就能准确定位问题。
