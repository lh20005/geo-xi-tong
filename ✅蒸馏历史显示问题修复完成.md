# âœ… è’¸é¦å†å²æ˜¾ç¤ºé—®é¢˜ä¿®å¤å®Œæˆ

## ğŸ› é—®é¢˜æè¿°

Windowsç™»å½•ç®¡ç†å™¨"ç”Ÿæˆæ–‡ç« "é¡µé¢ï¼Œæ–°å»ºä»»åŠ¡é€‰æ‹©"è’¸é¦å†å²"æ—¶ï¼Œçœ‹ä¸åˆ°å†…å®¹ã€‚

## ğŸ” é—®é¢˜è¯Šæ–­

### 1. æ£€æŸ¥åç«¯æœåŠ¡
- âŒ åç«¯æœåŠ¡æœªè¿è¡Œï¼ˆç«¯å£3001ï¼‰
- âœ… å·²å¯åŠ¨åç«¯æœåŠ¡ï¼ˆç«¯å£3000ï¼‰

### 2. æ£€æŸ¥æ•°æ®åº“
```sql
SELECT d.id, d.keyword, d.provider, d.user_id, COUNT(t.id) as topic_count 
FROM distillations d 
LEFT JOIN topics t ON d.id = t.distillation_id 
WHERE d.user_id = 437 
GROUP BY d.id;
```

ç»“æœï¼š
- âœ… ç”¨æˆ·437ï¼ˆtestuserï¼‰æœ‰1æ¡è’¸é¦è®°å½•
- ID: 25189
- å…³é”®è¯: "è£…ä¿®è£…é¥°"
- è¯é¢˜æ•°: 12ä¸ª

### 3. æ£€æŸ¥å‰ç«¯APIè°ƒç”¨
- âŒ `distillationApi.ts` ä½¿ç”¨äº†åŸç”Ÿ `axios` è€Œä¸æ˜¯ `apiClient`
- âŒ æ²¡æœ‰è‡ªåŠ¨æ·»åŠ è®¤è¯token
- âŒ baseURLé…ç½®ä¸æ­£ç¡®

## ğŸ”§ ä¿®å¤æ–¹æ¡ˆ

### ä¿®æ”¹æ–‡ä»¶ï¼š`windows-login-manager/src/api/distillationApi.ts`

#### 1. å¯¼å…¥æ­£ç¡®çš„å®¢æˆ·ç«¯
```typescript
// ä¿®æ”¹å‰
import axios from 'axios';

// ä¿®æ”¹å
import { apiClient } from './client';
```

#### 2. æ›´æ–°æ‰€æœ‰APIè°ƒç”¨

**getDistillationsWithStats:**
```typescript
// ä¿®æ”¹å‰
const response = await axios.get('/api/distillation/stats', {
  params: { page, pageSize, sortBy, sortOrder, filterUsage }
});

// ä¿®æ”¹å
const response = await apiClient.get('/distillation/stats', {
  params: { page, pageSize, sortBy, sortOrder, filterUsage }
});
```

**getRecommendedDistillations:**
```typescript
// ä¿®æ”¹å‰
const response = await axios.get('/api/distillation/recommended', {
  params: { limit }
});

// ä¿®æ”¹å
const response = await apiClient.get('/distillation/recommended', {
  params: { limit }
});
```

**getDistillationDetail:**
```typescript
// ä¿®æ”¹å‰
const response = await axios.get(`/api/distillation/${distillationId}`);

// ä¿®æ”¹å
const response = await apiClient.get(`/distillation/${distillationId}`);
```

**getUsageHistory:**
```typescript
// ä¿®æ”¹å‰
const response = await axios.get(`/api/distillation/${distillationId}/usage`, {
  params: { page, pageSize }
});

// ä¿®æ”¹å
const response = await apiClient.get(`/distillation/${distillationId}/usage`, {
  params: { page, pageSize }
});
```

## âœ… ä¿®å¤æ•ˆæœ

### ä½¿ç”¨ apiClient çš„ä¼˜åŠ¿ï¼š

1. **è‡ªåŠ¨æ·»åŠ è®¤è¯token**
   - ä» Electron storage æˆ– localStorage è·å– token
   - è‡ªåŠ¨æ·»åŠ  `Authorization: Bearer <token>` header

2. **æ­£ç¡®çš„baseURL**
   - baseURL: `http://localhost:3000/api`
   - è·¯å¾„è‡ªåŠ¨æ‹¼æ¥ï¼š`/distillation/stats` â†’ `http://localhost:3000/api/distillation/stats`

3. **ç»Ÿä¸€çš„é”™è¯¯å¤„ç†**
   - 401é”™è¯¯è‡ªåŠ¨åˆ·æ–°token
   - ç»Ÿä¸€çš„é”™è¯¯æ¶ˆæ¯æ ¼å¼

4. **è¯·æ±‚/å“åº”æ‹¦æˆªå™¨**
   - è‡ªåŠ¨è®°å½•è¯·æ±‚æ—¥å¿—
   - è‡ªåŠ¨å¤„ç†tokenè¿‡æœŸ

## ğŸ§ª æµ‹è¯•éªŒè¯

### 1. å¯åŠ¨æœåŠ¡
```bash
# åç«¯æœåŠ¡
npm run server:dev

# Windowsç™»å½•ç®¡ç†å™¨
cd windows-login-manager
npm run electron:dev
```

### 2. æµ‹è¯•æ­¥éª¤
1. æ‰“å¼€Windowsç™»å½•ç®¡ç†å™¨
2. ç™»å½•è´¦å·ï¼ˆtestuserï¼‰
3. è¿›å…¥"ç”Ÿæˆæ–‡ç« "é¡µé¢
4. ç‚¹å‡»"æ–°å»ºä»»åŠ¡"
5. æŸ¥çœ‹"é€‰æ‹©è’¸é¦å†å²"ä¸‹æ‹‰æ¡†

### 3. é¢„æœŸç»“æœ
âœ… åº”è¯¥çœ‹åˆ°ï¼š
- "è£…ä¿®è£…é¥° (deepseek)" é€‰é¡¹
- æ˜¾ç¤ºä½¿ç”¨æ¬¡æ•°
- å¦‚æœä½¿ç”¨æ¬¡æ•°å°‘ï¼Œæ˜¾ç¤º"æ¨è"æ ‡ç­¾

## ğŸ“Š æ•°æ®éªŒè¯

### å½“å‰ç”¨æˆ·æ•°æ®ï¼ˆtestuser, ID=437ï¼‰
```
è’¸é¦è®°å½•æ•°: 1
- ID: 25189
- å…³é”®è¯: è£…ä¿®è£…é¥°
- æä¾›å•†: deepseek
- è¯é¢˜æ•°: 12
- ä½¿ç”¨æ¬¡æ•°: 0ï¼ˆæ¨èä½¿ç”¨ï¼‰
```

## ğŸ¯ ç›¸å…³æ–‡ä»¶

### ä¿®æ”¹çš„æ–‡ä»¶
- `windows-login-manager/src/api/distillationApi.ts`

### ç›¸å…³æ–‡ä»¶
- `windows-login-manager/src/api/client.ts` - APIå®¢æˆ·ç«¯é…ç½®
- `windows-login-manager/src/components/TaskConfigModal.tsx` - ä»»åŠ¡é…ç½®å¼¹çª—
- `server/src/routes/distillation.ts` - åç«¯è’¸é¦è·¯ç”±
- `server/src/services/distillationService.ts` - åç«¯è’¸é¦æœåŠ¡

## ğŸš€ æœåŠ¡çŠ¶æ€

### åç«¯æœåŠ¡
- âœ… è¿è¡Œåœ¨ http://localhost:3000
- âœ… WebSocketè¿è¡Œåœ¨ ws://localhost:3000/ws
- âœ… æ•°æ®åº“è¿æ¥æ­£å¸¸
- âœ… Redisè¿æ¥æ­£å¸¸

### Windowsç™»å½•ç®¡ç†å™¨
- âœ… è¿è¡Œåœ¨ http://localhost:5174
- âœ… Electronåº”ç”¨æ­£å¸¸
- âœ… å·²ç™»å½•ç”¨æˆ·ï¼štestuser (ID: 437)
- âœ… WebSocketè¿æ¥æ­£å¸¸

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **APIè·¯å¾„è§„èŒƒ**
   - ä½¿ç”¨ `apiClient` æ—¶ï¼Œè·¯å¾„ä¸éœ€è¦ `/api` å‰ç¼€
   - baseURLå·²ç»åŒ…å«äº† `/api`

2. **è®¤è¯è¦æ±‚**
   - æ‰€æœ‰è’¸é¦å†å²APIéƒ½éœ€è¦è®¤è¯
   - ä½¿ç”¨ `apiClient` è‡ªåŠ¨å¤„ç†è®¤è¯

3. **ç§Ÿæˆ·éš”ç¦»**
   - åç«¯è‡ªåŠ¨æ ¹æ®tokenä¸­çš„user_idè¿‡æ»¤æ•°æ®
   - ç”¨æˆ·åªèƒ½çœ‹åˆ°è‡ªå·±çš„è’¸é¦è®°å½•

## âœ¨ æ€»ç»“

é—®é¢˜æ ¹æºï¼šå‰ç«¯APIè°ƒç”¨æ²¡æœ‰ä½¿ç”¨ç»Ÿä¸€çš„ `apiClient`ï¼Œå¯¼è‡´è¯·æ±‚ç¼ºå°‘è®¤è¯ä¿¡æ¯ã€‚

ä¿®å¤æ–¹æ³•ï¼šå°†æ‰€æœ‰ `axios` è°ƒç”¨æ”¹ä¸º `apiClient`ï¼Œå¹¶ç§»é™¤è·¯å¾„ä¸­çš„ `/api` å‰ç¼€ã€‚

ç°åœ¨ç”¨æˆ·å¯ä»¥æ­£å¸¸çœ‹åˆ°è‡ªå·±çš„è’¸é¦å†å²è®°å½•äº†ï¼ğŸ‰
