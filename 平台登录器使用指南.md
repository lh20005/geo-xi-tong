# 平台登录器使用指南

## 🎯 快速开始

### 1. 启动系统

```bash
# 启动后端服务
./启动GEO系统.command

# 启动Windows登录管理器
./启动Windows管理器.command
```

### 2. 登录平台

1. 打开Windows登录管理器
2. 进入"平台管理"页面
3. 点击要登录的平台卡片
4. 在弹出的浏览器中完成登录
5. 系统自动检测登录成功并保存账号

### 3. 验证结果

- 平台卡片右上角显示 ✓ 标记
- 账号列表中显示新账号
- 真实用户名正确显示

## 📋 支持的平台

### 自媒体平台（5个）
| 平台 | ID | 状态 | 说明 |
|------|-----|------|------|
| 头条号 | toutiao | ✅ 已测试 | 参考标准 |
| 网易号 | wangyi | ✅ 已优化 | 多选择器 |
| 搜狐号 | souhu | ✅ 已优化 | 多选择器 |
| 百家号 | baijiahao | ✅ 已优化 | 多选择器 |
| 企鹅号 | qie | ✅ 已优化 | 多选择器 |

### 社交媒体平台（4个）
| 平台 | ID | 状态 | 说明 |
|------|-----|------|------|
| 抖音 | douyin | ⏭️ 跳过 | 按要求跳过 |
| 小红书 | xiaohongshu | ✅ 已优化 | 需要导航 |
| 微信公众号 | wechat | ✅ 已优化 | 需要导航 |
| B站 | bilibili | ✅ 已优化 | 需要导航 |

### 技术社区平台（8个）
| 平台 | ID | 状态 | 说明 |
|------|-----|------|------|
| 知乎 | zhihu | ✅ 已优化 | 多选择器 |
| 简书 | jianshu | ✅ 已优化 | 多选择器 |
| CSDN | csdn | ✅ 已优化 | 多选择器 |
| 掘金 | juejin | ✅ 已优化 | 多选择器 |
| SegmentFault | segmentfault | ✅ 已优化 | 多选择器 |
| 开源中国 | oschina | ✅ 已优化 | 多选择器 |
| 博客园 | cnblogs | ✅ 已优化 | 多选择器 |
| V2EX | v2ex | ✅ 已优化 | 多选择器 |

**总计：17个平台（除抖音外全部完成）**

## 🧪 测试方法

### 方法1：使用测试脚本

```bash
# 测试网易号
./test-platform-login.sh wangyi

# 测试小红书
./test-platform-login.sh xiaohongshu

# 测试知乎
./test-platform-login.sh zhihu
```

### 方法2：使用界面

1. 打开Windows登录管理器
2. 点击平台卡片
3. 在浏览器中登录
4. 等待自动保存

### 方法3：使用API

```bash
# 获取token
TOKEN="your_auth_token"

# 调用登录API
curl -X POST http://localhost:3000/api/platform-accounts/browser-login \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{"platform": "wangyi"}'
```

## 🔍 查看登录结果

### 查看所有账号

```bash
curl http://localhost:3000/api/platform-accounts \
  -H "Authorization: Bearer $TOKEN" | jq '.'
```

### 查看特定平台账号

```bash
curl "http://localhost:3000/api/platform-accounts?platform=wangyi" \
  -H "Authorization: Bearer $TOKEN" | jq '.'
```

### 在界面中查看

1. 打开Windows登录管理器
2. 进入"平台管理"页面
3. 查看"账号管理"表格

## 🐛 调试技巧

### 1. 查看控制台日志

后端日志会显示详细的登录过程：

```
========================================
[浏览器登录] 开始登录流程
[浏览器登录] 平台: 网易号 (wangyi)
========================================

[等待登录] wangyi 登录成功
[提取用户信息] ✅ 成功提取用户名: "测试用户"
[浏览器登录] 账号保存成功
```

### 2. 检查HTML快照

如果用户名提取失败，系统会保存HTML快照：

```bash
# 查看快照目录
ls -la debug/

# 打开快照文件
open debug/wangyi_1234567890.html
```

在HTML中搜索用户名，找到对应的元素和class名。

### 3. 更新选择器

如果需要更新选择器，编辑 `server/src/services/AccountService.ts`：

```typescript
const selectors: { [key: string]: string[] } = {
  'wangyi': [
    '.user-info .name',      // 添加新的选择器
    '.new-selector',         // 从HTML快照中找到的
    '.user-name',
    '.username'
  ]
};
```

### 4. 调整等待时间

如果页面加载慢，可以增加等待时间：

```typescript
const platformsNeedingNavigation = {
  'wangyi': {
    url: 'https://mp.163.com/',
    waitTime: 5000  // 增加到5秒
  }
};
```

## ⚠️ 常见问题

### Q1: 浏览器没有打开

**原因：** Chrome路径未找到

**解决：**
```bash
# 检查Chrome是否安装
which google-chrome-stable
which chromium

# 如果未安装，安装Chrome
# macOS: brew install --cask google-chrome
# Linux: sudo apt install chromium-browser
```

### Q2: 登录成功但未保存账号

**原因：** 用户名提取失败

**解决：**
1. 查看控制台日志
2. 检查HTML快照
3. 更新选择器配置
4. 重新测试

### Q3: Cookie未保存

**原因：** 登录检测过早

**解决：**
1. 增加等待时间
2. 调整登录检测策略
3. 确保完全登录后再关闭浏览器

### Q4: 用户名显示为空

**原因：** 选择器不匹配

**解决：**
1. 打开HTML快照
2. 搜索用户名
3. 找到正确的选择器
4. 更新配置

## 📊 测试建议

### 测试顺序

1. **第一批：自媒体平台**
   ```bash
   ./test-platform-login.sh toutiao     # 已测试，作为参考
   ./test-platform-login.sh wangyi
   ./test-platform-login.sh souhu
   ./test-platform-login.sh baijiahao
   ./test-platform-login.sh qie
   ```

2. **第二批：社交媒体**
   ```bash
   ./test-platform-login.sh xiaohongshu
   ./test-platform-login.sh wechat
   ./test-platform-login.sh bilibili
   ```

3. **第三批：技术社区**
   ```bash
   ./test-platform-login.sh zhihu
   ./test-platform-login.sh csdn
   ./test-platform-login.sh jianshu
   ./test-platform-login.sh juejin
   ```

### 测试检查清单

每个平台测试时检查：

- [ ] 浏览器正常打开
- [ ] 登录页面正确加载
- [ ] 手动登录成功
- [ ] 系统检测到登录
- [ ] Cookie正确保存
- [ ] 用户名正确提取
- [ ] 账号显示在列表中
- [ ] 真实用户名正确显示

## 🎯 成功标准

一个平台登录成功的标准：

1. ✅ 浏览器自动打开登录页面
2. ✅ 用户手动完成登录
3. ✅ 系统自动检测登录成功
4. ✅ Cookie自动保存到数据库
5. ✅ 用户名自动提取并保存
6. ✅ 账号显示在管理界面
7. ✅ 可以用于文章发布

## 📁 相关文件

```
server/src/services/AccountService.ts    # 核心登录逻辑
windows-login-manager/src/pages/
  PlatformManagementPage.tsx             # 前端界面
test-platform-login.sh                   # 测试脚本
debug/                                   # HTML快照目录
✅平台登录器开发完成.md                   # 详细文档
```

## 🚀 下一步

1. **逐个测试平台**
   - 按照建议顺序测试
   - 记录测试结果
   - 修复发现的问题

2. **优化选择器**
   - 根据实际测试结果
   - 更新选择器配置
   - 提高提取成功率

3. **完善文档**
   - 记录特殊情况
   - 更新使用说明
   - 添加最佳实践

## 💡 提示

- 首次登录可能需要验证码或二次验证
- 某些平台可能需要手机验证
- 建议在测试环境先测试
- 保持浏览器窗口可见，不要最小化
- 等待页面完全加载后再操作

## 🎉 总结

所有平台（除抖音外）的登录器已开发完成，具备：
- ✅ 完整的登录流程
- ✅ 智能的用户名提取
- ✅ 可靠的Cookie保存
- ✅ 强大的调试功能
- ✅ 详细的日志输出

现在可以开始测试各平台的登录功能！
