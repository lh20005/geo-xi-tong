# å•†å“æ¨¡å— Token é—®é¢˜ - å¿«é€Ÿä¿®å¤æŒ‡å—

## ğŸ¯ é—®é¢˜
å•†å“ç®¡ç†é¡µé¢è¿”å› 401 é”™è¯¯ï¼š"è¯·å…ˆç™»å½•"

## ğŸ” å¿«é€Ÿè¯Šæ–­

### æ–¹æ³• 1: ä½¿ç”¨ Token è°ƒè¯•é¡µé¢ï¼ˆæ¨èï¼‰

1. **è®¿é—®è°ƒè¯•é¡µé¢**
   - URL: `http://localhost:5174/products/token-debug`
   - æˆ–åœ¨åº”ç”¨ä¸­å¯¼èˆªåˆ°è¯¥é¡µé¢

2. **ç‚¹å‡»"æ£€æŸ¥ Token"**
   - æŸ¥çœ‹æ˜¯å¦æœ‰ `authToken` å’Œ `refreshToken`
   - å¦‚æœæ²¡æœ‰ï¼Œéœ€è¦é‡æ–°ç™»å½•

3. **ç‚¹å‡»"æµ‹è¯• API"**
   - ç›´æ¥æµ‹è¯•å•†å“ API
   - æŸ¥çœ‹è¿”å›ç»“æœ

### æ–¹æ³• 2: æµè§ˆå™¨ Console

```javascript
// 1. æ£€æŸ¥ token
window.electron.storage.getTokens().then(console.log);

// 2. å¦‚æœæœ‰ tokenï¼Œæµ‹è¯• API
window.electron.storage.getTokens().then(tokens => {
  if (tokens?.authToken) {
    fetch('http://localhost:3000/api/admin/products', {
      headers: {
        'Authorization': `Bearer ${tokens.authToken}`,
        'Content-Type': 'application/json'
      }
    })
    .then(r => r.json())
    .then(console.log);
  }
});
```

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: é‡æ–°ç™»å½•ï¼ˆæœ€ç®€å•ï¼‰

1. é€€å‡ºç™»å½•
2. é‡æ–°ç™»å½•
3. å†æ¬¡è®¿é—®å•†å“ç®¡ç†é¡µé¢

### æ–¹æ¡ˆ 2: ä½¿ç”¨ localStorageï¼ˆä¸´æ—¶ï¼‰

å¦‚æœ Electron storage æœ‰é—®é¢˜ï¼Œå¯ä»¥ä¸´æ—¶ä½¿ç”¨ localStorageï¼š

1. åœ¨ Token è°ƒè¯•é¡µé¢ç‚¹å‡»"å¤åˆ¶åˆ° localStorage"
2. åˆ·æ–°é¡µé¢
3. API å®¢æˆ·ç«¯ä¼šè‡ªåŠ¨é™çº§ä½¿ç”¨ localStorage

### æ–¹æ¡ˆ 3: æ¸…é™¤å¹¶é‡æ–°ç™»å½•

```javascript
// åœ¨ Console ä¸­æ‰§è¡Œ
window.electron.storage.clearTokens().then(() => {
  console.log('Tokens cleared');
  location.reload();
});
```

ç„¶åé‡æ–°ç™»å½•ã€‚

## ğŸ“ éªŒè¯ä¿®å¤

ä¿®å¤åï¼Œåœ¨ Console ä¸­åº”è¯¥çœ‹åˆ°ï¼š

```
[API Client] å¼€å§‹å¤„ç†è¯·æ±‚: /admin/products
[API Client] æ£€æµ‹åˆ° Electron ç¯å¢ƒ
[API Client] è·å–åˆ°çš„ tokens: { authToken: '...', refreshToken: '...' }
[API Client] âœ… å·²æ·»åŠ  Authorization header
[ProductManagement] API å“åº”: { success: true, data: [...] }
```

é¡µé¢åº”è¯¥æ˜¾ç¤º 3 ä¸ªå¥—é¤ã€‚

## ğŸ”§ å¦‚æœé—®é¢˜æŒç»­

1. **æ£€æŸ¥åç«¯æœåŠ¡**
   ```bash
   lsof -i :3000
   ```

2. **æ£€æŸ¥æ•°æ®åº“**
   ```bash
   psql postgresql://lzc@localhost:5432/geo_system -c "SELECT COUNT(*) FROM subscription_plans;"
   ```

3. **æŸ¥çœ‹å®Œæ•´æ—¥å¿—**
   - æµè§ˆå™¨ Console (F12)
   - Network æ ‡ç­¾
   - åç«¯æœåŠ¡å™¨æ—¥å¿—

## ğŸ“ éœ€è¦å¸®åŠ©

å¦‚æœä»¥ä¸Šæ–¹æ³•éƒ½æ— æ•ˆï¼Œè¯·æä¾›ï¼š
1. Token è°ƒè¯•é¡µé¢çš„æˆªå›¾
2. æµè§ˆå™¨ Console çš„å®Œæ•´æ—¥å¿—
3. Network æ ‡ç­¾ä¸­ `/api/admin/products` è¯·æ±‚çš„è¯¦æƒ…

---

**åˆ›å»ºæ—¶é—´**: 2025-12-28  
**è°ƒè¯•é¡µé¢**: http://localhost:5174/products/token-debug
