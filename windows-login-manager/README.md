# Windows平台登录管理器

基于Electron + React + TypeScript的桌面应用，用于管理多个平台的登录账号。包含完整的后端API服务，支持JWT认证和WebSocket实时通信。

## 🎯 项目概述

本项目包含两个主要组件：

1. **Electron桌面应用** - Windows平台登录管理器
2. **后端API服务** - Node.js/Express服务器，提供认证和数据同步

## 功能特性

### 核心功能
- ✅ **多平台支持** - 支持多个社交媒体和内容平台的账号管理
- ✅ **安全登录** - 使用真实浏览器环境进行登录，自动捕获Cookie和用户信息
- ✅ **加密存储** - 使用系统级加密（Electron safeStorage + AES-256）保护敏感数据
- ✅ **实时同步** - WebSocket实时数据同步，账号变更即时通知
- ✅ **JWT认证** - 安全的令牌认证系统
- ✅ **离线支持** - 离线时自动缓存操作，网络恢复后自动同步
- ✅ **自动更新** - 支持应用自动更新

### 后端API功能
- 🔐 **JWT认证** - 登录、刷新令牌、登出、验证
- 📦 **账号管理** - 完整的CRUD操作
- 🔌 **WebSocket** - 实时事件广播和通知
- 💓 **心跳检测** - 自动维持连接
- 🔄 **自动重连** - 网络中断后自动恢复
- 👥 **用户管理同步** - 实时同步用户信息变更（新增）

### 安全特性
- 🔒 Context Isolation - 渲染进程隔离
- 🔒 Sandbox Mode - 沙箱模式
- 🔒 Content Security Policy - 内容安全策略
- 🔒 HTTPS Only - 强制HTTPS通信
- 🔒 SSL Certificate Validation - SSL证书验证
- 🔒 Input Validation - 输入验证
- 🔒 JWT Token Security - 令牌安全

### 用户体验
- 🎨 现代化UI设计
- 🌓 支持亮色/暗色主题
- 📊 实时同步状态显示
- 📝 完整的日志记录
- 🔄 崩溃自动恢复

## 技术栈

### Electron应用
- **Electron 28** - 跨平台桌面应用框架
- **React 18** - UI框架
- **TypeScript 5** - 类型安全
- **Vite 5** - 构建工具
- **Axios** - HTTP客户端
- **electron-log** - 日志系统
- **electron-updater** - 自动更新

### 后端服务
- **Node.js** - 运行时环境
- **Express** - Web框架
- **PostgreSQL** - 数据库
- **jsonwebtoken** - JWT认证
- **ws** - WebSocket服务器
- **TypeScript** - 类型安全

## 系统要求

- Windows 10/11 (64-bit)
- Node.js 18+
- PostgreSQL 12+
- 至少 4GB RAM
- 至少 500MB 可用磁盘空间
- 网络连接（用于同步和更新）

## 快速开始

查看 [快速开始指南](QUICK_START.md) 了解如何在5分钟内启动完整系统。

## 安装说明

### 开发环境安装

1. **克隆仓库**
```bash
git clone <repository-url>
cd windows-login-manager
```

2. **安装依赖**
```bash
npm install
```

3. **配置环境变量**
创建 `.env` 文件：
```env
VITE_API_BASE_URL=http://localhost:3000
```

4. **启动开发服务器**
```bash
npm run electron:dev
```

### 生产环境构建

1. **准备应用图标**
将图标文件放置在 `build/` 目录：
- Windows: `icon.ico` (256x256或更大)

2. **构建Windows安装包**
```bash
npm run build:win
```

3. **安装包位置**
构建完成后，安装包位于 `release/` 目录。

## 使用指南

### 首次使用

1. **启动应用**
   - 双击桌面快捷方式或从开始菜单启动

2. **配置后端服务器**
   - 点击左侧导航栏的"设置"
   - 输入后端服务器地址
   - 点击"保存设置"

3. **添加账号**
   - 点击"平台登录"
   - 选择要登录的平台
   - 在弹出的浏览器窗口中完成登录
   - 登录成功后，账号信息会自动保存

### 管理账号

1. **查看账号列表**
   - 点击"账号管理"查看所有已保存的账号
   - 显示平台名称、用户名、登录状态等信息

2. **设置默认账号**
   - 在账号卡片上点击"设为默认"按钮
   - 默认账号会在相关操作中优先使用

3. **删除账号**
   - 在账号卡片上点击"删除"按钮
   - 确认后账号将从本地和服务器删除

4. **刷新账号**
   - 点击"刷新"按钮重新登录账号
   - 更新Cookie和用户信息

### 查看日志

1. **应用内查看**
   - 点击"设置" → "日志管理"
   - 选择日志文件查看内容

2. **打开日志文件夹**
   - 菜单栏：帮助 → 查看日志
   - 或在设置页面点击"打开日志文件夹"

### 数据管理

1. **清除缓存**
   - 设置 → 数据管理 → 清除缓存
   - 清除本地缓存数据（不影响服务器数据）

2. **导出日志**
   - 设置 → 日志管理 → 导出日志
   - 选择导出位置

## 开发指南

### 项目结构

```
windows-login-manager/
├── electron/                 # Electron主进程
│   ├── main.ts              # 应用入口
│   ├── preload.ts           # 预加载脚本
│   ├── api/                 # API客户端
│   ├── storage/             # 存储管理
│   ├── sync/                # 同步服务
│   ├── login/               # 登录管理
│   ├── ipc/                 # IPC通信
│   ├── error/               # 错误处理
│   ├── logger/              # 日志系统
│   ├── crash/               # 崩溃恢复
│   ├── security/            # 安全功能
│   └── updater/             # 自动更新
├── src/                     # React渲染进程
│   ├── components/          # UI组件
│   ├── pages/               # 页面
│   ├── context/             # 状态管理
│   ├── services/            # 服务层
│   ├── hooks/               # 自定义Hooks
│   └── types/               # 类型定义
├── build/                   # 构建资源
└── dist/                    # 构建输出
```

### 添加新平台支持

1. 在后端服务器的平台配置中添加新平台
2. 配置登录URL和用户信息提取选择器
3. 应用会自动识别新平台

### 调试技巧

1. **开发者工具**
   - 开发模式下自动打开
   - 生产模式：菜单栏 → 视图 → 开发者工具

2. **日志调试**
   - 查看 `userData/logs/` 目录下的日志文件
   - 使用 `logger.debug()` 添加调试信息

3. **IPC通信调试**
   - 在preload.ts中添加日志
   - 在handler.ts中添加日志

### 代码规范

- 使用ESLint进行代码检查
- 使用Prettier进行代码格式化
- 遵循TypeScript严格模式

```bash
# 检查代码
npm run lint

# 自动修复
npm run lint:fix

# 格式化代码
npm run format

# 类型检查
npm run type-check
```

## 常见问题

### 登录失败

**问题**: 点击平台后无法打开登录窗口
**解决**: 
- 检查网络连接
- 查看日志文件中的错误信息
- 确认平台URL配置正确

### 同步失败

**问题**: 账号无法同步到服务器
**解决**:
- 检查后端服务器地址配置
- 确认网络连接正常
- 查看日志中的错误信息
- 离线操作会自动缓存，网络恢复后重试

### 应用崩溃

**问题**: 应用意外关闭
**解决**:
- 重新启动应用（会自动恢复状态）
- 查看崩溃日志
- 如果持续崩溃，尝试清除缓存

### 更新失败

**问题**: 自动更新失败
**解决**:
- 检查网络连接
- 手动下载最新版本安装
- 查看更新日志

## 故障排除

### 收集诊断信息

1. **导出日志**
   - 设置 → 日志管理 → 导出日志

2. **查看应用信息**
   - 设置 → 关于 → 查看版本信息

3. **检查网络连接**
   - 设置 → 同步状态 → 测试连接

### 重置应用

如果遇到严重问题，可以尝试重置应用：

1. 备份重要数据
2. 卸载应用
3. 删除用户数据目录：
   - Windows: `%APPDATA%/platform-login-manager`
4. 重新安装应用

## 安全建议

1. **定期更新** - 及时安装应用更新
2. **安全网络** - 避免在公共WiFi下使用
3. **定期备份** - 定期导出账号数据
4. **强密码** - 使用强密码保护账号
5. **谨慎授权** - 不要在不信任的设备上登录

## 许可证

MIT License

## 支持

如有问题或建议，请联系：
- Email: support@yourcompany.com
- GitHub Issues: <repository-url>/issues

## 更新日志

### v1.0.0 (2024-12-21)
- 🎉 首次发布
- ✅ 完整的登录管理功能
- ✅ 安全的数据存储
- ✅ 数据同步支持
- ✅ 自动更新功能
- ✅ 崩溃恢复机制
