# è¿ç§»æ–‡ä»¶å½’æ¡£

## è¯´æ˜

æ­¤ç›®å½•åŒ…å«å·²å½’æ¡£çš„è¿ç§»æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶ç”±äºä»¥ä¸‹åŸå› è¢«ç§»åˆ°å½’æ¡£ï¼š

1. **ç‰ˆæœ¬å·é‡å¤** - å¤šä¸ªæ–‡ä»¶ä½¿ç”¨ç›¸åŒçš„ç‰ˆæœ¬å·
2. **æ— ç‰ˆæœ¬å·** - æ–‡ä»¶åæ²¡æœ‰éµå¾ªç‰ˆæœ¬å·è§„èŒƒ
3. **Rollback æ–‡ä»¶** - å›æ»šè„šæœ¬åº”è¯¥åœ¨è¿ç§»æ–‡ä»¶çš„ DOWN éƒ¨åˆ†
4. **å·²åˆå¹¶** - åŠŸèƒ½å·²åˆå¹¶åˆ°ä¸»è¿ç§»æ–‡ä»¶ä¸­

## å½’æ¡£æ—¶é—´

2025-12-27

## å½’æ¡£çš„æ–‡ä»¶

### Rollback æ–‡ä»¶ï¼ˆ3ä¸ªï¼‰
- `002_rollback_usage_tracking.sql`
- `003_rollback_smart_selection.sql`
- `rollback_001.sql`

### æ— ç‰ˆæœ¬å·æ–‡ä»¶ï¼ˆ8ä¸ªï¼‰
- `add_article_generation.sql`
- `add_article_indexes.sql`
- `add_conversion_target_to_tasks.sql`
- `add_conversion_targets.sql`
- `add_distillation_config.sql`
- `add_publication_status.sql`
- `add_topic_usage_tracking.sql`
- `create_users_table.sql`

### é‡å¤ç‰ˆæœ¬å·æ–‡ä»¶ï¼ˆ19ä¸ªï¼‰
- `001_add_ollama_support.sql`
- `001_create_security_tables.sql`
- `001_create_subscription_tables.sql`
- `002_add_upgrade_downgrade_support.sql`
- `002_add_usage_tracking.sql`
- `002_create_permission_tables.sql`
- `003_add_smart_selection.sql`
- `003_create_admin_logs.sql`
- `004_add_manual_distillation_support.sql`
- `004_create_security_alerts.sql`
- `005_fix_articles_distillation_fk.sql`
- `006_add_publishing_system.sql`
- `007_add_publishing_records.sql`
- `007_add_timeout_status.sql`
- `008_add_real_username.sql`
- `008_fix_publishing_records_cascade.sql`
- `009_add_platform_selectors.sql`
- `010_fix_platform_login_detection.sql`
- `011_fix_audit_logs_admin_id.sql`

**æ€»è®¡ï¼š30 ä¸ªæ–‡ä»¶**

## å½“å‰æœ‰æ•ˆçš„è¿ç§»æ–‡ä»¶

åªä¿ç•™ä»¥ä¸‹ 3 ä¸ªè¿ç§»æ–‡ä»¶ï¼š

1. `001_initial_schema.sql` - åˆå§‹æ•°æ®åº“ç»“æ„ï¼ˆå ä½ç¬¦ï¼‰
2. `002_add_missing_columns.sql` - æ·»åŠ ç¼ºå¤±çš„åˆ—ï¼ˆ2025-12-27ï¼‰
3. `012_add_publishing_status_column.sql` - æ·»åŠ å‘å¸ƒçŠ¶æ€åˆ—ï¼ˆ2025-12-27ï¼‰

## ä¸ºä»€ä¹ˆè¦å½’æ¡£ï¼Ÿ

### é—®é¢˜

1. **ç‰ˆæœ¬å·æ··ä¹±** - å¤šä¸ªæ–‡ä»¶ä½¿ç”¨ç›¸åŒçš„ç‰ˆæœ¬å·ï¼ˆ001, 002, 003 ç­‰ï¼‰
2. **æ— æ³•è¿½è¸ª** - ä¸æ¸…æ¥šå“ªäº›è¿ç§»å·²æ‰§è¡Œï¼Œå“ªäº›æœªæ‰§è¡Œ
3. **è¿ç§»ç³»ç»Ÿå¤±æ•ˆ** - ç‰ˆæœ¬å·é‡å¤å¯¼è‡´è¿ç§»ç³»ç»Ÿæ— æ³•æ­£å¸¸å·¥ä½œ
4. **ç»´æŠ¤å›°éš¾** - 30+ ä¸ªæ–‡ä»¶éš¾ä»¥ç®¡ç†

### è§£å†³æ–¹æ¡ˆ

1. **æ¸…ç†å½’æ¡£** - å°†æ—§æ–‡ä»¶ç§»åˆ° archive ç›®å½•
2. **é‡æ–°å¼€å§‹** - ä» 001 å¼€å§‹ï¼Œåªä¿ç•™å¿…è¦çš„è¿ç§»
3. **ç»Ÿä¸€è§„èŒƒ** - æ‰€æœ‰æ–°è¿ç§»å¿…é¡»éµå¾ªç‰ˆæœ¬å·è§„èŒƒ
4. **æ–‡æ¡£è®°å½•** - è®°å½•å½’æ¡£åŸå› å’Œæ—¶é—´

## æ•°æ®åº“å½“å‰çŠ¶æ€

ç”Ÿäº§æ•°æ®åº“å·²åŒ…å«æ‰€æœ‰å¿…è¦çš„è¡¨å’Œå­—æ®µï¼ŒåŒ…æ‹¬ï¼š

- âœ… 40 ä¸ªè¡¨
- âœ… æ‰€æœ‰å¿…éœ€çš„åˆ—
- âœ… æ‰€æœ‰ç´¢å¼•å’Œå¤–é”®
- âœ… å‘å¸ƒç³»ç»Ÿç›¸å…³è¡¨
- âœ… å®‰å…¨ç³»ç»Ÿç›¸å…³è¡¨
- âœ… è®¢é˜…ç³»ç»Ÿç›¸å…³è¡¨

## å¦‚æœéœ€è¦æ¢å¤

å¦‚æœéœ€è¦æŸ¥çœ‹å½’æ¡£æ–‡ä»¶çš„å†…å®¹ï¼š

```bash
# æŸ¥çœ‹å½’æ¡£æ–‡ä»¶åˆ—è¡¨
ls -la server/src/db/migrations/archive/

# æŸ¥çœ‹ç‰¹å®šæ–‡ä»¶
cat server/src/db/migrations/archive/001_add_ollama_support.sql
```

**æ³¨æ„ï¼š** ä¸è¦ç›´æ¥æ‰§è¡Œå½’æ¡£æ–‡ä»¶ï¼Œå®ƒä»¬å¯èƒ½ä¸å½“å‰æ•°æ®åº“çŠ¶æ€ä¸å…¼å®¹ã€‚

## æœªæ¥è¿ç§»è§„èŒƒ

æ‰€æœ‰æ–°è¿ç§»å¿…é¡»éµå¾ªä»¥ä¸‹è§„èŒƒï¼š

1. **ç‰ˆæœ¬å·** - ä½¿ç”¨é€’å¢çš„ä¸‰ä½æ•°ç‰ˆæœ¬å·ï¼ˆ001, 002, 003...ï¼‰
2. **å‘½å** - `{ç‰ˆæœ¬å·}_{æè¿°}.sql`
3. **å†…å®¹** - å¿…é¡»åŒ…å« UP å’Œ DOWN ä¸¤éƒ¨åˆ†
4. **å¹‚ç­‰æ€§** - ä½¿ç”¨ IF EXISTS / IF NOT EXISTS
5. **æµ‹è¯•** - åœ¨æœ¬åœ°æµ‹è¯•åå†éƒ¨ç½²åˆ°ç”Ÿäº§

## ç›¸å…³æ–‡æ¡£

- ğŸ“– [æ•°æ®åº“è¿ç§»æŒ‡å—](../../../../docs/03-éƒ¨ç½²æŒ‡å—/DATABASE_MIGRATION_GUIDE.md)
- ğŸ“– [è¿ç§»ç³»ç»Ÿæ€»ç»“](../../../../docs/03-éƒ¨ç½²æŒ‡å—/MIGRATION_SYSTEM_SUMMARY.md)
- ğŸ“– [è¿ç§»æ¸…ç†æŒ‡å—](../../../../docs/03-éƒ¨ç½²æŒ‡å—/MIGRATION_CLEANUP_GUIDE.md)

---

**å½’æ¡£æ—¶é—´**: 2025-12-27  
**å½’æ¡£äºº**: Kiro AI Assistant  
**åŸå› **: ç‰ˆæœ¬å·æ··ä¹±ï¼Œé‡æ–°æ•´ç†è¿ç§»ç³»ç»Ÿ
