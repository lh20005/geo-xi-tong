# 个人中心空白页问题解决方案

## 问题原因

前端配置文件 `client/.env` 中的 API 地址指向了无法访问的远程服务器 `43.143.163.6`，导致：
1. 所有 API 请求失败
2. WebSocket 连接失败
3. 页面无法加载数据，显示空白

## 已执行的修复

### 1. 修改前端环境变量配置

**文件**: `client/.env`

**修改前**:
```
VITE_API_URL=http://43.143.163.6
VITE_WS_URL=ws://43.143.163.6/ws
VITE_LANDING_URL=http://43.143.163.6
```

**修改后**:
```
VITE_API_URL=http://localhost:3000
VITE_WS_URL=ws://localhost:3000/ws
VITE_LANDING_URL=http://localhost:8080
```

### 2. 添加调试日志

在 `UserCenterPage.tsx` 中添加了更详细的调试日志，帮助排查问题：
- 显示 API_BASE_URL
- 显示 Token 是否存在
- 添加错误状态追踪

## 需要执行的操作

### 重启前端开发服务器

由于 Vite 的环境变量在启动时加载，需要重启前端服务器：

```bash
# 方法1: 如果使用 npm run dev:all
# 停止当前进程 (Ctrl+C)，然后重新运行
npm run dev:all

# 方法2: 如果单独运行前端
# 停止当前进程 (Ctrl+C)，然后重新运行
npm run client:dev

# 方法3: 使用 kill 命令重启
kill -9 2879 74245  # 杀掉当前前端进程
npm run client:dev  # 重新启动
```

### 验证修复

重启后，访问 http://localhost:5173/user-center，应该能看到：

1. **浏览器控制台日志**:
   ```
   [UserCenter] 组件已挂载
   [UserCenter] API_BASE_URL: http://localhost:3000/api
   [UserCenter] Token存在: true
   ```

2. **页面正常显示**:
   - 订阅管理标签页
   - 订单记录标签页
   - 个人信息标签页
   - 邀请系统标签页

3. **网络请求成功**:
   - GET /api/subscription/current
   - GET /api/subscription/usage-stats
   - GET /api/orders
   - GET /api/subscription/plans
   - GET /api/users/profile
   - GET /api/invitations/stats

## 如果问题仍然存在

### 检查步骤

1. **确认后端运行正常**:
   ```bash
   curl http://localhost:3000/api/health
   # 应该返回: {"status":"ok","message":"GEO优化系统运行正常（多租户模式）"}
   ```

2. **确认前端配置已更新**:
   ```bash
   cat client/.env
   # 应该显示 localhost 地址
   ```

3. **清除浏览器缓存**:
   - 打开开发者工具 (F12)
   - 右键点击刷新按钮
   - 选择"清空缓存并硬性重新加载"

4. **检查浏览器控制台错误**:
   - 打开开发者工具 (F12)
   - 查看 Console 标签页
   - 查看 Network 标签页，检查失败的请求

5. **检查认证 Token**:
   ```javascript
   // 在浏览器控制台执行
   console.log('Token:', localStorage.getItem('auth_token'));
   console.log('User Info:', localStorage.getItem('user_info'));
   ```

### 如果 Token 无效

如果发现 Token 无效或不存在，需要重新登录：

1. 访问 http://localhost:5173/login
2. 使用有效的用户名和密码登录
3. 登录成功后再访问个人中心

## 技术说明

### Vite 环境变量机制

- Vite 在启动时读取 `.env` 文件
- 只有以 `VITE_` 开头的变量会暴露给客户端代码
- 修改 `.env` 后必须重启开发服务器才能生效
- 环境变量通过 `import.meta.env.VITE_*` 访问

### API 配置流程

1. `.env` 文件定义 `VITE_API_URL`
2. `client/src/config/env.ts` 读取并处理
3. 导出 `API_BASE_URL` 常量
4. 各页面组件使用 `API_BASE_URL` 发起请求

## 预防措施

### 开发环境配置

建议创建 `client/.env.local` 用于本地开发（该文件不会被提交到 Git）：

```bash
# client/.env.local
VITE_API_URL=http://localhost:3000
VITE_WS_URL=ws://localhost:3000/ws
VITE_LANDING_URL=http://localhost:8080
```

### 生产环境配置

`client/.env` 保留生产环境配置：

```bash
# client/.env
VITE_API_URL=http://43.143.163.6
VITE_WS_URL=ws://43.143.163.6/ws
VITE_LANDING_URL=http://43.143.163.6
```

Vite 会优先使用 `.env.local`，这样可以避免每次切换环境时修改配置。

## 总结

问题的根本原因是前端尝试连接无法访问的远程服务器。通过修改环境变量配置为本地地址并重启前端服务器即可解决。
