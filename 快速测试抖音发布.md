# 快速测试抖音发布

## 前提条件

✅ 已保存抖音账号（ID: 10）
✅ 已修改抖音适配器代码
✅ 有测试文章（包含标题、正文、图片）

## 测试步骤

### 1. 重启服务器

```bash
cd server
npm start
```

**注意**：虽然编译有测试文件错误，但不影响主要功能。服务器可以正常启动。

### 2. 准备测试文章

确保文章包含：
- ✅ 标题（10-30字）
- ✅ 正文（100-2000字）
- ✅ 至少1张图片

### 3. 创建发布任务

1. 打开前端：http://localhost:5173
2. 进入"发布任务"页面
3. 点击"创建发布任务"
4. 选择"抖音"平台
5. 选择账号"抖音号_1765967876508"
6. 选择测试文章
7. 点击"创建任务"

### 4. 执行发布

1. 在任务列表中找到新任务
2. 点击"执行"按钮
3. **观察浏览器自动操作**：
   - 打开抖音创作者中心
   - 悬停"高清发布"按钮
   - 点击"发布图文"
   - 上传图片
   - 填写标题
   - 填写描述
   - 添加话题
   - 添加自主声明
   - 点击发布

### 5. 查看日志

打开终端，查看服务器日志：

```bash
# 实时查看日志
tail -f server/logs/app.log

# 或者查看最近的日志
tail -100 server/logs/app.log | grep "抖音"
```

**预期日志**：
```
[抖音号] 开始发布流程
[抖音号] 第1步：点击高清发布按钮
[抖音号] ✅ 高清发布按钮已悬停
[抖音号] 点击发布图文按钮
[抖音号] ✅ 已点击发布图文按钮
[抖音号] 第2步：点击上传图文按钮
[抖音号] 找到图片: xxx.jpg
[抖音号] 共有 X 张图片需要上传
[抖音号] ✅ 已上传 X 张图片
[抖音号] 第3步：填写标题
[抖音号] ✅ 标题已填写
[抖音号] 第4步：填写描述
[抖音号] ✅ 描述已填写
[抖音号] 第5步：添加话题
[抖音号] ✅ 话题已添加
[抖音号] 第6步：添加自主声明
[抖音号] ✅ 自主声明已添加
[抖音号] 第7步：点击发布按钮
✅ 抖音号文章发布成功
```

### 6. 验证结果

1. 登录抖音创作者中心：https://creator.douyin.com/
2. 进入"内容管理"
3. 查看是否有新发布的图文
4. 检查：
   - ✅ 标题是否正确
   - ✅ 描述是否正确
   - ✅ 图片是否上传
   - ✅ 话题是否添加
   - ✅ 自主声明是否添加

## 调试技巧

### 如果发布失败

1. **查看错误日志**
   ```bash
   grep "ERROR\|❌" server/logs/app.log | tail -20
   ```

2. **检查选择器是否有效**
   - 打开抖音创作者中心
   - 按F12打开开发者工具
   - 手动测试每个选择器

3. **增加等待时间**
   如果操作太快，可以在代码中增加等待时间：
   ```typescript
   await new Promise(resolve => setTimeout(resolve, 3000)); // 增加到3秒
   ```

4. **截图调试**
   在关键步骤添加截图：
   ```typescript
   await page.screenshot({ path: `douyin-step-${stepNumber}.png` });
   ```

### 常见错误

#### 错误1：找不到"高清发布"按钮

**原因**：页面还没加载完成

**解决**：增加等待时间
```typescript
await page.waitForSelector(hdPublishButton, { timeout: 15000 }); // 增加到15秒
```

#### 错误2：下拉菜单消失

**原因**：鼠标移开了按钮

**解决**：确保悬停时间足够
```typescript
await page.hover(hdPublishButton);
await new Promise(resolve => setTimeout(resolve, 2000)); // 增加到2秒
```

#### 错误3：图片上传失败

**原因**：图片路径不正确

**解决**：检查图片路径
```bash
# 查看图片是否存在
ls -la uploads/
```

#### 错误4：选择器失效

**原因**：抖音页面更新

**解决**：
1. 打开抖音创作者中心
2. 按F12，使用Elements标签
3. 找到对应元素
4. 复制新的选择器
5. 更新代码

## 测试检查清单

- [ ] 服务器已重启
- [ ] 抖音账号已保存
- [ ] 测试文章已准备（包含图片）
- [ ] 发布任务已创建
- [ ] 浏览器自动打开
- [ ] 高清发布按钮已点击
- [ ] 发布图文按钮已点击
- [ ] 图片已上传
- [ ] 标题已填写
- [ ] 描述已填写
- [ ] 话题已添加
- [ ] 自主声明已添加
- [ ] 发布按钮已点击
- [ ] 抖音后台有新内容

## 下一步

如果测试成功：
- ✅ 抖音自动发布功能完成
- ✅ 可以批量发布文章到抖音

如果测试失败：
- 查看错误日志
- 检查选择器
- 调整等待时间
- 联系开发者

---

**创建时间**：2025-12-17
**状态**：等待测试
