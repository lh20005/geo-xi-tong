# GEO 系统技术交底文档

## 1. 项目概述
本系统是一个集成了多平台内容发布、SEO 优化、AI 文章生成和数据监控的综合性 GEO（Generative Engine Optimization）优化系统。系统由桌面客户端（Electron）、Web 管理端、落地页和后端服务组成。

## 2. 技术架构

### 2.1 后端服务 (`server/`)
*   **运行环境**: Node.js (TypeScript)
*   **Web 框架**: Express.js
*   **数据库**:
    *   **PostgreSQL**: 主要业务数据存储 (驱动: `pg`)
    *   **Redis**: 缓存和会话管理 (驱动: `ioredis`)
*   **自动化/爬虫**: Playwright (用于自动化操作和抓取)
*   **身份验证**: JWT (JSON Web Token), Bcrypt (密码哈希)
*   **任务调度**: node-cron
*   **支付集成**: 微信支付 (wechatpay-axios-plugin)
*   **文档处理**: mammoth (Word), pdf-parse (PDF)
*   **主要命令**:
    *   开发: `npm run dev`
    *   构建: `npm run build`
    *   数据库迁移: `npm run db:migrate`

### 2.2 桌面客户端 (`windows-login-manager/`)
*   **核心框架**: Electron 28
*   **前端框架**: React 18 + Vite 5
*   **UI 组件库**: Ant Design 5 + TailwindCSS
*   **状态管理**: Zustand
*   **构建工具**: Electron Builder
*   **自动更新**: electron-updater
*   **本地存储**: electron-store, SQLite
*   **自动化**: Playwright (用于模拟用户登录各大平台)
*   **主要命令**:
    *   开发: `npm run electron:dev`
    *   打包 Windows: `npm run build:win`
    *   打包 macOS: `npm run build:mac`

### 2.3 Web 前端 (`client/`)
*   **框架**: React 18 + Vite 5 + TypeScript
*   **UI**: Ant Design 5 + TailwindCSS
*   **图表**: ECharts
*   **富文本编辑器**: React Quill
*   **主要命令**: `npm run dev`, `npm run build`

### 2.4 落地页 (`landing/`)
*   **框架**: React 18 + Vite + TypeScript + TailwindCSS
*   **用途**: 产品展示和营销页面
*   **部署位置**: 服务器 `/var/www/geo-system/landing/`

## 3. 核心功能模块

1.  **多平台账号管理**: 支持抖音、头条、百家号、知乎、小红书等平台的 Cookie 获取与管理（通过 Electron 客户端实现）。
2.  **GEO 优化与文章生成**: 集成 AI 能力，根据关键词生成优化后的文章。
3.  **内容分发**: 一键发布内容到绑定的多个平台。
4.  **数据监控**: 实时抓取并展示各平台的阅读量、转化率等数据。
5.  **用户体系**: 包含注册登录、会员订阅、支付流程、权限控制。
6.  **代理商系统**: 佣金计算、折扣管理。

## 4. 目录结构说明

```
/
├── client/                 # Web 端前端代码
├── server/                 # Node.js 后端服务
│   ├── src/
│   │   ├── db/             # 数据库迁移脚本
│   │   ├── middleware/     # Express 中间件
│   │   ├── scripts/        # 运维脚本
│   │   └── ...
│   └── ...
├── windows-login-manager/  # Electron 桌面端代码
│   ├── electron/           # Electron 主进程代码
│   ├── src/                # Electron 渲染进程代码 (React)
│   └── scripts/            # 打包脚本
├── landing/                # 营销落地页代码
├── config/                 # Nginx 和部署配置
├── docs/                   # 详细开发文档
└── dev-docs/               # 开发过程记录
```

## 5. 部署与发布

### 5.1 服务器部署
**服务器信息**:
*   IP: 124.221.247.107
*   User: ubuntu
*   项目路径: `/var/www/geo-system`
*   进程管理: PM2 (进程名: `geo-server`)

**目录对应关系 (重要)**:
*   本地 `server/dist/` -> 服务器 `/var/www/geo-system/server/`
    *   **注意**: 不要直接上传整个 dist 目录覆盖 server 目录，应将 dist 下的内容上传到 server 根目录。
    *   例如: 本地 `server/dist/services/` -> 服务器 `/var/www/geo-system/server/services/`
*   本地 `client/dist/` -> 服务器 `/var/www/geo-system/client/dist/`
*   本地 `landing/dist/` -> 服务器 `/var/www/geo-system/landing/` (需包含 assets)

**更新流程**:
1.  本地编译: `npm run build`
2.  上传文件: 使用 scp 或 SSH 工具上传编译后的文件。
3.  重启服务: `pm2 restart geo-server`

### 5.2 桌面端发布
**版本规则**: 遵循语义化版本 (Major.Minor.Patch)。
**打包命令**:
```bash
cd windows-login-manager
npm run build:all  # 同时打包 Windows 和 macOS
```
**发布流程**:
1.  修改 `package.json` 版本号。
2.  更新 `CHANGELOG.md`。
3.  执行打包命令。
4.  将 `release/` 目录下的 `.exe`, `.dmg`, `.zip`, `.yml` 文件上传到腾讯云 COS 的 `/releases/` 目录。
5.  更新 `latest/` 目录下的固定链接文件 (由 Kiro 自动处理或手动重命名上传)。

**macOS 注意事项**:
*   由于未签名，macOS 自动更新只能下载 `.zip` 包，无法自动安装。用户需手动下载 `.dmg` 安装。
*   必须同时提供 Intel (x64) 和 Apple Silicon (arm64) 架构的包。

## 6. 环境搭建 (本地开发)

1.  **依赖安装**:
    *   Node.js >= 18
    *   PostgreSQL
    *   Redis
2.  **配置环境变量**:
    *   复制各目录下的 `.env.example` 为 `.env` 并填入必要配置 (数据库连接、密钥等)。
3.  **数据库初始化**:
    *   创建 PostgreSQL 数据库 `geo_system`。
    *   进入 `server` 目录运行 `npm run db:migrate`。

## 7. 常用资源与文档
*   **API 文档**: `server/docs/`
*   **部署指南**: `docs/03-部署指南/`
*   **打包规范**: `.trae/rules/dabao.md`
*   **数据库迁移指南**: `server/src/db/README.md`
