# 发布任务模块使用指南

## 功能概述

发布任务模块位于左侧边栏"平台登录"下方，提供了一个完整的文章发布工作流，包括：

1. **文章选择** - 显示所有草稿状态的文章供用户选择
2. **平台选择** - 以小卡片形式展示已登录的发布平台
3. **任务管理** - 显示任务运行状态和发布历史

## 页面结构

### 1. 统计卡片区域
显示四个关键指标：
- **草稿文章** - 当前可发布的草稿文章数量
- **已配置平台** - 已成功登录的平台数量
- **运行中任务** - 正在执行或等待执行的任务数
- **今日已发布** - 今天成功发布的文章数量

### 2. 文章选择区
- 以表格形式展示所有草稿状态的文章
- 支持单选和全选
- 显示文章ID、关键词、蒸馏结果、创建时间
- 已选文章数量实时显示在标题栏

### 3. 平台选择区
- 以小卡片形式展示已登录的平台账号
- 每个卡片显示：
  - 平台图标（首字母）
  - 平台名称
  - 账号名称
- 点击卡片进行选择/取消选择
- 选中的卡片会有绿色边框和对勾标识
- 已选平台数量实时显示在标题栏

### 4. 发布配置区（选择后显示）
当选择了文章和平台后，会显示紫色渐变的配置卡片：
- 显示已选文章数、平台数和将创建的任务数
- 可选择定时发布时间（不选则立即执行）
- 点击"创建发布任务"按钮批量创建任务

### 5. 任务列表区
- 显示所有发布任务的状态
- 任务状态包括：
  - **等待中** - 灰色标签，等待执行
  - **执行中** - 蓝色标签，正在发布
  - **成功** - 绿色标签，发布成功
  - **失败** - 红色标签，发布失败
- 支持的操作：
  - **查看日志** - 查看任务执行的详细日志
  - **立即执行** - 对等待中的任务立即执行
  - **取消任务** - 取消等待中的任务
- 支持分页、排序和筛选

## 使用流程

### 基本发布流程

1. **选择文章**
   - 在"选择文章"区域勾选要发布的文章
   - 可以单选或全选
   - 已选文章会在标题显示数量

2. **选择平台**
   - 在"选择发布平台"区域点击要发布的平台卡片
   - 可以选择多个平台
   - 选中的平台会显示绿色边框和对勾

3. **配置发布**
   - 查看将创建的任务数量（文章数 × 平台数）
   - 可选：设置定时发布时间
   - 点击"创建发布任务"按钮

4. **确认创建**
   - 系统会弹出确认对话框
   - 确认后批量创建发布任务
   - 任务会出现在下方的任务列表中

5. **监控任务**
   - 在任务列表中查看任务状态
   - 点击"日志"按钮查看详细执行日志
   - 对失败的任务可以重新执行

### 定时发布

1. 选择文章和平台后
2. 在配置区点击日期选择器
3. 选择未来的日期和时间
4. 创建任务后，任务会在指定时间自动执行

### 立即执行

1. 对于等待中的任务
2. 点击"执行"按钮
3. 确认后任务会立即开始执行

### 查看日志

1. 点击任务行的"日志"按钮
2. 弹出日志查看窗口
3. 日志按时间顺序显示，包含：
   - 日志级别（INFO/WARNING/ERROR）
   - 时间戳
   - 日志消息
   - 详细信息（JSON格式）

## 设计特点

### 1. 视觉设计
- **统一风格** - 与其他页面保持一致的设计语言
- **卡片布局** - 清晰的区域划分
- **颜色编码** - 不同状态使用不同颜色标识
- **渐变效果** - 配置区使用紫色渐变突出重点

### 2. 交互设计
- **即时反馈** - 选择操作立即显示视觉反馈
- **批量操作** - 支持批量选择和批量创建
- **确认机制** - 重要操作需要二次确认
- **实时更新** - 统计数据和任务状态实时刷新

### 3. 用户体验
- **清晰的流程** - 从上到下的自然工作流
- **灵活的选择** - 支持任意组合的文章和平台
- **完整的反馈** - 详细的日志和状态信息
- **便捷的操作** - 一键创建多个发布任务

## 技术实现

### 前端组件
- **页面路径**: `/publishing-tasks`
- **组件文件**: `client/src/pages/PublishingTasksPage.tsx`
- **使用技术**: React + TypeScript + Ant Design

### API接口
使用现有的发布系统API：
- `getArticles()` - 获取草稿文章
- `getPlatforms()` - 获取平台列表
- `getAccounts()` - 获取账号列表
- `createPublishingTask()` - 创建发布任务
- `getPublishingTasks()` - 获取任务列表
- `getTaskLogs()` - 获取任务日志
- `executeTask()` - 立即执行任务
- `cancelTask()` - 取消任务

### 状态管理
- 文章选择状态（Set<number>）
- 平台选择状态（Set<number>）
- 任务列表状态
- 统计数据状态

## 注意事项

1. **前置条件**
   - 需要先在"平台登录"页面完成平台登录
   - 需要在"文章管理"页面生成草稿文章

2. **任务创建**
   - 每个文章-平台组合会创建一个独立任务
   - 选择3篇文章和2个平台会创建6个任务

3. **定时发布**
   - 只能选择未来的时间
   - 定时任务会在指定时间自动执行

4. **任务状态**
   - 等待中的任务可以取消或立即执行
   - 执行中的任务无法取消
   - 失败的任务可以在发布记录页面重试

## 快速测试

1. 启动服务
```bash
npm run dev
```

2. 访问页面
```
http://localhost:5173/publishing-tasks
```

3. 测试流程
   - 确保有草稿文章（在文章管理页面）
   - 确保有已登录平台（在平台登录页面）
   - 选择文章和平台
   - 创建发布任务
   - 查看任务执行状态

## 后续优化建议

1. **批量操作增强**
   - 支持批量取消任务
   - 支持批量重试失败任务

2. **筛选功能**
   - 按状态筛选任务
   - 按平台筛选任务
   - 按时间范围筛选

3. **统计增强**
   - 添加成功率统计
   - 添加平台发布统计图表
   - 添加时间趋势分析

4. **通知功能**
   - 任务完成后的桌面通知
   - 失败任务的邮件提醒

5. **模板功能**
   - 保存常用的发布配置
   - 快速应用发布模板
