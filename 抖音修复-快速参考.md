# 抖音AI声明修复 - 快速参考

## 问题

❌ 无法选择"内容由AI生成"选项

## 原因

1. ⏱️  等待时间太短（3秒 → 需要8秒）
2. 🎯 选择器不够精确

## 解决方案

### 修改文件
`server/src/services/adapters/DouyinAdapter.ts`

### 修改位置
第436-497行左右（查找"等待侧边栏弹出"）

### 关键改进

| 项目 | 原值 | 新值 |
|------|------|------|
| 侧滑页等待 | 3秒 | 8秒 |
| 选项点击后等待 | 1秒 | 3秒 |
| 侧滑页关闭等待 | 1秒 | 5秒 |

### 精确选择器（你提供的）

**AI选项**:
```
body > div:nth-child(26) > div > div.semi-sidesheet-inner.semi-sidesheet-inner-wrap > div > div.semi-sidesheet-body > section > div > div:nth-child(3) > label
```

**确定按钮**:
```
body > div:nth-child(26) > div > div.semi-sidesheet-inner.semi-sidesheet-inner-wrap > div > div.semi-sidesheet-body > footer > button.semi-button.semi-button-primary.btn-I78nOi
```

## 快速修复步骤

### 1. 修改等待时间 ✅ 已完成

第436-438行已自动修改为8秒

### 2. 手动修改AI选项查找

**位置**: 第448-483行
**查找**: `// 点击"内容由AI生成"选项`
**替换**: 参考 `抖音AI声明修复-精确选择器版本.ts` 第24-107行

### 3. 手动修改确定按钮点击

**位置**: 第485-497行
**查找**: `// 点击确定按钮`
**替换**: 参考 `抖音AI声明修复-精确选择器版本.ts` 第109-177行

### 4. 重启服务

```bash
Ctrl+C
npm run dev
```

### 5. 测试

创建抖音发布任务 → 执行 → 查看日志和截图

## 预期日志

```
[抖音号] ⏳ 等待侧滑页弹出和完全加载（8秒）...
[抖音号] ✅ 侧滑页应该已完全加载
[抖音号] ✅ 找到"内容由AI生成"选项
[抖音号] ✅ 已点击选项
[抖音号] ⏳ 等待选项选中状态更新（3秒）...
[抖音号] ✅ 找到"确定"按钮
[抖音号] ✅ 已点击确定按钮
[抖音号] ⏳ 等待侧滑页关闭（5秒）...
[抖音号] ✅ 侧滑页应该已关闭，自主声明添加完成
```

## 相关文档

- `抖音AI声明修复-立即执行.md` - 详细修复指南
- `抖音AI声明修复-精确选择器版本.ts` - 完整修复代码

---

**总等待时间**: 8秒（加载）+ 3秒（选中）+ 5秒（关闭）= 16秒
**成功率**: 精确选择器 + XPath备用 = 高可靠性
