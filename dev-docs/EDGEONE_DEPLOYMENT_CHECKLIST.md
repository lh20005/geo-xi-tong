# 腾讯EdgeOne部署检查清单

## 📋 部署前准备

### 账号和域名
- [ ] 注册腾讯云账号
- [ ] 完成实名认证
- [ ] 开通EdgeOne服务
- [ ] 准备域名（已购买或新购买）
- [ ] 域名备案（如需要）

### 开发环境
- [ ] 代码已提交到Git仓库
- [ ] 所有功能测试通过
- [ ] 数据库迁移脚本已准备
- [ ] 环境变量已配置
- [ ] API密钥已获取

## 🎯 前端部署

### 构建和上传
- [ ] 创建`.env.production`文件
- [ ] 配置生产环境API地址
- [ ] 执行`npm run build`构建前端
- [ ] 创建腾讯云COS存储桶
- [ ] 上传dist目录到COS
- [ ] 验证文件上传完整性

### EdgeOne配置
- [ ] 创建EdgeOne站点
- [ ] 添加域名到EdgeOne
- [ ] 配置DNS记录（NS记录）
- [ ] 等待DNS生效
- [ ] 配置源站（COS）
- [ ] 配置缓存规则
  - [ ] HTML文件：10分钟
  - [ ] JS/CSS：30天
  - [ ] 图片：30天
  - [ ] 字体：365天
- [ ] 配置SPA路由（404→index.html）
- [ ] 申请SSL证书
- [ ] 配置HTTPS
- [ ] 开启强制HTTPS跳转

### CDN优化
- [ ] 开启智能压缩（Gzip/Brotli）
- [ ] 开启HTTP/2
- [ ] 开启HTTP/3 (QUIC)
- [ ] 配置图片优化
- [ ] 测试CDN访问速度

## 🖥️ 后端部署

### 服务器准备
- [ ] 购买腾讯云服务器（CVM或轻量应用服务器）
- [ ] 选择合适的配置（推荐2核4GB）
- [ ] 选择Ubuntu 22.04 LTS系统
- [ ] 配置安全组规则
  - [ ] 开放22端口（SSH）
  - [ ] 开放80端口（HTTP）
  - [ ] 开放443端口（HTTPS）
- [ ] SSH连接服务器

### 环境安装
- [ ] 更新系统：`sudo apt update && sudo apt upgrade -y`
- [ ] 安装Node.js 18
- [ ] 安装PM2：`sudo npm install -g pm2`
- [ ] 安装Nginx
- [ ] 安装Git

### 应用部署
- [ ] 创建应用目录：`/var/www/geo-system`
- [ ] 克隆代码到服务器
- [ ] 安装依赖：`npm install --production`
- [ ] 构建应用：`npm run build`
- [ ] 创建`.env`文件
- [ ] 配置环境变量
  - [ ] DATABASE_URL
  - [ ] DEEPSEEK_API_KEY
  - [ ] GEMINI_API_KEY
  - [ ] OLLAMA_BASE_URL（如需要）
  - [ ] JWT_SECRET
  - [ ] FRONTEND_URL

### Nginx配置
- [ ] 创建Nginx配置文件
- [ ] 配置反向代理到Node.js
- [ ] 上传SSL证书
- [ ] 配置HTTPS
- [ ] 测试Nginx配置：`sudo nginx -t`
- [ ] 重启Nginx：`sudo systemctl restart nginx`

### PM2启动
- [ ] 创建`ecosystem.config.js`
- [ ] 启动应用：`pm2 start ecosystem.config.js`
- [ ] 保存PM2配置：`pm2 save`
- [ ] 设置开机自启：`pm2 startup`
- [ ] 验证应用运行：`pm2 status`

## 💾 数据库部署

### 云数据库（推荐）
- [ ] 购买腾讯云数据库PostgreSQL
- [ ] 选择合适的配置（推荐2核4GB）
- [ ] 配置VPC网络（与云服务器同一VPC）
- [ ] 配置安全组规则
- [ ] 创建数据库：`geo_system`
- [ ] 创建用户并授权
- [ ] 配置自动备份策略
- [ ] 测试数据库连接

### 数据迁移
- [ ] 更新服务器`.env`中的DATABASE_URL
- [ ] 运行基础迁移：`npm run db:migrate`
- [ ] 运行Ollama迁移：`npm run db:migrate:ollama`
- [ ] 验证表结构：`\d api_configs`
- [ ] 测试数据库操作

## 🔒 安全配置

### EdgeOne安全
- [ ] 开启DDoS防护
- [ ] 配置WAF规则
  - [ ] SQL注入防护
  - [ ] XSS攻击防护
  - [ ] 文件上传防护
  - [ ] 恶意爬虫防护
  - [ ] CC攻击防护
- [ ] 配置速率限制（100请求/分钟/IP）
- [ ] 配置IP黑白名单（如需要）
- [ ] 配置地域访问控制（如需要）

### 服务器安全
- [ ] 配置防火墙：`sudo ufw enable`
- [ ] 禁用root登录
- [ ] 配置SSH密钥登录
- [ ] 安装fail2ban
- [ ] 定期更新系统

### 应用安全
- [ ] 安装Helmet中间件
- [ ] 配置CORS白名单
- [ ] 实现速率限制
- [ ] 配置请求大小限制
- [ ] 启用HTTPS强制跳转

## 📊 监控和日志

### EdgeOne监控
- [ ] 配置EdgeOne监控面板
- [ ] 查看请求量统计
- [ ] 查看带宽使用
- [ ] 查看缓存命中率
- [ ] 查看状态码分布

### 应用监控
- [ ] 配置PM2监控
- [ ] 配置腾讯云监控
- [ ] 设置告警策略
  - [ ] CPU使用率 > 80%
  - [ ] 内存使用率 > 85%
  - [ ] 磁盘使用率 > 80%
  - [ ] 应用进程异常
- [ ] 配置日志轮转
- [ ] 设置日志保留策略

### 数据库监控
- [ ] 配置数据库监控
- [ ] 查看连接数
- [ ] 查看慢查询
- [ ] 查看磁盘使用
- [ ] 设置性能告警

## ✅ 功能测试

### 前端测试
- [ ] 访问主域名：`https://your-domain.com`
- [ ] 测试页面加载速度
- [ ] 测试所有页面路由
- [ ] 测试静态资源加载
- [ ] 测试HTTPS证书
- [ ] 测试移动端适配

### 后端测试
- [ ] 测试API健康检查：`/health`
- [ ] 测试API配置接口
- [ ] 测试关键词蒸馏功能
- [ ] 测试文章生成功能
- [ ] 测试Ollama集成（如配置）
- [ ] 测试错误处理

### 数据库测试
- [ ] 测试数据读取
- [ ] 测试数据写入
- [ ] 测试数据更新
- [ ] 测试数据删除
- [ ] 测试事务处理

### 性能测试
- [ ] 测试首页加载时间（< 2秒）
- [ ] 测试API响应时间（< 500ms）
- [ ] 测试并发请求处理
- [ ] 测试CDN缓存效果
- [ ] 测试数据库查询性能

## 🔄 EdgeOne API配置

### API代理规则
- [ ] 配置API路径：`/api/*`
- [ ] 配置回源地址：`https://api.your-domain.com`
- [ ] 配置回源协议：HTTPS
- [ ] 配置回源Host
- [ ] 测试API代理

### 缓存规则
- [ ] API响应不缓存
- [ ] 或配置短时间缓存（如适用）
- [ ] 配置缓存键规则
- [ ] 测试缓存行为

## 📝 文档和备份

### 文档记录
- [ ] 记录所有配置信息
- [ ] 记录域名和DNS配置
- [ ] 记录服务器IP和登录信息
- [ ] 记录数据库连接信息
- [ ] 记录API密钥和证书
- [ ] 创建运维文档

### 备份策略
- [ ] 配置数据库自动备份
- [ ] 配置代码备份
- [ ] 配置配置文件备份
- [ ] 测试备份恢复流程
- [ ] 记录备份位置

## 🚀 上线发布

### 最终检查
- [ ] 所有功能测试通过
- [ ] 性能测试达标
- [ ] 安全配置完成
- [ ] 监控告警配置完成
- [ ] 备份策略配置完成
- [ ] 文档记录完整

### 发布流程
- [ ] 通知团队成员
- [ ] 更新DNS记录（如需要）
- [ ] 清除EdgeOne缓存
- [ ] 验证新域名访问
- [ ] 监控系统状态
- [ ] 记录发布时间

### 发布后验证
- [ ] 验证所有功能正常
- [ ] 验证性能指标
- [ ] 验证监控数据
- [ ] 验证日志记录
- [ ] 收集用户反馈

## 🔧 故障排查

### 常见问题检查
- [ ] EdgeOne缓存问题 → 清除缓存
- [ ] API跨域问题 → 检查CORS配置
- [ ] 数据库连接问题 → 检查安全组和连接字符串
- [ ] SSL证书问题 → 检查证书配置
- [ ] 性能问题 → 检查监控数据

### 应急预案
- [ ] 准备回滚方案
- [ ] 准备降级方案
- [ ] 准备应急联系人
- [ ] 准备故障处理流程

## 📈 优化计划

### 短期优化（1周内）
- [ ] 优化CDN缓存策略
- [ ] 优化数据库查询
- [ ] 优化API响应时间
- [ ] 优化前端资源加载

### 中期优化（1个月内）
- [ ] 添加Redis缓存
- [ ] 实现API限流
- [ ] 优化数据库索引
- [ ] 实现日志分析

### 长期优化（3个月内）
- [ ] 实现CI/CD自动化
- [ ] 实现灰度发布
- [ ] 实现服务监控
- [ ] 实现性能追踪

## ✨ 完成标志

当以下所有项都完成时，部署即告成功：

- ✅ 前端可通过EdgeOne CDN访问
- ✅ 后端API正常响应
- ✅ 数据库连接正常
- ✅ 所有功能测试通过
- ✅ 性能指标达标
- ✅ 安全配置完成
- ✅ 监控告警正常
- ✅ 备份策略生效

---

**恭喜！您的GEO优化系统已成功部署到腾讯EdgeOne云平台！** 🎉

**下一步：**
1. 持续监控系统状态
2. 收集用户反馈
3. 优化性能和体验
4. 定期更新和维护

**参考文档：**
- [腾讯EdgeOne部署方案](./docs/腾讯EdgeOne部署方案.md)
- [EdgeOne架构适配性评估](./docs/EdgeOne架构适配性评估.md)
- [部署指南](./docs/部署指南.md)
