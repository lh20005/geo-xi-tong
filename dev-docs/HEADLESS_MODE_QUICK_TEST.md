# 静默发布/可视化发布功能 - 快速测试指南

## 快速测试步骤

### 1. 启动应用

```bash
# 启动服务器
cd server
npm run dev

# 启动客户端（新终端）
cd client
npm run dev
```

### 2. 访问发布任务页面

打开浏览器访问：`http://localhost:5173/publishing/tasks`

### 3. 测试静默模式（默认）

1. 选择一篇文章
2. 选择一个已登录的平台
3. 确认滑块处于"静默发布"状态（关闭状态）
4. 点击"创建发布任务"
5. **预期结果**：
   - 任务创建成功
   - 浏览器在后台运行，不显示窗口
   - 可以在任务列表中看到任务状态变化
   - 点击"实时日志"可以看到日志中显示"启动浏览器（静默模式）"

### 4. 测试可视化模式

1. 选择另一篇文章
2. 选择一个已登录的平台
3. 将滑块切换到"可视化发布"状态（开启状态）
4. 点击"创建发布任务"
5. **预期结果**：
   - 任务创建成功
   - 浏览器窗口弹出并显示
   - 可以看到自动操作的整个过程
   - 日志中显示"启动浏览器（可视化模式）"

### 5. 测试状态持久化

1. 将滑块切换到"可视化发布"
2. 刷新页面（F5）
3. **预期结果**：
   - 滑块仍然保持在"可视化发布"状态
   - 说明用户选择已保存

4. 将滑块切换回"静默发布"
5. 刷新页面
6. **预期结果**：
   - 滑块保持在"静默发布"状态

### 6. 测试批量任务

1. 选择 3 篇文章
2. 选择 2 个平台
3. 设置发布间隔为 2 分钟
4. 切换到"可视化发布"模式
5. 点击"创建发布任务"
6. **预期结果**：
   - 创建 6 个任务（3篇文章 × 2个平台）
   - 所有任务都使用可视化模式
   - 可以看到浏览器窗口依次执行每个任务

## 验证要点

### UI 验证

- [ ] 滑块位置正确（在"发布间隔"下方）
- [ ] 滑块文字清晰："静默发布" / "可视化发布"
- [ ] 图标显示正确：
  - 静默模式：🔇 + EyeInvisibleOutlined
  - 可视化模式：👁️ + EyeOutlined
- [ ] Tooltip 提示信息完整
- [ ] 滑块样式美观，与整体设计一致

### 功能验证

- [ ] 静默模式：浏览器不显示窗口
- [ ] 可视化模式：浏览器窗口显示
- [ ] 状态持久化：刷新页面后状态保持
- [ ] 批量任务：所有任务使用相同模式
- [ ] 日志记录：显示正确的模式信息

### 日志验证

在实时日志或历史日志中查找：

**静默模式**：
```
🚀 启动浏览器（静默模式）...
✅ 浏览器启动成功
```

**可视化模式**：
```
🚀 启动浏览器（可视化模式）...
✅ 浏览器启动成功
```

## 常见问题排查

### 问题 1：滑块状态不保存

**原因**：localStorage 可能被禁用或清除

**解决方案**：
1. 检查浏览器控制台是否有错误
2. 确认浏览器允许使用 localStorage
3. 清除浏览器缓存后重试

### 问题 2：可视化模式下浏览器不显示

**原因**：后端可能没有正确读取 config.headless 参数

**解决方案**：
1. 检查任务创建时的请求参数
2. 查看服务器日志确认 config 参数
3. 确认 PublishingExecutor.ts 的修改已生效

### 问题 3：静默模式下仍然显示浏览器

**原因**：headless 参数可能传递错误

**解决方案**：
1. 检查前端发送的 config.headless 值
2. 确认后端读取逻辑正确
3. 查看浏览器启动日志

## 调试技巧

### 前端调试

在浏览器控制台执行：
```javascript
// 查看当前保存的模式
localStorage.getItem('publishHeadlessMode')

// 手动设置为静默模式
localStorage.setItem('publishHeadlessMode', 'true')

// 手动设置为可视化模式
localStorage.setItem('publishHeadlessMode', 'false')
```

### 后端调试

在 `server/src/services/PublishingExecutor.ts` 中添加日志：
```typescript
console.log('Task config:', task.config);
console.log('Headless mode:', headlessMode);
```

### 网络请求调试

在浏览器开发者工具的 Network 标签中：
1. 找到 `POST /api/publishing/tasks` 请求
2. 查看 Request Payload
3. 确认 `config.headless` 字段存在且值正确

## 性能对比测试

可以测试两种模式的性能差异：

1. **静默模式**：
   - 记录任务开始时间
   - 记录任务完成时间
   - 计算总耗时

2. **可视化模式**：
   - 记录任务开始时间
   - 记录任务完成时间
   - 计算总耗时

3. **对比结果**：
   - 静默模式通常比可视化模式快 10-20%
   - 静默模式占用内存更少

## 测试完成检查清单

- [ ] 静默模式功能正常
- [ ] 可视化模式功能正常
- [ ] 状态持久化正常
- [ ] 批量任务正常
- [ ] UI 显示正确
- [ ] 日志记录正确
- [ ] 无控制台错误
- [ ] 无服务器错误
- [ ] 性能表现符合预期
- [ ] 用户体验良好

## 下一步

测试通过后，可以：
1. 提交代码到版本控制
2. 更新用户文档
3. 通知团队成员新功能
4. 收集用户反馈
5. 根据反馈优化功能
