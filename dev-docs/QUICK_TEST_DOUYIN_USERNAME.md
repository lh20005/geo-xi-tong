# 抖音号用户名提取 - 快速测试指南

## 🎯 测试目标
验证抖音号登录后能正确显示真实用户名 "Ai来了"，而不是临时账号名 "抖音号_1766159145791"

## ⚡ 快速测试步骤

### 1. 重启服务器（如果正在运行）
```bash
# 在项目根目录
npm run dev
```

### 2. 打开浏览器测试
1. 访问：http://localhost:3000
2. 点击：发布管理 → 账号管理
3. 找到抖音平台
4. 点击"浏览器登录"按钮

### 3. 完成登录
- 在弹出的浏览器窗口中登录抖音创作者平台
- 等待URL变化（登录成功标志）
- 浏览器会自动关闭

### 4. 验证结果 ✅

**期望结果：**
- 账号列表中显示：**Ai来了**
- 不再显示：~~抖音号_1766159145791~~

**如果显示正确：**
✅ 修复成功！真实用户名已正确提取并保存

**如果仍显示临时名称：**
❌ 需要查看服务器日志排查问题

## 📋 检查服务器日志

登录过程中，服务器会输出详细日志：

```
[提取用户信息] 开始提取 douyin 平台的用户名
[提取用户信息] 尝试选择器 1/8: .name-_lSSDc
[提取用户信息] ✅ 找到元素: .name-_lSSDc
[提取用户信息] ✅ 成功提取用户名: "Ai来了"
[浏览器登录] 真实用户名: Ai来了
[浏览器登录] 账号保存成功 ID: X, 真实用户名: Ai来了
```

## 🔧 如果测试失败

### 方案1：查看调试HTML文件
```bash
ls -la server/debug/douyin_*.html
```
打开最新的HTML文件，搜索 "Ai来了"，查看元素结构

### 方案2：手动更新数据库
```sql
-- 查看当前账号
SELECT id, account_name, real_username FROM platform_accounts WHERE platform_id = 'douyin';

-- 手动设置真实用户名
UPDATE platform_accounts 
SET real_username = 'Ai来了' 
WHERE platform_id = 'douyin';
```

### 方案3：删除旧账号重新登录
1. 在账号管理界面删除抖音账号
2. 重新点击"浏览器登录"
3. 完成登录流程

## 📊 预期数据库状态

```sql
-- 查询结果应该类似：
id | platform_id | account_name | real_username | created_at
---+-------------+--------------+---------------+------------
 X | douyin      | Ai来了       | Ai来了        | 2024-...
```

## ✨ 修复内容摘要

1. ✅ 添加 `real_username` 数据库字段
2. ✅ 优化抖音用户名选择器（`.name-_lSSDc`）
3. ✅ 更新账号保存逻辑（自动提取并保存真实用户名）
4. ✅ 更新账号显示逻辑（优先显示真实用户名）

## 📞 需要帮助？

如果测试失败，请提供：
1. 服务器控制台日志（特别是 `[提取用户信息]` 相关的）
2. 账号管理界面截图
3. 数据库查询结果

---

**预计测试时间：** 2-3分钟  
**修复状态：** ✅ 代码已更新，等待测试验证
