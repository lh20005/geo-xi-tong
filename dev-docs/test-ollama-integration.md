# Ollama集成测试清单

## 测试环境准备

- [ ] Ollama已安装并运行
- [ ] 至少安装了一个DeepSeek模型
- [ ] 数据库迁移已执行
- [ ] 服务器已启动
- [ ] 前端已启动

## 功能测试

### 1. 配置页面UI测试

- [ ] 访问配置页面
- [ ] 验证"本地Ollama"选项在下拉框中显示
- [ ] 选择"本地Ollama"
- [ ] 验证API Key字段被隐藏
- [ ] 验证Ollama服务地址字段显示（默认值：http://localhost:11434）
- [ ] 验证模型选择下拉框显示

### 2. 模型检测测试

- [ ] 选择"本地Ollama"后自动触发模型检测
- [ ] 验证检测到的DeepSeek模型显示在下拉框中
- [ ] 验证模型信息包含名称和大小
- [ ] 点击刷新图标重新检测模型
- [ ] 修改服务地址，验证自动重新检测

### 3. 连接测试

- [ ] 选择一个模型
- [ ] 点击"测试连接"按钮
- [ ] 验证显示"连接成功"消息
- [ ] 测试错误场景：
  - [ ] 停止Ollama服务，验证显示连接失败错误
  - [ ] 输入不存在的模型，验证显示模型未安装错误

### 4. 配置保存测试

- [ ] 填写完整的Ollama配置
- [ ] 点击"保存配置"
- [ ] 验证显示"API配置保存成功"消息
- [ ] 刷新页面，验证配置被正确加载
- [ ] 验证当前配置显示"已配置本地Ollama"

### 5. 关键词蒸馏测试

- [ ] 配置Ollama后，访问蒸馏页面
- [ ] 输入测试关键词（如"人工智能"）
- [ ] 点击执行蒸馏
- [ ] 验证成功生成问题列表
- [ ] 验证问题数量在10-15个之间
- [ ] 验证问题内容相关且合理

### 6. 文章生成测试

- [ ] 使用蒸馏生成的话题
- [ ] 选择部分话题
- [ ] 输入文章要求
- [ ] 点击生成文章
- [ ] 验证成功生成文章内容
- [ ] 验证文章内容相关且完整
- [ ] 验证文章字数符合要求

### 7. Provider切换测试

- [ ] 从Ollama切换到DeepSeek云端API
  - [ ] 验证Ollama字段被隐藏
  - [ ] 验证API Key字段显示
  - [ ] 保存配置
  - [ ] 验证配置成功切换
- [ ] 从云端API切换回Ollama
  - [ ] 验证字段正确切换
  - [ ] 验证模型重新检测
  - [ ] 保存配置
  - [ ] 验证配置成功切换

### 8. 错误处理测试

- [ ] Ollama服务未启动
  - [ ] 验证显示友好错误提示
  - [ ] 验证提示包含解决方案
- [ ] 未安装DeepSeek模型
  - [ ] 验证显示安装提示
  - [ ] 验证提示包含安装命令
- [ ] 模型响应超时
  - [ ] 验证显示超时错误
  - [ ] 验证系统状态不受影响
- [ ] 配置保存失败
  - [ ] 验证显示错误消息
  - [ ] 验证原配置保持不变

### 9. 配置持久化测试

- [ ] 保存Ollama配置
- [ ] 重启服务器
- [ ] 验证配置被正确恢复
- [ ] 执行AI任务，验证使用正确的配置

### 10. 数据库测试

- [ ] 查询api_configs表
- [ ] 验证ollama配置正确存储
- [ ] 验证字段包含：
  - [ ] provider = 'ollama'
  - [ ] ollama_base_url
  - [ ] ollama_model
  - [ ] api_key = null

## 性能测试

- [ ] 测试关键词蒸馏响应时间（应在合理范围内）
- [ ] 测试文章生成响应时间（应在合理范围内）
- [ ] 测试并发请求处理（避免同时多个请求）

## 兼容性测试

- [ ] 验证现有的DeepSeek云端API配置不受影响
- [ ] 验证现有的Gemini配置不受影响
- [ ] 验证历史数据（蒸馏记录、文章）正常显示

## 文档测试

- [ ] 阅读Ollama集成指南
- [ ] 验证所有步骤清晰可执行
- [ ] 验证故障排除部分有用

## 测试结果

### 通过的测试
- 记录通过的测试项

### 失败的测试
- 记录失败的测试项和错误信息

### 需要改进的地方
- 记录发现的问题和改进建议

## 测试命令

### 启动服务器
```bash
cd server
npm run dev
```

### 启动前端
```bash
cd client
npm run dev
```

### 执行数据库迁移
```bash
cd server
npm run db:migrate:ollama
```

### 检查Ollama状态
```bash
ollama list
curl http://localhost:11434/api/tags
```

### 测试Ollama模型
```bash
ollama run deepseek-r1:latest "测试"
```

## 注意事项

1. 确保Ollama服务在测试期间持续运行
2. 某些测试可能需要较长时间（模型推理）
3. 测试前备份数据库（如有重要数据）
4. 记录所有错误日志用于调试
