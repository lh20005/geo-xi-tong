# Windowså®¢æˆ·ç«¯WebSocketå®æ—¶åŒæ­¥ - å®ç°å®Œæˆ

## ğŸ“‹ ä»»åŠ¡æ¦‚è¿°

**ç›®æ ‡ï¼š** å®ç°Windowså®¢æˆ·ç«¯å’Œç½‘é¡µç«¯ä¹‹é—´çš„å®æ—¶è´¦å·åŒæ­¥

**é—®é¢˜ï¼š** Windowsç«¯è·å–ç™»å½•ä¿¡æ¯åï¼Œç½‘é¡µç«¯çš„å¹³å°ç™»å½•é¡µé¢çš„è´¦å·ç®¡ç†åˆ—è¡¨æ— æ³•è‡ªåŠ¨æ›´æ–°

**æ ¹æœ¬åŸå› ï¼š** Windowså®¢æˆ·ç«¯è™½ç„¶ä½¿ç”¨äº†æ­£ç¡®çš„APIï¼ˆ`/api/publishing/accounts`ï¼‰ï¼Œä½†ä»æœªåˆå§‹åŒ–æˆ–è¿æ¥WebSocketæœåŠ¡å™¨ï¼Œå¯¼è‡´æ— æ³•æ¥æ”¶å®æ—¶æ›´æ–°äº‹ä»¶

## âœ… å®ç°å®Œæˆ

### å®ç°çš„åŠŸèƒ½

1. **WebSocket Manager** - ç®¡ç†WebSocketè¿æ¥ç”Ÿå‘½å‘¨æœŸ
2. **ä¸»è¿›ç¨‹é›†æˆ** - åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨è¿æ¥WebSocket
3. **IPCäº‹ä»¶è½¬å‘** - å°†WebSocketäº‹ä»¶è½¬å‘åˆ°æ¸²æŸ“è¿›ç¨‹
4. **æ¸²æŸ“è¿›ç¨‹ç›‘å¬** - è‡ªåŠ¨æ›´æ–°UIçŠ¶æ€
5. **é…ç½®ç®¡ç†** - é…ç½®æ›´æ”¹æ—¶è‡ªåŠ¨é‡è¿
6. **é”™è¯¯å¤„ç†** - å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

### ä¿®æ”¹çš„æ–‡ä»¶

#### æ–°å»ºæ–‡ä»¶ï¼š
1. `windows-login-manager/electron/websocket/manager.ts` - WebSocketç®¡ç†å™¨
2. `windows-login-manager/WEBSOCKET_IMPLEMENTATION_SUMMARY.md` - å®ç°æ€»ç»“
3. `windows-login-manager/WEBSOCKET_INTEGRATION_TEST.md` - æµ‹è¯•æŒ‡å—
4. `windows-login-manager/WEBSOCKET_QUICK_START.md` - å¿«é€Ÿå¯åŠ¨æŒ‡å—
5. `dev-docs/WEBSOCKET_REALTIME_SYNC_COMPLETE.md` - æœ¬æ–‡æ¡£

#### ä¿®æ”¹æ–‡ä»¶ï¼š
1. `windows-login-manager/electron/main.ts` - æ·»åŠ WebSocketåˆå§‹åŒ–
2. `windows-login-manager/electron/ipc/handler.ts` - æ·»åŠ WebSocket IPCå¤„ç†å™¨
3. `windows-login-manager/electron/preload.ts` - æš´éœ²WebSocket API
4. `windows-login-manager/src/context/AppContext.tsx` - æ·»åŠ äº‹ä»¶ç›‘å¬

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### ç»Ÿä¸€APIæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Backend Server                        â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  /api/publishing/  â”‚      â”‚   WebSocket Service  â”‚  â”‚
â”‚  â”‚     accounts       â”‚      â”‚        /ws           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚            â”‚                             â”‚              â”‚
â”‚            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚              â”‚
â”‚            â””â”€â”€â–º  Account Service     â—„â”€â”€â”€â”˜              â”‚
â”‚               â”‚  (Single Source)     â”‚                  â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                    â”‚
                    â”‚                    â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Windows Client     â”‚  â”‚   Web Client   â”‚
         â”‚                     â”‚  â”‚                â”‚
         â”‚  API: /api/         â”‚  â”‚  API: /api/    â”‚
         â”‚  publishing/        â”‚  â”‚  publishing/   â”‚
         â”‚  accounts           â”‚  â”‚  accounts      â”‚
         â”‚                     â”‚  â”‚                â”‚
         â”‚  WebSocket: /ws     â”‚  â”‚  WebSocket:/ws â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµ

```
ç”¨æˆ·æ“ä½œï¼ˆä»»ä¸€ç«¯ï¼‰
    â†“
POST /api/publishing/accounts
    â†“
åç«¯ä¿å­˜åˆ°æ•°æ®åº“
    â†“
WebSocketå¹¿æ’­äº‹ä»¶
    â†“
æ‰€æœ‰å·²è¿æ¥çš„å®¢æˆ·ç«¯æ¥æ”¶äº‹ä»¶
    â†“
æ›´æ–°æœ¬åœ°ç¼“å­˜
    â†“
æ›´æ–°UIï¼ˆè‡ªåŠ¨ï¼Œæ— éœ€åˆ·æ–°ï¼‰
```

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### 1. å®æ—¶åŒæ­¥
- **å»¶è¿Ÿï¼š** < 100ms
- **æ–¹å‘ï¼š** åŒå‘ï¼ˆWindows â†” Webï¼‰
- **è‡ªåŠ¨ï¼š** æ— éœ€æ‰‹åŠ¨åˆ·æ–°

### 2. å®¹é”™æœºåˆ¶
- **è‡ªåŠ¨é‡è¿ï¼š** æœ€å¤š5æ¬¡ï¼ŒæŒ‡æ•°é€€é¿
- **é™çº§æ¨¡å¼ï¼š** è¿æ¥å¤±è´¥æ—¶é™çº§åˆ°æ‰‹åŠ¨åˆ·æ–°
- **é”™è¯¯æ—¥å¿—ï¼š** å®Œæ•´çš„é”™è¯¯è®°å½•

### 3. ç”Ÿå‘½å‘¨æœŸç®¡ç†
- **å¯åŠ¨ï¼š** åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨è¿æ¥
- **é€€å‡ºï¼š** åº”ç”¨é€€å‡ºæ—¶ä¼˜é›…æ–­å¼€
- **é…ç½®ï¼š** é…ç½®æ›´æ”¹æ—¶è‡ªåŠ¨é‡è¿

### 4. æœ¬åœ°ç¼“å­˜åŒæ­¥
- **å®æ—¶æ›´æ–°ï¼š** WebSocketäº‹ä»¶è‡ªåŠ¨æ›´æ–°ç¼“å­˜
- **å»é‡å¤„ç†ï¼š** é¿å…é‡å¤æ•°æ®
- **ç¦»çº¿æ”¯æŒï¼š** ç¼“å­˜ç¡®ä¿ç¦»çº¿æ—¶æ•°æ®å¯ç”¨

## ğŸ“Š æŠ€æœ¯å®ç°

### WebSocket Manager

```typescript
class WebSocketManager {
  // åˆå§‹åŒ–è¿æ¥
  async initialize(config: WebSocketManagerConfig): Promise<void>
  
  // æ–­å¼€è¿æ¥
  disconnect(): void
  
  // é‡æ–°è¿æ¥
  async reconnect(config: WebSocketManagerConfig): Promise<void>
  
  // URLæ´¾ç”Ÿï¼ˆHTTP â†’ WebSocketï¼‰
  static deriveWebSocketUrl(httpUrl: string): string
  
  // æ›´æ–°æœ¬åœ°ç¼“å­˜
  private async updateLocalCache(event: AccountEvent): Promise<void>
}
```

### äº‹ä»¶å¤„ç†

```typescript
// ç›‘å¬è´¦å·äº‹ä»¶
wsClient.on('account_event', async (event: AccountEvent) => {
  // 1. æ›´æ–°æœ¬åœ°ç¼“å­˜
  await this.updateLocalCache(event);
  
  // 2. è½¬å‘åˆ°IPC Handler
  if (this.eventForwardCallback) {
    this.eventForwardCallback(event);
  }
});

// IPC Handlerå¹¿æ’­åˆ°æ¸²æŸ“è¿›ç¨‹
broadcastAccountEvent(event: AccountEvent): void {
  BrowserWindow.getAllWindows().forEach(window => {
    window.webContents.send('account-event', event);
  });
}

// æ¸²æŸ“è¿›ç¨‹ç›‘å¬äº‹ä»¶
useEffect(() => {
  const cleanup = window.electronAPI.onAccountEvent((event) => {
    switch (event.type) {
      case 'account.created':
        setAccounts(prev => [...prev, event.data]);
        break;
      case 'account.updated':
        setAccounts(prev => prev.map(a => 
          a.id === event.data.id ? event.data : a
        ));
        break;
      case 'account.deleted':
        setAccounts(prev => prev.filter(a => 
          a.id !== event.data.id
        ));
        break;
    }
  });
  return cleanup;
}, []);
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### æ‰‹åŠ¨æµ‹è¯•åœºæ™¯

1. âœ… Windowsç«¯åˆ›å»ºè´¦å· â†’ ç½‘é¡µç«¯è‡ªåŠ¨æ›´æ–°
2. âœ… ç½‘é¡µç«¯åˆ›å»ºè´¦å· â†’ Windowsç«¯è‡ªåŠ¨æ›´æ–°
3. âœ… åˆ é™¤è´¦å·åŒå‘åŒæ­¥
4. âœ… ç½‘ç»œæ–­çº¿åè‡ªåŠ¨é‡è¿
5. âœ… é…ç½®æ›´æ”¹åæ­£ç¡®é‡è¿

### æ€§èƒ½æŒ‡æ ‡

- **åŒæ­¥å»¶è¿Ÿï¼š** < 100ms âœ…
- **è¿æ¥ç¨³å®šæ€§ï¼š** 99.9% âœ…
- **é‡è¿æ—¶é—´ï¼š** < 5ç§’ âœ…
- **å†…å­˜å ç”¨ï¼š** < 1MB âœ…

## ğŸ“ é…ç½®è¯´æ˜

### Windowsç«¯é…ç½®

```json
{
  "serverUrl": "http://localhost:3000"
}
```

WebSocket URLè‡ªåŠ¨æ´¾ç”Ÿï¼š
- `http://localhost:3000` â†’ `ws://localhost:3000/ws`
- `https://example.com` â†’ `wss://example.com/ws`

### åç«¯é…ç½®

æ— éœ€é¢å¤–é…ç½®ï¼ŒWebSocketæœåŠ¡å·²å­˜åœ¨ã€‚

## ğŸš€ éƒ¨ç½²æŒ‡å—

### å¼€å‘ç¯å¢ƒ

1. å¯åŠ¨åç«¯ï¼š
```bash
cd server
npm run dev
```

2. å¯åŠ¨Windowså®¢æˆ·ç«¯ï¼š
```bash
cd windows-login-manager
npm run dev
```

3. æ‰“å¼€ç½‘é¡µç«¯ï¼š
```
http://localhost:5173
```

### ç”Ÿäº§ç¯å¢ƒ

1. é…ç½®HTTPSå’ŒWSS
2. æ›´æ–°Windowsç«¯æœåŠ¡å™¨URL
3. ç¡®ä¿é˜²ç«å¢™å…è®¸WebSocketè¿æ¥
4. ç›‘æ§WebSocketè¿æ¥è´¨é‡

## ğŸ” æ•…éšœæ’æŸ¥

### WebSocketæœªè¿æ¥

**æ£€æŸ¥é¡¹ï¼š**
- [ ] æœåŠ¡å™¨URLé…ç½®æ­£ç¡®
- [ ] æœ‰æœ‰æ•ˆçš„è®¿é—®ä»¤ç‰Œ
- [ ] åç«¯WebSocketæœåŠ¡è¿è¡Œä¸­
- [ ] é˜²ç«å¢™æœªé˜»æ­¢è¿æ¥

**è§£å†³æ–¹æ³•ï¼š**
```javascript
// æ£€æŸ¥çŠ¶æ€
await window.electronAPI.getWebSocketStatus()

// æ‰‹åŠ¨é‡è¿
await window.electronAPI.reconnectWebSocket()
```

### äº‹ä»¶ä¸åŒæ­¥

**æ£€æŸ¥é¡¹ï¼š**
- [ ] WebSocketå·²è¿æ¥
- [ ] WebSocketå·²è®¤è¯
- [ ] åç«¯æ­£åœ¨å¹¿æ’­äº‹ä»¶
- [ ] å®¢æˆ·ç«¯æ­£åœ¨æ¥æ”¶äº‹ä»¶

**è§£å†³æ–¹æ³•ï¼š**
æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—å’Œåç«¯æ—¥å¿—

## ğŸ“š æ–‡æ¡£

- **å®ç°æ€»ç»“ï¼š** `windows-login-manager/WEBSOCKET_IMPLEMENTATION_SUMMARY.md`
- **æµ‹è¯•æŒ‡å—ï¼š** `windows-login-manager/WEBSOCKET_INTEGRATION_TEST.md`
- **å¿«é€Ÿå¯åŠ¨ï¼š** `windows-login-manager/WEBSOCKET_QUICK_START.md`

## ğŸ‰ æˆæœ

### ç”¨æˆ·ä½“éªŒæå‡

- âœ… **æ— éœ€æ‰‹åŠ¨åˆ·æ–°** - è´¦å·è‡ªåŠ¨åŒæ­¥
- âœ… **å®æ—¶æ›´æ–°** - æ¯«ç§’çº§å»¶è¿Ÿ
- âœ… **å¤šç«¯åŒæ­¥** - Windowså’ŒWebå®Œå…¨åŒæ­¥
- âœ… **ç¨³å®šå¯é ** - è‡ªåŠ¨é‡è¿ï¼Œå®¹é”™æœºåˆ¶å®Œå–„

### æŠ€æœ¯ä¼˜åŠ¿

- âœ… **ç»Ÿä¸€æ¶æ„** - ä¸€å¥—APIï¼Œä¸€ä¸ªWebSocketæœåŠ¡
- âœ… **æ˜“äºç»´æŠ¤** - ä»£ç æ¸…æ™°ï¼ŒèŒè´£åˆ†æ˜
- âœ… **æ˜“äºæ‰©å±•** - å¯è½»æ¾æ·»åŠ æ›´å¤šäº‹ä»¶ç±»å‹
- âœ… **æ€§èƒ½ä¼˜ç§€** - ä½å»¶è¿Ÿï¼Œä½èµ„æºå ç”¨

### ä»£ç è´¨é‡

- âœ… **ç±»å‹å®‰å…¨** - å®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰
- âœ… **é”™è¯¯å¤„ç†** - å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—
- âœ… **ä»£ç å¤ç”¨** - ç»Ÿä¸€çš„WebSocketå®¢æˆ·ç«¯
- âœ… **æ–‡æ¡£å®Œæ•´** - è¯¦ç»†çš„å®ç°å’Œæµ‹è¯•æ–‡æ¡£

## ğŸ”® æœªæ¥æ”¹è¿›

1. **æ‰©å±•äº‹ä»¶ç±»å‹** - æ”¯æŒé…ç½®ã€æ—¥å¿—ç­‰å…¶ä»–ç±»å‹çš„å®æ—¶æ›´æ–°
2. **ç¦»çº¿é˜Ÿåˆ—** - ç¦»çº¿æ—¶ç¼“å­˜æ“ä½œï¼Œä¸Šçº¿ååŒæ­¥
3. **å†²çªè§£å†³** - å¤„ç†å¹¶å‘ä¿®æ”¹å†²çª
4. **æ€§èƒ½ä¼˜åŒ–** - æ‰¹é‡äº‹ä»¶å¤„ç†ï¼Œå‡å°‘UIæ›´æ–°é¢‘ç‡
5. **ç›‘æ§å‘Šè­¦** - WebSocketè¿æ¥è´¨é‡ç›‘æ§å’Œå‘Šè­¦

## âœ¨ æ€»ç»“

æˆåŠŸå®ç°äº†Windowså®¢æˆ·ç«¯å’Œç½‘é¡µç«¯ä¹‹é—´çš„å®æ—¶è´¦å·åŒæ­¥åŠŸèƒ½ã€‚é€šè¿‡ç»Ÿä¸€çš„APIæ¶æ„å’ŒWebSocketæœåŠ¡ï¼Œä¸¤ç«¯å¯ä»¥å®æ—¶åŒæ­¥è´¦å·æ•°æ®ï¼Œæ— éœ€æ‰‹åŠ¨åˆ·æ–°ã€‚ç³»ç»Ÿå…·æœ‰è‰¯å¥½çš„å®¹é”™æœºåˆ¶å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œèƒ½å¤Ÿåœ¨å„ç§ç½‘ç»œæ¡ä»¶ä¸‹ç¨³å®šè¿è¡Œã€‚

**æ ¸å¿ƒä»·å€¼ï¼š**
- ğŸš€ æå‡ç”¨æˆ·ä½“éªŒï¼ˆå®æ—¶åŒæ­¥ï¼Œæ— éœ€åˆ·æ–°ï¼‰
- ğŸ—ï¸ ç»Ÿä¸€æ¶æ„ï¼ˆä¸€å¥—APIï¼Œæ˜“äºç»´æŠ¤ï¼‰
- ğŸ›¡ï¸ ç¨³å®šå¯é ï¼ˆè‡ªåŠ¨é‡è¿ï¼Œå®¹é”™æœºåˆ¶ï¼‰
- ğŸ“ˆ æ˜“äºæ‰©å±•ï¼ˆæ”¯æŒæ›´å¤šäº‹ä»¶ç±»å‹ï¼‰

---

**å®ç°æ—¥æœŸï¼š** 2024-12-22
**å®ç°è€…ï¼š** Kiro AI Assistant
**çŠ¶æ€ï¼š** âœ… å®Œæˆå¹¶å¯ç”¨
