# 关键词蒸馏配置 - 完整使用指南

## 📋 目录
1. [功能介绍](#功能介绍)
2. [快速开始](#快速开始)
3. [详细配置](#详细配置)
4. [测试验证](#测试验证)
5. [常见问题](#常见问题)

---

## 功能介绍

### 什么是关键词蒸馏配置？

关键词蒸馏配置允许您自定义系统如何将关键词"蒸馏"成多个相关话题。通过配置，您可以控制：

1. **蒸馏提示词**：发送给AI大模型的指令模板
2. **生成话题数量**：每次蒸馏生成多少个话题（5-30个）

### 为什么需要这个功能？

- ✅ **灵活性**：无需修改代码即可调整蒸馏算法
- ✅ **可定制**：根据不同行业调整提示词
- ✅ **可控性**：精确控制生成话题的数量
- ✅ **实时生效**：配置保存后立即应用到新任务

---

## 快速开始

### 步骤1：启动服务

```bash
# 启动后端服务
cd server
npm run dev

# 启动前端服务（新终端）
cd client
npm run dev
```

### 步骤2：访问配置页面

打开浏览器访问：
```
http://localhost:5173/config
```

### 步骤3：配置蒸馏参数

1. 点击"关键词蒸馏配置"标签
2. 编辑"关键词蒸馏提示词"（必须包含 `{keyword}` 和 `{count}`）
3. 设置"生成话题数量"（5-30之间）
4. 点击"保存配置"

### 步骤4：测试蒸馏

1. 访问关键词蒸馏页面
2. 输入关键词（如"英国留学"）
3. 点击"开始蒸馏"
4. 查看生成的话题数量是否符合配置

---

## 详细配置

### 关键词蒸馏提示词

#### 必需元素

提示词必须包含两个占位符：

| 占位符 | 说明 | 示例 |
|--------|------|------|
| `{keyword}` | 会被替换为实际的关键词 | "英国留学" |
| `{count}` | 会被替换为生成话题数量 | 12 |

#### 推荐结构

```
[角色定位]
请根据关键词"{keyword}"，生成{count}个[目标内容]。

要求：
1. [要求1]
2. [要求2]
3. [要求3]

示例（关键词：[示例关键词]）：
- [示例1]
- [示例2]

请直接返回[输出格式]。
```

#### 默认提示词

```
你是一个专业的搜索行为分析专家。请根据关键词"{keyword}"，生成{count}个真实用户在互联网搜索时可能提出的问题。

要求：
1. 问题要符合真实用户的搜索习惯
2. 包含不同的搜索意图（比较、推荐、评价等）
3. 使用常见的搜索词组合，如"哪家好"、"靠谱的"、"口碑好的"、"性价比高的"、"专业的"等
4. 问题要自然、口语化

示例（关键词：英国留学）：
- 专业的英国留学哪家好
- 靠谱的英国留学机构哪家好
- 口碑好的英国留学企业哪家好
- 性价比高的英国留学公司哪家好
- 专业的英国留学服务商哪家专业

请直接返回问题列表，每行一个问题，不要编号，不要其他说明文字。
```

### 生成话题数量

#### 数量范围
- **最小值**：5个
- **最大值**：30个
- **默认值**：12个
- **推荐值**：10-15个

#### 数量选择建议

| 数量 | 适用场景 | 优点 | 缺点 |
|------|----------|------|------|
| 5-8个 | 快速测试 | 生成快速 | 覆盖面窄 |
| 10-15个 | 常规使用 | 平衡性好 | - |
| 16-30个 | 深度分析 | 覆盖全面 | 耗时较长 |

---

## 测试验证

### 方法1：使用自动化测试脚本

```bash
# 确保服务器正在运行
npm run dev

# 运行完整验证脚本
./验证关键词蒸馏配置功能.sh
```

脚本会自动测试：
- ✅ 数据库表结构
- ✅ API接口功能
- ✅ 参数验证
- ✅ 配置保存和读取
- ✅ 配置更新

### 方法2：手动API测试

#### 获取当前配置
```bash
curl http://localhost:3000/api/config/distillation | jq
```

预期响应：
```json
{
  "id": 1,
  "prompt": "你是一个专业的搜索行为分析专家...",
  "topicCount": 12,
  "configured": true,
  "createdAt": "2024-01-01T00:00:00.000Z",
  "updatedAt": "2024-01-01T00:00:00.000Z"
}
```

#### 保存新配置
```bash
curl -X POST http://localhost:3000/api/config/distillation \
  -H "Content-Type: application/json" \
  -d '{
    "prompt": "你的自定义提示词 {keyword} 和 {count}",
    "topicCount": 15
  }' | jq
```

预期响应：
```json
{
  "success": true,
  "config": {
    "id": 2,
    "prompt": "你的自定义提示词 {keyword} 和 {count}",
    "topicCount": 15,
    "createdAt": "2024-01-01T00:00:00.000Z",
    "updatedAt": "2024-01-01T00:00:00.000Z"
  },
  "message": "关键词蒸馏配置保存成功"
}
```

#### 测试蒸馏功能
```bash
curl -X POST http://localhost:3000/api/distillation \
  -H "Content-Type: application/json" \
  -d '{"keyword": "英国留学"}' | jq
```

检查返回的 `count` 字段是否等于配置的数量。

### 方法3：前端界面测试

#### 测试配置保存
1. 访问 `http://localhost:5173/config`
2. 切换到"关键词蒸馏配置"标签
3. 修改话题数量为15
4. 点击"保存配置"
5. 看到成功提示

#### 测试配置应用
1. 访问关键词蒸馏页面
2. 输入关键词"测试"
3. 点击"开始蒸馏"
4. 等待完成
5. 检查生成的话题数量是否为15个

---

## 常见问题

### Q1: 提示词必须包含什么？

**A:** 必须包含两个占位符：
- `{keyword}` - 关键词占位符
- `{count}` - 数量占位符

如果缺少任何一个，保存时会提示错误。

### Q2: 话题数量可以设置多少？

**A:** 5-30个之间。
- 少于5个：系统会提示"数量必须在5-30之间"
- 多于30个：同样会被拒绝

### Q3: 修改配置后立即生效吗？

**A:** 是的！配置保存后，下一次蒸馏任务就会使用新配置。

### Q4: 旧的蒸馏记录会受影响吗？

**A:** 不会。配置只影响新的蒸馏任务，已有的蒸馏记录保持不变。

### Q5: 如何恢复默认配置？

**A:** 在配置页面将内容改回默认值，然后保存：
- 提示词：复制默认提示词
- 话题数量：设置为12

### Q6: 可以保存多个配置吗？

**A:** 可以保存多个配置，但系统只使用最新保存的配置（标记为激活状态）。

### Q7: 如果AI生成的话题数量不符合配置怎么办？

**A:** AI可能生成略少或略多的话题。系统会：
1. 将配置的数量告诉AI
2. AI尽量按要求生成
3. 实际数量可能有±2个的偏差

### Q8: 提示词可以多长？

**A:** 理论上没有长度限制，但建议：
- 保持在500-1000字符
- 过长的提示词可能影响AI理解
- 过短的提示词可能不够清晰

### Q9: 如何查看配置历史？

**A:** 当前版本不支持查看历史。可以通过数据库查询：
```bash
psql $DATABASE_URL -c "SELECT * FROM distillation_config ORDER BY created_at DESC;"
```

### Q10: 配置出错了怎么办？

**A:** 如果配置导致蒸馏失败：
1. 检查提示词是否包含必需的占位符
2. 检查提示词是否清晰明确
3. 尝试恢复默认配置
4. 查看服务器日志获取详细错误信息

---

## 高级技巧

### 技巧1：针对不同行业定制提示词

**教育行业示例：**
```
你是教育咨询专家。请根据关键词"{keyword}"，生成{count}个学生和家长可能搜索的问题。

要求：
1. 关注教育质量、师资力量、课程设置
2. 包含价格、地点、口碑等实际关注点
3. 语言要贴近家长和学生的表达习惯

请直接返回问题列表。
```

**医疗行业示例：**
```
你是医疗健康顾问。请根据关键词"{keyword}"，生成{count}个患者可能搜索的问题。

要求：
1. 关注症状、治疗方法、医院选择
2. 包含费用、效果、风险等关键信息
3. 语言要专业但易懂

请直接返回问题列表。
```

### 技巧2：控制话题的多样性

在提示词中明确要求不同类型的问题：

```
请生成{count}个问题，包括：
- 30% 比较类问题（"哪家好"、"哪个更好"）
- 30% 推荐类问题（"推荐"、"靠谱的"）
- 20% 评价类问题（"怎么样"、"口碑"）
- 20% 咨询类问题（"如何选择"、"注意事项"）
```

### 技巧3：添加地域限制

如果需要生成特定地域的问题：

```
请根据关键词"{keyword}"，生成{count}个中国用户在搜索时可能提出的问题。
问题应该符合中国市场的特点和用户习惯。
```

### 技巧4：控制问题长度

```
要求：
1. 每个问题控制在10-20个字
2. 问题要简洁明了
3. 避免过于复杂的表述
```

---

## 最佳实践

### ✅ 推荐做法

1. **清晰的角色定位**
   ```
   你是一个专业的[领域]专家
   ```

2. **明确的任务描述**
   ```
   请根据关键词"{keyword}"，生成{count}个[具体内容]
   ```

3. **具体的要求列表**
   ```
   要求：
   1. [具体要求1]
   2. [具体要求2]
   ```

4. **有代表性的示例**
   ```
   示例（关键词：XXX）：
   - 示例1
   - 示例2
   ```

5. **明确的输出格式**
   ```
   请直接返回问题列表，每行一个问题，不要编号
   ```

### ❌ 避免的做法

1. **模糊的指令**
   ```
   ❌ 生成一些问题
   ✅ 生成{count}个真实用户可能搜索的问题
   ```

2. **过于复杂的要求**
   ```
   ❌ 要求1包含子要求1.1、1.2、1.3...
   ✅ 保持要求简洁明了
   ```

3. **缺少示例**
   ```
   ❌ 只有要求，没有示例
   ✅ 提供2-3个代表性示例
   ```

4. **忘记占位符**
   ```
   ❌ 请根据关键词，生成10个问题
   ✅ 请根据关键词"{keyword}"，生成{count}个问题
   ```

---

## 故障排除

### 问题1：保存配置时提示"必须包含占位符"

**原因**：提示词中缺少 `{keyword}` 或 `{count}`

**解决**：
1. 检查提示词
2. 确保包含 `{keyword}` 和 `{count}`
3. 注意大小写和拼写

### 问题2：蒸馏生成的话题数量不对

**原因**：AI可能没有严格按照数量生成

**解决**：
1. 在提示词中强调数量要求
2. 添加示例说明期望的数量
3. 适当调整提示词的表述

### 问题3：生成的话题质量不高

**原因**：提示词不够清晰或示例不够好

**解决**：
1. 优化提示词，使要求更明确
2. 提供更好的示例
3. 增加对质量的具体要求

### 问题4：配置保存成功但没有生效

**原因**：可能是缓存问题或服务未重启

**解决**：
1. 刷新浏览器页面
2. 清除浏览器缓存
3. 重启后端服务

---

## 相关文档

- 📖 [关键词蒸馏配置功能说明.md](./关键词蒸馏配置功能说明.md) - 详细技术文档
- 🚀 [关键词蒸馏配置-快速开始.md](./关键词蒸馏配置-快速开始.md) - 快速入门指南
- 📝 [关键词蒸馏配置-实现总结.md](./关键词蒸馏配置-实现总结.md) - 实现细节总结

---

## 技术支持

如有问题，请：
1. 查看本文档的常见问题部分
2. 运行验证脚本检查系统状态
3. 查看服务器日志获取详细错误信息
4. 联系技术支持团队

---

**祝您使用愉快！** 🎉
