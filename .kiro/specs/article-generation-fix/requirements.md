# 需求文档：文章生成失败诊断与修复

## 简介

当前文章生成模块存在问题：生成任务显示为"已完成"状态，但实际上没有生成任何文章。用户在文章生成页面看到任务完成，但在文章管理页面看不到生成的文章。需要诊断并修复这个问题。

## 术语表

- **生成任务（Generation Task）**：用户创建的文章批量生成任务
- **文章生成服务（Article Generation Service）**：负责执行文章生成任务的后端服务
- **任务状态（Task Status）**：任务的执行状态，包括pending（等待）、running（执行中）、completed（已完成）、failed（失败）

## 需求

### 需求 1：诊断文章生成失败原因

**用户故事：** 作为开发者，我想要诊断为什么文章生成任务显示完成但没有生成文章，以便找到问题根源。

#### 验收标准

1. WHEN 执行诊断脚本 THEN 系统应该输出详细的错误日志和失败原因
2. WHEN 文章生成过程中发生错误 THEN 系统应该记录具体的错误信息到error_message字段
3. WHEN 任务执行失败 THEN 系统应该将任务状态标记为failed而不是completed

### 需求 2：增强错误处理和日志记录

**用户故事：** 作为开发者，我想要在文章生成过程中有详细的错误日志，以便快速定位问题。

#### 验收标准

1. WHEN 文章生成服务执行任务 THEN 系统应该在每个关键步骤记录日志
2. WHEN 单篇文章生成失败 THEN 系统应该记录该文章的失败原因并继续处理下一篇
3. WHEN 所有文章都生成失败 THEN 系统应该将任务状态标记为failed并记录错误信息
4. WHEN 部分文章生成成功 THEN 系统应该将任务状态标记为completed并记录成功生成的数量

### 需求 3：修复文章生成逻辑

**用户故事：** 作为用户，我想要文章生成任务能够正确执行并保存文章，以便在文章管理页面查看生成的文章。

#### 验收标准

1. WHEN 文章生成任务执行 THEN 系统应该正确调用AI服务生成文章内容
2. WHEN 文章内容生成成功 THEN 系统应该将文章保存到articles表
3. WHEN 文章保存成功 THEN 系统应该更新任务的generated_count和progress
4. WHEN 任务完成 THEN 用户应该能在文章管理页面看到生成的文章

### 需求 4：添加任务重试功能

**用户故事：** 作为用户，我想要能够重新执行失败的生成任务，以便在修复问题后重新生成文章。

#### 验收标准

1. WHEN 用户点击重试按钮 THEN 系统应该重新执行该生成任务
2. WHEN 重新执行任务 THEN 系统应该清除之前的错误信息
3. WHEN 重新执行任务 THEN 系统应该将任务状态重置为pending
