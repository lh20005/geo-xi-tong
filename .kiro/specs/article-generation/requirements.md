# 需求文档

## 简介

文章生成模块是一个自动化内容创作系统，它整合了关键词蒸馏、企业图库、企业知识库和文章设置等多个模块的数据，通过AI大模型自动生成高质量文章。该模块位于侧边栏"文章设置"下方，支持批量生成文章并将结果保存到文章管理模块中。

## 术语表

- **文章生成系统 (Article Generation System)**: 整合多个数据源并调用AI模型生成文章的核心系统
- **生成任务 (Generation Task)**: 用户创建的一次文章生成请求，包含所有配置参数
- **蒸馏历史数据 (Distillation History Data)**: 来自关键词蒸馏模块的历史记录，包含关键词和对应的蒸馏结果
- **企业图库 (Enterprise Gallery)**: 存储企业图片资源的模块
- **企业知识库 (Enterprise Knowledge Base)**: 存储企业知识内容的模块
- **文章设置 (Article Settings)**: 包含文章生成提示词和其他配置的模块
- **任务历史列表 (Task History List)**: 显示所有生成任务及其执行状态的列表
- **文章管理模块 (Article Management Module)**: 展示和管理已生成文章的模块

## 需求

### 需求 1

**用户故事:** 作为内容创作者，我想要通过侧边栏访问文章生成模块，以便快速找到并使用文章生成功能。

#### 验收标准

1. WHEN 用户查看侧边栏 THEN 文章生成系统 SHALL 在"文章设置"模块下方显示"生成文章"菜单项
2. WHEN 用户点击"生成文章"菜单项 THEN 文章生成系统 SHALL 导航到文章生成页面
3. WHEN 文章生成页面加载 THEN 文章生成系统 SHALL 显示"新建任务"按钮和任务历史列表

### 需求 2

**用户故事:** 作为内容创作者，我想要创建新的文章生成任务，以便配置生成参数并启动文章生成流程。

#### 验收标准

1. WHEN 用户点击"新建任务"按钮 THEN 文章生成系统 SHALL 打开任务配置弹窗
2. WHEN 任务配置弹窗打开 THEN 文章生成系统 SHALL 显示所有必需的数据选择器和配置选项
3. WHEN 用户关闭任务配置弹窗 THEN 文章生成系统 SHALL 返回到文章生成主页面

### 需求 3

**用户故事:** 作为内容创作者，我想要选择蒸馏历史数据，以便基于特定的关键词和蒸馏结果生成文章。

#### 验收标准

1. WHEN 任务配置弹窗显示 THEN 文章生成系统 SHALL 提供蒸馏历史数据的下拉选择器
2. WHEN 用户打开蒸馏历史下拉列表 THEN 文章生成系统 SHALL 显示所有可用的蒸馏历史记录
3. WHEN 用户选择一条蒸馏历史记录 THEN 文章生成系统 SHALL 保存该选择并显示选中的记录信息
4. WHEN 蒸馏历史数据包含多个关键词 THEN 文章生成系统 SHALL 确保每个关键词与其对应的蒸馏结果保持一一对应关系

### 需求 4

**用户故事:** 作为内容创作者，我想要选择企业图库数据，以便为生成的文章配图。

#### 验收标准

1. WHEN 任务配置弹窗显示 THEN 文章生成系统 SHALL 提供企业图库的下拉选择器
2. WHEN 用户打开企业图库下拉列表 THEN 文章生成系统 SHALL 显示所有可用的图库相册或图片集合
3. WHEN 用户选择一个图库 THEN 文章生成系统 SHALL 保存该选择并显示选中的图库信息

### 需求 5

**用户故事:** 作为内容创作者，我想要选择企业知识库数据，以便生成的文章内容符合企业知识体系。

#### 验收标准

1. WHEN 任务配置弹窗显示 THEN 文章生成系统 SHALL 提供企业知识库的下拉选择器
2. WHEN 用户打开企业知识库下拉列表 THEN 文章生成系统 SHALL 显示所有可用的知识库
3. WHEN 用户选择一个知识库 THEN 文章生成系统 SHALL 保存该选择并显示选中的知识库信息

### 需求 6

**用户故事:** 作为内容创作者，我想要选择文章设置，以便按照预定义的提示词和格式要求生成文章。

#### 验收标准

1. WHEN 任务配置弹窗显示 THEN 文章生成系统 SHALL 提供文章设置的下拉选择器
2. WHEN 用户打开文章设置下拉列表 THEN 文章生成系统 SHALL 显示所有可用的文章设置配置
3. WHEN 用户选择一个文章设置 THEN 文章生成系统 SHALL 保存该选择并显示选中的设置信息

### 需求 7

**用户故事:** 作为内容创作者，我想要设置生成文章的数量，以便控制一次任务生成多少篇文章。

#### 验收标准

1. WHEN 任务配置弹窗显示 THEN 文章生成系统 SHALL 提供文章数量输入框
2. WHEN 用户输入文章数量 THEN 文章生成系统 SHALL 验证输入值为正整数
3. WHEN 用户输入无效的数量值 THEN 文章生成系统 SHALL 显示错误提示并阻止任务创建
4. WHEN 用户输入的数量超过蒸馏历史中的关键词数量 THEN 文章生成系统 SHALL 显示警告提示

### 需求 8

**用户故事:** 作为内容创作者，我想要提交配置好的生成任务，以便系统开始生成文章。

#### 验收标准

1. WHEN 用户完成所有必需配置 THEN 文章生成系统 SHALL 启用"生成文章"按钮
2. WHEN 任何必需配置项未填写 THEN 文章生成系统 SHALL 禁用"生成文章"按钮
3. WHEN 用户点击"生成文章"按钮 THEN 文章生成系统 SHALL 创建新的生成任务并关闭配置弹窗
4. WHEN 生成任务创建成功 THEN 文章生成系统 SHALL 在任务历史列表中添加该任务并显示"执行中"状态

### 需求 9

**用户故事:** 作为内容创作者，我想要查看任务历史列表，以便了解所有生成任务的状态和结果。

#### 验收标准

1. WHEN 文章生成页面加载 THEN 文章生成系统 SHALL 显示所有历史生成任务
2. WHEN 显示任务列表 THEN 文章生成系统 SHALL 展示每个任务的创建时间、配置信息、状态和生成结果数量
3. WHEN 任务状态为"执行中" THEN 文章生成系统 SHALL 显示进度指示器
4. WHEN 任务状态为"已完成" THEN 文章生成系统 SHALL 显示成功生成的文章数量
5. WHEN 任务状态为"失败" THEN 文章生成系统 SHALL 显示错误信息

### 需求 10

**用户故事:** 作为系统，我需要执行文章生成任务，以便根据配置的参数自动生成文章内容。

#### 验收标准

1. WHEN 生成任务开始执行 THEN 文章生成系统 SHALL 从选定的蒸馏历史中按顺序提取关键词和蒸馏结果对
2. WHEN 处理每个关键词-蒸馏结果对 THEN 文章生成系统 SHALL 从选定的企业图库中随机选择一张图片
3. WHEN 准备生成单篇文章 THEN 文章生成系统 SHALL 组合当前关键词、蒸馏结果、选中的图片、知识库内容和文章设置提示词
4. WHEN 调用AI模型 THEN 文章生成系统 SHALL 传递组合后的完整上下文信息
5. WHEN AI模型返回生成结果 THEN 文章生成系统 SHALL 解析出文章标题和内容
6. WHEN 达到设定的生成数量 THEN 文章生成系统 SHALL 停止生成并标记任务为"已完成"

### 需求 11

**用户故事:** 作为系统，我需要确保每篇文章只围绕一组关键词-蒸馏结果数据生成，以便保持文章主题的一致性和准确性。

#### 验收标准

1. WHEN 生成单篇文章 THEN 文章生成系统 SHALL 仅使用一个关键词及其对应的蒸馏结果
2. WHEN 生成多篇文章 THEN 文章生成系统 SHALL 为每篇文章使用不同的关键词-蒸馏结果对
3. WHEN 关键词数量少于请求的文章数量 THEN 文章生成系统 SHALL 仅生成与关键词数量相等的文章数

### 需求 12

**用户故事:** 作为系统，我需要将生成的文章保存到文章管理模块，以便用户可以查看和管理这些文章。

#### 验收标准

1. WHEN 单篇文章生成完成 THEN 文章生成系统 SHALL 将文章标题和内容分别保存到数据库
2. WHEN 保存文章 THEN 文章生成系统 SHALL 关联生成任务ID、使用的关键词、图片URL和创建时间
3. WHEN 所有文章保存完成 THEN 文章生成系统 SHALL 更新任务状态为"已完成"
4. WHEN 保存过程中发生错误 THEN 文章生成系统 SHALL 记录错误信息并标记任务为"失败"

### 需求 13

**用户故事:** 作为内容管理者，我想要在文章管理模块中查看生成的文章，以便审阅和编辑这些内容。

#### 验收标准

1. WHEN 用户访问文章管理模块 THEN 文章生成系统 SHALL 显示所有已生成的文章列表
2. WHEN 显示文章列表 THEN 文章生成系统 SHALL 每页展示10条文章记录
3. WHEN 文章列表包含超过10条记录 THEN 文章生成系统 SHALL 提供分页导航功能
4. WHEN 显示单条文章记录 THEN 文章生成系统 SHALL 展示文章标题、创建时间和内容预览
5. WHEN 用户点击文章记录 THEN 文章生成系统 SHALL 显示完整的文章标题和内容

### 需求 14

**用户故事:** 作为系统管理员，我需要系统处理生成过程中的错误，以便确保系统稳定性和数据完整性。

#### 验收标准

1. WHEN AI模型调用失败 THEN 文章生成系统 SHALL 记录错误信息并继续处理下一篇文章
2. WHEN 数据库保存失败 THEN 文章生成系统 SHALL 回滚当前文章的保存操作并记录错误
3. WHEN 选定的图库为空 THEN 文章生成系统 SHALL 使用默认占位图片或跳过图片选择
4. WHEN 任务执行过程中发生致命错误 THEN 文章生成系统 SHALL 标记任务为"失败"并保存已生成的文章
