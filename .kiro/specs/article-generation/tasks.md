# 实施计划

- [x] 1. 数据库架构设置
  - 创建generation_tasks表用于存储生成任务
  - 扩展articles表添加task_id、title、image_url字段
  - 创建必要的索引优化查询性能
  - _需求: 12.1, 12.2, 8.4_

- [x] 2. 后端核心服务实现
  - 创建ArticleGenerationService服务类
  - 实现任务创建和配置验证逻辑
  - 实现任务状态管理方法
  - _需求: 8.3, 8.4, 10.1_

- [x] 2.1 编写属性测试：任务创建持久化
  - **属性 8: 任务创建持久化**
  - **验证: 需求 8.3, 8.4**

- [x] 3. 数据获取和准备逻辑
  - 实现从蒸馏历史提取关键词-结果对的方法
  - 实现从图库随机选择图片的方法
  - 实现获取知识库内容的方法
  - 实现获取文章设置提示词的方法
  - _需求: 10.1, 10.2, 10.3_

- [x] 3.1 编写属性测试：关键词顺序提取
  - **属性 10: 关键词顺序提取**
  - **验证: 需求 10.1**

- [x] 3.2 编写属性测试：图片随机选择有效性
  - **属性 11: 图片随机选择有效性**
  - **验证: 需求 10.2**

- [x] 3.3 编写属性测试：关键词-蒸馏结果一一对应
  - **属性 3: 关键词-蒸馏结果一一对应**
  - **验证: 需求 3.4**

- [x] 4. AI文章生成逻辑
  - 实现构建AI prompt的方法，整合所有上下文信息
  - 实现调用AIService生成文章的方法
  - 实现解析AI响应提取标题和内容的方法
  - 添加错误处理和重试逻辑
  - _需求: 10.3, 10.4, 10.5_

- [x] 4.1 编写属性测试：文章生成上下文完整性
  - **属性 12: 文章生成上下文完整性**
  - **验证: 需求 10.3, 10.4**

- [x] 4.2 编写属性测试：AI响应解析完整性
  - **属性 13: AI响应解析完整性**
  - **验证: 需求 10.5**

- [x] 5. 文章生成主流程
  - 实现单篇文章生成方法，确保数据隔离
  - 实现批量生成循环逻辑
  - 实现生成数量控制和终止条件
  - 实现进度更新逻辑
  - _需求: 11.1, 11.2, 11.3, 10.6_

- [x] 5.1 编写属性测试：单文章数据隔离
  - **属性 15: 单文章数据隔离**
  - **验证: 需求 11.1**

- [x] 5.2 编写属性测试：多文章数据唯一性
  - **属性 16: 多文章数据唯一性**
  - **验证: 需求 11.2**

- [x] 5.3 编写属性测试：关键词数量限制
  - **属性 17: 关键词数量限制**
  - **验证: 需求 11.3**

- [x] 5.4 编写属性测试：生成数量终止条件
  - **属性 14: 生成数量终止条件**
  - **验证: 需求 10.6**

- [x] 6. 文章持久化逻辑
  - 实现保存单篇文章到数据库的方法
  - 确保保存所有必需字段（标题、内容、关键词、任务ID、图片URL）
  - 实现任务完成后的状态更新
  - 添加事务支持确保数据一致性
  - _需求: 12.1, 12.2, 12.3_

- [x] 6.1 编写属性测试：文章保存完整性
  - **属性 18: 文章保存完整性**
  - **验证: 需求 12.1, 12.2**

- [x] 6.2 编写属性测试：任务完成状态更新
  - **属性 19: 任务完成状态更新**
  - **验证: 需求 12.3**

- [x] 7. 错误处理和恢复
  - 实现AI调用失败的错误处理
  - 实现数据库保存失败的回滚逻辑
  - 实现空图库的默认处理
  - 实现任务失败状态的记录
  - _需求: 14.1, 14.2, 14.3, 14.4_

- [x] 8. 后端API路由实现
  - 创建/api/article-generation/tasks路由
  - 实现POST创建任务端点
  - 实现GET获取任务列表端点（支持分页）
  - 实现GET获取任务详情端点
  - 添加Zod验证schema
  - _需求: 8.3, 9.1_

- [x] 8.1 编写单元测试：API路由验证和错误处理

- [x] 9. 扩展文章API
  - 扩展/api/articles路由支持taskId筛选
  - 实现分页查询（每页10条）
  - 返回文章的完整信息包括图片URL
  - _需求: 13.1, 13.2_

- [x] 9.1 编写属性测试：文章列表分页一致性
  - **属性 20: 文章列表分页一致性**
  - **验证: 需求 13.2**

- [x] 10. 前端类型定义
  - 创建TypeScript类型定义文件
  - 定义TaskConfig、GenerationTask、Article等接口
  - 定义API响应类型
  - _需求: 8.1, 9.2_

- [x] 11. 前端API客户端
  - 创建articleGenerationApi.ts封装API调用
  - 实现createTask方法
  - 实现fetchTasks方法
  - 实现fetchTaskDetail方法
  - 添加错误处理
  - _需求: 8.3, 9.1_

- [x] 12. TaskConfigModal组件
  - 创建任务配置弹窗组件
  - 实现表单布局（所有数据源选择器和数量输入）
  - 实现数据源加载逻辑（蒸馏历史、图库、知识库、文章设置）
  - 实现表单状态管理
  - _需求: 2.1, 2.2, 3.1, 4.1, 5.1, 6.1, 7.1_

- [x] 12.1 编写属性测试：数据源选择完整性
  - **属性 1: 数据源选择完整性**
  - **验证: 需求 3.2, 4.2, 5.2, 6.2**

- [x] 12.2 编写属性测试：选择状态持久化
  - **属性 2: 选择状态持久化**
  - **验证: 需求 3.3, 4.3, 5.3, 6.3**

- [x] 13. 表单验证逻辑
  - 实现文章数量输入验证（正整数）
  - 实现无效输入的错误提示
  - 实现数量超限的警告提示
  - 实现表单完整性验证（所有必需字段）
  - 根据验证状态控制提交按钮
  - _需求: 7.2, 7.3, 7.4, 8.1, 8.2_

- [x] 13.1 编写属性测试：输入验证正整数
  - **属性 4: 输入验证正整数**
  - **验证: 需求 7.2**

- [x] 13.2 编写属性测试：无效输入错误提示
  - **属性 5: 无效输入错误提示**
  - **验证: 需求 7.3**

- [x] 13.3 编写属性测试：数量超限警告
  - **属性 6: 数量超限警告**
  - **验证: 需求 7.4**

- [x] 13.4 编写属性测试：表单完整性验证
  - **属性 7: 表单完整性验证**
  - **验证: 需求 8.1, 8.2**

- [x] 14. 任务提交逻辑
  - 实现表单提交处理
  - 调用API创建任务
  - 处理成功和失败响应
  - 关闭弹窗并刷新任务列表
  - _需求: 8.3, 8.4_

- [x] 15. TaskHistoryList组件
  - 创建任务历史列表组件
  - 实现任务列表渲染
  - 显示任务状态（执行中/已完成/失败）
  - 显示进度条和统计信息
  - 实现刷新功能
  - _需求: 9.1, 9.2, 9.3, 9.4, 9.5_

- [x] 15.1 编写单元测试：任务状态显示

- [x] 16. ArticleGenerationPage主页面
  - 创建文章生成主页面组件
  - 实现"新建任务"按钮
  - 集成TaskConfigModal组件
  - 集成TaskHistoryList组件
  - 实现任务列表加载和分页
  - 实现定时刷新任务状态
  - _需求: 1.3, 2.1, 9.1_

- [x] 17. 侧边栏菜单更新
  - 在Sidebar组件中添加"生成文章"菜单项
  - 配置路由导航到文章生成页面
  - 确保菜单项位于"文章设置"下方
  - _需求: 1.1, 1.2_

- [x] 18. 路由配置
  - 在App.tsx中添加/article-generation路由
  - 配置ArticleGenerationPage组件
  - 测试路由导航
  - _需求: 1.2_

- [x] 19. 扩展ArticleListPage
  - 添加按任务筛选功能
  - 显示文章关联的图片
  - 确保分页每页显示10条
  - 实现文章详情查看
  - _需求: 13.1, 13.2, 13.3, 13.4, 13.5_

- [x] 19.1 编写属性测试：文章记录渲染完整性
  - **属性 21: 文章记录渲染完整性**
  - **验证: 需求 13.4**

- [x] 20. 样式和UI优化
  - 使用Ant Design组件库统一样式
  - 实现响应式布局
  - 添加加载状态指示器
  - 优化用户体验
  - _需求: 1.3, 2.2, 9.3_

- [x] 21. 检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户

- [x] 22. 集成测试
  - 测试完整的任务创建到执行流程
  - 测试多模块数据集成
  - 测试错误场景和恢复
  - 验证数据持久化
  - _需求: 所有需求_

- [x] 22.1 编写端到端测试：完整生成流程

- [x] 23. 文档和部署准备
  - 编写API文档
  - 更新数据库迁移脚本
  - 编写部署说明
  - 准备环境变量配置示例
  - _需求: 所有需求_
