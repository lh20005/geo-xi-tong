# 实施计划

- [x] 1. 数据库架构和迁移
  - 创建albums和images表的SQL schema
  - 创建数据库迁移脚本
  - 添加必要的索引和外键约束
  - 运行迁移并验证表结构
  - _需求: 2.3, 3.5, 7.3, 8.3_

- [ ] 2. 后端API基础设施
  - [x] 2.1 创建gallery路由模块
    - 创建`server/src/routes/gallery.ts`文件
    - 定义路由结构和端点
    - 在`server/src/routes/index.ts`中注册gallery路由
    - _需求: 10.1, 10.2_

  - [x] 2.2 创建数据验证schemas
    - 使用Zod定义CreateAlbumRequest schema
    - 定义UpdateAlbumRequest schema
    - 定义ImageUpload schema
    - 添加文件类型和大小验证规则
    - _需求: 2.4, 3.2, 3.3, 3.4_

  - [ ]* 2.3 编写属性测试：相册名称验证
    - **属性 2: 相册名称验证**
    - **验证需求: 2.4, 9.4**

- [ ] 3. 相册管理API实现
  - [x] 3.1 实现获取所有相册API
    - 实现GET /api/gallery/albums端点
    - 查询albums表并关联图片数量
    - 获取封面图（第一张图片）
    - 返回相册列表数据
    - _需求: 4.1, 4.2, 4.3_

  - [ ]* 3.2 编写属性测试：相册列表完整性
    - **属性 5: 相册列表完整性**
    - **验证需求: 4.1, 4.2**

  - [x] 3.3 实现创建相册API
    - 实现POST /api/gallery/albums端点
    - 验证相册名称
    - 插入相册记录到数据库
    - 如果包含图片，批量插入图片记录
    - 返回创建的相册信息
    - _需求: 2.3, 3.5_

  - [ ]* 3.4 编写属性测试：相册创建持久化
    - **属性 1: 相册创建持久化**
    - **验证需求: 2.3**

  - [ ]* 3.5 编写属性测试：Base64编码持久化
    - **属性 4: 图片Base64编码持久化**
    - **验证需求: 3.5**

  - [x] 3.6 实现获取相册详情API
    - 实现GET /api/gallery/albums/:id端点
    - 查询相册信息
    - 查询该相册的所有图片
    - 返回相册和图片数据
    - 处理相册不存在的情况（404）
    - _需求: 5.2, 10.1_

  - [ ]* 3.7 编写属性测试：API图片查询完整性
    - **属性 12: API图片查询完整性**
    - **验证需求: 10.1, 10.3**

  - [x] 3.8 实现更新相册名称API
    - 实现PATCH /api/gallery/albums/:id端点
    - 验证新名称
    - 更新数据库中的相册名称
    - 返回更新后的相册信息
    - _需求: 9.3, 9.4_

  - [ ]* 3.9 编写属性测试：相册名称更新
    - **属性 11: 相册名称更新**
    - **验证需求: 9.3**

  - [x] 3.10 实现删除相册API
    - 实现DELETE /api/gallery/albums/:id端点
    - 删除相册记录（级联删除图片）
    - 返回删除结果
    - _需求: 8.3_

  - [ ]* 3.11 编写属性测试：相册删除级联效果
    - **属性 10: 相册删除级联效果**
    - **验证需求: 8.3**

- [ ] 4. 图片管理API实现
  - [x] 4.1 实现上传图片到相册API
    - 实现POST /api/gallery/albums/:albumId/images端点
    - 验证相册存在
    - 验证图片文件类型和大小
    - 批量插入图片记录
    - 返回上传结果
    - _需求: 6.3, 6.5_

  - [ ]* 4.2 编写属性测试：文件类型验证
    - **属性 3: 图片文件类型验证**
    - **验证需求: 3.2, 3.3**

  - [ ]* 4.3 编写属性测试：批量上传完整性
    - **属性 8: 批量上传完整性**
    - **验证需求: 6.3, 6.5**

  - [x] 4.4 实现获取单张图片API
    - 实现GET /api/gallery/images/:id端点
    - 查询图片数据
    - 返回完整的图片信息（包括Base64数据）
    - 处理图片不存在的情况（404）
    - _需求: 10.2, 10.3_

  - [ ]* 4.5 编写属性测试：API单图片查询
    - **属性 13: API单图片查询**
    - **验证需求: 10.2, 10.3**

  - [x] 4.6 实现删除图片API
    - 实现DELETE /api/gallery/images/:id端点
    - 删除图片记录
    - 返回删除结果
    - _需求: 7.3_

  - [ ]* 4.7 编写属性测试：图片删除级联效果
    - **属性 9: 图片删除级联效果**
    - **验证需求: 7.3**

- [x] 5. 检查点 - 后端API测试
  - 确保所有测试通过，如有问题请询问用户

- [ ] 6. 前端路由和导航
  - [x] 6.1 添加企业图库路由
    - 在`client/src/App.tsx`中添加/gallery路由
    - 在`client/src/App.tsx`中添加/gallery/:albumId路由
    - _需求: 1.2_

  - [x] 6.2 更新侧边栏导航
    - 在`client/src/components/Layout/Sidebar.tsx`中添加"企业图库"菜单项
    - 使用PictureOutlined图标
    - 放置在"关键词蒸馏"菜单项下方
    - _需求: 1.1, 1.3_

- [ ] 7. 相册列表页面实现
  - [x] 7.1 创建GalleryPage组件
    - 创建`client/src/pages/GalleryPage.tsx`文件
    - 实现基础组件结构和状态管理
    - 添加页面标题和"创建相册"按钮
    - _需求: 2.1_

  - [x] 7.2 实现相册列表加载和显示
    - 实现loadAlbums函数调用API
    - 使用Ant Design Card组件展示相册卡片
    - 显示相册名称、图片数量、创建时间
    - 显示封面图或默认占位图
    - 实现空状态提示
    - _需求: 4.1, 4.2, 4.3, 4.4, 4.5_

  - [x] 7.3 实现创建相册对话框
    - 创建Modal对话框组件
    - 添加相册名称输入框
    - 添加图片上传组件（Upload）
    - 实现文件类型和大小验证
    - 显示图片预览
    - _需求: 2.2, 3.1, 3.2, 3.6_

  - [x] 7.4 实现创建相册功能
    - 实现handleCreateAlbum函数
    - 验证相册名称
    - 将图片转换为Base64
    - 调用创建相册API
    - 显示成功消息并刷新列表
    - 处理错误情况
    - _需求: 2.3, 2.4, 2.5, 3.3, 3.4, 3.5_

  - [x] 7.5 实现相册卡片操作功能
    - 添加编辑相册名称功能
    - 添加删除相册功能
    - 实现确认对话框
    - 点击卡片导航到详情页
    - _需求: 5.1, 8.1, 8.2, 9.1, 9.2_

- [ ] 8. 相册详情页面实现
  - [x] 8.1 创建AlbumDetailPage组件
    - 创建`client/src/pages/AlbumDetailPage.tsx`文件
    - 实现基础组件结构和状态管理
    - 从URL参数获取albumId
    - _需求: 5.1_

  - [x] 8.2 实现相册详情加载和显示
    - 实现loadAlbumDetail函数调用API
    - 显示相册名称和操作按钮
    - 使用网格布局展示图片
    - 实现空状态提示
    - _需求: 5.2, 5.5_

  - [x] 8.3 实现图片网格和缩略图显示
    - 使用Ant Design Image组件
    - 实现响应式网格布局
    - 显示图片缩略图
    - 在每张图片上显示删除按钮
    - _需求: 5.3, 7.1_

  - [x] 8.4 实现图片预览功能
    - 点击缩略图显示大图
    - 使用Ant Design Image.PreviewGroup
    - 支持图片切换和缩放
    - _需求: 5.4_

  - [x] 8.5 实现上传图片功能
    - 添加"上传图片"按钮
    - 实现文件选择对话框
    - 支持多文件选择
    - 显示上传进度
    - 上传完成后刷新图片列表
    - _需求: 6.1, 6.2, 6.3, 6.4, 6.5_

  - [x] 8.6 实现删除图片功能
    - 实现handleDeleteImage函数
    - 显示确认对话框
    - 调用删除API
    - 从列表中移除图片
    - 显示成功消息
    - _需求: 7.2, 7.3, 7.4, 7.5_

  - [x] 8.7 实现相册操作功能
    - 添加编辑相册名称按钮
    - 添加删除相册按钮
    - 删除后返回列表页
    - _需求: 8.1, 8.2, 8.3, 8.4, 9.1, 9.2, 9.3, 9.5_

- [x] 9. 检查点 - 前端功能测试
  - 确保所有测试通过，如有问题请询问用户

- [ ] 10. 错误处理和用户体验优化
  - [x] 10.1 完善前端错误处理
    - 添加axios错误拦截器
    - 实现统一的错误消息显示
    - 处理网络请求失败情况
    - 处理资源不存在情况
    - _需求: 4.6_

  - [x] 10.2 完善后端错误处理
    - 使用errorHandler中间件
    - 返回标准化的错误响应
    - 记录错误日志
    - _需求: 10.4, 10.5_

  - [x] 10.3 添加加载状态和反馈
    - 添加loading状态指示器
    - 添加操作成功提示
    - 优化按钮禁用状态
    - 添加空状态插图和提示文案

- [ ]* 11. 前端单元测试
  - 编写GalleryPage组件测试
  - 编写AlbumDetailPage组件测试
  - 编写文件验证函数测试
  - 编写Base64转换函数测试

- [ ]* 12. 集成测试
  - 编写端到端流程测试
  - 测试创建相册并上传图片流程
  - 测试查看和删除图片流程
  - 测试删除相册流程

- [x] 13. 最终检查点
  - 确保所有测试通过，如有问题请询问用户
  - 验证所有需求都已实现
  - 检查UI/UX是否符合设计
