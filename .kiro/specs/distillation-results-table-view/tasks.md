# 实现计划

- [ ] 1. 数据库层：优化查询逻辑
  - [x] 1.1 在database.ts中创建获取带引用次数的话题列表的查询方法
    - 实现SQL查询，使用LEFT JOIN连接topics、distillations和articles表
    - 使用COUNT聚合函数统计引用次数
    - 支持按关键词、AI模型筛选
    - 支持分页（LIMIT和OFFSET）
    - _需求：6.1, 6.3_
  
  - [x] 1.2 编写属性测试验证引用计数准确性
    - **属性 1: 引用计数准确性**
    - **验证需求：2.1, 2.2, 2.3**
  
  - [x] 1.3 在database.ts中创建批量删除话题的方法
    - 实现批量删除topics记录的SQL
    - 使用事务确保数据一致性
    - 返回删除的记录数
    - _需求：4.4_
  
  - [x] 1.4 编写属性测试验证删除操作完整性
    - **属性 2: 删除操作完整性**
    - **验证需求：4.3, 4.4**
  
  - [x] 1.5 在database.ts中创建获取统计信息的查询方法
    - 查询总话题数
    - 查询不同关键词数量
    - 查询总被引用次数
    - 支持筛选条件
    - _需求：5.1, 5.2, 5.3_
  
  - [x] 1.6 编写属性测试验证统计数据一致性
    - **属性 5: 统计数据一致性**
    - **验证需求：5.1, 5.2, 5.3, 5.4**

- [ ] 2. 后端服务层：实现业务逻辑
  - [x] 2.1 在distillationService.ts中实现getResultsWithReferences方法
    - 调用数据库查询方法
    - 处理筛选参数
    - 格式化返回数据
    - 实现错误处理和日志记录
    - _需求：2.1, 3.2, 3.3, 6.3, 6.5_
  
  - [x] 2.2 编写单元测试验证服务方法正确性
    - 测试正常查询流程
    - 测试筛选参数应用
    - 测试错误处理
    - _需求：2.1, 3.2, 3.3_
  
  - [x] 2.3 在distillationService.ts中实现deleteTopics方法
    - 调用数据库删除方法
    - 实现事务处理
    - 返回删除结果
    - 实现错误处理
    - _需求：4.3, 4.4_
  
  - [x] 2.4 在distillationService.ts中实现getStatistics方法
    - 调用数据库统计方法
    - 支持筛选条件
    - 格式化统计数据
    - _需求：5.1, 5.2, 5.3, 5.4_

- [ ] 3. 后端API层：创建路由端点
  - [x] 3.1 在distillation.ts路由文件中添加GET /api/distillation/results端点
    - 解析查询参数（keyword, provider, page, pageSize）
    - 调用服务层方法
    - 返回包含数据、分页信息和统计信息的响应
    - 实现参数验证
    - _需求：1.1, 2.1, 3.2, 3.3, 5.1_
  
  - [x] 3.2 编写属性测试验证API响应格式完整性
    - **属性 11: API响应格式完整性**
    - **验证需求：6.3**
  
  - [x] 3.3 在distillation.ts路由文件中添加DELETE /api/distillation/topics端点
    - 解析请求体中的topicIds数组
    - 调用服务层删除方法
    - 返回删除结果
    - 实现参数验证和错误处理
    - _需求：4.3, 4.4_
  
  - [x] 3.4 编写集成测试验证完整的API流程
    - 测试查询端点的完整流程
    - 测试删除端点的完整流程
    - 测试错误场景
    - _需求：2.1, 4.3, 6.5_

- [ ] 4. 前端数据层：定义类型和API客户端
  - [x] 4.1 创建types/distillationResults.ts定义数据接口
    - 定义TopicWithReference接口
    - 定义ResultsResponse接口
    - 定义Statistics接口
    - 定义筛选参数接口
    - _需求：1.2, 2.1, 5.1_
  
  - [x] 4.2 在api目录中创建distillationResultsApi.ts
    - 实现fetchResultsWithReferences方法
    - 实现deleteTopics方法
    - 实现错误处理
    - _需求：2.1, 4.3_

- [ ] 5. 前端UI层：重构DistillationResultsPage组件
  - [x] 5.1 重构页面基础结构
    - 移除卡片式布局代码
    - 引入Ant Design Table组件
    - 设置页面布局（统计区域 + 筛选区域 + 表格区域）
    - _需求：1.1, 1.2_
  
  - [x] 5.2 实现统计卡片区域
    - 使用Row和Col布局4个统计卡片
    - 显示总话题数、关键词数量、总被引用次数、当前显示数量
    - 实现数据绑定
    - _需求：5.1, 5.2, 5.3_
  
  - [x] 5.3 编写属性测试验证统计显示一致性
    - **属性 5: 统计数据一致性**
    - **验证需求：5.1, 5.2, 5.3, 5.4**
  
  - [x] 5.4 实现筛选工具栏
    - 添加关键词下拉选择器
    - 添加AI模型下拉选择器
    - 添加搜索输入框
    - 添加清除筛选按钮
    - 实现筛选逻辑
    - _需求：3.1, 3.2, 3.3, 3.5_
  
  - [x] 5.5 编写属性测试验证筛选功能正确性
    - **属性 3: 筛选结果正确性**
    - **验证需求：3.1, 3.2, 3.3, 3.4**
  
  - [x] 5.6 编写属性测试验证筛选可逆性
    - **属性 4: 筛选可逆性**
    - **验证需求：3.5**
  
  - [x] 5.7 实现数据表格
    - 定义表格列配置（选择、关键词、蒸馏结果、被引用次数、蒸馏时间）
    - 实现列渲染函数（Tag、Badge、日期格式化）
    - 配置表格属性（分页、排序、选择）
    - _需求：1.2, 1.3, 1.4, 1.5, 2.5_
  
  - [x] 5.8 编写属性测试验证表格列完整性
    - **属性 6: 表格列完整性**
    - **验证需求：1.2**
  
  - [x] 5.9 编写属性测试验证排序功能正确性
    - **属性 7: 默认排序正确性**
    - **属性 8: 排序功能正确性**
    - **验证需求：1.3, 1.5**
  
  - [x] 5.10 实现选择和批量操作功能
    - 实现行选择逻辑
    - 实现全选功能
    - 添加删除选中按钮
    - 实现删除确认对话框
    - 调用删除API
    - 更新本地状态
    - _需求：4.1, 4.2, 4.3, 4.5_
  
  - [x] 5.11 编写属性测试验证选择状态一致性
    - **属性 9: 选择状态一致性**
    - **验证需求：4.1, 4.2**
  
  - [x] 5.12 实现数据加载和刷新逻辑
    - 在组件挂载时加载数据
    - 实现加载状态显示（骨架屏）
    - 实现刷新按钮
    - 实现错误处理和提示
    - _需求：1.1, 6.5_
  
  - [x] 5.13 编写单元测试验证组件渲染和交互
    - 测试组件正确渲染
    - 测试筛选交互
    - 测试删除交互
    - 测试错误处理
    - _需求：1.1, 3.1, 4.3_

- [ ] 6. 集成和优化
  - [x] 6.1 实现前端性能优化
    - 添加搜索防抖（300ms）
    - 实现本地筛选逻辑
    - 优化表格渲染性能
    - _需求：3.1, 3.4_
  
  - [x] 6.2 实现错误处理和用户反馈
    - 统一错误提示样式
    - 添加操作成功提示
    - 实现网络错误重试
    - _需求：6.5_
  
  - [x] 6.3 测试完整流程
    - 测试查询和展示流程
    - 测试筛选和搜索流程
    - 测试删除流程
    - 测试边界情况（空数据、大数据量）
    - _需求：1.1, 2.1, 3.1, 4.3_

- [ ] 7. 检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户

- [ ] 8. 文档和清理
  - [x] 8.1 更新API文档
    - 记录新增的API端点
    - 记录请求和响应格式
    - 添加使用示例
    - _需求：6.3_
  
  - [x] 8.2 添加代码注释
    - 为复杂的查询逻辑添加注释
    - 为关键业务逻辑添加注释
    - 为属性测试添加说明注释
    - _需求：所有_
  
  - [x] 8.3 清理和优化代码
    - 移除未使用的导入和变量
    - 统一代码风格
    - 优化性能瓶颈
    - _需求：所有_
