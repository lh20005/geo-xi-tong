# 实施计划

- [x] 1. 创建内容清理模块
  - 在 `server/src/services/` 目录下创建 `contentCleaner.ts` 文件
  - 实现思考过程移除、Markdown符号清理等核心功能
  - _需求：1.1, 1.2, 1.3, 1.4, 2.1, 2.2, 2.3, 2.4, 2.5, 2.6_

- [x] 1.1 编写属性测试：思考过程关键词移除
  - **属性 1：思考过程关键词完全移除**
  - **验证需求：1.1, 1.2**

- [x] 1.2 编写属性测试：XML思考标签移除
  - **属性 2：XML思考标签完全移除**
  - **验证需求：1.1, 1.3**

- [x] 1.3 编写属性测试：清理后内容非空
  - **属性 3：清理后内容非空**
  - **验证需求：1.4**

- [x] 1.4 编写属性测试：标题标记移除
  - **属性 4：标题标记符号移除**
  - **验证需求：2.1**

- [x] 1.5 编写属性测试：加粗斜体标记移除
  - **属性 5：加粗斜体标记移除但保留文本**
  - **验证需求：2.2**

- [x] 1.6 编写属性测试：列表标记转换
  - **属性 6：列表标记转换为纯文本**
  - **验证需求：2.3**

- [x] 1.7 编写属性测试：代码块标记移除
  - **属性 7：代码块标记移除但保留代码**
  - **验证需求：2.4**

- [x] 1.8 编写属性测试：Markdown链接转换
  - **属性 8：Markdown链接转换为纯文本**
  - **验证需求：2.5**

- [x] 1.9 编写属性测试：段落结构保持
  - **属性 9：段落结构保持不变**
  - **验证需求：2.6**

- [x] 2. 集成内容清理到文章生成服务
  - 修改 `server/src/services/articleGenerationService.ts` 中的 `parseArticleResponse` 方法
  - 在解析AI响应后调用内容清理函数
  - 添加清理失败的错误处理逻辑
  - _需求：1.1, 1.2, 1.3, 1.4, 2.1, 2.2, 2.3, 2.4, 2.5, 2.6_

- [x] 3. 优化AI服务提示词
  - 修改 `server/src/services/aiService.ts` 中的 `generateArticle` 方法
  - 在提示词开头添加明确的输出格式要求
  - 添加"不要包含思考过程"和"使用纯文本格式"的指令
  - _需求：5.1, 5.2, 5.3, 5.4_

- [x] 3.1 编写属性测试：提示词包含清理指令
  - **属性 12：提示词包含清理指令**
  - **验证需求：5.1, 5.2, 5.3, 5.4**

- [x] 4. 添加文章编辑API接口
  - 在 `server/src/routes/article.ts` 中添加 PUT /:id 路由
  - 实现输入验证（标题和内容非空）
  - 实现数据库更新逻辑，包括updated_at时间戳更新
  - 添加错误处理
  - _需求：4.4, 4.5, 4.7_

- [x] 4.1 编写属性测试：有效编辑更新时间戳
  - **属性 10：有效编辑更新时间戳**
  - **验证需求：4.4, 4.5**

- [x] 4.2 编写属性测试：空输入阻止保存
  - **属性 11：空输入阻止保存**
  - **验证需求：4.7**

- [x] 5. 增强前端文章列表页面
  - 修改 `client/src/pages/ArticleListPage.tsx`
  - 在文章详情Modal中添加图片显示组件
  - 处理图片加载失败的情况（显示占位图）
  - 添加编辑模式状态管理
  - 实现编辑/预览模式切换
  - _需求：3.1, 3.2, 3.3, 3.4, 4.1, 4.2, 4.3, 4.6_

- [x] 6. 实现文章编辑表单
  - 在 `ArticleListPage.tsx` 的Modal中添加编辑表单
  - 使用Ant Design的Form、Input和TextArea组件
  - 实现表单验证（标题和内容必填）
  - 实现保存和取消功能
  - 调用后端编辑API
  - _需求：4.3, 4.4, 4.5, 4.6, 4.7_

- [x] 7. 测试和验证
  - 使用不同AI提供商测试文章生成
  - 验证思考过程和Markdown符号被正确清理
  - 测试图片显示功能（有图片、无图片、图片加载失败）
  - 测试文章编辑功能（正常编辑、验证失败、取消编辑）
  - 确保所有属性测试通过
  - _需求：所有需求_
