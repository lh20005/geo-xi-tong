# 需求文档

## 简介

文章图片嵌入功能旨在改进文章生成和展示模块，使图片能够自然地嵌入到文章内容中，而不是单独显示。这将使生成的文章更接近互联网上的标准高质量图文文章，提升内容的可读性和专业性。

## 术语表

- **文章生成系统 (Article Generation System)**: 负责生成文章内容的核心系统
- **图片嵌入 (Image Embedding)**: 将图片自然地插入到文章内容的适当位置，而不是单独显示
- **Markdown格式 (Markdown Format)**: 一种轻量级标记语言，支持图片嵌入语法
- **文章内容 (Article Content)**: 包含文本和嵌入图片的完整文章正文
- **文章渲染 (Article Rendering)**: 将文章内容转换为可视化展示的过程
- **图片占位符 (Image Placeholder)**: 在文章内容中标记图片位置的特殊标记

## 需求

### 需求 1

**用户故事:** 作为内容创作者，我想要在生成文章时将图片自然嵌入到文章内容中，以便生成的文章更符合高质量图文文章的标准。

#### 验收标准

1. WHEN 文章生成系统生成文章 THEN 文章生成系统 SHALL 在文章内容的适当位置插入图片标记
2. WHEN 文章内容包含多个段落 THEN 文章生成系统 SHALL 在第一段或第二段之后插入图片
3. WHEN 图片被插入 THEN 文章生成系统 SHALL 使用Markdown图片语法格式化图片标记
4. WHEN 文章保存到数据库 THEN 文章生成系统 SHALL 将包含图片标记的完整内容保存为单一字段

### 需求 2

**用户故事:** 作为内容管理者，我想要在文章列表页面查看文章时看到图片自然嵌入在内容中，以便更好地预览文章效果。

#### 验收标准

1. WHEN 用户在文章列表页面查看文章详情 THEN 文章生成系统 SHALL 渲染文章内容中的Markdown图片标记
2. WHEN 文章内容包含图片标记 THEN 文章生成系统 SHALL 将图片显示在内容的相应位置
3. WHEN 图片加载失败 THEN 文章生成系统 SHALL 显示占位图或错误提示
4. WHEN 文章内容不包含图片标记 THEN 文章生成系统 SHALL 正常显示纯文本内容

### 需求 3

**用户故事:** 作为系统，我需要确保图片URL在文章内容中正确引用，以便图片能够正确加载和显示。

#### 验收标准

1. WHEN 生成文章时选择图片 THEN 文章生成系统 SHALL 获取图片的完整URL路径
2. WHEN 构建图片标记 THEN 文章生成系统 SHALL 使用正确的URL格式
3. WHEN 图片URL包含特殊字符 THEN 文章生成系统 SHALL 正确转义特殊字符
4. WHEN 图片不存在 THEN 文章生成系统 SHALL 使用默认占位图URL

### 需求 4

**用户故事:** 作为内容编辑者，我想要在编辑文章时能够修改图片位置或更换图片，以便优化文章布局。

#### 验收标准

1. WHEN 用户编辑文章内容 THEN 文章生成系统 SHALL 允许修改Markdown图片标记
2. WHEN 用户保存编辑后的文章 THEN 文章生成系统 SHALL 验证图片标记的语法正确性
3. WHEN 图片标记语法错误 THEN 文章生成系统 SHALL 显示错误提示但仍允许保存
4. WHEN 用户删除图片标记 THEN 文章生成系统 SHALL 保存不包含图片的文章内容

### 需求 5

**用户故事:** 作为系统管理员，我需要确保现有文章数据能够平滑迁移到新的图片嵌入格式，以便保持数据一致性。

#### 验收标准

1. WHEN 系统升级到新版本 THEN 文章生成系统 SHALL 保持现有文章的image_url字段不变
2. WHEN 渲染旧格式文章 THEN 文章生成系统 SHALL 检测content字段是否包含图片标记
3. WHEN 旧格式文章不包含图片标记但有image_url THEN 文章生成系统 SHALL 在内容开头自动插入图片
4. WHEN 新格式文章包含图片标记 THEN 文章生成系统 SHALL 忽略image_url字段

### 需求 6

**用户故事:** 作为内容创作者，我想要AI在生成文章时智能决定图片插入位置，以便图片位置更加合理自然。

#### 验收标准

1. WHEN AI生成文章内容 THEN 文章生成系统 SHALL 在提示词中指示AI在适当位置插入图片占位符
2. WHEN AI返回包含图片占位符的内容 THEN 文章生成系统 SHALL 将占位符替换为实际图片URL
3. WHEN AI未返回图片占位符 THEN 文章生成系统 SHALL 在第一段后自动插入图片标记
4. WHEN 文章内容少于两段 THEN 文章生成系统 SHALL 在内容末尾插入图片标记

### 需求 7

**用户故事:** 作为用户，我想要在文章详情页面看到图片以合适的尺寸和样式显示，以便获得良好的阅读体验。

#### 验收标准

1. WHEN 渲染文章中的图片 THEN 文章生成系统 SHALL 设置图片最大宽度为容器宽度
2. WHEN 图片高度超过合理范围 THEN 文章生成系统 SHALL 限制图片最大高度
3. WHEN 图片显示 THEN 文章生成系统 SHALL 应用圆角和边框样式
4. WHEN 图片加载 THEN 文章生成系统 SHALL 保持图片原始宽高比

### 需求 8

**用户故事:** 作为开发者，我需要使用Markdown渲染库来处理文章内容，以便支持更丰富的格式化选项。

#### 验收标准

1. WHEN 渲染文章内容 THEN 文章生成系统 SHALL 使用React Markdown库解析内容
2. WHEN 解析Markdown内容 THEN 文章生成系统 SHALL 支持图片、标题、列表等基本语法
3. WHEN 渲染图片标签 THEN 文章生成系统 SHALL 应用自定义样式组件
4. WHEN Markdown解析失败 THEN 文章生成系统 SHALL 降级显示纯文本内容
