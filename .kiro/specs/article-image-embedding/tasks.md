# 实施计划

- [x] 1. 安装前端依赖
  - 在client目录安装react-markdown和remark-gfm库
  - 验证依赖安装成功
  - _需求: 8.1_

- [x] 2. 创建ArticleContent组件
  - 在client/src/components目录创建ArticleContent.tsx
  - 实现Markdown渲染逻辑
  - 实现自定义图片组件，应用统一样式
  - 实现图片加载失败处理
  - 实现向后兼容逻辑（检测旧格式并自动转换）
  - _需求: 2.1, 2.2, 2.3, 2.4, 5.2, 5.3, 5.4, 7.1, 7.2, 7.3, 7.4, 8.1, 8.2, 8.3_

- [x] 2.1 编写属性测试：Markdown渲染正确性
  - **属性 4: Markdown渲染正确性**
  - **验证需求: 2.1, 2.2**

- [x] 2.2 编写属性测试：图片样式应用完整性
  - **属性 15: 图片样式应用完整性**
  - **验证需求: 7.1, 7.2, 7.3, 7.4**

- [x] 2.3 编写属性测试：Markdown语法支持完整性
  - **属性 16: Markdown语法支持完整性**
  - **验证需求: 8.2**

- [x] 2.4 编写属性测试：自定义图片组件应用
  - **属性 17: 自定义图片组件应用**
  - **验证需求: 8.3**

- [x] 2.5 编写属性测试：旧格式检测准确性
  - **属性 9: 旧格式检测准确性**
  - **验证需求: 5.2**

- [x] 2.6 编写属性测试：旧格式自动转换
  - **属性 10: 旧格式自动转换**
  - **验证需求: 5.3**

- [x] 2.7 编写属性测试：新格式优先级
  - **属性 11: 新格式优先级**
  - **验证需求: 5.4**

- [x] 3. 更新后端文章生成服务
  - 修改server/src/services/articleGenerationService.ts
  - 实现insertImageIntoContent方法，在内容中插入Markdown图片标记
  - 实现buildPromptWithImageInstruction方法，构建包含图片占位符指示的AI提示词
  - 更新generateSingleArticle方法，调用图片插入逻辑
  - _需求: 1.1, 1.2, 1.3, 1.4, 3.1, 3.2, 6.1, 6.2, 6.3, 6.4_

- [x] 3.1 编写属性测试：图片标记插入完整性
  - **属性 1: 图片标记插入完整性**
  - **验证需求: 1.1, 1.3**

- [x] 3.2 编写属性测试：多段落图片位置正确性
  - **属性 2: 多段落图片位置正确性**
  - **验证需求: 1.2**

- [x] 3.3 编写属性测试：图片URL格式正确性
  - **属性 5: 图片URL格式正确性**
  - **验证需求: 3.1, 3.2**

- [x] 3.4 编写属性测试：AI提示词包含占位符指示
  - **属性 12: AI提示词包含占位符指示**
  - **验证需求: 6.1**

- [x] 3.5 编写属性测试：占位符替换正确性
  - **属性 13: 占位符替换正确性**
  - **验证需求: 6.2**

- [x] 3.6 编写属性测试：无占位符自动插入
  - **属性 14: 无占位符自动插入**
  - **验证需求: 6.3**

- [x] 4. 更新ArticleListPage组件
  - 修改client/src/pages/ArticleListPage.tsx
  - 移除独立的图片显示区域
  - 使用ArticleContent组件渲染文章内容
  - 在编辑模式下添加Markdown语法提示
  - 更新Modal的布局和样式
  - _需求: 2.1, 2.2, 2.3, 2.4, 4.1, 4.2, 4.3, 4.4_

- [x] 4.1 编写属性测试：编辑保存一致性
  - **属性 6: 编辑保存一致性**
  - **验证需求: 4.1, 4.4**

- [x] 4.2 编写属性测试：图片标记语法验证
  - **属性 7: 图片标记语法验证**
  - **验证需求: 4.2**

- [x] 5. 更新ArticlePage组件（可选）
  - 修改client/src/pages/ArticlePage.tsx
  - 使用ArticleContent组件替代纯文本显示
  - 支持Markdown格式预览
  - _需求: 2.1, 2.2_

- [x] 6. 测试数据库持久化
  - 创建测试脚本验证文章保存逻辑
  - 测试包含Markdown图片标记的文章能正确保存
  - 测试查询后content字段包含完整的Markdown内容
  - _需求: 1.4, 5.1_

- [x] 6.1 编写属性测试：内容持久化完整性
  - **属性 3: 内容持久化完整性**
  - **验证需求: 1.4**

- [x] 6.2 编写属性测试：向后兼容性保持
  - **属性 8: 向后兼容性保持**
  - **验证需求: 5.1**

- [x] 7. 端到端测试
  - 测试完整的文章生成流程（从配置到生成到保存到查看）
  - 测试文章编辑功能（编辑Markdown内容并保存）
  - 测试旧格式文章的兼容性（查看现有文章）
  - 测试图片加载失败的处理
  - 测试不同AI提供商返回内容的处理
  - _需求: 所有需求_

- [x] 8. 文档更新
  - 更新用户文档，说明新的图片嵌入功能
  - 添加Markdown语法使用指南
  - 更新开发文档，说明实现细节
  - _需求: 所有需求_
