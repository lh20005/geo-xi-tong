<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¤´æ¡å·é€‰æ‹©å™¨æµ‹è¯•å·¥å…·</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      border-bottom: 2px solid #1890ff;
      padding-bottom: 10px;
    }
    h2 {
      color: #666;
      margin-top: 30px;
    }
    .step {
      background: #e6f7ff;
      border-left: 4px solid #1890ff;
      padding: 15px;
      margin: 15px 0;
    }
    .code-block {
      background: #f6f6f6;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 15px;
      overflow-x: auto;
      font-family: 'Courier New', monospace;
      font-size: 14px;
    }
    .result {
      margin: 20px 0;
      padding: 15px;
      border-radius: 4px;
    }
    .success {
      background: #f6ffed;
      border: 1px solid #b7eb8f;
      color: #52c41a;
    }
    .error {
      background: #fff2e8;
      border: 1px solid #ffbb96;
      color: #fa8c16;
    }
    button {
      background: #1890ff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 5px 10px 0;
    }
    button:hover {
      background: #40a9ff;
    }
    .selector-item {
      padding: 8px;
      margin: 5px 0;
      border-radius: 4px;
      font-family: monospace;
    }
    .found {
      background: #f6ffed;
      border-left: 3px solid #52c41a;
    }
    .not-found {
      background: #fff2e8;
      border-left: 3px solid #fa8c16;
    }
    a {
      color: #1890ff;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” å¤´æ¡å·é€‰æ‹©å™¨æµ‹è¯•å·¥å…·</h1>
    
    <div class="step">
      <h3>ğŸ“‹ ä½¿ç”¨æ­¥éª¤ï¼š</h3>
      <ol>
        <li>åœ¨<strong>æ–°æ ‡ç­¾é¡µ</strong>ä¸­æ‰“å¼€å¤´æ¡å·å¹¶ç™»å½•ï¼š<a href="https://mp.toutiao.com/auth/page/login" target="_blank">https://mp.toutiao.com/auth/page/login</a></li>
        <li>ç™»å½•æˆåŠŸåï¼Œæ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ˆæŒ‰ <code>F12</code> æˆ– <code>Cmd+Option+I</code>ï¼‰</li>
        <li>åˆ‡æ¢åˆ° <strong>Console</strong> æ ‡ç­¾</li>
        <li>å¤åˆ¶ä¸‹é¢çš„æµ‹è¯•ä»£ç ï¼Œç²˜è´´åˆ° Console ä¸­è¿è¡Œ</li>
        <li>æŸ¥çœ‹æµ‹è¯•ç»“æœï¼Œæ‰¾å‡ºå“ªäº›é€‰æ‹©å™¨æœ‰æ•ˆ</li>
      </ol>
    </div>

    <h2>ğŸ§ª æµ‹è¯•ä»£ç </h2>
    
    <h3>æ–¹æ³• 1ï¼šä¸€é”®æµ‹è¯•ï¼ˆæ¨èï¼‰</h3>
    <button onclick="copyCode('test-all')">ğŸ“‹ å¤åˆ¶ä»£ç </button>
    <div class="code-block" id="test-all">
// ========================================
// å¤´æ¡å·é€‰æ‹©å™¨æµ‹è¯•è„šæœ¬
// ========================================

console.log('%c=== å¼€å§‹æµ‹è¯•å¤´æ¡å·é€‰æ‹©å™¨ ===', 'color: blue; font-size: 16px; font-weight: bold');
console.log('å½“å‰ URL:', window.location.href);
console.log('');

// 1. æµ‹è¯•ç™»å½•æˆåŠŸé€‰æ‹©å™¨
console.log('%c1ï¸âƒ£ æµ‹è¯•ç™»å½•æˆåŠŸé€‰æ‹©å™¨', 'color: green; font-size: 14px; font-weight: bold');
const loginSuccessSelectors = [
  '.user-avatar',
  '.auth-avator-name',
  '.semi-navigation-header-username'
];

let foundLoginSuccess = false;
loginSuccessSelectors.forEach(selector => {
  const el = document.querySelector(selector);
  const found = el !== null;
  if (found) foundLoginSuccess = true;
  console.log(
    `${found ? 'âœ…' : 'âŒ'} ${selector}`,
    found ? el : ''
  );
  if (found && el.textContent) {
    console.log('   å†…å®¹:', el.textContent.trim());
  }
});

if (!foundLoginSuccess) {
  console.log('%câš ï¸ è­¦å‘Šï¼šæ‰€æœ‰ç™»å½•æˆåŠŸé€‰æ‹©å™¨éƒ½æœªæ‰¾åˆ°ï¼', 'color: red; font-weight: bold');
}

console.log('');

// 2. æµ‹è¯•ç”¨æˆ·åé€‰æ‹©å™¨
console.log('%c2ï¸âƒ£ æµ‹è¯•ç”¨æˆ·åé€‰æ‹©å™¨', 'color: green; font-size: 14px; font-weight: bold');
const usernameSelectors = [
  '.auth-avator-name',
  '.user-name',
  '.username',
  '.account-name',
  '[class*="username"]',
  '[class*="user-name"]',
  '.semi-navigation-header-username'
];

let foundUsername = false;
let extractedUsername = '';
usernameSelectors.forEach(selector => {
  const el = document.querySelector(selector);
  const found = el !== null;
  if (found && el.textContent && el.textContent.trim()) {
    foundUsername = true;
    if (!extractedUsername) {
      extractedUsername = el.textContent.trim();
    }
  }
  console.log(
    `${found ? 'âœ…' : 'âŒ'} ${selector}`,
    found ? el : ''
  );
  if (found && el.textContent) {
    console.log('   å†…å®¹:', el.textContent.trim());
  }
});

if (!foundUsername) {
  console.log('%câš ï¸ è­¦å‘Šï¼šæ‰€æœ‰ç”¨æˆ·åé€‰æ‹©å™¨éƒ½æœªæ‰¾åˆ°ï¼', 'color: red; font-weight: bold');
}

console.log('');

// 3. æŸ¥æ‰¾æ‰€æœ‰å¯èƒ½åŒ…å«ç”¨æˆ·åçš„å…ƒç´ 
console.log('%c3ï¸âƒ£ æŸ¥æ‰¾å¯èƒ½çš„ç”¨æˆ·åå…ƒç´ ', 'color: green; font-size: 14px; font-weight: bold');
const possibleElements = document.querySelectorAll('[class*="user"], [class*="name"], [class*="avatar"], [class*="account"]');
console.log(`æ‰¾åˆ° ${possibleElements.length} ä¸ªå¯èƒ½çš„å…ƒç´ `);

const candidates = [];
possibleElements.forEach((el, i) => {
  const text = el.textContent?.trim();
  if (text && text.length > 0 && text.length < 50 && !text.includes('\n')) {
    const classes = el.className;
    candidates.push({ index: i + 1, classes, text });
  }
});

if (candidates.length > 0) {
  console.log('å¯èƒ½çš„ç”¨æˆ·åå…ƒç´ ï¼š');
  candidates.slice(0, 10).forEach(c => {
    console.log(`  ${c.index}. [${c.classes}]: "${c.text}"`);
  });
} else {
  console.log('æœªæ‰¾åˆ°æ˜æ˜¾çš„ç”¨æˆ·åå…ƒç´ ');
}

console.log('');

// 4. æ€»ç»“
console.log('%c=== æµ‹è¯•æ€»ç»“ ===', 'color: blue; font-size: 16px; font-weight: bold');
if (foundLoginSuccess && foundUsername) {
  console.log('%câœ… æµ‹è¯•é€šè¿‡ï¼é€‰æ‹©å™¨é…ç½®æ­£ç¡®', 'color: green; font-weight: bold');
  console.log('æå–åˆ°çš„ç”¨æˆ·å:', extractedUsername);
} else {
  console.log('%câŒ æµ‹è¯•å¤±è´¥ï¼éœ€è¦æ›´æ–°é€‰æ‹©å™¨é…ç½®', 'color: red; font-weight: bold');
  if (!foundLoginSuccess) {
    console.log('  - ç™»å½•æˆåŠŸé€‰æ‹©å™¨å…¨éƒ¨å¤±æ•ˆ');
  }
  if (!foundUsername) {
    console.log('  - ç”¨æˆ·åé€‰æ‹©å™¨å…¨éƒ¨å¤±æ•ˆ');
  }
  console.log('');
  console.log('ğŸ’¡ å»ºè®®ï¼š');
  console.log('  1. æ£€æŸ¥ä¸Šé¢çš„"å¯èƒ½çš„ç”¨æˆ·åå…ƒç´ "åˆ—è¡¨');
  console.log('  2. æ‰¾åˆ°åŒ…å«ä½ ç”¨æˆ·åçš„å…ƒç´ ');
  console.log('  3. è®°å½•è¯¥å…ƒç´ çš„ class åç§°');
  console.log('  4. æ›´æ–°æ•°æ®åº“é…ç½®');
}

console.log('');
console.log('%c=== æµ‹è¯•å®Œæˆ ===', 'color: blue; font-size: 16px; font-weight: bold');
    </div>

    <h3>æ–¹æ³• 2ï¼šåˆ†æ­¥æµ‹è¯•</h3>
    
    <h4>æµ‹è¯•ç™»å½•æˆåŠŸé€‰æ‹©å™¨</h4>
    <button onclick="copyCode('test-login-success')">ğŸ“‹ å¤åˆ¶ä»£ç </button>
    <div class="code-block" id="test-login-success">
const loginSuccessSelectors = [
  '.user-avatar',
  '.auth-avator-name',
  '.semi-navigation-header-username'
];

console.log('=== æµ‹è¯•ç™»å½•æˆåŠŸé€‰æ‹©å™¨ ===');
loginSuccessSelectors.forEach(selector => {
  const el = document.querySelector(selector);
  console.log(`${selector}:`, el ? 'âœ… FOUND' : 'âŒ NOT FOUND');
  if (el) console.log('  å†…å®¹:', el.textContent?.trim());
});
    </div>

    <h4>æµ‹è¯•ç”¨æˆ·åé€‰æ‹©å™¨</h4>
    <button onclick="copyCode('test-username')">ğŸ“‹ å¤åˆ¶ä»£ç </button>
    <div class="code-block" id="test-username">
const usernameSelectors = [
  '.auth-avator-name',
  '.user-name',
  '.username',
  '.account-name',
  '[class*="username"]',
  '[class*="user-name"]',
  '.semi-navigation-header-username'
];

console.log('=== æµ‹è¯•ç”¨æˆ·åé€‰æ‹©å™¨ ===');
usernameSelectors.forEach(selector => {
  const el = document.querySelector(selector);
  console.log(`${selector}:`, el ? 'âœ… FOUND' : 'âŒ NOT FOUND');
  if (el) console.log('  å†…å®¹:', el.textContent?.trim());
});
    </div>

    <h4>æŸ¥æ‰¾æ‰€æœ‰å¯èƒ½çš„å…ƒç´ </h4>
    <button onclick="copyCode('find-elements')">ğŸ“‹ å¤åˆ¶ä»£ç </button>
    <div class="code-block" id="find-elements">
const possibleElements = document.querySelectorAll('[class*="user"], [class*="name"], [class*="avatar"]');
console.log(`æ‰¾åˆ° ${possibleElements.length} ä¸ªå¯èƒ½çš„å…ƒç´ `);

possibleElements.forEach((el, i) => {
  const text = el.textContent?.trim();
  if (text && text.length > 0 && text.length < 50) {
    console.log(`${i + 1}. ${el.className}:`, text);
  }
});
    </div>

    <h2>ğŸ“ å¦‚ä½•æ›´æ–°é€‰æ‹©å™¨</h2>
    
    <div class="step">
      <p>å¦‚æœæµ‹è¯•å‘ç°é€‰æ‹©å™¨å¤±æ•ˆï¼Œéœ€è¦æ›´æ–°æ•°æ®åº“é…ç½®ï¼š</p>
      
      <h4>æ­¥éª¤ 1ï¼šæ‰¾åˆ°æ–°çš„é€‰æ‹©å™¨</h4>
      <p>ä»æµ‹è¯•ç»“æœä¸­æ‰¾åˆ°æœ‰æ•ˆçš„é€‰æ‹©å™¨ï¼Œæˆ–è€…ï¼š</p>
      <ol>
        <li>åœ¨å¼€å‘è€…å·¥å…·ä¸­ï¼Œç‚¹å‡»å·¦ä¸Šè§’çš„"é€‰æ‹©å…ƒç´ "æŒ‰é’®ï¼ˆæˆ–æŒ‰ <code>Cmd+Shift+C</code>ï¼‰</li>
        <li>ç‚¹å‡»é¡µé¢ä¸Šæ˜¾ç¤ºç”¨æˆ·åçš„å…ƒç´ </li>
        <li>åœ¨ Elements é¢æ¿ä¸­ï¼Œå³é”®ç‚¹å‡»è¯¥å…ƒç´  â†’ Copy â†’ Copy selector</li>
      </ol>

      <h4>æ­¥éª¤ 2ï¼šæ›´æ–°æ•°æ®åº“</h4>
      <button onclick="copyCode('update-db')">ğŸ“‹ å¤åˆ¶ SQL</button>
      <div class="code-block" id="update-db">
-- æ›´æ–°å¤´æ¡å·çš„é€‰æ‹©å™¨é…ç½®
UPDATE platforms_config 
SET selectors = '{
  "username": [
    "ä½ æ‰¾åˆ°çš„æ–°é€‰æ‹©å™¨1",
    "ä½ æ‰¾åˆ°çš„æ–°é€‰æ‹©å™¨2",
    ".auth-avator-name",
    ".user-name"
  ],
  "loginSuccess": [
    "ä½ æ‰¾åˆ°çš„æ–°é€‰æ‹©å™¨1",
    ".user-avatar",
    ".auth-avator-name"
  ]
}'::jsonb
WHERE platform_id = 'toutiao';
      </div>

      <h4>æ­¥éª¤ 3ï¼šé‡å¯æœåŠ¡</h4>
      <div class="code-block">
# é‡å¯åç«¯
cd server && npm run dev

# é‡å¯ Windows ç™»å½•ç®¡ç†å™¨
cd windows-login-manager && npm run dev
      </div>
    </div>

    <h2>ğŸ†˜ å¸¸è§é—®é¢˜</h2>
    
    <div class="step">
      <h4>Q: æ‰€æœ‰é€‰æ‹©å™¨éƒ½æ˜¾ç¤º "NOT FOUND"</h4>
      <p><strong>A:</strong> å¯èƒ½çš„åŸå› ï¼š</p>
      <ul>
        <li>æ²¡æœ‰ç™»å½•æˆåŠŸï¼ˆè¯·ç¡®ä¿å·²ç»ç™»å½•ï¼‰</li>
        <li>é¡µé¢ç»“æ„å‘ç”Ÿäº†å˜åŒ–ï¼ˆå¤´æ¡å·æ›´æ–°äº†ç•Œé¢ï¼‰</li>
        <li>åœ¨é”™è¯¯çš„é¡µé¢è¿è¡Œæµ‹è¯•ï¼ˆè¯·ç¡®ä¿åœ¨ç™»å½•åçš„é¡µé¢è¿è¡Œï¼‰</li>
      </ul>
    </div>

    <div class="step">
      <h4>Q: æ‰¾åˆ°äº†æ–°çš„é€‰æ‹©å™¨ï¼Œä½†ä¸çŸ¥é“å¦‚ä½•æ›´æ–°</h4>
      <p><strong>A:</strong> è¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š</p>
      <ul>
        <li>æµ‹è¯•ä»£ç çš„å®Œæ•´è¾“å‡ºï¼ˆæˆªå›¾æˆ–å¤åˆ¶æ–‡æœ¬ï¼‰</li>
        <li>æ‰¾åˆ°çš„æ–°é€‰æ‹©å™¨</li>
        <li>ç™»å½•åçš„é¡µé¢ URL</li>
      </ul>
      <p>æˆ‘ä»¬ä¼šå¸®ä½ æ›´æ–°é…ç½®ã€‚</p>
    </div>

    <div class="step">
      <h4>Q: æ›´æ–°åä»ç„¶å¤±è´¥</h4>
      <p><strong>A:</strong> è¯·æ£€æŸ¥ï¼š</p>
      <ul>
        <li>æ˜¯å¦é‡å¯äº†åç«¯æœåŠ¡</li>
        <li>æ˜¯å¦é‡å¯äº† Windows ç™»å½•ç®¡ç†å™¨</li>
        <li>API æ˜¯å¦è¿”å›äº†æ–°çš„é…ç½®ï¼ˆè¿è¡Œ <code>curl http://localhost:3000/api/platforms/toutiao</code>ï¼‰</li>
      </ul>
    </div>
  </div>

  <script>
    function copyCode(elementId) {
      const element = document.getElementById(elementId);
      const text = element.textContent;
      
      navigator.clipboard.writeText(text).then(() => {
        const button = event.target;
        const originalText = button.textContent;
        button.textContent = 'âœ… å·²å¤åˆ¶ï¼';
        button.style.background = '#52c41a';
        
        setTimeout(() => {
          button.textContent = originalText;
          button.style.background = '#1890ff';
        }, 2000);
      }).catch(err => {
        alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ä»£ç ');
        console.error('å¤åˆ¶å¤±è´¥:', err);
      });
    }
  </script>
</body>
</html>
