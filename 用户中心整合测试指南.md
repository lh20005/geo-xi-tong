# 用户中心整合测试指南

## 快速测试步骤

### 准备工作
```bash
# 启动所有服务
npm run dev:all

# 或分别启动
npm run server:dev   # 后端 (端口 3000)
npm run client:dev   # 主应用 (端口 5173)
npm run landing:dev  # 落地页 (端口 8080)
```

## 测试场景

### 场景 1：从 Landing 访问用户中心
**目标**: 验证 Landing 页面的"个人中心"链接能正确跳转到主应用

**步骤**:
1. 打开浏览器访问 `http://localhost:8080`
2. 点击右上角"立即登录"
3. 使用测试账号登录
4. 登录成功后，点击右上角用户头像
5. 在下拉菜单中点击"个人中心"

**预期结果**:
- ✅ 自动跳转到 `http://localhost:5173/user-center`
- ✅ 无需重新登录
- ✅ 显示完整的用户中心页面（4个标签页）

---

### 场景 2：查看订阅管理
**目标**: 验证订阅信息和使用统计显示正常

**步骤**:
1. 在用户中心，默认显示"订阅管理"标签页
2. 查看当前套餐信息
3. 查看使用统计（各功能配额）
4. 点击"升级套餐"按钮

**预期结果**:
- ✅ 显示当前套餐名称、到期时间、状态
- ✅ 显示各功能的使用情况（进度条）
- ✅ 弹出套餐选择对话框

---

### 场景 3：查看订单记录
**目标**: 验证历史订单列表显示正常

**步骤**:
1. 点击"订单记录"标签页
2. 查看订单列表
3. 检查订单状态、金额、时间等信息

**预期结果**:
- ✅ 显示所有历史订单
- ✅ 订单状态正确（待支付/已支付/已关闭）
- ✅ 支持分页（每页10条）

---

### 场景 4：查看个人信息
**目标**: 验证个人资料和账户安全功能

**步骤**:
1. 点击"个人信息"标签页
2. 查看基本信息（用户名、角色、注册时间等）
3. 点击"修改密码"按钮
4. 输入当前密码和新密码
5. 提交修改

**预期结果**:
- ✅ 显示完整的用户信息
- ✅ 弹出修改密码对话框
- ✅ 表单验证正常（密码长度、一致性）
- ✅ 修改成功后显示提示

---

### 场景 5：查看邀请系统
**目标**: 验证邀请码和邀请统计功能

**步骤**:
1. 点击"邀请系统"标签页
2. 查看邀请码
3. 点击"复制"按钮
4. 查看累计邀请数
5. 查看受邀用户列表

**预期结果**:
- ✅ 显示邀请码（渐变卡片背景）
- ✅ 点击复制后显示"已复制"提示
- ✅ 显示累计邀请数（大数字显示）
- ✅ 显示受邀用户列表（头像、用户名、加入时间）

---

### 场景 6：支付成功跳转
**目标**: 验证支付成功后自动跳转到用户中心

**步骤**:
1. 在 Landing 页面选择套餐
2. 点击"立即购买"
3. 扫码支付（或使用测试订单）
4. 等待支付成功

**预期结果**:
- ✅ 显示支付成功提示
- ✅ 1.5秒后自动跳转到主应用用户中心
- ✅ 显示最新的订阅信息

---

### 场景 7：移动端测试
**目标**: 验证移动端响应式布局

**步骤**:
1. 打开浏览器开发者工具
2. 切换到移动设备模式（iPhone/Android）
3. 重复场景 1-6 的测试

**预期结果**:
- ✅ 布局适配移动端
- ✅ 标签页可正常切换
- ✅ 所有功能正常使用

---

## 常见问题排查

### 问题 1: 跳转后显示"请先登录"
**原因**: Token 未正确传递
**解决**: 
- 检查 localStorage 中是否有 `auth_token`
- 检查 URL 参数是否包含 token
- 查看浏览器控制台错误信息

### 问题 2: 邀请统计不显示
**原因**: API 返回错误或数据为空
**解决**:
- 检查后端 `/api/invitations/stats` 接口
- 查看网络请求响应
- 确认用户有邀请记录

### 问题 3: 修改密码失败
**原因**: 当前密码错误或新密码不符合要求
**解决**:
- 确认当前密码正确
- 新密码至少6位
- 两次输入的新密码一致

### 问题 4: 订阅信息不显示
**原因**: 用户未订阅任何套餐
**解决**:
- 这是正常情况
- 会显示"您还没有订阅任何套餐"
- 点击"立即订阅"可购买套餐

---

## API 端点检查

使用以下命令测试 API 是否正常：

```bash
# 获取用户资料
curl -H "Authorization: Bearer YOUR_TOKEN" \
  http://localhost:3000/api/users/profile

# 获取邀请统计
curl -H "Authorization: Bearer YOUR_TOKEN" \
  http://localhost:3000/api/invitations/stats

# 获取订阅信息
curl -H "Authorization: Bearer YOUR_TOKEN" \
  http://localhost:3000/api/subscription/current

# 获取使用统计
curl -H "Authorization: Bearer YOUR_TOKEN" \
  http://localhost:3000/api/subscription/usage-stats

# 获取订单列表
curl -H "Authorization: Bearer YOUR_TOKEN" \
  http://localhost:3000/api/orders
```

---

## 浏览器兼容性测试

### 桌面端
- [ ] Chrome (最新版)
- [ ] Safari (最新版)
- [ ] Firefox (最新版)
- [ ] Edge (最新版)

### 移动端
- [ ] iOS Safari
- [ ] Android Chrome
- [ ] 微信内置浏览器

---

## 性能检查

### 页面加载
- [ ] 首次加载时间 < 2秒
- [ ] 标签页切换流畅
- [ ] 数据刷新及时

### 网络请求
- [ ] API 响应时间 < 500ms
- [ ] 无重复请求
- [ ] 错误处理正确

---

## 测试完成清单

### 功能测试
- [ ] Landing 跳转到用户中心
- [ ] 订阅管理显示正常
- [ ] 订单记录显示正常
- [ ] 个人信息显示正常
- [ ] 邀请系统显示正常
- [ ] 修改密码功能正常
- [ ] 支付成功跳转正常

### UI/UX 测试
- [ ] 标签页切换流畅
- [ ] 按钮点击有反馈
- [ ] 表单验证提示清晰
- [ ] 错误提示友好
- [ ] 加载状态显示

### 响应式测试
- [ ] 桌面端布局正常
- [ ] 平板端布局正常
- [ ] 手机端布局正常
- [ ] 横屏/竖屏切换正常

### 跨浏览器测试
- [ ] Chrome 正常
- [ ] Safari 正常
- [ ] Firefox 正常
- [ ] Edge 正常

---

## 测试报告模板

```markdown
## 测试日期
2025-01-04

## 测试环境
- 操作系统: macOS
- 浏览器: Chrome 120
- 后端版本: 1.0.0
- 前端版本: 1.0.0

## 测试结果
- ✅ 场景 1: 通过
- ✅ 场景 2: 通过
- ✅ 场景 3: 通过
- ✅ 场景 4: 通过
- ✅ 场景 5: 通过
- ✅ 场景 6: 通过
- ✅ 场景 7: 通过

## 发现的问题
无

## 建议
1. 添加邀请奖励功能
2. 优化移动端布局
3. 添加数据导出功能
```

---

## 自动化测试（可选）

如果需要编写自动化测试，可以使用以下框架：

```typescript
// 示例: Cypress E2E 测试
describe('用户中心整合测试', () => {
  beforeEach(() => {
    cy.login('testuser', 'password123');
  });

  it('应该能从 Landing 跳转到用户中心', () => {
    cy.visit('http://localhost:8080');
    cy.get('[data-testid="user-menu"]').click();
    cy.get('[data-testid="profile-link"]').click();
    cy.url().should('include', '/user-center');
  });

  it('应该显示邀请码', () => {
    cy.visit('http://localhost:5173/user-center');
    cy.get('[data-testid="invitation-tab"]').click();
    cy.get('[data-testid="invitation-code"]').should('be.visible');
  });
});
```

---

## 总结

完成以上所有测试后，用户中心整合功能应该完全正常。如果遇到任何问题，请参考"常见问题排查"部分或查看浏览器控制台的错误信息。
