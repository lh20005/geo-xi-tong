# 前端测试指南 - 用户管理增强功能

## 测试环境

- **后端服务器**: http://localhost:3000
- **前端应用**: http://localhost:5173
- **测试日期**: 2024-12-24

---

## 测试准备

### 1. 确认服务运行

```bash
# 检查后端
curl http://localhost:3000/api/health

# 检查前端
curl http://localhost:5173
```

### 2. 测试账号

**普通用户**:
- 用户名: `testuser_1766557091`
- 密码: `test123456`
- 邀请码: `xheglv`

**被邀请用户**:
- 用户名: `invited_1766557203`
- 密码: `test123456`
- 邀请码: `ysch4c`

**管理员账号** (如果已创建):
- 用户名: `admin`
- 密码: `admin123`

---

## 测试清单

### ✅ 任务 20: Landing 前端测试检查点

#### 1. 用户注册流程测试

**测试步骤**:
1. 访问 http://localhost:5173
2. 点击"注册"或导航到注册页面
3. 填写注册表单：
   - 用户名: `frontend_test_$(date +%s)`
   - 密码: `test123456`
   - 确认密码: `test123456`
   - 邀请码（可选）: `xheglv`
4. 点击"注册"按钮

**预期结果**:
- ✓ 表单验证正常（用户名格式、密码长度）
- ✓ 注册成功后自动登录
- ✓ 跳转到仪表板或主页
- ✓ 显示用户信息和邀请码
- ✓ 如果使用了邀请码，邀请关系应该建立

**验证方法**:
```bash
# 检查用户是否创建成功
curl -s -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"frontend_test_XXXXX","password":"test123456"}' | jq '.'
```

---

#### 2. 用户登录测试

**测试步骤**:
1. 访问 http://localhost:5173
2. 点击"登录"或导航到登录页面
3. 填写登录表单：
   - 用户名: `testuser_1766557091`
   - 密码: `test123456`
4. 点击"登录"按钮

**预期结果**:
- ✓ 登录成功
- ✓ 跳转到仪表板或主页
- ✓ 显示用户信息
- ✓ JWT 令牌存储在 localStorage

**错误场景测试**:
1. 错误密码：应显示"用户名或密码错误"
2. 不存在的用户名：应显示"用户名或密码错误"
3. 空字段：应显示验证错误

---

#### 3. 个人资料页面测试

**测试步骤**:
1. 登录后，导航到个人资料页面
2. 查看个人信息

**预期结果**:
- ✓ 显示用户名
- ✓ 显示注册日期
- ✓ 显示邀请码（带复制按钮）
- ✓ 显示邀请统计（邀请人数）
- ✓ 显示被邀请用户列表

**测试邀请码复制**:
1. 点击"复制邀请码"按钮
2. 验证邀请码已复制到剪贴板
3. 应显示"已复制"提示

---

#### 4. 修改密码测试

**测试步骤**:
1. 在个人资料页面，点击"修改密码"
2. 填写表单：
   - 当前密码: `test123456`
   - 新密码: `newpass123456`
   - 确认新密码: `newpass123456`
3. 点击"确认修改"

**预期结果**:
- ✓ 密码修改成功
- ✓ 显示成功提示
- ✓ 旧令牌失效（需要重新登录）

**验证方法**:
```bash
# 使用新密码登录
curl -s -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"testuser_1766557091","password":"newpass123456"}' | jq '.'
```

**错误场景测试**:
1. 当前密码错误：应显示"当前密码不正确"
2. 新密码太短：应显示"密码必须至少6个字符"
3. 两次新密码不一致：应显示"两次密码不一致"

---

#### 5. 邀请系统测试

**测试步骤**:
1. 登录用户 `testuser_1766557091`
2. 查看邀请统计
3. 复制邀请码 `xheglv`
4. 登出
5. 使用邀请码注册新用户
6. 重新登录 `testuser_1766557091`
7. 查看邀请统计

**预期结果**:
- ✓ 邀请统计显示正确的邀请人数
- ✓ 被邀请用户列表包含新注册的用户
- ✓ 显示被邀请用户的用户名和注册时间

---

#### 6. 管理员用户管理测试

**前提条件**: 需要管理员账号

**测试步骤**:
1. 使用管理员账号登录
2. 导航到用户管理页面

**预期结果**:
- ✓ 显示用户列表（表格形式）
- ✓ 显示用户名、注册日期、邀请码、邀请人数
- ✓ 每个用户有操作按钮（查看详情、重置密码、删除）

**搜索功能测试**:
1. 在搜索框输入 "test"
2. 等待 300ms（防抖）
3. 验证结果只包含用户名包含 "test" 的用户

**分页功能测试**:
1. 如果用户数 > 10，应显示分页控件
2. 点击下一页，验证显示下一批用户
3. 验证总数显示正确

---

#### 7. 用户详情模态框测试

**测试步骤**:
1. 在用户管理页面，点击某个用户的"查看详情"
2. 查看用户详细信息

**预期结果**:
- ✓ 显示完整用户信息
- ✓ 显示邀请码（带复制按钮）
- ✓ 显示邀请统计
- ✓ 显示被邀请用户列表
- ✓ 有编辑、重置密码、删除按钮

**编辑用户测试**:
1. 点击"编辑"按钮
2. 修改用户名或角色
3. 点击"保存"
4. 验证修改成功

**重置密码测试**:
1. 点击"重置密码"按钮
2. 确认操作
3. 验证显示临时密码
4. 复制临时密码
5. 登出管理员
6. 使用该用户和临时密码登录
7. 验证强制修改密码流程

**删除用户测试**:
1. 点击"删除"按钮
2. 确认删除
3. 验证用户从列表中消失
4. 验证该用户无法登录

---

#### 8. 临时密码流程测试

**测试步骤**:
1. 管理员重置某个用户的密码
2. 获取临时密码
3. 登出管理员
4. 使用该用户和临时密码登录

**预期结果**:
- ✓ 登录成功
- ✓ 立即显示"必须修改密码"模态框
- ✓ 模态框无法关闭（必须修改密码）
- ✓ 填写新密码表单
- ✓ 修改成功后跳转到仪表板

---

#### 9. WebSocket 实时同步测试

**测试准备**:
1. 打开两个浏览器窗口（或使用隐身模式）
2. 窗口 A：登录用户 A
3. 窗口 B：登录管理员

**测试场景 1: 用户信息更新**
1. 窗口 B（管理员）：修改用户 A 的信息
2. 窗口 A（用户 A）：观察页面

**预期结果**:
- ✓ 窗口 A 自动刷新显示新的用户信息
- ✓ 无需手动刷新页面

**测试场景 2: 密码重置**
1. 窗口 B（管理员）：重置用户 A 的密码
2. 窗口 A（用户 A）：观察页面

**预期结果**:
- ✓ 窗口 A 显示"密码已被重置"通知
- ✓ 窗口 A 自动登出或提示重新登录

**测试场景 3: 用户删除**
1. 窗口 B（管理员）：删除用户 A
2. 窗口 A（用户 A）：观察页面

**预期结果**:
- ✓ 窗口 A 立即登出
- ✓ 跳转到登录页面
- ✓ 显示"账号已被删除"提示

---

#### 10. 限流保护测试

**登录限流测试**:
1. 使用错误密码连续登录 5 次
2. 第 6 次尝试登录

**预期结果**:
- ✓ 前 5 次显示"用户名或密码错误"
- ✓ 第 6 次显示"登录尝试过多，请15分钟后再试"
- ✓ 15 分钟后可以正常登录

**注册限流测试**:
1. 连续注册 3 个新用户
2. 尝试注册第 4 个用户

**预期结果**:
- ✓ 前 3 次注册成功
- ✓ 第 4 次显示"注册过于频繁，请1小时后再试"

---

#### 11. 响应式设计测试

**测试步骤**:
1. 在不同屏幕尺寸下测试所有页面
   - 桌面（1920x1080）
   - 平板（768x1024）
   - 手机（375x667）

**预期结果**:
- ✓ 所有页面在不同尺寸下正常显示
- ✓ 表格在小屏幕上可滚动或自适应
- ✓ 按钮和表单元素大小合适
- ✓ 文字可读性良好

---

#### 12. 错误处理测试

**网络错误测试**:
1. 关闭后端服务器
2. 尝试登录或注册

**预期结果**:
- ✓ 显示"网络错误，请稍后重试"
- ✓ 不会崩溃或白屏

**无效令牌测试**:
1. 手动修改 localStorage 中的令牌
2. 刷新页面或访问需要认证的页面

**预期结果**:
- ✓ 自动跳转到登录页面
- ✓ 显示"登录已过期，请重新登录"

---

## 测试报告模板

### 测试执行记录

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 1. 用户注册流程 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 | |
| 2. 用户登录 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 | |
| 3. 个人资料页面 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 | |
| 4. 修改密码 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 | |
| 5. 邀请系统 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 | |
| 6. 管理员用户管理 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 | |
| 7. 用户详情模态框 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 | |
| 8. 临时密码流程 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 | |
| 9. WebSocket 实时同步 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 | |
| 10. 限流保护 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 | |
| 11. 响应式设计 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 | |
| 12. 错误处理 | ⬜ 未测试 / ✅ 通过 / ❌ 失败 | |

### 发现的问题

| 问题编号 | 严重程度 | 描述 | 重现步骤 | 状态 |
|----------|----------|------|----------|------|
| 1 | 高/中/低 | | | 待修复/已修复 |

---

## 自动化测试建议

### 推荐工具
- **E2E 测试**: Playwright 或 Cypress
- **组件测试**: React Testing Library
- **API 测试**: Jest + Supertest

### 测试脚本示例

```typescript
// 示例：注册流程 E2E 测试
describe('用户注册流程', () => {
  it('应该成功注册新用户', async () => {
    await page.goto('http://localhost:5173/register');
    await page.fill('[name="username"]', 'testuser');
    await page.fill('[name="password"]', 'test123456');
    await page.fill('[name="confirmPassword"]', 'test123456');
    await page.click('button[type="submit"]');
    
    await expect(page).toHaveURL(/\/dashboard/);
    await expect(page.locator('.user-info')).toContainText('testuser');
  });
});
```

---

## 测试完成标准

前端测试通过的标准：

- ✅ 所有 12 项测试场景通过
- ✅ 无严重或中等级别的 bug
- ✅ 用户体验流畅，无明显卡顿
- ✅ 错误提示清晰友好
- ✅ 响应式设计在所有设备上正常
- ✅ WebSocket 实时同步工作正常

---

## 下一步

完成前端测试后，继续执行：
- **任务 26**: 最终集成测试
  - 跨平台测试（Landing + Client + Windows）
  - 完整用户流程测试
  - 性能和压力测试

---

**测试指南版本**: 1.0  
**创建日期**: 2024-12-24  
**更新日期**: 2024-12-24
