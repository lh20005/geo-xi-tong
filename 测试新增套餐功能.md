# 测试新增套餐功能

## 快速测试步骤

### 1. 启动系统

```bash
# 启动后端
npm run server:dev

# 启动前端（新终端）
npm run client:dev

# 启动落地页（新终端）
cd landing && npm run dev
```

### 2. 测试新增套餐

1. **登录管理员账号**
   - 访问 `http://localhost:5173`
   - 使用管理员账号登录

2. **进入商品管理页面**
   - 点击左侧菜单"商品管理"
   - 应该看到现有的套餐列表

3. **点击"新增套餐"按钮**
   - 按钮应该是蓝色可点击状态（不是灰色）
   - 点击后弹出"新增套餐"模态框

4. **填写套餐信息**
   ```
   套餐代码：premium_plus
   套餐名称：高级增强版
   价格：199.00
   计费周期：月付
   有效天数：30
   描述：适合中大型企业的高级套餐
   显示顺序：4
   启用状态：✓ 开启
   ```

5. **添加功能配额**
   - 点击"添加功能配额"
   - 选择功能：每日生成文章数
   - 配额值：100
   - 再添加一个：
     - 功能：每日发布文章数
     - 配额值：50

6. **保存套餐**
   - 点击"保存"按钮
   - 应该显示"套餐新增成功"提示
   - 模态框关闭
   - 套餐列表中出现新套餐

### 3. 验证落地页显示

1. **打开落地页**
   - 访问 `http://localhost:8080`
   - 滚动到"灵活的使用方案"区域

2. **查看新套餐卡片**
   - 应该看到"高级增强版"套餐卡片
   - 显示价格：¥199.00/月
   - 显示功能配额：
     - 每日生成文章数 100
     - 每日发布文章数 50
   - 有"点击购买"按钮

3. **测试购买流程**
   - 点击"点击购买"按钮
   - 如果未登录，应该跳转到登录页
   - 如果已登录，应该打开支付弹窗

### 4. 测试编辑功能

1. **编辑新创建的套餐**
   - 回到商品管理页面
   - 点击"高级增强版"的"编辑"按钮
   - 修改价格为 179.00
   - 点击"保存"

2. **验证更新**
   - 应该显示"套餐更新成功"
   - 套餐列表中价格更新为 ¥179.00
   - 刷新落地页，价格也应该更新

### 5. 测试停用功能

1. **停用套餐**
   - 编辑"高级增强版"套餐
   - 关闭"启用状态"开关
   - 保存

2. **验证落地页**
   - 刷新落地页
   - "高级增强版"套餐应该不再显示
   - 只显示启用状态的套餐

### 6. 查看变更历史

1. **查看套餐历史**
   - 点击"高级增强版"的"历史"按钮
   - 应该看到：
     - 创建记录
     - 价格修改记录（199.00 → 179.00）
     - 状态修改记录（启用 → 停用）

2. **查看所有历史**
   - 点击"查看所有历史"按钮
   - 应该看到所有套餐的变更记录

## 数据库验证

```sql
-- 查看新创建的套餐
SELECT * FROM subscription_plans 
WHERE plan_code = 'premium_plus';

-- 查看套餐的功能配额
SELECT pf.*, sp.plan_name 
FROM plan_features pf
JOIN subscription_plans sp ON sp.id = pf.plan_id
WHERE sp.plan_code = 'premium_plus';

-- 查看配置变更历史
SELECT pch.*, sp.plan_name, u.username
FROM product_config_history pch
JOIN subscription_plans sp ON sp.id = pch.plan_id
JOIN users u ON u.id = pch.changed_by
WHERE sp.plan_code = 'premium_plus'
ORDER BY pch.created_at DESC;
```

## 预期结果

✅ "新增套餐"按钮可以点击
✅ 可以成功创建新套餐
✅ 新套餐在商品管理页面显示
✅ 新套餐在落地页自动显示（启用状态）
✅ 可以编辑套餐信息
✅ 停用套餐后落地页不显示
✅ 所有操作都有历史记录
✅ 数据库中有完整的套餐和配额数据

## 常见问题

### Q1: "新增套餐"按钮还是灰色的？
- 清除浏览器缓存
- 重新编译前端：`cd client && npm run build`
- 重启前端开发服务器

### Q2: 保存时提示"套餐代码已存在"？
- 套餐代码必须唯一
- 使用不同的代码，如：`premium_plus_v2`

### Q3: 落地页没有显示新套餐？
- 确认套餐的"启用状态"是开启的
- 刷新落地页（Ctrl+F5 强制刷新）
- 检查浏览器控制台是否有错误

### Q4: 功能配额没有保存？
- 确保每个配额都选择了功能代码
- 确保配额值是有效数字
- 检查是否有重复的功能代码

## 清理测试数据

测试完成后，可以删除测试套餐：

```sql
-- 删除测试套餐（会级联删除功能配额和历史记录）
DELETE FROM subscription_plans 
WHERE plan_code = 'premium_plus';
```

或者在商品管理页面点击"删除"按钮。
