# 用户菜单测试指南

## 快速测试步骤

### 1. 启动系统

```bash
# 启动后端服务
cd server
npm run dev

# 启动网页端（新终端）
cd landing
npm run dev
```

### 2. 测试场景

#### 场景一：未登录状态
1. 访问 http://localhost:5174
2. 查看导航栏右上角应显示"立即登录"按钮
3. 点击按钮跳转到登录页面

#### 场景二：普通用户登录
1. 使用普通用户账号登录（如：testuser / Test123456）
2. 登录成功后返回首页
3. 查看导航栏右上角应显示用户头像（用户名首字母）

**桌面端测试**：
- 点击用户头像，应弹出卡片式菜单
- 菜单应包含：
  - 用户信息（头像、用户名、"普通用户"标识）
  - 进入系统（渐变背景高亮）
  - 个人中心
  - 退出登录（红色）
- 不应显示"用户管理"选项
- 点击菜单外部，菜单应关闭
- 悬停在菜单项上，应有背景色变化

**移动端测试**（缩小浏览器窗口或使用开发者工具）：
- 点击用户头像，应弹出全屏菜单
- 菜单从顶部滑下
- 背景有半透明遮罩
- 点击遮罩或关闭按钮，菜单应关闭

#### 场景三：管理员登录
1. 使用管理员账号登录（如：admin / Admin123456）
2. 登录成功后返回首页
3. 点击用户头像打开菜单

**应额外显示**：
- "管理功能"分组标题
- "用户管理"选项（紫色主题）
- 角色标识显示"系统管理员"（紫色圆点）

#### 场景四：功能测试

**测试"进入系统"**：
1. 点击"进入系统"
2. 应跳转到前端系统（http://localhost:5173）
3. Token 应正确传递

**测试"个人中心"**：
1. 点击"个人中心"
2. 应跳转到 /profile 页面
3. 菜单应自动关闭

**测试"用户管理"**（仅管理员）：
1. 点击"用户管理"
2. 应跳转到 /admin/users 页面
3. 菜单应自动关闭

**测试"退出登录"**：
1. 点击"退出登录"
2. 应弹出确认对话框
3. 对话框包含：
   - 警告图标（黄色）
   - 确认文案
   - "取消"和"确认退出"按钮
4. 点击"取消"，对话框关闭，保持登录状态
5. 点击"确认退出"，应：
   - 清除 localStorage 中的 token
   - 跳转到首页
   - 导航栏显示"立即登录"按钮

### 3. 视觉效果测试

#### 动画效果
- **菜单打开**：应有从上到下的滑动动画（slideDown）
- **对话框打开**：应有淡入和缩放动画（fadeIn + scaleIn）
- **箭头旋转**：桌面端菜单打开时，用户名旁的箭头应旋转180度

#### 悬停效果
- **用户头像按钮**：悬停时应有背景色变化
- **进入系统**：悬停时应有渐变背景加深
- **个人中心**：悬停时应有灰色背景
- **用户管理**：悬停时应有紫色背景
- **退出登录**：悬停时应有红色背景

#### 颜色方案
- **头像渐变**：蓝色到紫色（from-blue-500 to-purple-600）
- **头部背景**：浅蓝到浅紫（from-blue-50 to-purple-50）
- **角色标识**：
  - 管理员：紫色圆点
  - 普通用户：绿色圆点

### 4. 响应式测试

#### 桌面端（宽度 >= 768px）
- 用户头像旁应显示用户名和下拉箭头
- 点击后弹出宽度为 320px 的卡片菜单
- 菜单定位在头像右下方

#### 移动端（宽度 < 768px）
- 用户头像旁不显示用户名
- 点击后弹出全屏菜单
- 菜单从顶部滑下，占据大部分屏幕
- 按钮更大，便于触摸操作

### 5. 边界情况测试

#### 长用户名
1. 创建一个用户名很长的账号
2. 登录后查看菜单
3. 用户名应使用 truncate 截断，不应溢出

#### 快速点击
1. 快速连续点击用户头像
2. 菜单应正常打开/关闭，不应出现异常

#### 多标签页同步
1. 在两个标签页中打开网站
2. 在一个标签页中登录
3. 另一个标签页应自动更新登录状态（通过 storage 事件）
4. 在一个标签页中退出
5. 另一个标签页应自动更新为未登录状态

### 6. 性能测试

#### 菜单打开速度
- 点击头像后，菜单应立即响应（< 100ms）
- 动画应流畅，无卡顿

#### 内存泄漏
1. 反复打开/关闭菜单多次
2. 检查浏览器开发者工具的内存使用
3. 不应有明显的内存增长

## 常见问题排查

### 问题1：菜单不显示
- 检查是否已登录（localStorage 中是否有 auth_token）
- 检查浏览器控制台是否有错误
- 检查 user_info 是否正确解析

### 问题2：点击外部菜单不关闭
- 检查 useEffect 中的事件监听是否正确设置
- 检查 menuRef 是否正确绑定到菜单元素

### 问题3：动画不流畅
- 检查 CSS 动画是否正确加载
- 检查浏览器是否支持 CSS 动画
- 尝试禁用浏览器扩展

### 问题4：移动端菜单显示异常
- 检查响应式断点（md:768px）
- 检查 z-index 层级
- 检查是否有其他元素遮挡

### 问题5：退出后仍显示登录状态
- 检查 localStorage 是否正确清除
- 检查 storage 事件监听是否正常
- 尝试刷新页面

## 测试检查清单

- [ ] 未登录状态显示"立即登录"按钮
- [ ] 普通用户登录后显示用户头像
- [ ] 管理员登录后显示用户头像
- [ ] 桌面端点击头像弹出卡片菜单
- [ ] 移动端点击头像弹出全屏菜单
- [ ] 菜单显示正确的用户信息
- [ ] 普通用户不显示"用户管理"
- [ ] 管理员显示"用户管理"
- [ ] "进入系统"功能正常
- [ ] "个人中心"功能正常
- [ ] "用户管理"功能正常（管理员）
- [ ] "退出登录"弹出确认对话框
- [ ] 确认退出后正确清除登录状态
- [ ] 点击菜单外部关闭菜单
- [ ] 所有悬停效果正常
- [ ] 所有动画效果流畅
- [ ] 响应式布局正常
- [ ] 长用户名正确截断
- [ ] 多标签页状态同步

## 浏览器兼容性

### 推荐浏览器
- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

### 已知问题
- IE 11 不支持（不再维护）
- 旧版 Safari 可能动画效果不佳

## 反馈和改进

如果在测试过程中发现问题，请记录：
1. 问题描述
2. 复现步骤
3. 浏览器和版本
4. 屏幕截图（如有）
5. 控制台错误信息（如有）

## 下一步

测试通过后，可以考虑：
1. 添加更多动画效果
2. 支持键盘导航
3. 添加快捷键
4. 集成通知中心
5. 支持深色模式
