# 数据库完整审计报告 - 详细版

**生成时间**: Fri Jan 16 19:35:06 CST 2026
**服务器**: 124.221.247.107
**数据库**: geo_system

---

## 表: articles

```
                                                                                                                  Table "public.articles"
            Column             |            Type             | Collation | Nullable |               Default                | Storage  | Compression | Stats target |                                      Description                                       
-------------------------------+-----------------------------+-----------+----------+--------------------------------------+----------+-------------+--------------+----------------------------------------------------------------------------------------
 id                            | integer                     |           | not null | nextval('articles_id_seq'::regclass) | plain    |             |              | 
 user_id                       | integer                     |           | not null |                                      | plain    |             |              | 
 title                         | character varying(500)      |           |          |                                      | extended |             |              | 
 keyword                       | character varying(255)      |           | not null |                                      | extended |             |              | 
 distillation_id               | integer                     |           |          |                                      | plain    |             |              | 
 topic_id                      | integer                     |           |          |                                      | plain    |             |              | 
 task_id                       | integer                     |           |          |                                      | plain    |             |              | 
 image_id                      | integer                     |           |          |                                      | plain    |             |              | 引用的图片ID，用于引用计数管理
 requirements                  | text                        |           |          |                                      | extended |             |              | 
 content                       | text                        |           | not null |                                      | extended |             |              | 
 image_url                     | character varying(500)      |           |          |                                      | extended |             |              | 
 image_size_bytes              | integer                     |           |          | 0                                    | plain    |             |              | 文章引用图片的大小（字节），用于存储配额计算
 provider                      | character varying(20)       |           | not null |                                      | extended |             |              | 
 is_published                  | boolean                     |           |          | false                                | plain    |             |              | 
 publishing_status             | character varying(20)       |           |          |                                      | extended |             |              | 发布状态: unpublished(未发布), publishing(发布中), published(已发布), failed(发布失败)
 published_at                  | timestamp without time zone |           |          |                                      | plain    |             |              | 
 distillation_keyword_snapshot | character varying(255)      |           |          |                                      | extended |             |              | 蒸馏关键词快照（删除源数据后仍保留）
 topic_question_snapshot       | text                        |           |          |                                      | extended |             |              | 话题问题快照（删除源数据后仍保留）
 created_at                    | timestamp without time zone |           |          | CURRENT_TIMESTAMP                    | plain    |             |              | 
 updated_at                    | timestamp without time zone |           |          | CURRENT_TIMESTAMP                    | plain    |             |              | 
Indexes:
    "articles_pkey" PRIMARY KEY, btree (id)
    "idx_articles_distillation" btree (distillation_id)
    "idx_articles_distillation_keyword_snapshot" btree (distillation_keyword_snapshot)
    "idx_articles_image_id" btree (image_id)
    "idx_articles_is_published" btree (is_published)
    "idx_articles_keyword" btree (keyword)
    "idx_articles_publishing_status" btree (publishing_status)
    "idx_articles_task_id" btree (task_id)
    "idx_articles_title" btree (title)
    "idx_articles_topic_id" btree (topic_id)
    "idx_articles_user_created" btree (user_id, created_at DESC)
    "idx_articles_user_id" btree (user_id)
    "idx_articles_user_published_created" btree (user_id, is_published, created_at DESC)
Foreign-key constraints:
    "articles_distillation_id_fkey" FOREIGN KEY (distillation_id) REFERENCES distillations(id) ON DELETE SET NULL
    "articles_image_id_fkey" FOREIGN KEY (image_id) REFERENCES images(id) ON DELETE SET NULL
    "articles_task_id_fkey" FOREIGN KEY (task_id) REFERENCES generation_tasks(id) ON DELETE SET NULL
    "articles_topic_id_fkey" FOREIGN KEY (topic_id) REFERENCES topics(id) ON DELETE SET NULL
    "articles_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
Referenced by:
    TABLE "distillation_usage" CONSTRAINT "distillation_usage_article_id_fkey" FOREIGN KEY (article_id) REFERENCES articles(id) ON DELETE CASCADE
    TABLE "image_usage" CONSTRAINT "image_usage_article_id_fkey" FOREIGN KEY (article_id) REFERENCES articles(id) ON DELETE CASCADE
    TABLE "publish_records" CONSTRAINT "publish_records_article_id_fkey" FOREIGN KEY (article_id) REFERENCES articles(id) ON DELETE CASCADE
    TABLE "publishing_records" CONSTRAINT "publishing_records_article_id_fkey" FOREIGN KEY (article_id) REFERENCES articles(id) ON DELETE SET NULL
    TABLE "publishing_tasks" CONSTRAINT "publishing_tasks_article_id_fkey" FOREIGN KEY (article_id) REFERENCES articles(id) ON DELETE SET NULL
    TABLE "topic_usage" CONSTRAINT "topic_usage_article_id_fkey" FOREIGN KEY (article_id) REFERENCES articles(id) ON DELETE CASCADE
Triggers:
    trigger_sync_article_distillation_snapshot BEFORE INSERT OR UPDATE OF topic_id, distillation_id ON articles FOR EACH ROW EXECUTE FUNCTION sync_article_distillation_snapshot()
    trigger_update_article_image_size BEFORE INSERT OR UPDATE OF image_url ON articles FOR EACH ROW EXECUTE FUNCTION update_article_image_size()
Access method: heap

```

---

## 表: albums

```
                                                                   Table "public.albums"
   Column   |            Type             | Collation | Nullable |              Default               | Storage  | Compression | Stats target | Description 
------------+-----------------------------+-----------+----------+------------------------------------+----------+-------------+--------------+-------------
 id         | integer                     |           | not null | nextval('albums_id_seq'::regclass) | plain    |             |              | 
 user_id    | integer                     |           |          |                                    | plain    |             |              | 
 name       | character varying(255)      |           | not null |                                    | extended |             |              | 
 created_at | timestamp without time zone |           |          | CURRENT_TIMESTAMP                  | plain    |             |              | 
 updated_at | timestamp without time zone |           |          | CURRENT_TIMESTAMP                  | plain    |             |              | 
Indexes:
    "albums_pkey" PRIMARY KEY, btree (id)
    "idx_albums_created_at" btree (created_at DESC)
    "idx_albums_user_id" btree (user_id)
Foreign-key constraints:
    "albums_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
Referenced by:
    TABLE "images" CONSTRAINT "images_album_id_fkey" FOREIGN KEY (album_id) REFERENCES albums(id) ON DELETE SET NULL
Access method: heap

```

---

## 表: images

```
                                                                                             Table "public.images"
     Column      |            Type             | Collation | Nullable |              Default               | Storage  | Compression | Stats target |                        Description                         
-----------------+-----------------------------+-----------+----------+------------------------------------+----------+-------------+--------------+------------------------------------------------------------
 id              | integer                     |           | not null | nextval('images_id_seq'::regclass) | plain    |             |              | 
 user_id         | integer                     |           |          |                                    | plain    |             |              | 图片所属用户ID，用于存储计算（即使相册被删除也能关联用户）
 album_id        | integer                     |           |          |                                    | plain    |             |              | 
 filename        | character varying(255)      |           | not null |                                    | extended |             |              | 
 filepath        | character varying(500)      |           | not null |                                    | extended |             |              | 
 mime_type       | character varying(50)       |           | not null |                                    | extended |             |              | 
 size            | integer                     |           | not null |                                    | plain    |             |              | 
 usage_count     | integer                     |           |          | 0                                  | plain    |             |              | 
 deleted_at      | timestamp without time zone |           |          |                                    | plain    |             |              | 软删除时间，NULL表示未删除
 is_orphan       | boolean                     |           |          | false                              | plain    |             |              | 是否为孤儿文件（图库删除但被文章引用）
 reference_count | integer                     |           |          | 0                                  | plain    |             |              | 被文章引用的次数，用于存储配额计算
 created_at      | timestamp without time zone |           |          | CURRENT_TIMESTAMP                  | plain    |             |              | 
Indexes:
    "images_pkey" PRIMARY KEY, btree (id)
    "idx_images_album_id" btree (album_id)
    "idx_images_created_at" btree (created_at DESC)
    "idx_images_deleted_at" btree (deleted_at)
    "idx_images_is_orphan" btree (is_orphan)
    "idx_images_orphan" btree (is_orphan) WHERE is_orphan = true
    "idx_images_usage_count" btree (album_id, usage_count, created_at)
    "idx_images_user_id" btree (user_id)
Foreign-key constraints:
    "images_album_id_fkey" FOREIGN KEY (album_id) REFERENCES albums(id) ON DELETE SET NULL
    "images_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
Referenced by:
    TABLE "articles" CONSTRAINT "articles_image_id_fkey" FOREIGN KEY (image_id) REFERENCES images(id) ON DELETE SET NULL
    TABLE "image_usage" CONSTRAINT "image_usage_image_id_fkey" FOREIGN KEY (image_id) REFERENCES images(id) ON DELETE CASCADE
Access method: heap

```

---

## 表: knowledge_bases

```
                                                                    Table "public.knowledge_bases"
   Column    |            Type             | Collation | Nullable |                   Default                   | Storage  | Compression | Stats target | Description 
-------------+-----------------------------+-----------+----------+---------------------------------------------+----------+-------------+--------------+-------------
 id          | integer                     |           | not null | nextval('knowledge_bases_id_seq'::regclass) | plain    |             |              | 
 user_id     | integer                     |           |          |                                             | plain    |             |              | 
 name        | character varying(255)      |           | not null |                                             | extended |             |              | 
 description | text                        |           |          |                                             | extended |             |              | 
 created_at  | timestamp without time zone |           |          | CURRENT_TIMESTAMP                           | plain    |             |              | 
 updated_at  | timestamp without time zone |           |          | CURRENT_TIMESTAMP                           | plain    |             |              | 
Indexes:
    "knowledge_bases_pkey" PRIMARY KEY, btree (id)
    "idx_knowledge_bases_created_at" btree (created_at DESC)
    "idx_knowledge_bases_user_id" btree (user_id)
Foreign-key constraints:
    "knowledge_bases_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
Referenced by:
    TABLE "knowledge_documents" CONSTRAINT "knowledge_documents_knowledge_base_id_fkey" FOREIGN KEY (knowledge_base_id) REFERENCES knowledge_bases(id) ON DELETE CASCADE
Access method: heap

```

---

## 表: knowledge_documents

```
                                                                       Table "public.knowledge_documents"
      Column       |            Type             | Collation | Nullable |                     Default                     | Storage  | Compression | Stats target | Description 
-------------------+-----------------------------+-----------+----------+-------------------------------------------------+----------+-------------+--------------+-------------
 id                | integer                     |           | not null | nextval('knowledge_documents_id_seq'::regclass) | plain    |             |              | 
 knowledge_base_id | integer                     |           | not null |                                                 | plain    |             |              | 
 filename          | character varying(255)      |           | not null |                                                 | extended |             |              | 
 file_type         | character varying(50)       |           | not null |                                                 | extended |             |              | 
 file_size         | integer                     |           | not null |                                                 | plain    |             |              | 
 content           | text                        |           | not null |                                                 | extended |             |              | 
 created_at        | timestamp without time zone |           |          | CURRENT_TIMESTAMP                               | plain    |             |              | 
Indexes:
    "knowledge_documents_pkey" PRIMARY KEY, btree (id)
    "idx_knowledge_documents_created_at" btree (created_at DESC)
    "idx_knowledge_documents_kb_id" btree (knowledge_base_id)
Foreign-key constraints:
    "knowledge_documents_knowledge_base_id_fkey" FOREIGN KEY (knowledge_base_id) REFERENCES knowledge_bases(id) ON DELETE CASCADE
Access method: heap

```

---

## 表: platform_accounts

```
                                                                                       Table "public.platform_accounts"
    Column     |            Type             | Collation | Nullable |                    Default                    | Storage  | Compression | Stats target |                   Description                    
---------------+-----------------------------+-----------+----------+-----------------------------------------------+----------+-------------+--------------+--------------------------------------------------
 id            | integer                     |           | not null | nextval('platform_accounts_id_seq'::regclass) | plain    |             |              | 
 user_id       | integer                     |           | not null |                                               | plain    |             |              | 
 platform      | character varying(50)       |           | not null |                                               | extended |             |              | 
 platform_id   | character varying(50)       |           |          |                                               | extended |             |              | 
 account_name  | character varying(100)      |           |          |                                               | extended |             |              | 
 real_username | character varying(255)      |           |          |                                               | extended |             |              | 平台上的真实用户名（用于区分同一平台的多个账号）
 credentials   | text                        |           |          |                                               | extended |             |              | 
 cookies       | text                        |           |          |                                               | extended |             |              | 
 status        | character varying(20)       |           |          | 'inactive'::character varying                 | extended |             |              | 
 is_default    | boolean                     |           |          | false                                         | plain    |             |              | 
 error_message | text                        |           |          |                                               | extended |             |              | 
 last_used_at  | timestamp without time zone |           |          |                                               | plain    |             |              | 
 created_at    | timestamp without time zone |           |          | CURRENT_TIMESTAMP                             | plain    |             |              | 
 updated_at    | timestamp without time zone |           |          | CURRENT_TIMESTAMP                             | plain    |             |              | 
Indexes:
    "platform_accounts_pkey" PRIMARY KEY, btree (id)
    "idx_platform_accounts_platform" btree (platform)
    "idx_platform_accounts_platform_id" btree (platform_id)
    "idx_platform_accounts_status" btree (status)
    "idx_platform_accounts_user_id" btree (user_id)
    "idx_platform_accounts_user_platform" btree (user_id, platform_id)
    "unique_user_platform_real_username" UNIQUE, btree (user_id, platform_id, COALESCE(real_username, account_name))
Foreign-key constraints:
    "platform_accounts_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
Referenced by:
    TABLE "publish_records" CONSTRAINT "publish_records_platform_account_id_fkey" FOREIGN KEY (platform_account_id) REFERENCES platform_accounts(id) ON DELETE CASCADE
    TABLE "publishing_records" CONSTRAINT "publishing_records_account_id_fkey" FOREIGN KEY (account_id) REFERENCES platform_accounts(id) ON DELETE CASCADE
    TABLE "publishing_tasks" CONSTRAINT "publishing_tasks_account_id_fkey" FOREIGN KEY (account_id) REFERENCES platform_accounts(id) ON DELETE CASCADE
Access method: heap

```

---

## 表: publishing_tasks

```
                                                                                     Table "public.publishing_tasks"
         Column         |            Type             | Collation | Nullable |                   Default                    | Storage  | Compression | Stats target |            Description             
------------------------+-----------------------------+-----------+----------+----------------------------------------------+----------+-------------+--------------+------------------------------------
 id                     | integer                     |           | not null | nextval('publishing_tasks_id_seq'::regclass) | plain    |             |              | 
 user_id                | integer                     |           | not null |                                              | plain    |             |              | 
 article_id             | integer                     |           |          |                                              | plain    |             |              | 
 account_id             | integer                     |           | not null |                                              | plain    |             |              | 
 platform_id            | character varying(50)       |           | not null |                                              | extended |             |              | 
 status                 | character varying(20)       |           |          | 'pending'::character varying                 | extended |             |              | 
 config                 | text                        |           | not null |                                              | extended |             |              | 
 scheduled_at           | timestamp without time zone |           |          |                                              | plain    |             |              | 
 started_at             | timestamp without time zone |           |          |                                              | plain    |             |              | 
 completed_at           | timestamp without time zone |           |          |                                              | plain    |             |              | 
 error_message          | text                        |           |          |                                              | extended |             |              | 
 retry_count            | integer                     |           |          | 0                                            | plain    |             |              | 
 max_retries            | integer                     |           |          | 3                                            | plain    |             |              | 
 batch_id               | character varying(50)       |           |          |                                              | extended |             |              | 
 batch_order            | integer                     |           |          | 0                                            | plain    |             |              | 
 interval_minutes       | integer                     |           |          | 0                                            | plain    |             |              | 
 created_at             | timestamp without time zone |           |          | CURRENT_TIMESTAMP                            | plain    |             |              | 
 updated_at             | timestamp without time zone |           |          | CURRENT_TIMESTAMP                            | plain    |             |              | 
 article_title          | text                        |           |          |                                              | extended |             |              | 
 article_content        | text                        |           |          |                                              | extended |             |              | 
 article_keyword        | character varying(255)      |           |          |                                              | extended |             |              | 
 article_image_url      | text                        |           |          |                                              | extended |             |              | 
 account_name_snapshot  | character varying(255)      |           |          |                                              | extended |             |              | 账号名称快照（删除账号后仍保留）
 real_username_snapshot | character varying(255)      |           |          |                                              | extended |             |              | 真实用户名快照（删除账号后仍保留）
Indexes:
    "publishing_tasks_pkey" PRIMARY KEY, btree (id)
    "idx_publishing_tasks_article" btree (article_id)
    "idx_publishing_tasks_batch_id" btree (batch_id)
    "idx_publishing_tasks_scheduled" btree (scheduled_at)
    "idx_publishing_tasks_status" btree (status)
    "idx_publishing_tasks_user_created" btree (user_id, created_at DESC)
    "idx_publishing_tasks_user_id" btree (user_id)
    "idx_publishing_tasks_user_status" btree (user_id, status)
    "idx_publishing_tasks_user_status_created" btree (user_id, status, created_at DESC)
Foreign-key constraints:
    "publishing_tasks_account_id_fkey" FOREIGN KEY (account_id) REFERENCES platform_accounts(id) ON DELETE CASCADE
    "publishing_tasks_article_id_fkey" FOREIGN KEY (article_id) REFERENCES articles(id) ON DELETE SET NULL
    "publishing_tasks_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
Referenced by:
    TABLE "publishing_logs" CONSTRAINT "publishing_logs_task_id_fkey" FOREIGN KEY (task_id) REFERENCES publishing_tasks(id) ON DELETE CASCADE
    TABLE "publishing_records" CONSTRAINT "publishing_records_task_id_fkey" FOREIGN KEY (task_id) REFERENCES publishing_tasks(id) ON DELETE SET NULL
Triggers:
    trigger_sync_publishing_task_account_snapshot BEFORE INSERT ON publishing_tasks FOR EACH ROW EXECUTE FUNCTION sync_publishing_task_account_snapshot()
Access method: heap

```

---

## 表: publishing_records

```
                                                                                     Table "public.publishing_records"
         Column         |            Type             | Collation | Nullable |                    Default                     | Storage  | Compression | Stats target |            Description             
------------------------+-----------------------------+-----------+----------+------------------------------------------------+----------+-------------+--------------+------------------------------------
 id                     | integer                     |           | not null | nextval('publishing_records_id_seq'::regclass) | plain    |             |              | 
 user_id                | integer                     |           | not null |                                                | plain    |             |              | 
 article_id             | integer                     |           |          |                                                | plain    |             |              | 
 task_id                | integer                     |           |          |                                                | plain    |             |              | 
 account_id             | integer                     |           | not null |                                                | plain    |             |              | 
 account_name           | character varying(100)      |           |          |                                                | extended |             |              | 
 platform_id            | character varying(50)       |           | not null |                                                | extended |             |              | 
 platform_article_id    | character varying(255)      |           |          |                                                | extended |             |              | 
 platform_url           | character varying(500)      |           |          |                                                | extended |             |              | 
 status                 | character varying(20)       |           |          | 'pending'::character varying                   | extended |             |              | 
 publishing_status      | character varying(20)       |           |          | 'draft'::character varying                     | extended |             |              | 
 published_at           | timestamp without time zone |           |          |                                                | plain    |             |              | 
 error_message          | text                        |           |          |                                                | extended |             |              | 
 article_title          | character varying(500)      |           |          |                                                | extended |             |              | 文章标题快照
 article_content        | text                        |           |          |                                                | extended |             |              | 文章内容快照
 article_keyword        | character varying(255)      |           |          |                                                | extended |             |              | 文章关键词快照
 article_image_url      | text                        |           |          |                                                | extended |             |              | 文章图片URL快照
 topic_question         | text                        |           |          |                                                | extended |             |              | 蒸馏话题问题快照
 article_setting_name   | character varying(255)      |           |          |                                                | extended |             |              | 文章设置名称快照
 distillation_keyword   | character varying(255)      |           |          |                                                | extended |             |              | 蒸馏关键词快照
 created_at             | timestamp without time zone |           |          | CURRENT_TIMESTAMP                              | plain    |             |              | 
 updated_at             | timestamp without time zone |           |          | CURRENT_TIMESTAMP                              | plain    |             |              | 
 real_username_snapshot | character varying(255)      |           |          |                                                | extended |             |              | 真实用户名快照（删除账号后仍保留）
Indexes:
    "publishing_records_pkey" PRIMARY KEY, btree (id)
    "idx_publishing_records_account_id" btree (account_id)
    "idx_publishing_records_article_id" btree (article_id)
    "idx_publishing_records_article_keyword" btree (article_keyword)
    "idx_publishing_records_platform_id" btree (platform_id)
    "idx_publishing_records_published_at" btree (published_at DESC)
    "idx_publishing_records_publishing_status" btree (publishing_status)
    "idx_publishing_records_status" btree (status)
    "idx_publishing_records_task" btree (task_id)
    "idx_publishing_records_task_platform" btree (task_id, platform_id)
    "idx_publishing_records_user_article" btree (user_id, article_id)
    "idx_publishing_records_user_id" btree (user_id)
    "idx_publishing_records_user_platform" btree (user_id, platform_id)
    "idx_publishing_records_user_task" btree (user_id, task_id)
Foreign-key constraints:
    "fk_publishing_records_user" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
    "publishing_records_account_id_fkey" FOREIGN KEY (account_id) REFERENCES platform_accounts(id) ON DELETE CASCADE
    "publishing_records_article_id_fkey" FOREIGN KEY (article_id) REFERENCES articles(id) ON DELETE SET NULL
    "publishing_records_task_id_fkey" FOREIGN KEY (task_id) REFERENCES publishing_tasks(id) ON DELETE SET NULL
    "publishing_records_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
Triggers:
    trigger_sync_publishing_record_account_snapshot BEFORE INSERT ON publishing_records FOR EACH ROW EXECUTE FUNCTION sync_publishing_record_account_snapshot()
Access method: heap

```

---

## 表: publishing_logs

```
                                                                   Table "public.publishing_logs"
   Column   |            Type             | Collation | Nullable |                   Default                   | Storage  | Compression | Stats target | Description 
------------+-----------------------------+-----------+----------+---------------------------------------------+----------+-------------+--------------+-------------
 id         | integer                     |           | not null | nextval('publishing_logs_id_seq'::regclass) | plain    |             |              | 
 task_id    | integer                     |           | not null |                                             | plain    |             |              | 
 level      | character varying(20)       |           | not null |                                             | extended |             |              | 
 message    | text                        |           | not null |                                             | extended |             |              | 
 details    | text                        |           |          |                                             | extended |             |              | 
 created_at | timestamp without time zone |           |          | CURRENT_TIMESTAMP                           | plain    |             |              | 
Indexes:
    "publishing_logs_pkey" PRIMARY KEY, btree (id)
    "idx_publishing_logs_level" btree (level)
    "idx_publishing_logs_task" btree (task_id)
Foreign-key constraints:
    "publishing_logs_task_id_fkey" FOREIGN KEY (task_id) REFERENCES publishing_tasks(id) ON DELETE CASCADE
Access method: heap

```

---

## 表: conversion_targets

```
                                                                        Table "public.conversion_targets"
     Column      |            Type             | Collation | Nullable |                    Default                     | Storage  | Compression | Stats target |   Description    
-----------------+-----------------------------+-----------+----------+------------------------------------------------+----------+-------------+--------------+------------------
 id              | integer                     |           | not null | nextval('conversion_targets_id_seq'::regclass) | plain    |             |              | 
 user_id         | integer                     |           |          |                                                | plain    |             |              | 
 company_name    | character varying(255)      |           | not null |                                                | extended |             |              | 
 industry        | character varying(100)      |           |          |                                                | extended |             |              | 行业（可选）
 company_size    | character varying(50)       |           |          |                                                | extended |             |              | 公司规模（可选）
 features        | text                        |           |          |                                                | extended |             |              | 公司特点（可选）
 contact_info    | character varying(255)      |           |          |                                                | extended |             |              | 联系方式（可选）
 website         | character varying(500)      |           |          |                                                | extended |             |              | 
 target_audience | text                        |           |          |                                                | extended |             |              | 目标受众（可选）
 core_products   | text                        |           |          |                                                | extended |             |              | 核心产品（可选）
 address         | character varying(500)      |           |          |                                                | extended |             |              | 公司地址
 created_at      | timestamp without time zone |           |          | CURRENT_TIMESTAMP                              | plain    |             |              | 
 updated_at      | timestamp without time zone |           |          | CURRENT_TIMESTAMP                              | plain    |             |              | 
Indexes:
    "conversion_targets_pkey" PRIMARY KEY, btree (id)
    "idx_conversion_targets_company_name" btree (company_name)
    "idx_conversion_targets_created_at" btree (created_at DESC)
    "idx_conversion_targets_user_id" btree (user_id)
Foreign-key constraints:
    "conversion_targets_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
Referenced by:
    TABLE "generation_tasks" CONSTRAINT "generation_tasks_conversion_target_id_fkey" FOREIGN KEY (conversion_target_id) REFERENCES conversion_targets(id) ON DELETE SET NULL
Access method: heap

```

---

## 表: distillations

```
                                                                    Table "public.distillations"
   Column    |            Type             | Collation | Nullable |                  Default                  | Storage  | Compression | Stats target | Description  
-------------+-----------------------------+-----------+----------+-------------------------------------------+----------+-------------+--------------+--------------
 id          | integer                     |           | not null | nextval('distillations_id_seq'::regclass) | plain    |             |              | 
 user_id     | integer                     |           |          |                                           | plain    |             |              | 
 keyword     | character varying(255)      |           | not null |                                           | extended |             |              | 
 provider    | character varying(20)       |           | not null |                                           | extended |             |              | 
 usage_count | integer                     |           |          | 0                                         | plain    |             |              | 使用次数统计
 created_at  | timestamp without time zone |           |          | CURRENT_TIMESTAMP                         | plain    |             |              | 
Indexes:
    "distillations_pkey" PRIMARY KEY, btree (id)
    "idx_distillations_keyword" btree (keyword)
    "idx_distillations_usage_count" btree (usage_count DESC)
    "idx_distillations_user_created" btree (user_id, created_at DESC)
    "idx_distillations_user_id" btree (user_id)
Foreign-key constraints:
    "distillations_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
Referenced by:
    TABLE "articles" CONSTRAINT "articles_distillation_id_fkey" FOREIGN KEY (distillation_id) REFERENCES distillations(id) ON DELETE SET NULL
    TABLE "distillation_usage" CONSTRAINT "distillation_usage_distillation_id_fkey" FOREIGN KEY (distillation_id) REFERENCES distillations(id) ON DELETE CASCADE
    TABLE "generation_tasks" CONSTRAINT "generation_tasks_distillation_id_fkey" FOREIGN KEY (distillation_id) REFERENCES distillations(id) ON DELETE SET NULL
    TABLE "topic_usage" CONSTRAINT "topic_usage_distillation_id_fkey" FOREIGN KEY (distillation_id) REFERENCES distillations(id) ON DELETE CASCADE
    TABLE "topics" CONSTRAINT "topics_distillation_id_fkey" FOREIGN KEY (distillation_id) REFERENCES distillations(id) ON DELETE SET NULL
Access method: heap

```

---

## 表: topics

```
                                                                                          Table "public.topics"
     Column      |            Type             | Collation | Nullable |              Default               | Storage  | Compression | Stats target |                     Description                      
-----------------+-----------------------------+-----------+----------+------------------------------------+----------+-------------+--------------+------------------------------------------------------
 id              | integer                     |           | not null | nextval('topics_id_seq'::regclass) | plain    |             |              | 
 user_id         | integer                     |           | not null |                                    | plain    |             |              | 用户ID（独立存储，用于多租户隔离）
 distillation_id | integer                     |           |          |                                    | plain    |             |              | 来源蒸馏ID（可选，仅作追踪用途，ON DELETE SET NULL）
 keyword         | character varying(255)      |           | not null |                                    | extended |             |              | 关键词（独立存储，不依赖 distillations）
 question        | text                        |           | not null |                                    | extended |             |              | 
 usage_count     | integer                     |           |          | 0                                  | plain    |             |              | 
 created_at      | timestamp without time zone |           |          | CURRENT_TIMESTAMP                  | plain    |             |              | 
Indexes:
    "topics_pkey" PRIMARY KEY, btree (id)
    "idx_topics_distillation" btree (distillation_id)
    "idx_topics_keyword" btree (keyword)
    "idx_topics_usage_count" btree (usage_count DESC)
    "idx_topics_user_created" btree (user_id, created_at DESC)
    "idx_topics_user_id" btree (user_id)
Foreign-key constraints:
    "topics_distillation_id_fkey" FOREIGN KEY (distillation_id) REFERENCES distillations(id) ON DELETE SET NULL
    "topics_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
Referenced by:
    TABLE "articles" CONSTRAINT "articles_topic_id_fkey" FOREIGN KEY (topic_id) REFERENCES topics(id) ON DELETE SET NULL
    TABLE "topic_usage" CONSTRAINT "topic_usage_topic_id_fkey" FOREIGN KEY (topic_id) REFERENCES topics(id) ON DELETE CASCADE
Triggers:
    trigger_sync_topic_snapshot BEFORE INSERT ON topics FOR EACH ROW EXECUTE FUNCTION sync_topic_snapshot()
Access method: heap

```

---

## 表: article_settings

```
                                                                   Table "public.article_settings"
   Column   |            Type             | Collation | Nullable |                   Default                    | Storage  | Compression | Stats target | Description 
------------+-----------------------------+-----------+----------+----------------------------------------------+----------+-------------+--------------+-------------
 id         | integer                     |           | not null | nextval('article_settings_id_seq'::regclass) | plain    |             |              | 
 user_id    | integer                     |           |          |                                              | plain    |             |              | 
 name       | character varying(255)      |           | not null |                                              | extended |             |              | 
 prompt     | text                        |           | not null |                                              | extended |             |              | 
 created_at | timestamp without time zone |           |          | CURRENT_TIMESTAMP                            | plain    |             |              | 
 updated_at | timestamp without time zone |           |          | CURRENT_TIMESTAMP                            | plain    |             |              | 
Indexes:
    "article_settings_pkey" PRIMARY KEY, btree (id)
    "idx_article_settings_created_at" btree (created_at DESC)
    "idx_article_settings_user_id" btree (user_id)
Foreign-key constraints:
    "article_settings_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
Referenced by:
    TABLE "generation_tasks" CONSTRAINT "generation_tasks_article_setting_id_fkey" FOREIGN KEY (article_setting_id) REFERENCES article_settings(id) ON DELETE SET NULL
Access method: heap

```

---

## 表: distillation_config

```
                                                                    Table "public.distillation_config"
   Column    |            Type             | Collation | Nullable |                     Default                     | Storage  | Compression | Stats target | Description 
-------------+-----------------------------+-----------+----------+-------------------------------------------------+----------+-------------+--------------+-------------
 id          | integer                     |           | not null | nextval('distillation_config_id_seq'::regclass) | plain    |             |              | 
 user_id     | integer                     |           |          |                                                 | plain    |             |              | 
 prompt      | text                        |           | not null |                                                 | extended |             |              | 
 topic_count | integer                     |           | not null | 12                                              | plain    |             |              | 
 is_active   | boolean                     |           |          | true                                            | plain    |             |              | 
 created_at  | timestamp without time zone |           |          | CURRENT_TIMESTAMP                               | plain    |             |              | 
 updated_at  | timestamp without time zone |           |          | CURRENT_TIMESTAMP                               | plain    |             |              | 
Indexes:
    "distillation_config_pkey" PRIMARY KEY, btree (id)
    "idx_distillation_config_active" btree (is_active)
    "idx_distillation_config_user_id" btree (user_id)
Check constraints:
    "distillation_config_topic_count_check" CHECK (topic_count >= 5 AND topic_count <= 30)
Foreign-key constraints:
    "distillation_config_user_id_fkey" FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
Access method: heap

```

---

## 表: image_usage

```
                                                                   Table "public.image_usage"
   Column   |            Type             | Collation | Nullable |                 Default                 | Storage | Compression | Stats target | Description 
------------+-----------------------------+-----------+----------+-----------------------------------------+---------+-------------+--------------+-------------
 id         | integer                     |           | not null | nextval('image_usage_id_seq'::regclass) | plain   |             |              | 
 image_id   | integer                     |           | not null |                                         | plain   |             |              | 
 article_id | integer                     |           | not null |                                         | plain   |             |              | 
 used_at    | timestamp without time zone |           |          | CURRENT_TIMESTAMP                       | plain   |             |              | 
Indexes:
    "image_usage_pkey" PRIMARY KEY, btree (id)
    "idx_image_usage_article_id" btree (article_id)
    "idx_image_usage_image_id" btree (image_id)
    "image_usage_image_id_article_id_key" UNIQUE CONSTRAINT, btree (image_id, article_id)
Foreign-key constraints:
    "image_usage_article_id_fkey" FOREIGN KEY (article_id) REFERENCES articles(id) ON DELETE CASCADE
    "image_usage_image_id_fkey" FOREIGN KEY (image_id) REFERENCES images(id) ON DELETE CASCADE
Access method: heap

```

---

## 表: distillation_usage

```
                                                                     Table "public.distillation_usage"
     Column      |            Type             | Collation | Nullable |                    Default                     | Storage | Compression | Stats target | Description 
-----------------+-----------------------------+-----------+----------+------------------------------------------------+---------+-------------+--------------+-------------
 id              | integer                     |           | not null | nextval('distillation_usage_id_seq'::regclass) | plain   |             |              | 
 distillation_id | integer                     |           |          |                                                | plain   |             |              | 
 task_id         | integer                     |           | not null |                                                | plain   |             |              | 
 article_id      | integer                     |           |          |                                                | plain   |             |              | 
 used_at         | timestamp without time zone |           |          | CURRENT_TIMESTAMP                              | plain   |             |              | 
Indexes:
    "distillation_usage_pkey" PRIMARY KEY, btree (id)
    "idx_distillation_usage_article_id" btree (article_id)
    "idx_distillation_usage_distillation_id" btree (distillation_id)
    "idx_distillation_usage_task_id" btree (task_id)
Foreign-key constraints:
    "distillation_usage_article_id_fkey" FOREIGN KEY (article_id) REFERENCES articles(id) ON DELETE CASCADE
    "distillation_usage_distillation_id_fkey" FOREIGN KEY (distillation_id) REFERENCES distillations(id) ON DELETE CASCADE
    "distillation_usage_task_id_fkey" FOREIGN KEY (task_id) REFERENCES generation_tasks(id) ON DELETE CASCADE
Access method: heap

```

---

## 表: topic_usage

```
                                                                         Table "public.topic_usage"
     Column      |            Type             | Collation | Nullable |                 Default                 | Storage  | Compression | Stats target |    Description     
-----------------+-----------------------------+-----------+----------+-----------------------------------------+----------+-------------+--------------+--------------------
 id              | integer                     |           | not null | nextval('topic_usage_id_seq'::regclass) | plain    |             |              | 
 topic_id        | integer                     |           |          |                                         | plain    |             |              | 
 distillation_id | integer                     |           |          |                                         | plain    |             |              | 
 article_id      | integer                     |           |          |                                         | plain    |             |              | 
 task_id         | integer                     |           |          |                                         | plain    |             |              | 
 keyword         | character varying(255)      |           |          |                                         | extended |             |              | 关键词（独立存储）
 used_at         | timestamp without time zone |           |          | CURRENT_TIMESTAMP                       | plain    |             |              | 
Indexes:
    "topic_usage_pkey" PRIMARY KEY, btree (id)
    "idx_topic_usage_article_id" btree (article_id)
    "idx_topic_usage_distillation_id" btree (distillation_id)
    "idx_topic_usage_keyword" btree (keyword)
    "idx_topic_usage_task_id" btree (task_id)
    "idx_topic_usage_topic_id" btree (topic_id)
Foreign-key constraints:
    "topic_usage_article_id_fkey" FOREIGN KEY (article_id) REFERENCES articles(id) ON DELETE CASCADE
    "topic_usage_distillation_id_fkey" FOREIGN KEY (distillation_id) REFERENCES distillations(id) ON DELETE CASCADE
    "topic_usage_task_id_fkey" FOREIGN KEY (task_id) REFERENCES generation_tasks(id) ON DELETE SET NULL
    "topic_usage_topic_id_fkey" FOREIGN KEY (topic_id) REFERENCES topics(id) ON DELETE CASCADE
Triggers:
    trigger_sync_topic_usage_keyword_snapshot BEFORE INSERT ON topic_usage FOR EACH ROW EXECUTE FUNCTION sync_topic_usage_keyword_snapshot()
Access method: heap

```

---

