# ç¯å¢ƒå˜é‡é…ç½®è¯´æ˜

## âœ… æœ€ç»ˆæ–¹æ¡ˆï¼šç»Ÿä¸€ä½¿ç”¨ server/.env

### ä¸ºä»€ä¹ˆåªä¿ç•™ä¸€ä¸ª .env æ–‡ä»¶ï¼Ÿ

1. **é¿å…æ··æ·†** - ä¸¤ä¸ª `.env` æ–‡ä»¶å®¹æ˜“å¯¼è‡´é…ç½®ä¸ä¸€è‡´
2. **ç®€åŒ–ç»´æŠ¤** - åªéœ€è¦ç»´æŠ¤ä¸€ä¸ªé…ç½®æ–‡ä»¶
3. **æ¸…æ™°æ˜ç¡®** - åç«¯æœåŠ¡çš„é…ç½®å°±åœ¨åç«¯ç›®å½•

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
GEOç³»ç»Ÿ/
â”œâ”€â”€ .env                    âŒ å·²åˆ é™¤
â”œâ”€â”€ server/
â”‚   â”œâ”€â”€ .env               âœ… å”¯ä¸€çš„ç¯å¢ƒå˜é‡æ–‡ä»¶
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ index.ts       âœ… è¯»å– server/.env
â”‚       â””â”€â”€ db/
â”‚           â”œâ”€â”€ database.ts âœ… è¯»å– server/.env
â”‚           â””â”€â”€ redis.ts    âœ… è¯»å– server/.env
```

---

## ğŸ”§ ä»£ç ä¿®æ”¹

### 1. server/src/index.ts
```typescript
// ä¿®æ”¹å‰
dotenv.config({ path: path.join(__dirname, '../../.env') });

// ä¿®æ”¹å
dotenv.config({ path: path.join(__dirname, '../.env') });
```

### 2. server/src/db/database.ts
```typescript
// ä¿®æ”¹å‰
dotenv.config({ path: path.join(__dirname, '../../../.env') });

// ä¿®æ”¹å
dotenv.config({ path: path.join(__dirname, '../../.env') });
```

### 3. server/src/db/redis.ts
```typescript
// ä¿®æ”¹å‰
dotenv.config({ path: path.join(__dirname, '../../../.env') });

// ä¿®æ”¹å
dotenv.config({ path: path.join(__dirname, '../../.env') });
```

---

## ğŸ“ server/.env é…ç½®å†…å®¹

```env
# æœ¬åœ°å¼€å‘ç¯å¢ƒé…ç½®
NODE_ENV=development
PORT=3000

# æ•°æ®åº“é…ç½®
DATABASE_URL=postgresql://lzc@localhost:5432/geo_system
DB_HOST=localhost
DB_PORT=5432
DB_NAME=geo_system
DB_USER=lzc
DB_PASSWORD=

# JWT é…ç½®
JWT_SECRET=01063967995933d396d9c8271612794d4c174665de8748d27c7abce6b366f46e
JWT_REFRESH_SECRET=e5c75b1c40c8457fff6955b99fab1e8eec8645cca0146981fa2fa7a1794f482a
JWT_EXPIRES_IN=1h
REFRESH_TOKEN_EXPIRES_IN=7d

# ç®¡ç†å‘˜è´¦å·
ADMIN_USERNAME=lzc2005
ADMIN_PASSWORD=Woshixiaogou2005

# AI API é…ç½®
DEEPSEEK_API_KEY=sk-your-deepseek-api-key
GEMINI_API_KEY=AIzaSy-your-gemini-api-key
OLLAMA_BASE_URL=http://localhost:11434

# WebSocket é…ç½®
WEBSOCKET_PORT=8080

# CORS é…ç½®
ALLOWED_ORIGINS=http://localhost,http://localhost:5173,http://localhost:5174,http://localhost:8080,https://granolithic-pseudoprosperous-rebeca.ngrok-free.dev

# é™æµé…ç½®
LOGIN_RATE_LIMIT=5
LOGIN_RATE_WINDOW_MINUTES=15
REGISTRATION_RATE_LIMIT=3
REGISTRATION_RATE_WINDOW_HOURS=1

# ==================== å¾®ä¿¡æ”¯ä»˜é…ç½® ====================
WECHAT_PAY_APP_ID=wx_your_app_id_here
WECHAT_PAY_MCH_ID=your_merchant_id
WECHAT_PAY_API_V3_KEY=your_32_character_api_v3_key_here
WECHAT_PAY_SERIAL_NO=your_certificate_serial_number_here
WECHAT_PAY_PRIVATE_KEY_PATH=/Users/lzc/.wechat-pay/apiclient_key.pem
WECHAT_PAY_NOTIFY_URL=https://granolithic-pseudoprosperous-rebeca.ngrok-free.dev/api/payment/wechat/notify
```

---

## âš ï¸ é‡è¦æç¤º

### æ›´æ–° ngrok åœ°å€æ—¶

å½“ ngrok é‡å¯ååŸŸåæ”¹å˜æ—¶ï¼Œéœ€è¦æ›´æ–°ä¸¤ä¸ªåœ°æ–¹ï¼š

1. **ALLOWED_ORIGINS** - æ·»åŠ æ–°çš„ ngrok åŸŸå
2. **WECHAT_PAY_NOTIFY_URL** - æ›´æ–°ä¸ºæ–°çš„ ngrok åŸŸå

```env
# ç¤ºä¾‹
ALLOWED_ORIGINS=http://localhost,http://localhost:5173,http://localhost:5174,http://localhost:8080,https://æ–°çš„ngrokåŸŸå.ngrok-free.dev
WECHAT_PAY_NOTIFY_URL=https://æ–°çš„ngrokåŸŸå.ngrok-free.dev/api/payment/wechat/notify
```

### å¯†ç è¯´æ˜

- **ç®¡ç†å‘˜å¯†ç **ï¼š`Woshixiaogou2005`ï¼ˆåœ¨ server/.env ä¸­é…ç½®ï¼‰
- è¿™æ˜¯å”¯ä¸€æœ‰æ•ˆçš„å¯†ç ï¼Œä¹‹å‰çš„ `TestDocker2024!` å·²åºŸå¼ƒ

---

## âœ… éªŒè¯é…ç½®

### 1. æ£€æŸ¥æœåŠ¡å¯åŠ¨
```bash
cd server
npm run dev
```

åº”è¯¥çœ‹åˆ°ï¼š
```
âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ
âœ… Redisè¿æ¥æˆåŠŸ
âœ… æ”¯ä»˜é…ç½®éªŒè¯é€šè¿‡
ğŸš€ æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:3000
```

### 2. æµ‹è¯•ç™»å½•
```bash
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"lzc2005","password":"Woshixiaogou2005"}'
```

åº”è¯¥è¿”å›ï¼š
```json
{
  "success": true,
  "data": {
    "token": "...",
    "user": {...}
  }
}
```

---

## ğŸ¯ æ€»ç»“

âœ… åˆ é™¤äº†æ ¹ç›®å½•çš„ `.env` æ–‡ä»¶  
âœ… ç»Ÿä¸€ä½¿ç”¨ `server/.env`  
âœ… ä¿®æ”¹äº†æ‰€æœ‰è¯»å–ç¯å¢ƒå˜é‡çš„ä»£ç   
âœ… æœåŠ¡å™¨å¯åŠ¨æ­£å¸¸  
âœ… ç™»å½•åŠŸèƒ½æ­£å¸¸  
âœ… CORS é…ç½®æ­£ç¡®  
âœ… å¾®ä¿¡æ”¯ä»˜é…ç½®æ­£ç¡®  

**ç°åœ¨é…ç½®æ¸…æ™°æ˜ç¡®ï¼Œä¸ä¼šå†æ··æ·†äº†ï¼**
