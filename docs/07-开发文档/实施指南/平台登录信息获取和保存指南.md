# å¹³å°ç™»å½•ä¿¡æ¯è·å–å’Œä¿å­˜å®Œæ•´æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

è¿™ä»½æŒ‡å—å°†è¯¦ç»†è¯´æ˜å¦‚ä½•è·å–å„å¹³å°çš„ç™»å½•ä¿¡æ¯ï¼ˆCookieï¼‰å¹¶æ­£ç¡®ä¿å­˜åˆ°ç³»ç»Ÿä¸­ã€‚ç³»ç»Ÿä½¿ç”¨ **Playwright** æµè§ˆå™¨è‡ªåŠ¨åŒ–æŠ€æœ¯ï¼Œé€šè¿‡çœŸå®æµè§ˆå™¨ç™»å½•æ¥æ•è·Cookieã€‚

---

## ğŸ¯ æ ¸å¿ƒåŸç†

### å·¥ä½œæµç¨‹

```
ç”¨æˆ·ç‚¹å‡»ç™»å½• â†’ æ‰“å¼€çœŸå®æµè§ˆå™¨ â†’ ç”¨æˆ·æ‰‹åŠ¨ç™»å½• â†’ ç³»ç»Ÿæ£€æµ‹ç™»å½•æˆåŠŸ 
â†’ è‡ªåŠ¨æ•è·Cookie â†’ æå–ç”¨æˆ·å â†’ ä¿å­˜åˆ°æ•°æ®åº“ï¼ˆåŠ å¯†ï¼‰
```

### å…³é”®æŠ€æœ¯

1. **Playwright**: æ§åˆ¶çœŸå®Chromeæµè§ˆå™¨
2. **Cookieæ•è·**: ç™»å½•æˆåŠŸåè‡ªåŠ¨è·å–æ‰€æœ‰Cookie
3. **ç”¨æˆ·åæå–**: ä½¿ç”¨CSSé€‰æ‹©å™¨ä»é¡µé¢æå–çœŸå®ç”¨æˆ·å
4. **åŠ å¯†å­˜å‚¨**: Cookieå’Œå‡­è¯åŠ å¯†åå­˜å‚¨åœ¨æ•°æ®åº“

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³•1ï¼šä½¿ç”¨ç•Œé¢ï¼ˆæ¨èï¼‰

1. **å¯åŠ¨ç³»ç»Ÿ**
   ```bash
   ./å¯åŠ¨GEOç³»ç»Ÿ.command          # å¯åŠ¨åç«¯æœåŠ¡
   ./å¯åŠ¨Windowsç®¡ç†å™¨.command     # å¯åŠ¨ç™»å½•ç®¡ç†å™¨
   ```

2. **ç™»å½•å¹³å°**
   - æ‰“å¼€Windowsç™»å½•ç®¡ç†å™¨
   - è¿›å…¥"å¹³å°ç®¡ç†"é¡µé¢
   - ç‚¹å‡»è¦ç™»å½•çš„å¹³å°å¡ç‰‡
   - åœ¨å¼¹å‡ºçš„æµè§ˆå™¨ä¸­å®Œæˆç™»å½•
   - ç³»ç»Ÿè‡ªåŠ¨æ£€æµ‹å¹¶ä¿å­˜

3. **éªŒè¯ç»“æœ**
   - å¹³å°å¡ç‰‡å³ä¸Šè§’æ˜¾ç¤º âœ“ æ ‡è®°
   - è´¦å·åˆ—è¡¨ä¸­æ˜¾ç¤ºæ–°è´¦å·
   - çœŸå®ç”¨æˆ·åæ­£ç¡®æ˜¾ç¤º

### æ–¹æ³•2ï¼šä½¿ç”¨API

```bash
# 1. è·å–è®¤è¯token
TOKEN="your_auth_token"

# 2. è°ƒç”¨æµè§ˆå™¨ç™»å½•API
curl -X POST http://localhost:3000/api/platform-accounts/browser-login \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{
    "platform": "toutiao"
  }'

# 3. åœ¨å¼¹å‡ºçš„æµè§ˆå™¨ä¸­å®Œæˆç™»å½•
# 4. ç³»ç»Ÿè‡ªåŠ¨ä¿å­˜è´¦å·ä¿¡æ¯
```

### æ–¹æ³•3ï¼šä½¿ç”¨æµ‹è¯•è„šæœ¬

```bash
# æµ‹è¯•å¤´æ¡å·ç™»å½•
./test-platform-login.sh toutiao

# æµ‹è¯•å°çº¢ä¹¦ç™»å½•
./test-platform-login.sh xiaohongshu

# æµ‹è¯•çŸ¥ä¹ç™»å½•
./test-platform-login.sh zhihu
```

---

## ğŸ“š è¯¦ç»†æµç¨‹è¯´æ˜

### ç¬¬ä¸€æ­¥ï¼šæµè§ˆå™¨å¯åŠ¨

**ä»£ç ä½ç½®**: `server/src/services/AccountService.ts` - `loginWithBrowser()`

```typescript
// ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
1. æŸ¥æ‰¾ç³»ç»ŸChromeæµè§ˆå™¨è·¯å¾„
2. ä½¿ç”¨Playwrightå¯åŠ¨Chromeï¼ˆéheadlessæ¨¡å¼ï¼‰
3. åˆ›å»ºæ–°çš„æµè§ˆå™¨ä¸Šä¸‹æ–‡å’Œé¡µé¢
4. å¯¼èˆªåˆ°å¹³å°ç™»å½•é¡µé¢
```

**å¹³å°ç™»å½•URLé…ç½®**:

```typescript
const loginUrls = {
  'toutiao': 'https://mp.toutiao.com/auth/page/login/',
  'xiaohongshu': 'https://creator.xiaohongshu.com/login',
  'wechat': 'https://mp.weixin.qq.com/',
  'zhihu': 'https://www.zhihu.com/signin',
  'jianshu': 'https://www.jianshu.com/sign_in',
  // ... æ›´å¤šå¹³å°
};
```

### ç¬¬äºŒæ­¥ï¼šç”¨æˆ·æ‰‹åŠ¨ç™»å½•

**ä½ éœ€è¦åšçš„**:
1. åœ¨å¼¹å‡ºçš„æµè§ˆå™¨çª—å£ä¸­è¾“å…¥è´¦å·å¯†ç 
2. å®ŒæˆéªŒè¯ç ï¼ˆå¦‚æœæœ‰ï¼‰
3. å®ŒæˆäºŒæ¬¡éªŒè¯ï¼ˆå¦‚æœæœ‰ï¼‰
4. ç­‰å¾…è·³è½¬åˆ°å¹³å°ä¸»é¡µ

**ç³»ç»Ÿä¼šåšçš„**:
- å®æ—¶ç›‘æ§URLå˜åŒ–
- æ£€æµ‹ç™»å½•æˆåŠŸæ ‡å¿—
- ç­‰å¾…é¡µé¢å®Œå…¨åŠ è½½

### ç¬¬ä¸‰æ­¥ï¼šç™»å½•æˆåŠŸæ£€æµ‹

**ä»£ç ä½ç½®**: `server/src/services/AccountService.ts` - `waitForLogin()`

ç³»ç»Ÿä¸ºæ¯ä¸ªå¹³å°é…ç½®äº†ä¸“é—¨çš„ç™»å½•æ£€æµ‹ç­–ç•¥ï¼š

#### ç­–ç•¥1ï¼šURLå˜åŒ–æ£€æµ‹ï¼ˆé€šç”¨ï¼‰

```typescript
// æ£€æµ‹URLä»ç™»å½•é¡µè·³è½¬åˆ°å…¶ä»–é¡µé¢
await page.waitForFunction(
  `window.location.href !== "${initialUrl}"`,
  { timeout: 300000 }
);
```

**é€‚ç”¨å¹³å°**: å¤´æ¡å·ã€ç½‘æ˜“å·ç­‰

#### ç­–ç•¥2ï¼šURL + å…ƒç´ æ£€æµ‹ï¼ˆç²¾å‡†ï¼‰

```typescript
// å°çº¢ä¹¦ï¼šæ£€æµ‹URLè·³è½¬åˆ°æ–°ç‰ˆä¸»é¡µ
await page.waitForFunction(
  `window.location.href.includes('creator.xiaohongshu.com/new/home')`,
  { timeout: 300000 }
);
```

**é€‚ç”¨å¹³å°**: å°çº¢ä¹¦ã€å¾®ä¿¡å…¬ä¼—å·ã€Bç«™

#### ç­–ç•¥3ï¼šè·³è¿‡ä¸­é—´é¡µé¢ï¼ˆç‰¹æ®Šï¼‰

```typescript
// ä¼é¹…å·ï¼šè·³è¿‡æ³¨å†Œç¡®è®¤é¡µï¼Œç­‰å¾…åˆ°è¾¾åˆ›ä½œè€…ä¸­å¿ƒ
await page.waitForFunction(
  `!window.location.href.includes('userReg') &&
   window.location.href.includes('/main')`,
  { timeout: 300000 }
);
```

**é€‚ç”¨å¹³å°**: ä¼é¹…å·ã€æœç‹å·

### ç¬¬å››æ­¥ï¼šCookieæ•è·

**ä»£ç ä½ç½®**: `server/src/services/AccountService.ts` - `loginWithBrowser()`

```typescript
// Playwrightè‡ªåŠ¨æ•è·æ‰€æœ‰Cookie
const cookies = await context.cookies();

console.log(`æˆåŠŸè·å– ${cookies.length} ä¸ªCookie`);
```

**Cookieæ ¼å¼**:
```json
[
  {
    "name": "sessionid",
    "value": "abc123...",
    "domain": ".toutiao.com",
    "path": "/",
    "expires": 1735689600,
    "httpOnly": true,
    "secure": true,
    "sameSite": "Lax"
  }
]
```

### ç¬¬äº”æ­¥ï¼šç”¨æˆ·åæå–

**ä»£ç ä½ç½®**: `server/src/services/AccountService.ts` - `extractUserInfo()`

ç³»ç»Ÿä½¿ç”¨CSSé€‰æ‹©å™¨ä»é¡µé¢æå–çœŸå®ç”¨æˆ·åï¼š

#### é€‰æ‹©å™¨é…ç½®ï¼ˆä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼‰

```typescript
const selectors = {
  'toutiao': [
    '.auth-avator-name',              // ä¼˜å…ˆçº§1ï¼šå¤´åƒæ—çš„åç§°
    '.semi-navigation-header-username', // ä¼˜å…ˆçº§2ï¼šå¯¼èˆªæ ç”¨æˆ·å
    '.user-name',                     // ä¼˜å…ˆçº§3ï¼šé€šç”¨ç”¨æˆ·å
    '[class*="username"]'             // ä¼˜å…ˆçº§4ï¼šåŒ…å«usernameçš„class
  ],
  
  'xiaohongshu': [
    // ç²¾å‡†é€‰æ‹©å™¨ï¼ˆå·²æµ‹è¯•æˆåŠŸï¼‰
    '#header-area > div > div > div:nth-child(2) > div > span'
  ],
  
  'wechat': [
    '.weui-desktop-account__info',    // ä¼˜å…ˆçº§1ï¼šä¾§è¾¹æ è´¦å·ä¿¡æ¯
    '.weui-desktop-account__nickname', // ä¼˜å…ˆçº§2ï¼šè´¦å·æ˜µç§°
    '#js_account_name'                // ä¼˜å…ˆçº§3ï¼šè´¦å·åç§°ID
  ]
};
```

#### æå–è¿‡ç¨‹

```typescript
// 1. éå†æ‰€æœ‰é€‰æ‹©å™¨
for (const selector of selectorList) {
  // 2. æ£€æŸ¥å…ƒç´ æ˜¯å¦å­˜åœ¨
  const element = await page.$(selector);
  
  if (element) {
    // 3. æå–æ–‡æœ¬å†…å®¹
    username = await page.$eval(selector, 
      el => el.textContent?.trim() || ''
    );
    
    if (username) {
      console.log(`âœ… æˆåŠŸæå–ç”¨æˆ·å: "${username}"`);
      break;
    }
  }
}
```

#### è°ƒè¯•åŠŸèƒ½

å¦‚æœæå–å¤±è´¥ï¼Œç³»ç»Ÿä¼šï¼š
1. ä¿å­˜é¡µé¢HTMLåˆ° `debug/` ç›®å½•
2. è¾“å‡ºè°ƒè¯•ä¿¡æ¯åˆ°æ§åˆ¶å°
3. å»ºè®®æ£€æŸ¥é€‰æ‹©å™¨é…ç½®

```bash
# æŸ¥çœ‹ä¿å­˜çš„HTML
ls -la debug/
open debug/toutiao_1234567890.html

# åœ¨HTMLä¸­æœç´¢ç”¨æˆ·åï¼Œæ‰¾åˆ°å¯¹åº”çš„å…ƒç´ 
# ç„¶åæ›´æ–°é€‰æ‹©å™¨é…ç½®
```

### ç¬¬å…­æ­¥ï¼šæ•°æ®ä¿å­˜

**ä»£ç ä½ç½®**: `server/src/services/AccountService.ts` - `createOrUpdateAccount()`

#### ä¿å­˜å†…å®¹

```typescript
const credentials = {
  username: userInfo.username || 'browser_login',
  password: 'cookie_auth',  // æ ‡è®°ä¸ºCookieè®¤è¯
  cookies: cookies,         // å®Œæ•´çš„Cookieæ•°ç»„
  loginTime: new Date().toISOString(),
  userInfo: userInfo        // ç”¨æˆ·ä¿¡æ¯
};
```

#### åŠ å¯†å­˜å‚¨

```typescript
// 1. åŠ å¯†å‡­è¯
const encryptedCredentials = encryptionService.encryptObject(credentials);

// 2. ä¿å­˜åˆ°æ•°æ®åº“
await pool.query(
  `INSERT INTO platform_accounts 
   (platform_id, account_name, credentials, real_username, user_id) 
   VALUES ($1, $2, $3, $4, $5)`,
  [platformId, accountName, encryptedCredentials, realUsername, userId]
);
```

#### å»é‡é€»è¾‘

```typescript
// æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒç”¨æˆ·åçš„è´¦å·
const existingAccount = await pool.query(
  `SELECT * FROM platform_accounts 
   WHERE platform_id = $1 
   AND user_id = $2
   AND real_username = $3`,
  [platformId, userId, realUsername]
);

if (existingAccount.rows.length > 0) {
  // æ›´æ–°ç°æœ‰è´¦å·
  await updateAccount(existingAccount.id, credentials);
} else {
  // åˆ›å»ºæ–°è´¦å·
  await createAccount(credentials);
}
```

---

## ğŸ”§ é…ç½®å’Œå®šåˆ¶

### æ·»åŠ æ–°å¹³å°

#### 1. æ·»åŠ ç™»å½•URL

ç¼–è¾‘ `server/src/services/AccountService.ts`:

```typescript
private getPlatformLoginUrl(platformId: string): string | null {
  const loginUrls: { [key: string]: string } = {
    // ... ç°æœ‰å¹³å°
    'newplatform': 'https://newplatform.com/login'  // æ·»åŠ æ–°å¹³å°
  };
  return loginUrls[platformId] || null;
}
```

#### 2. é…ç½®ç™»å½•æ£€æµ‹ç­–ç•¥

```typescript
private async waitForLogin(page: any, platformId: string): Promise<void> {
  const loginDetectionStrategies = {
    // ... ç°æœ‰ç­–ç•¥
    'newplatform': async () => {
      // æ–¹æ³•1ï¼šURLå˜åŒ–æ£€æµ‹
      await page.waitForFunction(
        `window.location.href.includes('dashboard')`,
        { timeout: 300000 }
      );
      
      // æ–¹æ³•2ï¼šå…ƒç´ æ£€æµ‹
      await page.waitForSelector('.user-avatar', { timeout: 300000 });
    }
  };
}
```

#### 3. é…ç½®ç”¨æˆ·åé€‰æ‹©å™¨

```typescript
private async extractUserInfo(page: any, platformId: string): Promise<any> {
  const selectors: { [key: string]: string[] } = {
    // ... ç°æœ‰é€‰æ‹©å™¨
    'newplatform': [
      '.user-name',           // ä¼˜å…ˆçº§1
      '.username',            // ä¼˜å…ˆçº§2
      '[class*="user"]'       // ä¼˜å…ˆçº§3
    ]
  };
}
```

#### 4. æ·»åŠ ä¸»é¡µURLï¼ˆç”¨äºæµ‹è¯•ï¼‰

```typescript
private getPlatformHomeUrl(platformId: string): string | null {
  const homeUrls: { [key: string]: string } = {
    // ... ç°æœ‰å¹³å°
    'newplatform': 'https://newplatform.com/dashboard'
  };
  return homeUrls[platformId] || null;
}
```

### è°ƒæ•´ç­‰å¾…æ—¶é—´

æŸäº›å¹³å°éœ€è¦é¢å¤–çš„ç­‰å¾…æ—¶é—´æ¥åŠ è½½ç”¨æˆ·ä¿¡æ¯ï¼š

```typescript
const platformsNeedingNavigation = {
  'newplatform': {
    url: 'https://newplatform.com/home',
    waitTime: 3000  // ç­‰å¾…3ç§’
  }
};
```

---

## ğŸ› è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—

åç«¯ä¼šè¾“å‡ºè¯¦ç»†çš„ç™»å½•è¿‡ç¨‹ï¼š

```
========================================
[æµè§ˆå™¨ç™»å½•] å¼€å§‹ç™»å½•æµç¨‹
[æµè§ˆå™¨ç™»å½•] å¹³å°: å¤´æ¡å· (toutiao)
[æµè§ˆå™¨ç™»å½•] ç™»å½•URL: https://mp.toutiao.com/auth/page/login/
========================================

[æµè§ˆå™¨ç™»å½•] æ­£åœ¨å¯åŠ¨æµè§ˆå™¨...
[æµè§ˆå™¨ç™»å½•] æµè§ˆå™¨å¯åŠ¨æˆåŠŸ
[æµè§ˆå™¨ç™»å½•] åˆ›å»ºæ–°é¡µé¢æˆåŠŸ
[æµè§ˆå™¨ç™»å½•] æ­£åœ¨å¯¼èˆªåˆ°ç™»å½•é¡µé¢...
[æµè§ˆå™¨ç™»å½•] é¡µé¢åŠ è½½å®Œæˆ

[ç­‰å¾…ç™»å½•] toutiao å¹³å° - åˆå§‹URL: https://mp.toutiao.com/auth/page/login/
[ç­‰å¾…ç™»å½•] å¤´æ¡å·ï¼šç­‰å¾…URLå˜åŒ–...
[ç­‰å¾…ç™»å½•] toutiao ç™»å½•æˆåŠŸï¼Œå½“å‰URL: https://mp.toutiao.com/profile_v4/index

[æµè§ˆå™¨ç™»å½•] æ£€æµ‹åˆ°ç™»å½•æˆåŠŸï¼Œæ­£åœ¨è·å–Cookie...
[æµè§ˆå™¨ç™»å½•] æˆåŠŸè·å– 15 ä¸ªCookie

[æå–ç”¨æˆ·ä¿¡æ¯] å¼€å§‹æå– toutiao å¹³å°çš„ç”¨æˆ·å
[æå–ç”¨æˆ·ä¿¡æ¯] å°è¯•é€‰æ‹©å™¨ 1/6: .auth-avator-name
[æå–ç”¨æˆ·ä¿¡æ¯] âœ… æ‰¾åˆ°å…ƒç´ : .auth-avator-name
[æå–ç”¨æˆ·ä¿¡æ¯] âœ… æˆåŠŸæå–ç”¨æˆ·å: "æµ‹è¯•ç”¨æˆ·"

[æµè§ˆå™¨ç™»å½•] è´¦å·ä¿å­˜æˆåŠŸ ID: 123
```

### 2. æ£€æŸ¥HTMLå¿«ç…§

å¦‚æœç”¨æˆ·åæå–å¤±è´¥ï¼Œç³»ç»Ÿä¼šä¿å­˜HTMLï¼š

```bash
# æŸ¥çœ‹å¿«ç…§ç›®å½•
ls -la debug/

# è¾“å‡ºç¤ºä¾‹
-rw-r--r--  1 user  staff  245678  Dec 31 10:30 toutiao_1735689000123.html
-rw-r--r--  1 user  staff  189234  Dec 31 10:35 xiaohongshu_1735689300456.html

# æ‰“å¼€HTMLæ–‡ä»¶
open debug/toutiao_1735689000123.html

# åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€åï¼š
# 1. æŒ‰ Cmd+F æœç´¢ä½ çš„ç”¨æˆ·å
# 2. æŸ¥çœ‹ç”¨æˆ·åæ‰€åœ¨çš„HTMLå…ƒç´ 
# 3. å¤åˆ¶å…ƒç´ çš„classæˆ–id
# 4. æ›´æ–°é€‰æ‹©å™¨é…ç½®
```

### 3. æ›´æ–°é€‰æ‹©å™¨

æ‰¾åˆ°æ­£ç¡®çš„é€‰æ‹©å™¨åï¼Œæ›´æ–°é…ç½®ï¼š

```typescript
// åœ¨ AccountService.ts çš„ extractUserInfo() æ–¹æ³•ä¸­
const selectors: { [key: string]: string[] } = {
  'toutiao': [
    '.new-selector-you-found',  // æ·»åŠ æ–°å‘ç°çš„é€‰æ‹©å™¨
    '.auth-avator-name',        // ä¿ç•™åŸæœ‰é€‰æ‹©å™¨ä½œä¸ºå¤‡ç”¨
    '.user-name'
  ]
};
```

### 4. æµ‹è¯•ç™»å½•

ä½¿ç”¨æµ‹è¯•åŠŸèƒ½éªŒè¯Cookieæ˜¯å¦æœ‰æ•ˆï¼š

```bash
# æ–¹æ³•1ï¼šä½¿ç”¨API
curl -X POST http://localhost:3000/api/platform-accounts/123/test-login \
  -H "Authorization: Bearer $TOKEN"

# æ–¹æ³•2ï¼šåœ¨ç•Œé¢ä¸­ç‚¹å‡»"æµ‹è¯•ç™»å½•"æŒ‰é’®

# ç³»ç»Ÿä¼šï¼š
# 1. æ‰“å¼€æµè§ˆå™¨
# 2. è®¾ç½®ä¿å­˜çš„Cookie
# 3. å¯¼èˆªåˆ°å¹³å°ä¸»é¡µ
# 4. è®©ä½ æŸ¥çœ‹ç™»å½•çŠ¶æ€
```

---

## ğŸ“Š æ”¯æŒçš„å¹³å°åˆ—è¡¨

### è‡ªåª’ä½“å¹³å°ï¼ˆ5ä¸ªï¼‰

| å¹³å° | ID | ç™»å½•URL | çŠ¶æ€ |
|------|-----|---------|------|
| å¤´æ¡å· | toutiao | https://mp.toutiao.com/auth/page/login/ | âœ… å·²æµ‹è¯• |
| ç½‘æ˜“å· | wangyi | https://mp.163.com/login.html | âœ… å·²ä¼˜åŒ– |
| æœç‹å· | souhu | https://mp.sohu.com/mpfe/v4/login | âœ… å·²ä¼˜åŒ– |
| ç™¾å®¶å· | baijiahao | https://baijiahao.baidu.com/builder/author/register/index | âœ… å·²ä¼˜åŒ– |
| ä¼é¹…å· | qie | https://om.qq.com/userAuth/index | âœ… å·²ä¼˜åŒ– |

### ç¤¾äº¤åª’ä½“å¹³å°ï¼ˆ4ä¸ªï¼‰

| å¹³å° | ID | ç™»å½•URL | çŠ¶æ€ |
|------|-----|---------|------|
| å°çº¢ä¹¦ | xiaohongshu | https://creator.xiaohongshu.com/login | âœ… å·²ä¼˜åŒ– |
| å¾®ä¿¡å…¬ä¼—å· | wechat | https://mp.weixin.qq.com/ | âœ… å·²ä¼˜åŒ– |
| Bç«™ | bilibili | https://member.bilibili.com/platform/home | âœ… å·²ä¼˜åŒ– |
| æŠ–éŸ³ | douyin | https://creator.douyin.com/ | â­ï¸ è·³è¿‡ |

### æŠ€æœ¯ç¤¾åŒºå¹³å°ï¼ˆ8ä¸ªï¼‰

| å¹³å° | ID | ç™»å½•URL | çŠ¶æ€ |
|------|-----|---------|------|
| çŸ¥ä¹ | zhihu | https://www.zhihu.com/signin | âœ… å·²ä¼˜åŒ– |
| ç®€ä¹¦ | jianshu | https://www.jianshu.com/sign_in | âœ… å·²ä¼˜åŒ– |
| CSDN | csdn | https://passport.csdn.net/login | âœ… å·²ä¼˜åŒ– |
| æ˜é‡‘ | juejin | https://juejin.cn/login | âœ… å·²ä¼˜åŒ– |
| SegmentFault | segmentfault | https://segmentfault.com/user/login | âœ… å·²ä¼˜åŒ– |
| å¼€æºä¸­å›½ | oschina | https://www.oschina.net/home/login | âœ… å·²ä¼˜åŒ– |
| åšå®¢å›­ | cnblogs | https://account.cnblogs.com/signin | âœ… å·²ä¼˜åŒ– |
| V2EX | v2ex | https://www.v2ex.com/signin | âœ… å·²ä¼˜åŒ– |

**æ€»è®¡ï¼š17ä¸ªå¹³å°ï¼ˆé™¤æŠ–éŸ³å¤–å…¨éƒ¨å®Œæˆï¼‰**

---

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: æµè§ˆå™¨æ²¡æœ‰æ‰“å¼€

**åŸå› **: Chromeè·¯å¾„æœªæ‰¾åˆ°

**è§£å†³**:
```bash
# æ£€æŸ¥Chromeæ˜¯å¦å®‰è£…
which google-chrome-stable
which chromium

# macOSå®‰è£…Chrome
brew install --cask google-chrome

# Linuxå®‰è£…Chrome
sudo apt install chromium-browser
```

### Q2: ç™»å½•æˆåŠŸä½†æœªä¿å­˜è´¦å·

**åŸå› **: ç”¨æˆ·åæå–å¤±è´¥

**è§£å†³**:
1. æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—
2. æ£€æŸ¥ `debug/` ç›®å½•ä¸­çš„HTMLå¿«ç…§
3. åœ¨HTMLä¸­æœç´¢ç”¨æˆ·å
4. æ‰¾åˆ°æ­£ç¡®çš„é€‰æ‹©å™¨
5. æ›´æ–° `AccountService.ts` ä¸­çš„é€‰æ‹©å™¨é…ç½®
6. é‡æ–°æµ‹è¯•

### Q3: Cookieæœªä¿å­˜

**åŸå› **: ç™»å½•æ£€æµ‹è¿‡æ—©

**è§£å†³**:
1. å¢åŠ ç­‰å¾…æ—¶é—´
2. è°ƒæ•´ç™»å½•æ£€æµ‹ç­–ç•¥
3. ç¡®ä¿å®Œå…¨ç™»å½•åå†å…³é—­æµè§ˆå™¨

### Q4: ç”¨æˆ·åæ˜¾ç¤ºä¸ºç©º

**åŸå› **: é€‰æ‹©å™¨ä¸åŒ¹é…

**è§£å†³**:
1. æ‰“å¼€HTMLå¿«ç…§
2. æœç´¢ç”¨æˆ·å
3. æ‰¾åˆ°æ­£ç¡®çš„é€‰æ‹©å™¨
4. æ›´æ–°é…ç½®

### Q5: ç™»å½•è¶…æ—¶

**åŸå› **: ç½‘ç»œæ…¢æˆ–é¡µé¢åŠ è½½æ…¢

**è§£å†³**:
```typescript
// å¢åŠ è¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤300ç§’ï¼‰
await page.waitForFunction(
  `window.location.href !== "${initialUrl}"`,
  { timeout: 600000 }  // æ”¹ä¸º600ç§’
);
```

---

## ğŸ¯ æœ€ä½³å®è·µ

### 1. ç™»å½•å‰å‡†å¤‡

- ç¡®ä¿ç½‘ç»œè¿æ¥ç¨³å®š
- å‡†å¤‡å¥½è´¦å·å¯†ç 
- å‡†å¤‡å¥½éªŒè¯ç ï¼ˆå¦‚æœéœ€è¦ï¼‰
- å…³é—­å…¶ä»–å ç”¨æµè§ˆå™¨çš„ç¨‹åº

### 2. ç™»å½•è¿‡ç¨‹ä¸­

- ä¸è¦æœ€å°åŒ–æµè§ˆå™¨çª—å£
- ç­‰å¾…é¡µé¢å®Œå…¨åŠ è½½
- ç¡®ä¿ç™»å½•æˆåŠŸåå†ç­‰å¾…ç³»ç»Ÿæ£€æµ‹
- ä¸è¦æ‰‹åŠ¨å…³é—­æµè§ˆå™¨

### 3. ç™»å½•åéªŒè¯

- æ£€æŸ¥å¹³å°å¡ç‰‡æ˜¯å¦æ˜¾ç¤º âœ“
- æ£€æŸ¥è´¦å·åˆ—è¡¨æ˜¯å¦æœ‰æ–°è´¦å·
- æ£€æŸ¥çœŸå®ç”¨æˆ·åæ˜¯å¦æ­£ç¡®
- ä½¿ç”¨"æµ‹è¯•ç™»å½•"åŠŸèƒ½éªŒè¯

### 4. å®šæœŸç»´æŠ¤

- Cookieä¼šè¿‡æœŸï¼Œéœ€è¦å®šæœŸé‡æ–°ç™»å½•
- å»ºè®®æ¯æœˆæ£€æŸ¥ä¸€æ¬¡è´¦å·çŠ¶æ€
- åŠæ—¶æ›´æ–°å¤±æ•ˆçš„è´¦å·

---

## ğŸ“ ç›¸å…³æ–‡ä»¶

```
server/src/services/
  â”œâ”€â”€ AccountService.ts              # æ ¸å¿ƒç™»å½•é€»è¾‘
  â”œâ”€â”€ BrowserAutomationService.ts    # æµè§ˆå™¨è‡ªåŠ¨åŒ–
  â””â”€â”€ EncryptionService.ts           # å‡­è¯åŠ å¯†

server/src/config/
  â””â”€â”€ browserConfig.ts               # æµè§ˆå™¨é…ç½®

windows-login-manager/src/pages/
  â””â”€â”€ PlatformManagementPage.tsx     # å‰ç«¯ç•Œé¢

debug/                               # HTMLå¿«ç…§ç›®å½•
test-platform-login.sh               # æµ‹è¯•è„šæœ¬
å¹³å°ç™»å½•å™¨ä½¿ç”¨æŒ‡å—.md                 # ä½¿ç”¨æŒ‡å—
```

---

## ğŸš€ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

```bash
# å¯åŠ¨ç³»ç»Ÿ
./å¯åŠ¨GEOç³»ç»Ÿ.command
./å¯åŠ¨Windowsç®¡ç†å™¨.command

# æµ‹è¯•ç™»å½•
./test-platform-login.sh toutiao
./test-platform-login.sh xiaohongshu

# æŸ¥çœ‹æ—¥å¿—
tail -f server/logs/app.log

# æŸ¥çœ‹HTMLå¿«ç…§
ls -la debug/
open debug/toutiao_*.html

# é‡å¯æœåŠ¡
./é‡å¯GEOç³»ç»Ÿ.command
```

---

## ğŸ’¡ æ€»ç»“

è¿™ä¸ªç³»ç»Ÿçš„æ ¸å¿ƒä¼˜åŠ¿ï¼š

1. âœ… **çœŸå®æµè§ˆå™¨ç™»å½•** - ä½¿ç”¨Playwrightæ§åˆ¶çœŸå®Chrome
2. âœ… **è‡ªåŠ¨Cookieæ•è·** - ç™»å½•æˆåŠŸåè‡ªåŠ¨è·å–æ‰€æœ‰Cookie
3. âœ… **æ™ºèƒ½ç”¨æˆ·åæå–** - å¤šé€‰æ‹©å™¨ç­–ç•¥ï¼Œæé«˜æˆåŠŸç‡
4. âœ… **åŠ å¯†å­˜å‚¨** - Cookieå’Œå‡­è¯åŠ å¯†åå­˜å‚¨
5. âœ… **å»é‡é€»è¾‘** - è‡ªåŠ¨æ£€æµ‹å’Œæ›´æ–°é‡å¤è´¦å·
6. âœ… **è°ƒè¯•åŠŸèƒ½** - HTMLå¿«ç…§å’Œè¯¦ç»†æ—¥å¿—
7. âœ… **æµ‹è¯•åŠŸèƒ½** - éªŒè¯Cookieæ˜¯å¦æœ‰æ•ˆ

ç°åœ¨ä½ å¯ä»¥å¼€å§‹æµ‹è¯•å„å¹³å°çš„ç™»å½•åŠŸèƒ½äº†ï¼ğŸ‰
