# 定时发布间隔修复说明

## 问题
Windows端批量定时发布没有按照设定的时间间隔发布，任务提前执行了。

## 原因
TaskScheduler每10秒检查一次待执行任务，原来的SQL查询会找到批次中"当前最小batch_order的pending任务"，导致在等待间隔期间，调度器发现下一个任务是pending状态，就提前触发了执行。

## 修复
修改 `server/src/services/BatchExecutor.ts` 中的 `checkAndExecuteBatches()` 方法：
- 只查找 `batch_order = 0` 的任务（批次的第一个任务）
- 添加 `executingBatches` 检查，跳过正在执行的批次

## 效果
- ✅ 第一个任务立即执行
- ✅ 后续任务在前一个任务**完成后**等待指定间隔
- ✅ 间隔时间准确
- ✅ 不会提前执行

## 测试
```bash
# 查看测试指南
./test-batch-interval-fix.sh

# 实时监控日志
tail -f server.log | grep -E '批次|等待|间隔'
```

## 状态
✅ 已修复并重启服务器，可以立即测试
