# âœ… æŠ–éŸ³è‡ªåŠ¨å‘å¸ƒé€‚é…å™¨å®Œæˆ

## ğŸ“‹ å®Œæˆå†…å®¹

### 1. åˆ›å»ºæŠ–éŸ³é€‚é…å™¨

**æ–‡ä»¶ï¼š** `server/src/services/adapters/DouyinAdapter.ts`

**åŠŸèƒ½ç‰¹ç‚¹ï¼š**
- âœ… åŸºäº Playwright è‡ªåŠ¨åŒ–
- âœ… å®Œæ•´çš„ 14 æ­¥å‘å¸ƒæµç¨‹
- âœ… æ¨¡æ‹Ÿäººç±»æ“ä½œï¼ˆé€‚å½“åœé¡¿ï¼‰
- âœ… è‡ªåŠ¨ä¸Šä¼ å›¾ç‰‡ï¼ˆæ”¯æŒå¤šå›¾ï¼Œæœ€å¤š9å¼ ï¼‰
- âœ… è‡ªåŠ¨å¡«å†™æ ‡é¢˜å’Œæ­£æ–‡ï¼ˆæ­£æ–‡é™åˆ¶900å­—ï¼‰
- âœ… è‡ªåŠ¨æ·»åŠ è¯é¢˜æ ‡ç­¾
- âœ… è‡ªåŠ¨æ·»åŠ  AI ç”Ÿæˆå£°æ˜
- âœ… æ™ºèƒ½é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- âœ… å‘å¸ƒç»“æœéªŒè¯

### 2. æ³¨å†Œé€‚é…å™¨

**æ–‡ä»¶ï¼š** `server/src/services/adapters/AdapterRegistry.ts`

å·²å°†æŠ–éŸ³é€‚é…å™¨æ³¨å†Œåˆ°ç³»ç»Ÿä¸­ï¼Œç°åœ¨æ”¯æŒï¼š
- å°çº¢ä¹¦ (xiaohongshu)
- æŠ–éŸ³ (douyin)

### 3. ç¼–è¯‘æˆåŠŸ

TypeScript ä»£ç å·²æˆåŠŸç¼–è¯‘ä¸º JavaScriptã€‚

---

## ğŸ¯ å‘å¸ƒæµç¨‹è¯¦è§£

### å®Œæ•´çš„ 14 æ­¥æµç¨‹

```typescript
// ç¬¬ä¸€æ­¥ï¼šå¯¼èˆªåˆ°å‘å¸ƒé¡µé¢
await page.goto('https://creator.douyin.com/creator-micro/content/upload');
await page.waitForTimeout(3000);

// ç¬¬äºŒæ­¥ï¼šç‚¹å‡»"é«˜æ¸…å‘å¸ƒ"
await page.getByRole('button', { name: 'é«˜æ¸…å‘å¸ƒ' }).click();
await page.waitForTimeout(1500);

// ç¬¬ä¸‰æ­¥ï¼šç‚¹å‡»"å‘å¸ƒå›¾æ–‡"èœå•é¡¹
await page.getByRole('menuitem', { name: 'å‘å¸ƒå›¾æ–‡' }).click();
await page.waitForTimeout(2000);

// ç¬¬å››æ­¥ï¼šç‚¹å‡»"ä¸Šä¼ å›¾æ–‡"æŒ‰é’®
await page.getByRole('button', { name: 'ä¸Šä¼ å›¾æ–‡' }).click();
await page.waitForTimeout(2500);

// ç¬¬äº”æ­¥ï¼šä¸Šä¼ å›¾ç‰‡ï¼ˆä¸è§¦å‘å¯¹è¯æ¡†ï¼Œç›´æ¥è®¾ç½®æ–‡ä»¶ï¼‰
const fileInput = page.locator('input[type="file"]').first();
await fileInput.setInputFiles(imagePaths); // æ”¯æŒå¤šå›¾
await page.waitForTimeout(3000);

// ç¬¬å…­æ­¥ï¼šå¡«å†™æ ‡é¢˜
await page.getByRole('textbox', { name: 'æ·»åŠ ä½œå“æ ‡é¢˜' }).click();
await page.waitForTimeout(800);
await page.getByRole('textbox', { name: 'æ·»åŠ ä½œå“æ ‡é¢˜' }).fill(article.title);
await page.waitForTimeout(1000);

// ç¬¬ä¸ƒæ­¥ï¼šå¡«å†™æ­£æ–‡ï¼ˆé™åˆ¶900å­—ï¼‰
await page.locator('.ace-line > div').click();
await page.waitForTimeout(800);
const content = cleanContent.substring(0, 897) + '...'; // é™åˆ¶900å­—
await page.locator('.zone-container').fill(content);
await page.waitForTimeout(1500);

// ç¬¬å…«æ­¥ï¼šç‚¹å‡»#å·è¯é¢˜
await page.getByText('#æ·»åŠ è¯é¢˜').click();
await page.waitForTimeout(1000);

// ç¬¬ä¹æ­¥ï¼šå¡«å†™è¯é¢˜å…³é”®è¯
await page.keyboard.type(keywords, { delay: 100 }); // æ¨¡æ‹Ÿäººç±»è¾“å…¥
await page.waitForTimeout(1500);

// ç¬¬åæ­¥ï¼šé€‰æ‹©è¯é¢˜
await page.locator(`text=#${keywords}`).first().click();
await page.waitForTimeout(1000);

// ç¬¬åä¸€æ­¥ï¼šç‚¹å‡»"æ·»åŠ å£°æ˜"
await page.getByText('æ·»åŠ å£°æ˜').click();
await page.waitForTimeout(1000);

// ç¬¬åäºŒæ­¥ï¼šé€‰æ‹©"å†…å®¹ç”±AIç”Ÿæˆ"
await page.locator('label').filter({ hasText: 'å†…å®¹ç”±AIç”Ÿæˆ' }).click();
await page.waitForTimeout(800);

// ç¬¬åä¸‰æ­¥ï¼šç‚¹å‡»ç¡®å®šæŒ‰é’®
await page.getByRole('button', { name: 'ç¡®å®š' }).click();
await page.waitForTimeout(1500);

// ç¬¬åå››æ­¥ï¼šç‚¹å‡»å‘å¸ƒæŒ‰é’®
await page.getByRole('button', { name: 'å‘å¸ƒ', exact: true }).click();
await page.waitForTimeout(1000);
```

---

## ğŸ¨ ç‰¹è‰²åŠŸèƒ½

### 1. æ™ºèƒ½å›¾ç‰‡ä¸Šä¼ 

```typescript
// è‡ªåŠ¨ä»æ–‡ç« å†…å®¹ä¸­æå–å›¾ç‰‡
const images = this.extractImagesFromContent(article.content);

// æ”¯æŒå¤šç§å›¾ç‰‡æ ¼å¼
// - Markdown: ![alt](path)
// - HTML: <img src="path">

// æ”¯æŒå¤šå›¾ä¸Šä¼ ï¼ˆæœ€å¤š9å¼ ï¼‰
const imagesToUpload = images.slice(0, 9);

// ç›´æ¥è®¾ç½®æ–‡ä»¶ï¼Œä¸è§¦å‘å¯¹è¯æ¡†
await fileInput.setInputFiles(imagePaths);
```

### 2. æ™ºèƒ½å†…å®¹å¤„ç†

```typescript
// æ¸…ç† HTML æ ‡ç­¾
const cleanContent = this.cleanArticleContent(article.content);

// é™åˆ¶æ­£æ–‡é•¿åº¦ä¸º 900 å­—
let finalContent = cleanContent.length > 900 
  ? cleanContent.substring(0, 897) + '...' 
  : cleanContent;
```

### 3. æ™ºèƒ½å…³é”®è¯æå–

```typescript
// ä¼˜å…ˆä½¿ç”¨æ–‡ç« çš„ keyword å­—æ®µ
if (article.keyword) {
  return article.keyword.trim();
}

// ä»æ ‡é¢˜ä¸­æå–è£…ä¿®ç›¸å…³å…³é”®è¯
const decorationKeywords = [
  'è£…ä¿®', 'è£…é¥°', 'è®¾è®¡', 'å®¶å±…', 
  'å®¤å†…', 'è½¯è£…', 'ç¡¬è£…', 'é£æ ¼', 'è£…ä¿®å…¬å¸'
];

// é»˜è®¤ä½¿ç”¨"è£…ä¿®å…¬å¸"
return 'è£…ä¿®å…¬å¸';
```

### 4. æ¨¡æ‹Ÿäººç±»æ“ä½œ

```typescript
// æ¯ä¸ªæ­¥éª¤ä¹‹é—´éƒ½æœ‰é€‚å½“çš„åœé¡¿
await page.waitForTimeout(800);   // çŸ­æš‚æ€è€ƒ
await page.waitForTimeout(1000);  // æ­£å¸¸åœé¡¿
await page.waitForTimeout(1500);  // è¾ƒé•¿åœé¡¿
await page.waitForTimeout(3000);  // ç­‰å¾…åŠ è½½

// æ¨¡æ‹Ÿäººç±»è¾“å…¥é€Ÿåº¦
await page.keyboard.type(keywords, { delay: 100 });
```

### 5. å®Œå–„çš„é”™è¯¯å¤„ç†

```typescript
try {
  // å‘å¸ƒæµç¨‹
} catch (error) {
  // è®°å½•é”™è¯¯æ—¥å¿—
  await this.log('error', 'å‘å¸ƒå¤±è´¥', { error: error.message });
  
  // ä¿å­˜é”™è¯¯æˆªå›¾
  const screenshotPath = `error-douyin-${Date.now()}.png`;
  await page.screenshot({ path: screenshotPath, fullPage: true });
  
  return false;
}
```

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³• 1ï¼šé€šè¿‡ API å‘å¸ƒ

```bash
# 1. åˆ›å»ºæ–‡ç« 
curl -X POST http://localhost:3000/api/articles \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{
    "title": "æµ‹è¯•æ–‡ç« ",
    "content": "æ–‡ç« å†…å®¹\n\n![å›¾ç‰‡](/uploads/test.jpg)",
    "keyword": "è£…ä¿®å…¬å¸"
  }'

# 2. åˆ›å»ºå‘å¸ƒä»»åŠ¡
curl -X POST http://localhost:3000/api/publishing-tasks \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{
    "articleId": 1,
    "accountId": 1,
    "scheduledAt": "2025-12-31T10:00:00.000Z"
  }'
```

### æ–¹æ³• 2ï¼šä½¿ç”¨æµ‹è¯•è„šæœ¬

```bash
# è¿è¡Œæµ‹è¯•è„šæœ¬
./test-douyin-publish.sh
```

æµ‹è¯•è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
1. âœ… æ£€æŸ¥æœåŠ¡çŠ¶æ€
2. âœ… ç™»å½•ç³»ç»Ÿ
3. âœ… åˆ›å»ºæµ‹è¯•æ–‡ç« 
4. âœ… æ£€æŸ¥æŠ–éŸ³è´¦å·
5. âœ… åˆ›å»ºå‘å¸ƒä»»åŠ¡
6. âœ… ç­‰å¾…å‘å¸ƒå®Œæˆ
7. âœ… æ˜¾ç¤ºå‘å¸ƒç»“æœ

### æ–¹æ³• 3ï¼šé€šè¿‡å‰ç«¯ç•Œé¢

1. è®¿é—® http://localhost:3000
2. ç™»å½•ç³»ç»Ÿ
3. è¿›å…¥ã€Œæ–‡ç« ç®¡ç†ã€
4. åˆ›å»ºæ–°æ–‡ç« ï¼ˆè®°å¾—æ·»åŠ å›¾ç‰‡ï¼‰
5. ç‚¹å‡»ã€Œå‘å¸ƒã€
6. é€‰æ‹©æŠ–éŸ³è´¦å·
7. ç‚¹å‡»ã€Œç«‹å³å‘å¸ƒã€

---

## ğŸ“ æ³¨æ„äº‹é¡¹

### 1. å›¾ç‰‡è¦æ±‚

- âœ… **å¿…é¡»ä¸Šä¼ å›¾ç‰‡**ï¼šæŠ–éŸ³å›¾æ–‡å¿…é¡»åŒ…å«å›¾ç‰‡
- âœ… **æ”¯æŒå¤šå›¾**ï¼šæœ€å¤šä¸Šä¼  9 å¼ å›¾ç‰‡
- âœ… **å›¾ç‰‡æ ¼å¼**ï¼šæ”¯æŒ JPGã€PNGã€GIF
- âœ… **å›¾ç‰‡è·¯å¾„**ï¼šæ”¯æŒç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„

**ç¤ºä¾‹ï¼š**
```markdown
![å›¾ç‰‡1](/uploads/image1.jpg)
![å›¾ç‰‡2](/uploads/image2.jpg)
![å›¾ç‰‡3](/uploads/image3.jpg)
```

### 2. å†…å®¹è¦æ±‚

- âœ… **æ ‡é¢˜**ï¼šå¿…å¡«ï¼Œå»ºè®® 10-30 å­—
- âœ… **æ­£æ–‡**ï¼šå¿…å¡«ï¼Œè‡ªåŠ¨é™åˆ¶ 900 å­—
- âœ… **å…³é”®è¯**ï¼šå¯é€‰ï¼Œç”¨äºè¯é¢˜æ ‡ç­¾
- âœ… **AI å£°æ˜**ï¼šè‡ªåŠ¨æ·»åŠ "å†…å®¹ç”±AIç”Ÿæˆ"

### 3. è´¦å·è¦æ±‚

- âœ… **ç™»å½•çŠ¶æ€**ï¼šéœ€è¦å…ˆç™»å½•æŠ–éŸ³è´¦å·
- âœ… **Cookie æœ‰æ•ˆ**ï¼šç¡®ä¿ Cookie æœªè¿‡æœŸ
- âœ… **è´¦å·æƒé™**ï¼šç¡®ä¿è´¦å·æœ‰å‘å¸ƒæƒé™

### 4. å‘å¸ƒæ—¶é—´

- âœ… **ç«‹å³å‘å¸ƒ**ï¼šè®¾ç½® scheduledAt ä¸ºå½“å‰æ—¶é—´
- âœ… **å®šæ—¶å‘å¸ƒ**ï¼šè®¾ç½® scheduledAt ä¸ºæœªæ¥æ—¶é—´
- âœ… **æ‰¹é‡å‘å¸ƒ**ï¼šåˆ›å»ºå¤šä¸ªå‘å¸ƒä»»åŠ¡

---

## ğŸ”§ é…ç½®è¯´æ˜

### å¹³å° ID

```typescript
platformId = 'douyin'
platformName = 'æŠ–éŸ³'
```

### ç™»å½• URL

```typescript
getLoginUrl(): string {
  return 'https://creator.douyin.com/passport/web/login';
}
```

### å‘å¸ƒ URL

```typescript
getPublishUrl(): string {
  return 'https://creator.douyin.com/creator-micro/content/upload';
}
```

### é€‰æ‹©å™¨é…ç½®

```typescript
getLoginSelectors(): LoginSelectors {
  return {
    usernameInput: 'input[placeholder="è¯·è¾“å…¥æ‰‹æœºå·"]',
    passwordInput: 'input[placeholder="è¯·è¾“å…¥å¯†ç "]',
    submitButton: 'button:has-text("ç™»å½•")',
    successIndicator: 'text=å‘å¸ƒ'
  };
}

getPublishSelectors(): PublishSelectors {
  return {
    titleInput: 'input[placeholder*="æ·»åŠ ä½œå“æ ‡é¢˜"]',
    contentEditor: '.ace-line',
    publishButton: 'button:has-text("å‘å¸ƒ")',
    successIndicator: 'text=å‘å¸ƒæˆåŠŸ'
  };
}
```

---

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜ 1ï¼šå›¾ç‰‡ä¸Šä¼ å¤±è´¥

**åŸå› ï¼š** å›¾ç‰‡æ–‡ä»¶ä¸å­˜åœ¨æˆ–è·¯å¾„é”™è¯¯

**è§£å†³æ–¹æ³•ï¼š**
```bash
# æ£€æŸ¥å›¾ç‰‡æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la uploads/

# ç¡®ä¿å›¾ç‰‡è·¯å¾„æ­£ç¡®
# æ­£ç¡®ï¼š/uploads/test.jpg
# é”™è¯¯ï¼šuploads/test.jpgï¼ˆç¼ºå°‘å¼€å¤´çš„ /ï¼‰
```

### é—®é¢˜ 2ï¼šå‘å¸ƒå¤±è´¥

**åŸå› ï¼š** Cookie è¿‡æœŸæˆ–è´¦å·æœªç™»å½•

**è§£å†³æ–¹æ³•ï¼š**
```bash
# é‡æ–°ç™»å½•æŠ–éŸ³è´¦å·
# 1. è®¿é—®å‰ç«¯ç•Œé¢
# 2. è¿›å…¥ã€Œå¹³å°è´¦å·ç®¡ç†ã€
# 3. ç‚¹å‡»ã€Œæµ‹è¯•ç™»å½•ã€
# 4. é‡æ–°æ‰«ç ç™»å½•
```

### é—®é¢˜ 3ï¼šè¯é¢˜é€‰æ‹©å¤±è´¥

**åŸå› ï¼š** å…³é”®è¯ä¸åŒ¹é…æˆ–è¯é¢˜ä¸å­˜åœ¨

**è§£å†³æ–¹æ³•ï¼š**
```typescript
// åœ¨æ–‡ç« ä¸­æŒ‡å®šå…³é”®è¯
{
  "title": "è£…ä¿®è®¾è®¡æŠ€å·§",
  "content": "...",
  "keyword": "è£…ä¿®å…¬å¸"  // æŒ‡å®šå…³é”®è¯
}
```

### é—®é¢˜ 4ï¼šå†…å®¹è¢«æˆªæ–­

**åŸå› ï¼š** æ­£æ–‡è¶…è¿‡ 900 å­—é™åˆ¶

**è§£å†³æ–¹æ³•ï¼š**
```typescript
// é€‚é…å™¨ä¼šè‡ªåŠ¨æˆªæ–­åˆ° 900 å­—
// å¦‚æœéœ€è¦å‘å¸ƒå®Œæ•´å†…å®¹ï¼Œè¯·åˆ†æˆå¤šç¯‡æ–‡ç« 
```

---

## ğŸ“Š å¯¹æ¯”ï¼šå°çº¢ä¹¦ vs æŠ–éŸ³

| ç‰¹æ€§ | å°çº¢ä¹¦ | æŠ–éŸ³ |
|------|--------|------|
| å¹³å° ID | xiaohongshu | douyin |
| å‘å¸ƒæ­¥éª¤ | 10 æ­¥ | 14 æ­¥ |
| å›¾ç‰‡è¦æ±‚ | å¿…é¡»ï¼ˆ1å¼ ï¼‰ | å¿…é¡»ï¼ˆ1-9å¼ ï¼‰ |
| æ­£æ–‡é™åˆ¶ | 1000 å­— | 900 å­— |
| è¯é¢˜æ ‡ç­¾ | æ”¯æŒ | æ”¯æŒ |
| AI å£°æ˜ | ä¸éœ€è¦ | éœ€è¦ |
| å‘å¸ƒæŒ‰é’® | 1 æ¬¡ç‚¹å‡» | 2 æ¬¡ç‚¹å‡»ï¼ˆç¡®å®š+å‘å¸ƒï¼‰ |

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å°çº¢ä¹¦é€‚é…å™¨](./server/src/services/adapters/XiaohongshuAdapter.ts)
- [é€‚é…å™¨æ³¨å†Œè¡¨](./server/src/services/adapters/AdapterRegistry.ts)
- [é€‚é…å™¨æ¨¡æ¿](./server/src/services/adapters/AdapterTemplate.ts)
- [Playwright è¿ç§»æ–‡æ¡£](./PLAYWRIGHT_MIGRATION_COMPLETED.md)
- [å¦‚ä½•å½•åˆ¶ Playwright è„šæœ¬](./å¦‚ä½•å½•åˆ¶Playwrightè„šæœ¬.md)
- [æ‰€æœ‰å¹³å°å½•åˆ¶å‘½ä»¤](./æ‰€æœ‰å¹³å°å½•åˆ¶å‘½ä»¤.md)

---

## âœ… æµ‹è¯•æ¸…å•

- [x] åˆ›å»ºæŠ–éŸ³é€‚é…å™¨
- [x] æ³¨å†Œåˆ°é€‚é…å™¨æ³¨å†Œè¡¨
- [x] TypeScript ç¼–è¯‘æˆåŠŸ
- [x] åˆ›å»ºæµ‹è¯•è„šæœ¬
- [x] åˆ›å»ºæ–‡æ¡£

### å¾…æµ‹è¯•é¡¹ç›®

- [ ] ç™»å½•æŠ–éŸ³è´¦å·
- [ ] ä¸Šä¼ å•å¼ å›¾ç‰‡
- [ ] ä¸Šä¼ å¤šå¼ å›¾ç‰‡
- [ ] å‘å¸ƒçŸ­æ–‡ç« ï¼ˆ< 900 å­—ï¼‰
- [ ] å‘å¸ƒé•¿æ–‡ç« ï¼ˆ> 900 å­—ï¼Œè‡ªåŠ¨æˆªæ–­ï¼‰
- [ ] æ·»åŠ è¯é¢˜æ ‡ç­¾
- [ ] éªŒè¯ AI å£°æ˜
- [ ] éªŒè¯å‘å¸ƒæˆåŠŸ

---

## ğŸ‰ ä¸‹ä¸€æ­¥

### 1. æµ‹è¯•æŠ–éŸ³å‘å¸ƒ

```bash
# è¿è¡Œæµ‹è¯•è„šæœ¬
./test-douyin-publish.sh
```

### 2. æ·»åŠ æŠ–éŸ³è´¦å·

1. è®¿é—® http://localhost:3000
2. ç™»å½•ç³»ç»Ÿ
3. è¿›å…¥ã€Œå¹³å°è´¦å·ç®¡ç†ã€
4. ç‚¹å‡»ã€Œæ·»åŠ è´¦å·ã€
5. é€‰æ‹©ã€ŒæŠ–éŸ³ã€
6. æ‰«ç ç™»å½•

### 3. åˆ›å»ºå…¶ä»–å¹³å°é€‚é…å™¨

å‚è€ƒæŠ–éŸ³é€‚é…å™¨ï¼Œå¯ä»¥å¿«é€Ÿåˆ›å»ºï¼š
- å¤´æ¡å·é€‚é…å™¨
- å¾®ä¿¡å…¬ä¼—å·é€‚é…å™¨
- çŸ¥ä¹é€‚é…å™¨
- ç®€ä¹¦é€‚é…å™¨
- ç™¾å®¶å·é€‚é…å™¨
- ä¼é¹…å·é€‚é…å™¨
- æœç‹å·é€‚é…å™¨
- ç½‘æ˜“å·é€‚é…å™¨
- å“”å“©å“”å“©é€‚é…å™¨
- CSDNé€‚é…å™¨

---

## ğŸŠ æ€»ç»“

æŠ–éŸ³è‡ªåŠ¨å‘å¸ƒé€‚é…å™¨å·²å®Œæˆï¼

**æ ¸å¿ƒç‰¹ç‚¹ï¼š**
- âœ… å®Œæ•´çš„ 14 æ­¥å‘å¸ƒæµç¨‹
- âœ… æ™ºèƒ½å›¾ç‰‡ä¸Šä¼ ï¼ˆæ”¯æŒå¤šå›¾ï¼‰
- âœ… è‡ªåŠ¨å†…å®¹å¤„ç†ï¼ˆé™åˆ¶900å­—ï¼‰
- âœ… æ™ºèƒ½å…³é”®è¯æå–
- âœ… æ¨¡æ‹Ÿäººç±»æ“ä½œ
- âœ… å®Œå–„çš„é”™è¯¯å¤„ç†
- âœ… å‘å¸ƒç»“æœéªŒè¯

**ç«‹å³å¼€å§‹æµ‹è¯•ï¼** ğŸš€
