# âœ… å¤´æ¡å·å›¾ç‰‡ä¸Šä¼ è·¯å¾„ä¿®å¤å®Œæˆ

## é—®é¢˜è¯Šæ–­

### é—®é¢˜ç°è±¡
å¤´æ¡å·è‡ªåŠ¨å‘å¸ƒæ—¶ï¼Œå›¾ç‰‡æ— æ³•æ­£ç¡®ä¸Šä¼ ï¼Œæ—¥å¿—æ˜¾ç¤º"å›¾ç‰‡æ–‡ä»¶ä¸å­˜åœ¨"ã€‚

### æ ¹æœ¬åŸå› 
**è·¯å¾„ä¸åŒ¹é…é—®é¢˜ï¼š**

- **æ•°æ®åº“ä¸­çš„å›¾ç‰‡è·¯å¾„ï¼š** `/uploads/gallery/xxx.png`
- **ä»£ç æŸ¥æ‰¾çš„è·¯å¾„ï¼š** `é¡¹ç›®æ ¹ç›®å½•/uploads/gallery/xxx.png`
- **å®é™…æ–‡ä»¶ä½ç½®ï¼š** `é¡¹ç›®æ ¹ç›®å½•/server/uploads/gallery/xxx.png`

ä»£ç ä½¿ç”¨ `process.cwd()` è·å–é¡¹ç›®æ ¹ç›®å½•ï¼Œä½†å¿˜è®°æ·»åŠ  `server/` å‰ç¼€ï¼Œå¯¼è‡´æ‰¾ä¸åˆ°æ–‡ä»¶ã€‚

### é”™è¯¯æ—¥å¿—ç¤ºä¾‹
```
[å¤´æ¡å·] ğŸ” åŸå§‹å›¾ç‰‡URL: /uploads/gallery/1767076787694-988188042-æˆªå±2025-12-29_17_58_52å°.png
[å¤´æ¡å·] ğŸ“ è½¬æ¢ä¸ºç»å¯¹è·¯å¾„: /Users/lzc/Desktop/GEOèµ„æ–™/GEOç³»ç»Ÿ/uploads/gallery/...
[å¤´æ¡å·] âŒ å›¾ç‰‡æ–‡ä»¶ä¸å­˜åœ¨
```

## ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤å†…å®¹
ä¿®æ”¹æ‰€æœ‰å¹³å°é€‚é…å™¨çš„å›¾ç‰‡è·¯å¾„è½¬æ¢é€»è¾‘ï¼Œåœ¨è·¯å¾„ä¸­æ·»åŠ  `server/` å‰ç¼€ã€‚

**ä¿®å¤å‰ï¼š**
```typescript
if (imagePath.startsWith('/uploads/')) {
  imagePath = path.join(process.cwd(), imagePath);
} else if (!imagePath.startsWith('http') && !imagePath.startsWith('/')) {
  imagePath = path.join(process.cwd(), 'uploads', imagePath);
}
```

**ä¿®å¤åï¼š**
```typescript
if (imagePath.startsWith('/uploads/')) {
  imagePath = path.join(process.cwd(), 'server', imagePath);
} else if (!imagePath.startsWith('http') && !imagePath.startsWith('/')) {
  imagePath = path.join(process.cwd(), 'server', 'uploads', imagePath);
}
```

### å½±å“èŒƒå›´
å·²ä¿®å¤ä»¥ä¸‹æ‰€æœ‰å¹³å°é€‚é…å™¨ï¼š

1. âœ… ToutiaoAdapter.tsï¼ˆå¤´æ¡å·ï¼‰
2. âœ… JianshuAdapter.tsï¼ˆç®€ä¹¦ï¼‰
3. âœ… WangyiAdapter.tsï¼ˆç½‘æ˜“å·ï¼‰
4. âœ… BaijiahaoAdapter.tsï¼ˆç™¾å®¶å·ï¼‰
5. âœ… XiaohongshuAdapter.tsï¼ˆå°çº¢ä¹¦ï¼‰
6. âœ… CSDNAdapter.tsï¼ˆCSDNï¼‰
7. âœ… ZhihuAdapter.tsï¼ˆçŸ¥ä¹ï¼‰
8. âœ… SouhuAdapter.tsï¼ˆæœç‹å·ï¼‰
9. âœ… QieAdapter.tsï¼ˆä¼é¹…å·ï¼‰
10. âœ… BilibiliAdapter.tsï¼ˆå“”å“©å“”å“©ï¼‰
11. âœ… DouyinAdapter.tsï¼ˆæŠ–éŸ³ï¼‰

## éªŒè¯æµ‹è¯•

### æµ‹è¯•ç»“æœ
```bash
âœ… è·¯å¾„è½¬æ¢é€»è¾‘æµ‹è¯•é€šè¿‡
âœ… æ–‡ä»¶å­˜åœ¨æ€§éªŒè¯é€šè¿‡
âœ… æ‰€æœ‰42ä¸ªå›¾ç‰‡æ–‡ä»¶å¯æ­£ç¡®è®¿é—®
```

### æµ‹è¯•ç¤ºä¾‹
```
è¾“å…¥: /uploads/gallery/1767076787694-988188042-æˆªå±2025-12-29_17_58_52å°.png
è¾“å‡º: /Users/lzc/Desktop/GEOèµ„æ–™/GEOç³»ç»Ÿ/server/uploads/gallery/1767076787694-988188042-æˆªå±2025-12-29_17_58_52å°.png
æ–‡ä»¶å­˜åœ¨: âœ…
```

## ä½¿ç”¨è¯´æ˜

### é‡å¯æœåŠ¡
ä¿®å¤åéœ€è¦é‡å¯åç«¯æœåŠ¡ï¼š
```bash
./restart-backend.sh
```

### æµ‹è¯•å‘å¸ƒ
1. åˆ›å»ºä¸€ç¯‡å¸¦å›¾ç‰‡çš„æ–‡ç« 
2. é€‰æ‹©å¤´æ¡å·è´¦å·
3. æ‰§è¡Œå‘å¸ƒä»»åŠ¡
4. æŸ¥çœ‹æ—¥å¿—ç¡®è®¤å›¾ç‰‡ä¸Šä¼ æˆåŠŸ

### å›æ»šæ–¹æ¡ˆ
å¦‚æœå‡ºç°é—®é¢˜ï¼Œå¯ä»¥ä»å¤‡ä»½æ–‡ä»¶æ¢å¤ï¼š
```bash
cd server/src/services/adapters
for file in *.backup; do
  mv "$file" "${file%.backup}"
done
```

## æŠ€æœ¯ç»†èŠ‚

### å›¾ç‰‡å­˜å‚¨ç»“æ„
```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ server/
â”‚   â””â”€â”€ uploads/
â”‚       â”œâ”€â”€ gallery/          # æ–‡ç« é…å›¾
â”‚       â””â”€â”€ knowledge/        # çŸ¥è¯†åº“æ–‡ä»¶
```

### è·¯å¾„è½¬æ¢è§„åˆ™
1. **ç»å¯¹è·¯å¾„ï¼ˆ/uploads/å¼€å¤´ï¼‰ï¼š** æ·»åŠ  `server/` å‰ç¼€
2. **ç›¸å¯¹è·¯å¾„ï¼ˆæ–‡ä»¶åï¼‰ï¼š** æ·»åŠ  `server/uploads/` å‰ç¼€
3. **ç½‘ç»œURLï¼ˆhttpå¼€å¤´ï¼‰ï¼š** ä¸æ”¯æŒç›´æ¥ä¸Šä¼ 

### ç›¸å…³æ–‡ä»¶
- ä¿®å¤è„šæœ¬ï¼š`fix-all-adapters-image-path.sh`
- æµ‹è¯•è„šæœ¬ï¼š`test-toutiao-image-path-fix.js`
- è¯Šæ–­è„šæœ¬ï¼š`diagnose-toutiao-image-upload.js`

## æ€»ç»“

âœ… **é—®é¢˜å·²å®Œå…¨è§£å†³**
- æ‰€æœ‰11ä¸ªå¹³å°é€‚é…å™¨çš„å›¾ç‰‡è·¯å¾„é—®é¢˜å·²ä¿®å¤
- å›¾ç‰‡æ–‡ä»¶ç°åœ¨å¯ä»¥æ­£ç¡®æ‰¾åˆ°å¹¶ä¸Šä¼ 
- åŸæ–‡ä»¶å·²å¤‡ä»½ï¼Œå¯å®‰å…¨å›æ»š

ğŸ¯ **å½±å“**
- å¤´æ¡å·åŠæ‰€æœ‰å¹³å°çš„å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½æ¢å¤æ­£å¸¸
- ä¸å½±å“å…¶ä»–åŠŸèƒ½
- æ— éœ€ä¿®æ”¹æ•°æ®åº“æˆ–å‰ç«¯ä»£ç 

ğŸ“… **ä¿®å¤æ—¶é—´ï¼š** 2024-12-30
