# 蒸馏功能快速测试指南

**测试日期**: 2026-01-17  
**修复版本**: 已完成所有修复

---

## 测试前准备

1. **确保已编译**：
   ```bash
   cd windows-login-manager
   npm run build:electron
   ```

2. **启动应用**：
   ```bash
   npm run dev
   ```

3. **确保已登录**：使用测试账号登录系统

---

## 测试场景 1：执行新蒸馏

### 步骤

1. 进入"关键词蒸馏"页面
2. 输入测试关键词（例如："AI 编程助手"）
3. 点击"开始蒸馏"按钮
4. 等待 AI 生成完成（约 10-30 秒）

### 预期结果

- ✅ 显示成功消息："成功生成 X 个话题！"
- ✅ 自动跳转到"蒸馏结果"页面
- ✅ 能看到话题列表（包含关键词、问题、引用次数等）
- ✅ 统计数据正确显示（总话题数、关键词数量等）
- ✅ 关键词筛选下拉框中包含新关键词

### 如果失败

**症状**: 蒸馏后跳转到结果页面，但看不到数据

**检查**:
1. 打开开发者工具（F12）查看控制台错误
2. 检查是否有 IPC 调用失败的错误
3. 检查数据库中是否有数据：
   ```bash
   psql -d geo_windows -c "SELECT * FROM distillations ORDER BY created_at DESC LIMIT 1;"
   psql -d geo_windows -c "SELECT * FROM topics ORDER BY created_at DESC LIMIT 5;"
   ```

---

## 测试场景 2：查看历史记录

### 步骤

1. 返回"关键词蒸馏"页面
2. 在"蒸馏历史"表格中找到刚才的记录
3. 点击"查看详情"按钮

### 预期结果

- ✅ 跳转到"蒸馏结果"页面
- ✅ 能看到该关键词的所有话题
- ✅ 关键词筛选自动选中该关键词
- ✅ 数据显示正确

### 如果失败

**症状**: 点击"查看详情"后页面空白或无数据

**检查**:
1. 打开开发者工具查看错误
2. 检查是否有 `topic:local:getByDistillation` 调用失败
3. 验证 IPC 通道名称是否正确：
   ```bash
   grep "topic:local:getByDistillation" windows-login-manager/src/pages/DistillationPage.tsx
   ```

---

## 测试场景 3：筛选和搜索

### 步骤

1. 在"蒸馏结果"页面
2. 使用关键词筛选下拉框选择一个关键词
3. 验证筛选结果
4. 清除筛选
5. 在搜索框输入关键词（例如："如何"）
6. 验证搜索结果

### 预期结果

- ✅ 关键词筛选：只显示该关键词的话题
- ✅ 搜索功能：只显示包含搜索词的话题
- ✅ 清除筛选：恢复显示所有话题
- ✅ 统计数据随筛选/搜索动态更新

---

## 测试场景 4：删除操作

### 步骤

1. **批量删除**：
   - 勾选 2-3 个话题
   - 点击"删除选中"按钮
   - 确认删除

2. **按关键词删除**：
   - 选择一个关键词筛选
   - 点击"删除当前关键词"按钮
   - 确认删除

### 预期结果

- ✅ 批量删除：选中的话题被删除，列表更新
- ✅ 按关键词删除：该关键词的所有话题被删除
- ✅ 统计数据更新
- ✅ 如果删除了所有话题，显示空状态提示

---

## 测试场景 5：编辑关键词

### 步骤

1. 返回"关键词蒸馏"页面
2. 在历史记录中点击"编辑"按钮
3. 修改关键词名称
4. 保存

### 预期结果

- ✅ 关键词更新成功
- ✅ 历史列表中显示新关键词
- ✅ 查看详情时显示新关键词

---

## 测试场景 6：数据持久化

### 步骤

1. 执行一次蒸馏
2. 关闭应用
3. 重新启动应用
4. 进入"蒸馏结果"页面

### 预期结果

- ✅ 之前的蒸馏数据仍然存在
- ✅ 能正常查看和操作

---

## 常见问题排查

### 问题 1：蒸馏后看不到数据

**可能原因**:
1. IPC 通道名称不匹配
2. 数据库连接失败
3. 用户未登录

**排查步骤**:
```bash
# 1. 检查 IPC 通道名称
grep "topic:local:getByDistillation" windows-login-manager/src/pages/DistillationPage.tsx

# 2. 检查数据库数据
psql -d geo_windows -c "SELECT COUNT(*) FROM distillations;"
psql -d geo_windows -c "SELECT COUNT(*) FROM topics;"

# 3. 检查编译是否成功
ls -la windows-login-manager/dist-electron/ipc/handlers/
```

### 问题 2：页面加载失败（500 错误）

**可能原因**:
1. JSX 语法错误
2. 组件导入失败

**排查步骤**:
1. 打开开发者工具查看详细错误
2. 检查 `DistillationResultsPage.tsx` 的 JSX 结构
3. 确认所有导入的组件都存在

### 问题 3：统计数据不正确

**可能原因**:
1. SQL 查询错误
2. 数据库数据不一致

**排查步骤**:
```sql
-- 检查蒸馏记录的 topic_count 是否正确
SELECT 
  d.id, 
  d.keyword, 
  d.topic_count,
  (SELECT COUNT(*) FROM topics t WHERE t.distillation_id = d.id) as actual_count
FROM distillations d;

-- 如果不一致，更新 topic_count
UPDATE distillations 
SET topic_count = (
  SELECT COUNT(*) 
  FROM topics 
  WHERE distillation_id = distillations.id
);
```

---

## 性能测试

### 大数据量测试

1. 执行 10 次蒸馏（每次约 12 个话题）
2. 验证列表加载速度
3. 验证筛选和搜索性能

**预期**:
- 列表加载时间 < 1 秒
- 筛选响应时间 < 500ms
- 搜索响应时间 < 500ms

---

## 测试完成检查清单

- [ ] 新蒸馏功能正常
- [ ] 查看历史记录正常
- [ ] 关键词筛选正常
- [ ] 搜索功能正常
- [ ] 批量删除正常
- [ ] 按关键词删除正常
- [ ] 编辑关键词正常
- [ ] 数据持久化正常
- [ ] 统计数据正确
- [ ] 性能表现良好

---

## 测试报告模板

```
测试日期: 2026-01-17
测试人员: [姓名]
测试环境: macOS / Windows / Linux

测试结果:
✅ 场景 1: 执行新蒸馏 - 通过
✅ 场景 2: 查看历史记录 - 通过
✅ 场景 3: 筛选和搜索 - 通过
✅ 场景 4: 删除操作 - 通过
✅ 场景 5: 编辑关键词 - 通过
✅ 场景 6: 数据持久化 - 通过

发现的问题:
[无 / 列出问题]

总体评价:
[通过 / 需要修复]
```

---

## 下一步

如果所有测试通过：
1. ✅ 标记蒸馏功能为"已完成"
2. ✅ 更新用户文档
3. ✅ 准备发布新版本

如果测试失败：
1. 记录详细错误信息
2. 检查日志文件
3. 联系开发团队
