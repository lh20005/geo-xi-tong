# 蒸馏结果显示问题 - 用户指南

## 问题现象

执行蒸馏后，提示"成功生成话题"，但在结果页面看不到内容。

---

## 问题原因

这是由于之前的代码版本存在 bug，导致话题保存失败但没有错误提示。

**好消息**: 问题已经修复！✅

---

## 解决方案

### 第一步：清理无效记录

运行清理脚本删除保存失败的蒸馏记录：

```bash
cd windows-login-manager
./cleanup-invalid-distillations.sh
```

或者手动执行 SQL：

```bash
psql -U lzc -d geo_windows -c "DELETE FROM distillations WHERE id IN (19, 20, 21, 22, 23, 24, 25);"
```

### 第二步：重新执行蒸馏

1. 打开应用
2. 进入"关键词蒸馏"页面
3. 输入关键词（例如：法国留学）
4. 点击"开始蒸馏"
5. 等待跳转到结果页面

### 第三步：验证结果

结果页面应该显示：
- ✅ 话题列表（通常 12 个）
- ✅ 每个话题的问题内容
- ✅ 可以点击"生成文章"

---

## 如何确认问题已修复

### 方法 1：查看浏览器控制台

1. 打开开发者工具（F12 或 Cmd+Option+I）
2. 切换到"Console"标签
3. 执行蒸馏时，应该看到类似日志：

```
[蒸馏] 开始调用服务器 API
[蒸馏] 服务器返回话题数量: 12
[蒸馏] 开始保存蒸馏记录
[蒸馏] 蒸馏记录已保存, ID: 27
[蒸馏] 开始保存话题，数量: 12
[蒸馏] 保存话题 1/12: 法国留学一年大概需要多少钱？
[蒸馏] 话题 1 保存结果: {success: true, data: {...}}
...
[蒸馏] 所有话题保存完成
```

### 方法 2：查看数据库

```bash
# 运行诊断脚本
node windows-login-manager/diagnose-topic-save.js
```

应该看到：
```
✅ 26 | 法国留学 | 12 | 12 | 1 | 2026/1/17 22:31:03
```

---

## 常见问题

### Q1: 清理脚本提示"数据库连接失败"

**原因**: PostgreSQL 未启动或配置不正确

**解决**:
```bash
# 检查 PostgreSQL 是否运行
pg_isready

# 如果未运行，启动 PostgreSQL
brew services start postgresql@14
```

### Q2: 执行蒸馏后仍然看不到结果

**可能原因**:
1. 未清理旧的无效记录
2. 浏览器缓存问题
3. 代码未重新编译

**解决步骤**:
```bash
# 1. 清理无效记录
cd windows-login-manager
./cleanup-invalid-distillations.sh

# 2. 清理浏览器缓存
# 在应用中按 Cmd+Shift+R 强制刷新

# 3. 重启应用
# 关闭应用后重新打开
```

### Q3: 看到错误提示"保存话题失败"

**原因**: 数据库表结构不完整

**解决**:
```bash
# 添加缺失的列
psql -U lzc -d geo_windows -c "
ALTER TABLE topics 
ADD COLUMN IF NOT EXISTS category TEXT DEFAULT '',
ADD COLUMN IF NOT EXISTS priority INTEGER DEFAULT 0,
ADD COLUMN IF NOT EXISTS updated_at TIMESTAMP DEFAULT NOW();
"
```

### Q4: 蒸馏历史中显示的话题数量不对

**原因**: 显示的是 `topic_count`（预期数量），不是实际数量

**解决**: 运行诊断脚本查看实际数量
```bash
node windows-login-manager/diagnose-topic-save.js
```

---

## 技术支持

如果以上方法都无法解决问题，请提供以下信息：

1. **浏览器控制台日志**
   - 打开开发者工具
   - 复制所有 `[蒸馏]` 开头的日志

2. **诊断脚本输出**
   ```bash
   node windows-login-manager/diagnose-topic-save.js > diagnosis.txt
   ```

3. **数据库表结构**
   ```bash
   psql -U lzc -d geo_windows -c "\d topics" > topics_schema.txt
   ```

---

## 相关文档

- [完整修复报告](./DISTILLATION_TOPIC_SAVE_COMPLETE.md)
- [数据流程修复](./DISTILLATION_DATA_FLOW_FIX.md)
- [用户 ID 诊断](./DISTILLATION_USER_ID_DIAGNOSIS.md)

---

**最后更新**: 2026-01-17  
**状态**: ✅ 问题已修复
