# æºä»£ç ä¿æŠ¤å¼€å‘è®¡åˆ’

> ä¸“æ³¨äºä»£ç å®‰å…¨åŠ å›ºï¼Œé˜²æ­¢æºä»£ç æ³„éœ²

## ğŸ“‹ ç›®æ ‡

ç¡®ä¿ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ—¶ï¼Œæºä»£ç å’Œæ•æ„Ÿä¿¡æ¯ä¸è¢«æ³„éœ²

**é¢„è®¡æ—¶é—´ï¼š** 1-2 å¤©
**ä¼˜å…ˆçº§ï¼š** ğŸ”´ æœ€é«˜

---

## ç¬¬ä¸€é˜¶æ®µï¼šå‰ç«¯ä»£ç ä¿æŠ¤ï¼ˆ2 å°æ—¶ï¼‰â­â­â­

### ä»»åŠ¡ 1.1ï¼šç¦ç”¨ Source Map

**ä¸ºä»€ä¹ˆé‡è¦ï¼š** Source Map ä¼šæš´éœ²å®Œæ•´çš„åŸå§‹æºä»£ç 

#### ä¿®æ”¹ client/vite.config.ts

```typescript
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [react()],
  
  server: {
    port: 5173,
    proxy: {
      '/api': {
        target: 'http://localhost:3000',
        changeOrigin: true
      },
      '/uploads': {
        target: 'http://localhost:3000',
        changeOrigin: true
      }
    }
  },
  
  build: {
    // ğŸ”’ ç¦ç”¨ Source Mapï¼ˆæœ€é‡è¦ï¼ï¼‰
    sourcemap: false,
    
    // ğŸ”’ ä»£ç æ··æ·†å’Œå‹ç¼©
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true,      // åˆ é™¤ console.log
        drop_debugger: true,     // åˆ é™¤ debugger
        pure_funcs: [            // åˆ é™¤æŒ‡å®šå‡½æ•°
          'console.log',
          'console.info',
          'console.debug'
        ]
      },
      mangle: {
        safari10: true           // å˜é‡åæ··æ·†
      },
      format: {
        comments: false          // åˆ é™¤æ³¨é‡Š
      }
    },
    
    // åˆ†å—ç­–ç•¥ï¼ˆå¯é€‰ï¼Œæé«˜åŠ è½½é€Ÿåº¦ï¼‰
    rollupOptions: {
      output: {
        manualChunks: {
          'react-vendor': ['react', 'react-dom', 'react-router-dom'],
          'antd-vendor': ['antd', '@ant-design/icons']
        }
      }
    }
  }
});
```

#### ä¿®æ”¹ landing/vite.config.ts

```typescript
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [react()],
  
  server: {
    port: 8080
  },
  
  build: {
    // ğŸ”’ åŒæ ·çš„å®‰å…¨é…ç½®
    sourcemap: false,
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true,
        drop_debugger: true
      },
      mangle: {
        safari10: true
      },
      format: {
        comments: false
      }
    }
  }
});
```

#### éªŒè¯

```bash
# ç¼–è¯‘å‰ç«¯
cd client
npm run build

# æ£€æŸ¥æ˜¯å¦æœ‰ .map æ–‡ä»¶
find dist -name "*.map"
# åº”è¯¥æ²¡æœ‰ä»»ä½•è¾“å‡º

# æ£€æŸ¥ç¼–è¯‘åçš„ä»£ç æ˜¯å¦æ··æ·†
cat dist/assets/index-*.js | head -20
# åº”è¯¥çœ‹åˆ°æ··æ·†åçš„ä»£ç ï¼Œä¸æ˜¯åŸå§‹ä»£ç 

# åŒæ ·æ£€æŸ¥ landing
cd ../landing
npm run build
find dist -name "*.map"
```

---

## ç¬¬äºŒé˜¶æ®µï¼šåç«¯é”™è¯¯å¤„ç†ä¼˜åŒ–ï¼ˆ1 å°æ—¶ï¼‰â­â­â­

### ä»»åŠ¡ 2.1ï¼šæ”¹è¿›é”™è¯¯å¤„ç†

**ä¸ºä»€ä¹ˆé‡è¦ï¼š** é˜²æ­¢é”™è¯¯ä¿¡æ¯æ³„éœ²ä»£ç è·¯å¾„å’Œé€»è¾‘

#### ä¿®æ”¹ server/src/middleware/errorHandler.ts

```typescript
import { Request, Response, NextFunction } from 'express';

// ğŸ”’ å®‰å…¨çš„é”™è¯¯æ¶ˆæ¯æ˜ å°„
const SAFE_ERROR_MESSAGES: Record<string, string> = {
  'ValidationError': 'è¯·æ±‚å‚æ•°é”™è¯¯',
  'UnauthorizedError': 'æœªæˆæƒè®¿é—®',
  'ForbiddenError': 'æ— æƒè®¿é—®',
  'NotFoundError': 'èµ„æºä¸å­˜åœ¨',
  'ConflictError': 'èµ„æºå†²çª',
  'DatabaseError': 'æ•°æ®æ“ä½œå¤±è´¥',
  'NetworkError': 'ç½‘ç»œè¯·æ±‚å¤±è´¥'
};

export function errorHandler(
  err: Error,
  req: Request,
  res: Response,
  next: NextFunction
) {
  // ğŸ”’ è¯¦ç»†æ—¥å¿—åªè®°å½•åˆ°æœåŠ¡å™¨ï¼Œä¸è¿”å›ç»™å®¢æˆ·ç«¯
  console.error('[Error]', {
    message: err.message,
    stack: err.stack,
    url: req.url,
    method: req.method,
    ip: req.ip,
    user: (req as any).user?.id,
    timestamp: new Date().toISOString()
  });
  
  const statusCode = (err as any).statusCode || 500;
  
  if (process.env.NODE_ENV === 'production') {
    // ğŸ”’ ç”Ÿäº§ç¯å¢ƒï¼šåªè¿”å›å®‰å…¨çš„é”™è¯¯æ¶ˆæ¯
    const safeMessage = SAFE_ERROR_MESSAGES[err.name] || 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯';
    
    res.status(statusCode).json({
      success: false,
      message: safeMessage
      // ä¸è¿”å› stackã€fileã€line ç­‰ä¿¡æ¯
    });
  } else {
    // å¼€å‘ç¯å¢ƒï¼šè¿”å›è¯¦ç»†ä¿¡æ¯æ–¹ä¾¿è°ƒè¯•
    res.status(statusCode).json({
      success: false,
      message: err.message,
      stack: err.stack,
      name: err.name
    });
  }
}
```

#### éªŒè¯

```bash
# å¯åŠ¨åç«¯
cd server
NODE_ENV=production npm run dev

# æµ‹è¯•é”™è¯¯å“åº”
curl http://localhost:3000/api/nonexistent

# åº”è¯¥è¿”å›ç±»ä¼¼ï¼š
# {"success":false,"message":"æœåŠ¡å™¨å†…éƒ¨é”™è¯¯"}
# è€Œä¸æ˜¯åŒ…å« stack trace
```

---

## ç¬¬ä¸‰é˜¶æ®µï¼šå®‰å…¨ä¸­é—´ä»¶ï¼ˆ30 åˆ†é’Ÿï¼‰â­â­

### ä»»åŠ¡ 3.1ï¼šå®‰è£…å®‰å…¨ä¾èµ–

```bash
cd server
npm install helmet express-rate-limit
```

### ä»»åŠ¡ 3.2ï¼šæ·»åŠ å®‰å…¨ä¸­é—´ä»¶

#### ä¿®æ”¹ server/src/index.ts

åœ¨ç°æœ‰ä»£ç ä¸­æ·»åŠ ï¼ˆåœ¨ `const app = express();` ä¹‹åï¼‰ï¼š

```typescript
import helmet from 'helmet';
import rateLimit from 'express-rate-limit';

const app = express();

// ========== ğŸ”’ å®‰å…¨ä¸­é—´ä»¶ ==========

// 1. Helmet - è®¾ç½®å®‰å…¨ HTTP Headers
app.use(helmet({
  contentSecurityPolicy: false,  // å¦‚æœéœ€è¦å¯ä»¥è‡ªå®šä¹‰
  crossOriginEmbedderPolicy: false
}));

// 2. éšè—æŠ€æœ¯æ ˆä¿¡æ¯
app.disable('x-powered-by');
app.use((req, res, next) => {
  res.removeHeader('X-Powered-By');
  res.setHeader('Server', 'WebServer');  // ä¸æš´éœ² Express
  next();
});

// 3. é€Ÿç‡é™åˆ¶ï¼ˆé˜²æ­¢æš´åŠ›æ”»å‡»ï¼‰
const limiter = rateLimit({
  windowMs: 15 * 60 * 1000,  // 15 åˆ†é’Ÿ
  max: 100,                   // æœ€å¤š 100 ä¸ªè¯·æ±‚
  message: 'è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•',
  standardHeaders: true,
  legacyHeaders: false
});

app.use('/api', limiter);

// 4. CORS é…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒé™åˆ¶æ¥æºï¼‰
const allowedOrigins = process.env.ALLOWED_ORIGINS?.split(',') || [
  'http://localhost:5173',
  'http://localhost:8080'
];

app.use(cors({
  origin: (origin, callback) => {
    // å…è®¸æ²¡æœ‰ origin çš„è¯·æ±‚ï¼ˆå¦‚ç§»åŠ¨åº”ç”¨ã€Postmanï¼‰
    if (!origin) return callback(null, true);
    
    if (allowedOrigins.includes(origin)) {
      callback(null, true);
    } else {
      callback(new Error('ä¸å…è®¸çš„æ¥æº'));
    }
  },
  credentials: true
}));

// ... å…¶ä»–ä¸­é—´ä»¶
```

#### éªŒè¯

```bash
# å¯åŠ¨åç«¯
npm run dev

# æ£€æŸ¥ HTTP Headers
curl -I http://localhost:3000/api/health

# åº”è¯¥çœ‹åˆ°å®‰å…¨ headersï¼š
# X-Content-Type-Options: nosniff
# X-Frame-Options: SAMEORIGIN
# Server: WebServer  (ä¸æ˜¯ Express)
```

---

## ç¬¬å››é˜¶æ®µï¼šç¯å¢ƒå˜é‡å®‰å…¨ï¼ˆ30 åˆ†é’Ÿï¼‰â­â­â­

### ä»»åŠ¡ 4.1ï¼šç”Ÿæˆå¼ºå¯†é’¥

```bash
# ç”Ÿæˆ JWT_SECRETï¼ˆ64 å­—ç¬¦ï¼‰
openssl rand -hex 32

# ç”Ÿæˆæ•°æ®åº“å¯†ç ï¼ˆ24 å­—ç¬¦ï¼‰
openssl rand -base64 24 | tr -d "=+/" | cut -c1-24

# ç”Ÿæˆç®¡ç†å‘˜å¯†ç ï¼ˆ16 å­—ç¬¦ï¼‰
openssl rand -base64 16 | tr -d "=+/" | cut -c1-16
```

### ä»»åŠ¡ 4.2ï¼šæ›´æ–° .env.example

#### ä¿®æ”¹ .env.example

```bash
# æ•°æ®åº“é…ç½®
DATABASE_URL=postgresql://user:password@localhost:5432/geo_system

# AI APIé…ç½®
DEEPSEEK_API_KEY=sk-xxxxxxxxxxxxxxxx
GEMINI_API_KEY=AIzaSyxxxxxxxxxxxxxxxx

# æœåŠ¡å™¨é…ç½®
PORT=3000
NODE_ENV=production

# ğŸ”’ JWTå¯†é’¥ï¼ˆå¿…é¡»ä¿®æ”¹ï¼ä½¿ç”¨ openssl rand -hex 32 ç”Ÿæˆï¼‰
JWT_SECRET=è¯·ä½¿ç”¨å¼ºéšæœºå­—ç¬¦ä¸²_ä¸è¦ä½¿ç”¨è¿™ä¸ªé»˜è®¤å€¼

# ğŸ”’ ç®¡ç†å‘˜è´¦å·ï¼ˆå¿…é¡»ä¿®æ”¹ï¼ï¼‰
ADMIN_USERNAME=admin
ADMIN_PASSWORD=è¯·ä½¿ç”¨å¼ºå¯†ç _ä¸è¦ä½¿ç”¨é»˜è®¤å¯†ç 

# ğŸ”’ CORS å…è®¸çš„æ¥æºï¼ˆç”Ÿäº§ç¯å¢ƒåŸŸåï¼Œé€—å·åˆ†éš”ï¼‰
ALLOWED_ORIGINS=https://your-domain.com,https://www.your-domain.com

# å¾®ä¿¡æ”¯ä»˜é…ç½®
WECHAT_PAY_APP_ID=
WECHAT_PAY_MCH_ID=
WECHAT_PAY_API_V3_KEY=
WECHAT_PAY_SERIAL_NO=
WECHAT_PAY_PRIVATE_KEY_PATH=/secure/path/to/apiclient_key.pem
WECHAT_PAY_NOTIFY_URL=https://your-domain.com/api/payment/wechat/notify

# Redisé…ç½®
REDIS_URL=redis://:password@localhost:6379
```

### ä»»åŠ¡ 4.3ï¼šç¡®ä¿ .gitignore æ­£ç¡®

#### ä¿®æ”¹ .gitignore

```gitignore
# ä¾èµ–
node_modules/
*/node_modules/

# ğŸ”’ ç¯å¢ƒå˜é‡ï¼ˆé‡è¦ï¼ï¼‰
.env
.env.*
!.env.example

# ğŸ”’ æ•æ„Ÿæ–‡ä»¶
*.key
*.pem
*.crt
secrets/
config/production.json

# æ„å»ºè¾“å‡º
dist/
build/
*/dist/
*/build/

# æ—¥å¿—
logs/
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# ç¼–è¾‘å™¨
.vscode/
.idea/
*.swp
*.swo
*~

# æ“ä½œç³»ç»Ÿ
.DS_Store
Thumbs.db

# ä¸´æ—¶æ–‡ä»¶
*.tmp
*.temp

# æµ‹è¯•è¦†ç›–ç‡
coverage/

# TypeScript
*.tsbuildinfo

# ğŸ”’ æˆªå›¾ï¼ˆé¿å…æ³„éœ²ä¿¡æ¯ï¼‰
server/*.png
screenshots/
*.png
!client/public/**/*.png
!landing/public/**/*.png
```

#### éªŒè¯

```bash
# æ£€æŸ¥ .env æ˜¯å¦è¢«å¿½ç•¥
git status .env
# åº”è¯¥æ˜¾ç¤ºï¼šnothing to commit

# æ£€æŸ¥ .gitignore æ˜¯å¦ç”Ÿæ•ˆ
git check-ignore .env
# åº”è¯¥è¾“å‡ºï¼š.env
```

---

## ç¬¬äº”é˜¶æ®µï¼šä»£ç å®¡æŸ¥å’Œæ¸…ç†ï¼ˆ1 å°æ—¶ï¼‰â­â­

### ä»»åŠ¡ 5.1ï¼šåˆ é™¤æ•æ„Ÿæ³¨é‡Šå’Œè°ƒè¯•ä»£ç 

#### æ£€æŸ¥å¹¶åˆ é™¤

```bash
# æœç´¢å¯èƒ½æ³„éœ²ä¿¡æ¯çš„æ³¨é‡Š
grep -r "TODO" server/src/ client/src/
grep -r "FIXME" server/src/ client/src/
grep -r "password" server/src/ client/src/
grep -r "secret" server/src/ client/src/
grep -r "api_key" server/src/ client/src/

# æœç´¢ç¡¬ç¼–ç çš„æ•æ„Ÿä¿¡æ¯
grep -r "sk-" server/src/  # DeepSeek API Key
grep -r "AIzaSy" server/src/  # Gemini API Key
```

#### åˆ é™¤è°ƒè¯•ä»£ç 

```typescript
// âŒ åˆ é™¤è¿™äº›
console.log('ç”¨æˆ·å¯†ç :', password);
console.log('API Key:', apiKey);
console.log('æ•°æ®åº“è¿æ¥:', DATABASE_URL);

// âœ… ä¿ç•™è¿™äº›ï¼ˆä¸æ³„éœ²æ•æ„Ÿä¿¡æ¯ï¼‰
console.log('ç”¨æˆ·ç™»å½•æˆåŠŸ');
console.log('API è°ƒç”¨æˆåŠŸ');
console.log('æ•°æ®åº“è¿æ¥æˆåŠŸ');
```

### ä»»åŠ¡ 5.2ï¼šæ£€æŸ¥ä¾èµ–æ¼æ´

```bash
# æ£€æŸ¥åç«¯ä¾èµ–
cd server
npm audit

# ä¿®å¤å¯è‡ªåŠ¨ä¿®å¤çš„æ¼æ´
npm audit fix

# æ£€æŸ¥å‰ç«¯ä¾èµ–
cd ../client
npm audit
npm audit fix

# æ£€æŸ¥ landing ä¾èµ–
cd ../landing
npm audit
npm audit fix
```

### ä»»åŠ¡ 5.3ï¼šæ›´æ–°ä¾èµ–åˆ°æœ€æ–°ç‰ˆæœ¬

```bash
# æ£€æŸ¥è¿‡æœŸçš„åŒ…
npm outdated

# æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼ˆè°¨æ…æ“ä½œï¼‰
npm update

# æˆ–ä½¿ç”¨ npm-check-updates
npx npm-check-updates -u
npm install
```

---

## ç¬¬å…­é˜¶æ®µï¼šç¼–è¯‘å’ŒéªŒè¯ï¼ˆ30 åˆ†é’Ÿï¼‰â­â­â­

### ä»»åŠ¡ 6.1ï¼šç¼–è¯‘æ‰€æœ‰é¡¹ç›®

```bash
# ç¼–è¯‘åç«¯
cd server
npm install
npm run build

# ç¼–è¯‘å‰ç«¯
cd ../client
npm install
npm run build

# ç¼–è¯‘ Landing
cd ../landing
npm install
npm run build
```

### ä»»åŠ¡ 6.2ï¼šéªŒè¯ç¼–è¯‘äº§ç‰©

```bash
# 1. æ£€æŸ¥æ˜¯å¦æœ‰ Source Map
find . -name "*.map" | grep -v node_modules
# åº”è¯¥æ²¡æœ‰è¾“å‡º

# 2. æ£€æŸ¥å‰ç«¯ä»£ç æ˜¯å¦æ··æ·†
cat client/dist/assets/index-*.js | head -20
# åº”è¯¥çœ‹åˆ°æ··æ·†åçš„ä»£ç 

# 3. æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆæ··æ·†ååº”è¯¥æ›´å°ï¼‰
du -sh client/dist/assets/*.js
du -sh landing/dist/assets/*.js

# 4. æ£€æŸ¥æ˜¯å¦æœ‰æ•æ„Ÿæ–‡ä»¶
ls -la client/dist/ | grep -E "\.(env|ts|map)"
# ä¸åº”è¯¥æœ‰è¿™äº›æ–‡ä»¶
```

---

## ğŸ“‹ å®Œæ•´æ£€æŸ¥æ¸…å•

### ä»£ç ä¿æŠ¤æ£€æŸ¥

- [ ] å‰ç«¯ Source Map å·²ç¦ç”¨ï¼ˆclient + landingï¼‰
- [ ] å‰ç«¯ä»£ç å·²æ··æ·†ï¼ˆTerserï¼‰
- [ ] å‰ç«¯ console.log å·²åˆ é™¤
- [ ] åç«¯é”™è¯¯å¤„ç†å·²ä¼˜åŒ–
- [ ] ç”Ÿäº§ç¯å¢ƒä¸è¿”å› stack trace
- [ ] å®‰å…¨ä¸­é—´ä»¶å·²æ·»åŠ ï¼ˆHelmetï¼‰
- [ ] é€Ÿç‡é™åˆ¶å·²é…ç½®
- [ ] æœåŠ¡å™¨ä¿¡æ¯å·²éšè—
- [ ] CORS å·²æ­£ç¡®é…ç½®

### ç¯å¢ƒå˜é‡æ£€æŸ¥

- [ ] .env æ–‡ä»¶åœ¨ .gitignore ä¸­
- [ ] .env.example å·²æ›´æ–°
- [ ] å¼ºå¯†é’¥å·²ç”Ÿæˆï¼ˆJWT_SECRETï¼‰
- [ ] ç®¡ç†å‘˜å¯†ç å·²ä¿®æ”¹
- [ ] æ²¡æœ‰ç¡¬ç¼–ç çš„æ•æ„Ÿä¿¡æ¯
- [ ] API Key åªåœ¨åç«¯ä½¿ç”¨

### ä»£ç æ¸…ç†æ£€æŸ¥

- [ ] åˆ é™¤äº†æ•æ„Ÿæ³¨é‡Š
- [ ] åˆ é™¤äº†è°ƒè¯•ä»£ç 
- [ ] åˆ é™¤äº† TODO/FIXME
- [ ] ä¾èµ–æ¼æ´å·²ä¿®å¤
- [ ] ä¾èµ–å·²æ›´æ–°åˆ°å®‰å…¨ç‰ˆæœ¬

### ç¼–è¯‘éªŒè¯æ£€æŸ¥

- [ ] æ‰€æœ‰é¡¹ç›®ç¼–è¯‘æˆåŠŸ
- [ ] æ²¡æœ‰ .map æ–‡ä»¶
- [ ] ä»£ç å·²æ··æ·†
- [ ] æ²¡æœ‰ .ts æ–‡ä»¶åœ¨ dist ä¸­
- [ ] æ²¡æœ‰ .env æ–‡ä»¶åœ¨ dist ä¸­

---

## ğŸ§ª å®‰å…¨æµ‹è¯•

### æµ‹è¯• 1ï¼šSource Map æ£€æŸ¥

```bash
# ç¼–è¯‘åæ£€æŸ¥
cd client
npm run build

# æµ‹è¯• 1ï¼šæŸ¥æ‰¾ .map æ–‡ä»¶
find dist -name "*.map"
# é¢„æœŸï¼šæ— è¾“å‡º

# æµ‹è¯• 2ï¼šæ£€æŸ¥ JS æ–‡ä»¶ä¸­çš„ sourceMappingURL
grep -r "sourceMappingURL" dist/
# é¢„æœŸï¼šæ— è¾“å‡º

# æµ‹è¯• 3ï¼šæŸ¥çœ‹ä»£ç æ˜¯å¦æ··æ·†
cat dist/assets/index-*.js | head -50
# é¢„æœŸï¼šçœ‹åˆ°æ··æ·†åçš„ä»£ç ï¼Œå¦‚ function a(b,c){...}
```

### æµ‹è¯• 2ï¼šé”™è¯¯ä¿¡æ¯æ£€æŸ¥

```bash
# å¯åŠ¨åç«¯ï¼ˆç”Ÿäº§æ¨¡å¼ï¼‰
cd server
NODE_ENV=production npm run dev

# æµ‹è¯•é”™è¯¯å“åº”
curl http://localhost:3000/api/nonexistent

# é¢„æœŸå“åº”ï¼š
# {"success":false,"message":"æœåŠ¡å™¨å†…éƒ¨é”™è¯¯"}
# ä¸åº”è¯¥åŒ…å« stackã€fileã€line ç­‰ä¿¡æ¯
```

### æµ‹è¯• 3ï¼šHTTP Headers æ£€æŸ¥

```bash
# æ£€æŸ¥å®‰å…¨ Headers
curl -I http://localhost:3000/api/health

# é¢„æœŸåŒ…å«ï¼š
# X-Content-Type-Options: nosniff
# X-Frame-Options: SAMEORIGIN
# X-XSS-Protection: 1; mode=block
# Server: WebServer  (ä¸æ˜¯ Express)
```

### æµ‹è¯• 4ï¼šç¯å¢ƒå˜é‡æ£€æŸ¥

```bash
# æ£€æŸ¥ .env æ˜¯å¦è¢« Git å¿½ç•¥
git status .env
# é¢„æœŸï¼šnothing to commit

# æ£€æŸ¥ä»£ç ä¸­æ˜¯å¦æœ‰ç¡¬ç¼–ç çš„å¯†é’¥
grep -r "sk-" server/src/
grep -r "AIzaSy" server/src/
# é¢„æœŸï¼šæ— è¾“å‡ºï¼ˆæˆ–åªåœ¨æ³¨é‡Šä¸­ï¼‰
```

---

## ğŸš€ å¿«é€Ÿæ‰§è¡Œè„šæœ¬

### ä¸€é”®ä¿æŠ¤è„šæœ¬

åˆ›å»º `protect-code.sh`ï¼š

```bash
#!/bin/bash

echo "ğŸ”’ å¼€å§‹ä»£ç ä¿æŠ¤..."

# 1. æ£€æŸ¥ .gitignore
echo "ğŸ“ æ£€æŸ¥ .gitignore..."
if ! grep -q "^\.env$" .gitignore; then
    echo ".env" >> .gitignore
    echo "âœ… å·²æ·»åŠ  .env åˆ° .gitignore"
fi

# 2. ç”Ÿæˆå¼ºå¯†é’¥
echo "ğŸ”‘ ç”Ÿæˆå¼ºå¯†é’¥..."
JWT_SECRET=$(openssl rand -hex 32)
echo "JWT_SECRET=$JWT_SECRET"
echo "âš ï¸  è¯·å°†æ­¤å¯†é’¥ä¿å­˜åˆ° .env æ–‡ä»¶"

# 3. ç¼–è¯‘å‰ç«¯ï¼ˆç¦ç”¨ Source Mapï¼‰
echo "ğŸ“¦ ç¼–è¯‘å‰ç«¯..."
cd client
npm run build
if find dist -name "*.map" | grep -q .; then
    echo "âŒ è­¦å‘Šï¼šå‘ç° Source Map æ–‡ä»¶ï¼"
    exit 1
else
    echo "âœ… å‰ç«¯ç¼–è¯‘æˆåŠŸï¼Œæ—  Source Map"
fi

cd ../landing
npm run build
if find dist -name "*.map" | grep -q .; then
    echo "âŒ è­¦å‘Šï¼šå‘ç° Source Map æ–‡ä»¶ï¼"
    exit 1
else
    echo "âœ… Landing ç¼–è¯‘æˆåŠŸï¼Œæ—  Source Map"
fi

# 4. ç¼–è¯‘åç«¯
echo "ğŸ“¦ ç¼–è¯‘åç«¯..."
cd ../server
npm run build
echo "âœ… åç«¯ç¼–è¯‘æˆåŠŸ"

# 5. æ£€æŸ¥ä¾èµ–æ¼æ´
echo "ğŸ” æ£€æŸ¥ä¾èµ–æ¼æ´..."
npm audit --production
cd ../client
npm audit --production
cd ../landing
npm audit --production

echo ""
echo "âœ… ä»£ç ä¿æŠ¤å®Œæˆï¼"
echo ""
echo "ğŸ“‹ ä¸‹ä¸€æ­¥ï¼š"
echo "1. å°†ç”Ÿæˆçš„ JWT_SECRET ä¿å­˜åˆ° .env æ–‡ä»¶"
echo "2. ä¿®æ”¹ç®¡ç†å‘˜å¯†ç "
echo "3. é…ç½® ALLOWED_ORIGINS"
echo "4. è¿è¡Œå®‰å…¨æµ‹è¯•"
```

### å®‰å…¨æµ‹è¯•è„šæœ¬

åˆ›å»º `test-security.sh`ï¼š

```bash
#!/bin/bash

echo "ğŸ§ª å¼€å§‹å®‰å…¨æµ‹è¯•..."

# 1. æ£€æŸ¥ Source Map
echo "1ï¸âƒ£ æ£€æŸ¥ Source Map..."
if find client/dist landing/dist -name "*.map" 2>/dev/null | grep -q .; then
    echo "âŒ å¤±è´¥ï¼šå‘ç° Source Map æ–‡ä»¶"
    exit 1
else
    echo "âœ… é€šè¿‡ï¼šæ—  Source Map"
fi

# 2. æ£€æŸ¥ .env æ–‡ä»¶
echo "2ï¸âƒ£ æ£€æŸ¥ .env æ–‡ä»¶..."
if git ls-files --error-unmatch .env 2>/dev/null; then
    echo "âŒ å¤±è´¥ï¼š.env æ–‡ä»¶è¢« Git è·Ÿè¸ª"
    exit 1
else
    echo "âœ… é€šè¿‡ï¼š.env æ–‡ä»¶æœªè¢«è·Ÿè¸ª"
fi

# 3. æ£€æŸ¥ç¡¬ç¼–ç çš„å¯†é’¥
echo "3ï¸âƒ£ æ£€æŸ¥ç¡¬ç¼–ç çš„å¯†é’¥..."
if grep -r "sk-[a-zA-Z0-9]" server/src/ 2>/dev/null | grep -v "example\|comment"; then
    echo "âŒ è­¦å‘Šï¼šå‘ç°å¯èƒ½çš„ç¡¬ç¼–ç  API Key"
fi

# 4. æ£€æŸ¥ä¾èµ–æ¼æ´
echo "4ï¸âƒ£ æ£€æŸ¥ä¾èµ–æ¼æ´..."
cd server
if npm audit --production --audit-level=high 2>&1 | grep -q "found.*vulnerabilities"; then
    echo "âš ï¸  è­¦å‘Šï¼šå‘ç°ä¾èµ–æ¼æ´"
    npm audit --production
fi

echo ""
echo "âœ… å®‰å…¨æµ‹è¯•å®Œæˆï¼"
```

---

## ğŸ“ éƒ¨ç½²å‰æœ€ç»ˆæ£€æŸ¥

### åœ¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒå‰ï¼Œç¡®è®¤ï¼š

```bash
# 1. è¿è¡Œä¿æŠ¤è„šæœ¬
chmod +x protect-code.sh
./protect-code.sh

# 2. è¿è¡Œå®‰å…¨æµ‹è¯•
chmod +x test-security.sh
./test-security.sh

# 3. æ‰‹åŠ¨æ£€æŸ¥
echo "æ‰‹åŠ¨æ£€æŸ¥æ¸…å•ï¼š"
echo "- [ ] .env æ–‡ä»¶ä¸åœ¨ Git ä¸­"
echo "- [ ] JWT_SECRET å·²ä¿®æ”¹"
echo "- [ ] ç®¡ç†å‘˜å¯†ç å·²ä¿®æ”¹"
echo "- [ ] å‰ç«¯æ—  Source Map"
echo "- [ ] ä»£ç å·²æ··æ·†"
echo "- [ ] æ— ç¡¬ç¼–ç å¯†é’¥"
echo "- [ ] ä¾èµ–æ— é«˜å±æ¼æ´"
```

---

## ğŸ¯ æ€»ç»“

### æ ¸å¿ƒä¿æŠ¤æªæ–½

| æªæ–½ | é‡è¦æ€§ | è€—æ—¶ | çŠ¶æ€ |
|------|--------|------|------|
| ç¦ç”¨ Source Map | ğŸ”´ æœ€é«˜ | 30åˆ†é’Ÿ | [ ] |
| ä»£ç æ··æ·† | ğŸ”´ æœ€é«˜ | 30åˆ†é’Ÿ | [ ] |
| é”™è¯¯å¤„ç†ä¼˜åŒ– | ğŸŸ¡ é«˜ | 1å°æ—¶ | [ ] |
| å®‰å…¨ä¸­é—´ä»¶ | ğŸŸ¡ é«˜ | 30åˆ†é’Ÿ | [ ] |
| ç¯å¢ƒå˜é‡å®‰å…¨ | ğŸ”´ æœ€é«˜ | 30åˆ†é’Ÿ | [ ] |
| ä»£ç æ¸…ç† | ğŸŸ¢ ä¸­ | 1å°æ—¶ | [ ] |

### é¢„æœŸæ•ˆæœ

**ä¿æŠ¤å‰ï¼š**
- âš ï¸ å‰ç«¯æºä»£ç å¯è§
- âš ï¸ é”™è¯¯ä¿¡æ¯æ³„éœ²è·¯å¾„
- âš ï¸ æœåŠ¡å™¨ä¿¡æ¯æš´éœ²
- âš ï¸ ç¯å¢ƒå˜é‡å¯èƒ½æ³„éœ²

**ä¿æŠ¤åï¼š**
- âœ… å‰ç«¯ä»£ç æ··æ·†ï¼Œéš¾ä»¥ç†è§£
- âœ… é”™è¯¯ä¿¡æ¯å®‰å…¨ï¼Œä¸æ³„éœ²ç»†èŠ‚
- âœ… æœåŠ¡å™¨ä¿¡æ¯éšè—
- âœ… ç¯å¢ƒå˜é‡å®‰å…¨ç®¡ç†
- âœ… ä¾èµ–æ— å·²çŸ¥æ¼æ´

### å®‰å…¨ç­‰çº§

- **å½“å‰ï¼š** ğŸŸ¡ ä¸­ç­‰
- **ä¿æŠ¤åï¼š** ğŸŸ¢ é«˜

**æ€»è€—æ—¶ï¼š** 4-6 å°æ—¶
**éš¾åº¦ï¼š** ğŸŸ¢ ç®€å•

æŒ‰ç…§è¿™ä¸ªè®¡åˆ’æ‰§è¡Œï¼Œä½ çš„ä»£ç å°†å¾—åˆ°å……åˆ†ä¿æŠ¤ï¼
