# ç¼–è¯‘å’Œéƒ¨ç½²å®Œæ•´æŒ‡å—

## ğŸ“‹ éœ€è¦ç¼–è¯‘çš„é¡¹ç›®

éƒ¨ç½²åˆ°è…¾è®¯äº‘æœåŠ¡å™¨éœ€è¦ç¼–è¯‘ä»¥ä¸‹3ä¸ªé¡¹ç›®ï¼š

```
âœ… client/          # å‰ç«¯åº”ç”¨ï¼ˆReact + TypeScriptï¼‰
âœ… server/          # åç«¯åº”ç”¨ï¼ˆNode.js + TypeScriptï¼‰
âœ… landing/         # è¥é”€ç½‘ç«™ï¼ˆReact + TypeScriptï¼‰
```

## ğŸ¯ ä¸ºä»€ä¹ˆéœ€è¦ç¼–è¯‘ï¼Ÿ

### 1. å‰ç«¯åº”ç”¨ï¼ˆclient/ï¼‰
- **æºä»£ç **ï¼šTypeScript + JSX
- **ç¼–è¯‘å**ï¼šçº¯ JavaScript + HTML + CSS
- **åŸå› **ï¼šæµè§ˆå™¨ä¸èƒ½ç›´æ¥è¿è¡Œ TypeScript å’Œ JSX
- **ç¼–è¯‘å·¥å…·**ï¼šVite

### 2. åç«¯åº”ç”¨ï¼ˆserver/ï¼‰
- **æºä»£ç **ï¼šTypeScript
- **ç¼–è¯‘å**ï¼šçº¯ JavaScript
- **åŸå› **ï¼šNode.js è¿è¡Œ JavaScript æ›´å¿«ï¼Œä¸éœ€è¦å®æ—¶ç¼–è¯‘
- **ç¼–è¯‘å·¥å…·**ï¼šTypeScript Compiler (tsc)

### 3. è¥é”€ç½‘ç«™ï¼ˆlanding/ï¼‰
- **æºä»£ç **ï¼šTypeScript + JSX
- **ç¼–è¯‘å**ï¼šçº¯ JavaScript + HTML + CSS
- **åŸå› **ï¼šåŒå‰ç«¯åº”ç”¨
- **ç¼–è¯‘å·¥å…·**ï¼šVite

## ğŸ”§ ç¼–è¯‘æ­¥éª¤

### æ–¹å¼ä¸€ï¼šä¸€é”®ç¼–è¯‘ï¼ˆæ¨èï¼‰âš¡

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
npm run build

# è¿™ä¸ªå‘½ä»¤ä¼šä¾æ¬¡ç¼–è¯‘ï¼š
# 1. client/
# 2. server/
# 3. landing/
```

### æ–¹å¼äºŒï¼šåˆ†åˆ«ç¼–è¯‘

#### 1. ç¼–è¯‘å‰ç«¯åº”ç”¨

```bash
cd client
npm install
npm run build

# ç¼–è¯‘è¾“å‡ºï¼šclient/dist/
# åŒ…å«ï¼šindex.html, assets/*.js, assets/*.css
```

#### 2. ç¼–è¯‘åç«¯åº”ç”¨

```bash
cd server
npm install
npm run build

# ç¼–è¯‘è¾“å‡ºï¼šserver/dist/
# åŒ…å«ï¼šæ‰€æœ‰ .js æ–‡ä»¶ï¼ˆä» .ts ç¼–è¯‘è€Œæ¥ï¼‰
```

#### 3. ç¼–è¯‘è¥é”€ç½‘ç«™

```bash
cd landing
npm install
npm run build

# ç¼–è¯‘è¾“å‡ºï¼šlanding/dist/
# åŒ…å«ï¼šindex.html, assets/*.js, assets/*.css
```

## ğŸ“¦ ç¼–è¯‘åçš„ç›®å½•ç»“æ„

```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ client/
â”‚   â”œâ”€â”€ src/              # âŒ æºä»£ç ï¼ˆä¸ä¸Šä¼ ï¼‰
â”‚   â”œâ”€â”€ dist/             # âœ… ç¼–è¯‘è¾“å‡ºï¼ˆä¸Šä¼ ï¼‰
â”‚   â”‚   â”œâ”€â”€ index.html
â”‚   â”‚   â””â”€â”€ assets/
â”‚   â”‚       â”œâ”€â”€ index-xxx.js
â”‚   â”‚       â””â”€â”€ index-xxx.css
â”‚   â””â”€â”€ package.json      # âœ… ä¾èµ–é…ç½®ï¼ˆä¸Šä¼ ï¼‰
â”‚
â”œâ”€â”€ server/
â”‚   â”œâ”€â”€ src/              # âŒ æºä»£ç ï¼ˆä¸ä¸Šä¼ ï¼‰
â”‚   â”œâ”€â”€ dist/             # âœ… ç¼–è¯‘è¾“å‡ºï¼ˆä¸Šä¼ ï¼‰
â”‚   â”‚   â”œâ”€â”€ index.js
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ package.json      # âœ… ä¾èµ–é…ç½®ï¼ˆä¸Šä¼ ï¼‰
â”‚   â””â”€â”€ package-lock.json # âœ… ä¾èµ–é”å®šï¼ˆä¸Šä¼ ï¼‰
â”‚
â””â”€â”€ landing/
    â”œâ”€â”€ src/              # âŒ æºä»£ç ï¼ˆä¸ä¸Šä¼ ï¼‰
    â”œâ”€â”€ dist/             # âœ… ç¼–è¯‘è¾“å‡ºï¼ˆä¸Šä¼ ï¼‰
    â”‚   â”œâ”€â”€ index.html
    â”‚   â””â”€â”€ assets/
    â””â”€â”€ package.json      # âœ… ä¾èµ–é…ç½®ï¼ˆä¸Šä¼ ï¼‰
```

## ğŸš€ å®Œæ•´éƒ¨ç½²æµç¨‹

### ç¬¬ä¸€æ­¥ï¼šæœ¬åœ°ç¼–è¯‘ï¼ˆ10åˆ†é’Ÿï¼‰

```bash
# 1. ç¡®ä¿æ‰€æœ‰ä¾èµ–å·²å®‰è£…
npm run install:all

# 2. ç¼–è¯‘æ‰€æœ‰é¡¹ç›®
npm run build

# 3. éªŒè¯ç¼–è¯‘ç»“æœ
ls -la client/dist/
ls -la server/dist/
ls -la landing/dist/
```

### ç¬¬äºŒæ­¥ï¼šæ‰“åŒ…ä¸Šä¼ ï¼ˆ15åˆ†é’Ÿï¼‰

```bash
# 1. æ‰“åŒ…å‰ç«¯
cd client
tar -czf client-dist.tar.gz dist package.json

# 2. æ‰“åŒ…åç«¯ï¼ˆåŒ…å« node_modules æˆ–åªæ‰“åŒ… distï¼‰
cd ../server
tar -czf server-dist.tar.gz dist package.json package-lock.json

# 3. æ‰“åŒ…è¥é”€ç½‘ç«™
cd ../landing
tar -czf landing-dist.tar.gz dist package.json

# 4. æ‰“åŒ…é…ç½®æ–‡ä»¶
cd ..
tar -czf config.tar.gz config/

# 5. ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼ˆæ›¿æ¢ YOUR_SERVER_IPï¼‰
scp client/client-dist.tar.gz ubuntu@YOUR_SERVER_IP:/var/www/geo-system/
scp server/server-dist.tar.gz ubuntu@YOUR_SERVER_IP:/var/www/geo-system/
scp landing/landing-dist.tar.gz ubuntu@YOUR_SERVER_IP:/var/www/geo-system/
scp config.tar.gz ubuntu@YOUR_SERVER_IP:/var/www/geo-system/
```

### ç¬¬ä¸‰æ­¥ï¼šæœåŠ¡å™¨è§£å‹ï¼ˆ5åˆ†é’Ÿï¼‰

```bash
# SSH ç™»å½•æœåŠ¡å™¨
ssh ubuntu@YOUR_SERVER_IP

# è¿›å…¥é¡¹ç›®ç›®å½•
cd /var/www/geo-system

# è§£å‹æ–‡ä»¶
tar -xzf client-dist.tar.gz
tar -xzf server-dist.tar.gz
tar -xzf landing-dist.tar.gz
tar -xzf config.tar.gz

# å®‰è£…åç«¯ä¾èµ–ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
cd server
npm ci --production

# è¿”å›é¡¹ç›®æ ¹ç›®å½•
cd ..
```

### ç¬¬å››æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡ï¼ˆ10åˆ†é’Ÿï¼‰

```bash
# åˆ›å»º .env æ–‡ä»¶
nano /var/www/geo-system/.env

# å¤åˆ¶ä»¥ä¸‹å†…å®¹å¹¶ä¿®æ”¹
```

å‚è€ƒ [README.md](../../README.md) ä¸­çš„ç¯å¢ƒå˜é‡é…ç½®ã€‚

### ç¬¬äº”æ­¥ï¼šè¿è¡Œæ•°æ®åº“è¿ç§»ï¼ˆ5åˆ†é’Ÿï¼‰

```bash
cd /var/www/geo-system/server
npm run db:migrate
```

### ç¬¬å…­æ­¥ï¼šå¯åŠ¨æœåŠ¡ï¼ˆ5åˆ†é’Ÿï¼‰

```bash
# ä½¿ç”¨ PM2 å¯åŠ¨åç«¯
cd /var/www/geo-system/server
pm2 start dist/index.js --name geo-backend

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
pm2 save

# æŸ¥çœ‹çŠ¶æ€
pm2 status
pm2 logs geo-backend
```

### ç¬¬ä¸ƒæ­¥ï¼šé…ç½® Nginxï¼ˆ15åˆ†é’Ÿï¼‰

```bash
# å¤åˆ¶é…ç½®æ–‡ä»¶
sudo cp /var/www/geo-system/config/nginx/nginx.conf.example /etc/nginx/sites-available/geo-system

# ç¼–è¾‘é…ç½®ï¼ˆæ›¿æ¢åŸŸåå’Œè·¯å¾„ï¼‰
sudo nano /etc/nginx/sites-available/geo-system

# å¯ç”¨é…ç½®
sudo ln -s /etc/nginx/sites-available/geo-system /etc/nginx/sites-enabled/
sudo rm /etc/nginx/sites-enabled/default

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯ Nginx
sudo systemctl restart nginx
```

### ç¬¬å…«æ­¥ï¼šéªŒè¯éƒ¨ç½²ï¼ˆ5åˆ†é’Ÿï¼‰

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
pm2 status
sudo systemctl status nginx

# æµ‹è¯• API
curl http://localhost:3000/api/health

# æµè§ˆå™¨è®¿é—®
# http://YOUR_SERVER_IP
```

## ğŸ“Š ç¼–è¯‘äº§ç‰©å¤§å°å‚è€ƒ

| é¡¹ç›® | æºä»£ç å¤§å° | ç¼–è¯‘åå¤§å° | å‹ç¼©åå¤§å° |
|------|-----------|-----------|-----------|
| client/src/ | ~5MB | ~2MB | ~500KB |
| server/src/ | ~3MB | ~1.5MB | ~300KB |
| landing/src/ | ~2MB | ~1MB | ~200KB |
| **æ€»è®¡** | ~10MB | ~4.5MB | ~1MB |

## âš ï¸ å¸¸è§ç¼–è¯‘é—®é¢˜

### Q1: ç¼–è¯‘å¤±è´¥ - å†…å­˜ä¸è¶³

**é”™è¯¯ä¿¡æ¯**ï¼š
```
FATAL ERROR: Reached heap limit Allocation failed - JavaScript heap out of memory
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# å¢åŠ  Node.js å†…å­˜é™åˆ¶
export NODE_OPTIONS="--max-old-space-size=4096"

# é‡æ–°ç¼–è¯‘
npm run build
```

### Q2: ç¼–è¯‘å¤±è´¥ - ä¾èµ–ç¼ºå¤±

**é”™è¯¯ä¿¡æ¯**ï¼š
```
Cannot find module 'xxx'
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ¸…ç†å¹¶é‡æ–°å®‰è£…ä¾èµ–
rm -rf node_modules package-lock.json
npm install

# é‡æ–°ç¼–è¯‘
npm run build
```

### Q3: TypeScript ç¼–è¯‘é”™è¯¯

**é”™è¯¯ä¿¡æ¯**ï¼š
```
error TS2307: Cannot find module 'xxx'
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥ tsconfig.json é…ç½®
cat tsconfig.json

# ç¡®ä¿æ‰€æœ‰ç±»å‹å®šä¹‰å·²å®‰è£…
npm install --save-dev @types/node @types/react

# é‡æ–°ç¼–è¯‘
npm run build
```

### Q4: Vite ç¼–è¯‘è­¦å‘Š

**è­¦å‘Šä¿¡æ¯**ï¼š
```
(!) Some chunks are larger than 500 KiB after minification
```

**è¯´æ˜**ï¼šè¿™æ˜¯æ­£å¸¸çš„è­¦å‘Šï¼Œä¸å½±å“è¿è¡Œã€‚å¦‚éœ€ä¼˜åŒ–ï¼š

```bash
# åœ¨ vite.config.ts ä¸­é…ç½®ä»£ç åˆ†å‰²
build: {
  rollupOptions: {
    output: {
      manualChunks: {
        'react-vendor': ['react', 'react-dom'],
        'antd-vendor': ['antd']
      }
    }
  }
}
```

## ğŸ” éªŒè¯ç¼–è¯‘ç»“æœ

### æ£€æŸ¥ç¼–è¯‘è¾“å‡º

```bash
# æ£€æŸ¥å‰ç«¯ç¼–è¯‘è¾“å‡º
ls -lh client/dist/
# åº”è¯¥çœ‹åˆ°ï¼šindex.html, assets/

# æ£€æŸ¥åç«¯ç¼–è¯‘è¾“å‡º
ls -lh server/dist/
# åº”è¯¥çœ‹åˆ°ï¼šindex.js, routes/, services/, ç­‰

# æ£€æŸ¥è¥é”€ç½‘ç«™ç¼–è¯‘è¾“å‡º
ls -lh landing/dist/
# åº”è¯¥çœ‹åˆ°ï¼šindex.html, assets/
```

### æµ‹è¯•ç¼–è¯‘åçš„ä»£ç 

```bash
# æµ‹è¯•åç«¯
cd server
node dist/index.js
# åº”è¯¥çœ‹åˆ°ï¼šæœåŠ¡å™¨å¯åŠ¨ä¿¡æ¯

# æµ‹è¯•å‰ç«¯ï¼ˆéœ€è¦ HTTP æœåŠ¡å™¨ï¼‰
cd client
npx serve dist
# è®¿é—®ï¼šhttp://localhost:3000
```

## ğŸ“ ç¼–è¯‘è„šæœ¬è¯´æ˜

### package.json ä¸­çš„ç¼–è¯‘å‘½ä»¤

```json
{
  "scripts": {
    "build": "npm run build:client && npm run build:server && npm run build:landing",
    "build:client": "cd client && npm run build",
    "build:server": "cd server && npm run build",
    "build:landing": "cd landing && npm run build"
  }
}
```

### å„é¡¹ç›®çš„ç¼–è¯‘å‘½ä»¤

**client/package.json**ï¼š
```json
{
  "scripts": {
    "build": "vite build"
  }
}
```

**server/package.json**ï¼š
```json
{
  "scripts": {
    "build": "tsc"
  }
}
```

**landing/package.json**ï¼š
```json
{
  "scripts": {
    "build": "vite build"
  }
}
```

## ğŸ¯ éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] æœ¬åœ°ç¼–è¯‘æˆåŠŸï¼ˆclient, server, landingï¼‰
- [ ] ç¼–è¯‘è¾“å‡ºç›®å½•å­˜åœ¨ï¼ˆdist/ï¼‰
- [ ] æ‰“åŒ…æ–‡ä»¶å·²åˆ›å»ºï¼ˆ.tar.gzï¼‰
- [ ] æ–‡ä»¶å·²ä¸Šä¼ åˆ°æœåŠ¡å™¨
- [ ] æœåŠ¡å™¨å·²è§£å‹æ–‡ä»¶
- [ ] åç«¯ä¾èµ–å·²å®‰è£…ï¼ˆnpm ci --productionï¼‰
- [ ] ç¯å¢ƒå˜é‡å·²é…ç½®ï¼ˆ.envï¼‰
- [ ] æ•°æ®åº“è¿ç§»å·²è¿è¡Œ
- [ ] PM2 æœåŠ¡å·²å¯åŠ¨
- [ ] Nginx é…ç½®å·²å®Œæˆ
- [ ] æœåŠ¡å¯ä»¥æ­£å¸¸è®¿é—®

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [README.md](../../README.md) - å®Œæ•´éƒ¨ç½²æŒ‡å—
- [è…¾è®¯äº‘å¿«é€Ÿéƒ¨ç½²æŒ‡å—](./è…¾è®¯äº‘å¿«é€Ÿéƒ¨ç½²æŒ‡å—.md)
- [éƒ¨ç½²æ–¹å¼å¯¹æ¯”æŒ‡å—](./éƒ¨ç½²æ–¹å¼å¯¹æ¯”æŒ‡å—.md)

## ğŸ‰ æ€»ç»“

**éœ€è¦ç¼–è¯‘çš„é¡¹ç›®ï¼š**
1. âœ… client/ - å‰ç«¯åº”ç”¨
2. âœ… server/ - åç«¯åº”ç”¨
3. âœ… landing/ - è¥é”€ç½‘ç«™

**ç¼–è¯‘å‘½ä»¤ï¼š**
```bash
npm run build  # ä¸€é”®ç¼–è¯‘æ‰€æœ‰é¡¹ç›®
```

**ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼š**
- âœ… client/dist/
- âœ… server/dist/
- âœ… landing/dist/
- âœ… server/package.json
- âœ… config/

**ä¸éœ€è¦ä¸Šä¼ ï¼š**
- âŒ client/src/
- âŒ server/src/
- âŒ landing/src/
- âŒ node_modules/
- âŒ .git/

---

**æ›´æ–°æ—¶é—´ï¼š** 2024å¹´12æœˆ26æ—¥  
**çŠ¶æ€ï¼š** âœ… ç¼–è¯‘æŒ‡å—å®Œæˆ
