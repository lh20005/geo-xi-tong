# å¿«é€Ÿç¼–è¯‘éƒ¨ç½²å‚è€ƒ

## ğŸš€ ä¸€é”®ç¼–è¯‘å’Œéƒ¨ç½²

### æ–¹å¼ä¸€ï¼šä½¿ç”¨è„šæœ¬ï¼ˆæ¨èï¼‰âš¡

```bash
# 1. ç¼–è¯‘æ‰€æœ‰é¡¹ç›®
./scripts/deployment/build-all.sh

# 2. æ‰“åŒ…éƒ¨ç½²æ–‡ä»¶
./scripts/deployment/package-for-deploy.sh

# 3. ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp deploy-packages/*.tar.gz ubuntu@YOUR_SERVER_IP:/var/www/geo-system/
scp deploy-packages/.env.example ubuntu@YOUR_SERVER_IP:/var/www/geo-system/
```

### æ–¹å¼äºŒï¼šä½¿ç”¨ npm å‘½ä»¤

```bash
# 1. ç¼–è¯‘æ‰€æœ‰é¡¹ç›®
npm run build

# 2. æ‰‹åŠ¨æ‰“åŒ…
cd client && tar -czf ../client-dist.tar.gz dist package.json && cd ..
cd server && tar -czf ../server-dist.tar.gz dist package.json package-lock.json && cd ..
cd landing && tar -czf ../landing-dist.tar.gz dist package.json && cd ..
tar -czf config.tar.gz config/

# 3. ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp *.tar.gz ubuntu@YOUR_SERVER_IP:/var/www/geo-system/
```

## ğŸ“‹ éœ€è¦ç¼–è¯‘çš„é¡¹ç›®

| é¡¹ç›® | æºä»£ç  | ç¼–è¯‘å·¥å…· | è¾“å‡ºç›®å½• | ä¸Šä¼  |
|------|--------|---------|---------|------|
| **å‰ç«¯åº”ç”¨** | client/src/ | Vite | client/dist/ | âœ… |
| **åç«¯åº”ç”¨** | server/src/ | TypeScript | server/dist/ | âœ… |
| **è¥é”€ç½‘ç«™** | landing/src/ | Vite | landing/dist/ | âœ… |

## ğŸ”§ ç¼–è¯‘å‘½ä»¤é€ŸæŸ¥

```bash
# ç¼–è¯‘æ‰€æœ‰é¡¹ç›®
npm run build

# å•ç‹¬ç¼–è¯‘å‰ç«¯
npm run client:build
# æˆ–
cd client && npm run build

# å•ç‹¬ç¼–è¯‘åç«¯
npm run server:build
# æˆ–
cd server && npm run build

# å•ç‹¬ç¼–è¯‘è¥é”€ç½‘ç«™
npm run landing:build
# æˆ–
cd landing && npm run build
```

## ğŸ“¦ éœ€è¦ä¸Šä¼ çš„æ–‡ä»¶

### âœ… å¿…é¡»ä¸Šä¼ 

```
client/dist/              # å‰ç«¯ç¼–è¯‘è¾“å‡º
server/dist/              # åç«¯ç¼–è¯‘è¾“å‡º
landing/dist/             # è¥é”€ç½‘ç«™ç¼–è¯‘è¾“å‡º
server/package.json       # åç«¯ä¾èµ–é…ç½®
server/package-lock.json  # åç«¯ä¾èµ–é”å®š
config/nginx/             # Nginx é…ç½®
.env                      # ç¯å¢ƒå˜é‡ï¼ˆæ‰‹åŠ¨é…ç½®ï¼‰
```

### âŒ ä¸éœ€è¦ä¸Šä¼ 

```
client/src/               # å‰ç«¯æºä»£ç 
server/src/               # åç«¯æºä»£ç 
landing/src/              # è¥é”€ç½‘ç«™æºä»£ç 
node_modules/             # ä¾èµ–åŒ…ï¼ˆæœåŠ¡å™¨ä¸Šå®‰è£…ï¼‰
.git/                     # Git ä»“åº“
docs/                     # æ–‡æ¡£ï¼ˆå¯é€‰ï¼‰
dev-docs/                 # å¼€å‘æ–‡æ¡£
scripts/                  # è„šæœ¬ï¼ˆå¯é€‰ï¼‰
```

## ğŸ–¥ï¸ æœåŠ¡å™¨éƒ¨ç½²æ­¥éª¤

### 1. è§£å‹æ–‡ä»¶

```bash
cd /var/www/geo-system
tar -xzf client-dist.tar.gz
tar -xzf server-dist.tar.gz
tar -xzf landing-dist.tar.gz
tar -xzf config.tar.gz
```

### 2. å®‰è£…åç«¯ä¾èµ–

```bash
cd /var/www/geo-system/server
npm ci --production
```

### 3. é…ç½®ç¯å¢ƒå˜é‡

```bash
cd /var/www/geo-system
cp .env.example .env
nano .env
# ä¿®æ”¹æ•°æ®åº“ã€APIå¯†é’¥ç­‰é…ç½®
```

### 4. è¿è¡Œæ•°æ®åº“è¿ç§»

```bash
cd /var/www/geo-system/server
npm run db:migrate
```

### 5. å¯åŠ¨æœåŠ¡

```bash
cd /var/www/geo-system/server
pm2 start dist/index.js --name geo-backend
pm2 save
```

### 6. é…ç½® Nginx

```bash
sudo cp /var/www/geo-system/config/nginx/nginx.conf.example /etc/nginx/sites-available/geo-system
sudo nano /etc/nginx/sites-available/geo-system
# ä¿®æ”¹åŸŸåå’Œè·¯å¾„

sudo ln -s /etc/nginx/sites-available/geo-system /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
```

## âš¡ å¿«é€Ÿæ›´æ–°éƒ¨ç½²

å½“ä»£ç æ›´æ–°åï¼Œåªéœ€é‡æ–°ç¼–è¯‘å’Œä¸Šä¼ ï¼š

```bash
# æœ¬åœ°
npm run build
./scripts/deployment/package-for-deploy.sh
scp deploy-packages/*.tar.gz ubuntu@YOUR_SERVER_IP:/var/www/geo-system/

# æœåŠ¡å™¨
cd /var/www/geo-system
tar -xzf client-dist.tar.gz
tar -xzf server-dist.tar.gz
tar -xzf landing-dist.tar.gz
pm2 restart geo-backend
sudo systemctl reload nginx
```

## ğŸ” éªŒè¯ç¼–è¯‘ç»“æœ

```bash
# æ£€æŸ¥ç¼–è¯‘è¾“å‡ºæ˜¯å¦å­˜åœ¨
ls -la client/dist/
ls -la server/dist/
ls -la landing/dist/

# æ£€æŸ¥ç¼–è¯‘è¾“å‡ºå¤§å°
du -sh client/dist/
du -sh server/dist/
du -sh landing/dist/

# æ£€æŸ¥æ‰“åŒ…æ–‡ä»¶
ls -lh deploy-packages/
```

## âš ï¸ å¸¸è§é—®é¢˜

### Q: ç¼–è¯‘å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

```bash
# 1. æ¸…ç†ä¾èµ–
rm -rf node_modules package-lock.json
rm -rf client/node_modules client/package-lock.json
rm -rf server/node_modules server/package-lock.json
rm -rf landing/node_modules landing/package-lock.json

# 2. é‡æ–°å®‰è£…
npm run install:all

# 3. é‡æ–°ç¼–è¯‘
npm run build
```

### Q: ç¼–è¯‘åæ–‡ä»¶å¤ªå¤§ï¼Ÿ

ç¼–è¯‘åçš„æ–‡ä»¶å·²ç»è¿‡å‹ç¼©å’Œä¼˜åŒ–ï¼Œè¿™æ˜¯æ­£å¸¸çš„ã€‚å¦‚æœéœ€è¦è¿›ä¸€æ­¥ä¼˜åŒ–ï¼š

```bash
# æ£€æŸ¥å¤§æ–‡ä»¶
du -sh client/dist/* | sort -h
du -sh server/dist/* | sort -h

# Vite ä¼šè‡ªåŠ¨è¿›è¡Œä»£ç åˆ†å‰²å’Œå‹ç¼©
# TypeScript ç¼–è¯‘ä¹Ÿä¼šç§»é™¤ç±»å‹ä¿¡æ¯
```

### Q: ä¸Šä¼ é€Ÿåº¦æ…¢ï¼Ÿ

```bash
# ä½¿ç”¨å‹ç¼©ä¼ è¾“
scp -C deploy-packages/*.tar.gz ubuntu@YOUR_SERVER_IP:/var/www/geo-system/

# æˆ–ä½¿ç”¨ rsync
rsync -avz --progress deploy-packages/ ubuntu@YOUR_SERVER_IP:/var/www/geo-system/
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ç¼–è¯‘å’Œéƒ¨ç½²å®Œæ•´æŒ‡å—](./ç¼–è¯‘å’Œéƒ¨ç½²å®Œæ•´æŒ‡å—.md) - è¯¦ç»†è¯´æ˜
- [è…¾è®¯äº‘å¿«é€Ÿéƒ¨ç½²æŒ‡å—](./è…¾è®¯äº‘å¿«é€Ÿéƒ¨ç½²æŒ‡å—.md) - å®Œæ•´éƒ¨ç½²æµç¨‹
- [README.md](../../README.md) - é¡¹ç›®è¯´æ˜

## ğŸ¯ æ€»ç»“

**ç¼–è¯‘å‘½ä»¤ï¼š**
```bash
npm run build  # ä¸€é”®ç¼–è¯‘æ‰€æœ‰é¡¹ç›®
```

**æ‰“åŒ…å‘½ä»¤ï¼š**
```bash
./scripts/deployment/package-for-deploy.sh  # ä¸€é”®æ‰“åŒ…
```

**ä¸Šä¼ å‘½ä»¤ï¼š**
```bash
scp deploy-packages/*.tar.gz ubuntu@YOUR_SERVER_IP:/var/www/geo-system/
```

**æœåŠ¡å™¨éƒ¨ç½²ï¼š**
```bash
# è§£å‹ â†’ å®‰è£…ä¾èµ– â†’ é…ç½®ç¯å¢ƒ â†’ å¯åŠ¨æœåŠ¡
```

---

**æ›´æ–°æ—¶é—´ï¼š** 2024å¹´12æœˆ26æ—¥  
**çŠ¶æ€ï¼š** âœ… å¿«é€Ÿå‚è€ƒæŒ‡å—å®Œæˆ
