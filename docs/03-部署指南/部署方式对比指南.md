# éƒ¨ç½²æ–¹å¼å¯¹æ¯”æŒ‡å—

## ğŸ“Š å¤æ‚åº¦å¯¹æ¯”

| ç»´åº¦ | ç¼–è¯‘åéƒ¨ç½² | Docker éƒ¨ç½² |
|------|-----------|------------|
| **åˆæ¬¡å­¦ä¹ ** | ğŸŸ¢ ç®€å• | ğŸŸ¡ ä¸­ç­‰ |
| **é…ç½®æ–‡ä»¶** | 1-2 ä¸ª | 3-4 ä¸ª |
| **éƒ¨ç½²æ­¥éª¤** | 5-8 æ­¥ | 3-5 æ­¥ |
| **ç¯å¢ƒä¾èµ–** | ğŸ”´ å¤š | ğŸŸ¢ å°‘ |
| **æ›´æ–°éƒ¨ç½²** | ğŸŸ¡ ä¸­ç­‰ | ğŸŸ¢ ç®€å• |
| **å›æ»š** | ğŸ”´ å›°éš¾ | ğŸŸ¢ ç®€å• |
| **å¤šç¯å¢ƒ** | ğŸ”´ å›°éš¾ | ğŸŸ¢ ç®€å• |
| **å›¢é˜Ÿåä½œ** | ğŸŸ¡ ä¸­ç­‰ | ğŸŸ¢ ç®€å• |

## æ–¹æ¡ˆä¸€ï¼šç¼–è¯‘åéƒ¨ç½²

### ä¼˜ç‚¹ âœ…
- ä¸éœ€è¦å­¦ä¹  Docker
- ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œ
- è°ƒè¯•ç›¸å¯¹ç®€å•
- èµ„æºå ç”¨å°‘

### ç¼ºç‚¹ âŒ
- éœ€è¦æ‰‹åŠ¨é…ç½®ç¯å¢ƒï¼ˆNode.jsã€PostgreSQLã€Redisï¼‰
- ä¾èµ–æœåŠ¡å™¨ç¯å¢ƒ
- æ›´æ–°éº»çƒ¦ï¼ˆéœ€è¦æ‰‹åŠ¨å¤‡ä»½ã€ä¸Šä¼ ã€é‡å¯ï¼‰
- éš¾ä»¥å›æ»š
- å¤šæœåŠ¡å™¨éƒ¨ç½²éœ€è¦é‡å¤é…ç½®

### éƒ¨ç½²æ­¥éª¤ï¼ˆ8 æ­¥ï¼‰

#### 1. æœ¬åœ°ç¼–è¯‘
```bash
# ç¼–è¯‘åç«¯
cd server
npm install
npm run build  # ç”Ÿæˆ dist/ ç›®å½•

# ç¼–è¯‘å‰ç«¯
cd ../client
npm install
npm run build  # ç”Ÿæˆ dist/ ç›®å½•

# ç¼–è¯‘ landing é¡µ
cd ../landing
npm install
npm run build  # ç”Ÿæˆ dist/ ç›®å½•
```

#### 2. ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨
```bash
# ä½¿ç”¨ scp ä¸Šä¼ 
scp -r server/dist user@server:/var/www/app/server/
scp -r server/package*.json user@server:/var/www/app/server/
scp -r client/dist user@server:/var/www/app/client/
scp -r landing/dist user@server:/var/www/app/landing/
```

#### 3. æœåŠ¡å™¨å®‰è£…ä¾èµ–
```bash
ssh user@server

# å®‰è£… Node.jsï¼ˆå¦‚æœæ²¡æœ‰ï¼‰
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# å®‰è£… PostgreSQLï¼ˆå¦‚æœæ²¡æœ‰ï¼‰
sudo apt-get install postgresql postgresql-contrib

# å®‰è£… Redisï¼ˆå¦‚æœæ²¡æœ‰ï¼‰
sudo apt-get install redis-server

# å®‰è£…é¡¹ç›®ä¾èµ–
cd /var/www/app/server
npm ci --production
```

#### 4. é…ç½®ç¯å¢ƒå˜é‡
```bash
# åˆ›å»º .env æ–‡ä»¶
nano /var/www/app/.env

# ç²˜è´´é…ç½®
DATABASE_URL=postgresql://...
JWT_SECRET=...
# ... å…¶ä»–é…ç½®
```

#### 5. é…ç½®æ•°æ®åº“
```bash
# åˆ›å»ºæ•°æ®åº“
sudo -u postgres psql
CREATE DATABASE geo_system;
CREATE USER geo_user WITH PASSWORD 'password';
GRANT ALL PRIVILEGES ON DATABASE geo_system TO geo_user;
\q

# è¿è¡Œè¿ç§»
cd /var/www/app/server
npm run migrate  # å¦‚æœæœ‰è¿ç§»è„šæœ¬
```

#### 6. é…ç½® PM2ï¼ˆè¿›ç¨‹ç®¡ç†ï¼‰
```bash
# å®‰è£… PM2
sudo npm install -g pm2

# å¯åŠ¨åº”ç”¨
cd /var/www/app/server
pm2 start dist/index.js --name geo-backend

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
pm2 save
```

#### 7. é…ç½® Nginx
```bash
# åˆ›å»ºé…ç½®æ–‡ä»¶
sudo nano /etc/nginx/sites-available/geo-system

# ç²˜è´´é…ç½®ï¼ˆè§ä¸‹æ–¹ï¼‰
# ...

# å¯ç”¨ç«™ç‚¹
sudo ln -s /etc/nginx/sites-available/geo-system /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

#### 8. é…ç½® SSL
```bash
# å®‰è£… Certbot
sudo apt-get install certbot python3-certbot-nginx

# è·å–è¯ä¹¦
sudo certbot --nginx -d your-domain.com
```

### æ›´æ–°éƒ¨ç½²ï¼ˆæ¯æ¬¡éƒ½è¦åšï¼‰
```bash
# 1. æœ¬åœ°ç¼–è¯‘
npm run build

# 2. å¤‡ä»½æœåŠ¡å™¨æ–‡ä»¶
ssh user@server "cp -r /var/www/app/server/dist /var/www/app/server/dist.backup"

# 3. ä¸Šä¼ æ–°æ–‡ä»¶
scp -r server/dist user@server:/var/www/app/server/

# 4. é‡å¯æœåŠ¡
ssh user@server "pm2 restart geo-backend"

# 5. æ£€æŸ¥æ—¥å¿—
ssh user@server "pm2 logs geo-backend"
```

### æ€»è€—æ—¶
- **é¦–æ¬¡éƒ¨ç½²**ï¼š2-4 å°æ—¶ï¼ˆåŒ…æ‹¬å­¦ä¹ å’Œé…ç½®ï¼‰
- **æ›´æ–°éƒ¨ç½²**ï¼š10-20 åˆ†é’Ÿ

---

## æ–¹æ¡ˆäºŒï¼šDocker éƒ¨ç½²

### ä¼˜ç‚¹ âœ…
- ç¯å¢ƒä¸€è‡´æ€§ï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§å®Œå…¨ä¸€è‡´ï¼‰
- ä¸€é”®éƒ¨ç½²
- è½»æ¾å›æ»š
- æ˜“äºæ‰©å±•ï¼ˆå¤šå®¹å™¨ã€è´Ÿè½½å‡è¡¡ï¼‰
- å›¢é˜Ÿåä½œå‹å¥½

### ç¼ºç‚¹ âŒ
- éœ€è¦å­¦ä¹  Docker åŸºç¡€
- éœ€è¦ç¼–å†™ Dockerfile å’Œ docker-compose.yml
- èµ„æºå ç”¨ç¨å¤šï¼ˆä½†å¯å¿½ç•¥ï¼‰

### éƒ¨ç½²æ­¥éª¤ï¼ˆ5 æ­¥ï¼‰

#### 1. åˆ›å»º Dockerfileï¼ˆä¸€æ¬¡æ€§ï¼‰

**server/Dockerfileï¼š**
```dockerfile
# å¤šé˜¶æ®µæ„å»º
FROM node:18-alpine AS builder

WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

# ç”Ÿäº§é•œåƒ
FROM node:18-alpine

WORKDIR /app
COPY --from=builder /app/dist ./dist
COPY --from=builder /app/package*.json ./
RUN npm ci --production

USER node
EXPOSE 3000

CMD ["node", "dist/index.js"]
```

**client/Dockerfileï¼š**
```dockerfile
FROM node:18-alpine AS builder

WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

# Nginx é•œåƒ
FROM nginx:alpine

COPY --from=builder /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80
```

**landing/Dockerfileï¼š**
```dockerfile
FROM node:18-alpine AS builder

WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

FROM nginx:alpine

COPY --from=builder /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80
```

#### 2. åˆ›å»º docker-compose.ymlï¼ˆä¸€æ¬¡æ€§ï¼‰

```yaml
version: '3.8'

services:
  # PostgreSQL æ•°æ®åº“
  postgres:
    image: postgres:14-alpine
    container_name: geo-postgres
    environment:
      POSTGRES_DB: geo_system
      POSTGRES_USER: geo_user
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - geo-network
    restart: unless-stopped

  # Redis
  redis:
    image: redis:7-alpine
    container_name: geo-redis
    networks:
      - geo-network
    restart: unless-stopped

  # åç«¯æœåŠ¡
  backend:
    build:
      context: ./server
      dockerfile: Dockerfile
    container_name: geo-backend
    environment:
      DATABASE_URL: postgresql://geo_user:${DB_PASSWORD}@postgres:5432/geo_system
      REDIS_URL: redis://redis:6379
      JWT_SECRET: ${JWT_SECRET}
      DEEPSEEK_API_KEY: ${DEEPSEEK_API_KEY}
      NODE_ENV: production
    depends_on:
      - postgres
      - redis
    networks:
      - geo-network
    restart: unless-stopped

  # å‰ç«¯æœåŠ¡
  frontend:
    build:
      context: ./client
      dockerfile: Dockerfile
    container_name: geo-frontend
    ports:
      - "80:80"
    depends_on:
      - backend
    networks:
      - geo-network
    restart: unless-stopped

  # Landing é¡µ
  landing:
    build:
      context: ./landing
      dockerfile: Dockerfile
    container_name: geo-landing
    ports:
      - "8080:80"
    networks:
      - geo-network
    restart: unless-stopped

volumes:
  postgres_data:

networks:
  geo-network:
    driver: bridge
```

#### 3. åˆ›å»º .env æ–‡ä»¶
```bash
# .env
DB_PASSWORD=your_secure_password
JWT_SECRET=your_jwt_secret
DEEPSEEK_API_KEY=your_api_key
```

#### 4. éƒ¨ç½²åˆ°æœåŠ¡å™¨
```bash
# æ–¹å¼ Aï¼šç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šæ„å»º
scp -r . user@server:/var/www/app/
ssh user@server
cd /var/www/app
docker-compose up -d

# æ–¹å¼ Bï¼šæœ¬åœ°æ„å»ºï¼Œæ¨é€é•œåƒ
docker-compose build
docker-compose push  # æ¨é€åˆ° Docker Hub æˆ–ç§æœ‰ä»“åº“
# åœ¨æœåŠ¡å™¨ä¸Š
docker-compose pull
docker-compose up -d
```

#### 5. é…ç½® Nginxï¼ˆå¯é€‰ï¼Œç”¨äº HTTPSï¼‰
```bash
# å¦‚æœéœ€è¦ HTTPSï¼Œåœ¨å®¿ä¸»æœºé…ç½® Nginx åå‘ä»£ç†
sudo nano /etc/nginx/sites-available/geo-system

# é…ç½®åå‘ä»£ç†åˆ° Docker å®¹å™¨
# ...

sudo certbot --nginx -d your-domain.com
```

### æ›´æ–°éƒ¨ç½²ï¼ˆè¶…ç®€å•ï¼ï¼‰
```bash
# æ–¹å¼ Aï¼šåœ¨æœåŠ¡å™¨ä¸Š
ssh user@server
cd /var/www/app
git pull  # å¦‚æœä½¿ç”¨ Git
docker-compose up -d --build

# æ–¹å¼ Bï¼šæœ¬åœ°æ¨é€
docker-compose build
docker-compose push
ssh user@server "cd /var/www/app && docker-compose pull && docker-compose up -d"
```

### å›æ»šï¼ˆè¶…ç®€å•ï¼ï¼‰
```bash
# æŸ¥çœ‹é•œåƒå†å²
docker images

# å›æ»šåˆ°ä¹‹å‰çš„ç‰ˆæœ¬
docker-compose down
docker tag geo-backend:latest geo-backend:backup
docker tag geo-backend:v1.0 geo-backend:latest
docker-compose up -d
```

### æ€»è€—æ—¶
- **é¦–æ¬¡éƒ¨ç½²**ï¼š1-2 å°æ—¶ï¼ˆåŒ…æ‹¬å­¦ä¹  Docker åŸºç¡€ï¼‰
- **æ›´æ–°éƒ¨ç½²**ï¼š2-5 åˆ†é’Ÿ
- **å›æ»š**ï¼š1 åˆ†é’Ÿ

---

## ğŸ¯ æ¨èæ–¹æ¡ˆ

### å¦‚æœä½ æ˜¯æ–°æ‰‹ â†’ ç¼–è¯‘åéƒ¨ç½²
**ç†ç”±ï¼š**
- ä¸éœ€è¦å­¦ä¹ æ–°æŠ€æœ¯
- æ­¥éª¤æ¸…æ™°ï¼Œå®¹æ˜“ç†è§£
- å‡ºé—®é¢˜å®¹æ˜“æ’æŸ¥

**é€‚åˆåœºæ™¯ï¼š**
- ä¸ªäººé¡¹ç›®
- å•æœåŠ¡å™¨éƒ¨ç½²
- ä¸é¢‘ç¹æ›´æ–°

### å¦‚æœä½ æƒ³é•¿æœŸç»´æŠ¤ â†’ Docker éƒ¨ç½²
**ç†ç”±ï¼š**
- ä¸€æ¬¡é…ç½®ï¼Œç»ˆèº«å—ç›Š
- æ›´æ–°è¶…çº§ç®€å•
- ç¯å¢ƒä¸€è‡´ï¼Œä¸ä¼šå‡ºç°"æˆ‘è¿™èƒ½è·‘"çš„é—®é¢˜
- æ˜“äºæ‰©å±•

**é€‚åˆåœºæ™¯ï¼š**
- å›¢é˜Ÿé¡¹ç›®
- å¤šç¯å¢ƒéƒ¨ç½²ï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰
- é¢‘ç¹æ›´æ–°
- éœ€è¦å¿«é€Ÿå›æ»š

---

## ğŸ“‹ å¿«é€Ÿå†³ç­–è¡¨

| ä½ çš„æƒ…å†µ | æ¨èæ–¹æ¡ˆ |
|---------|---------|
| ä»æœªç”¨è¿‡ Docker | ç¼–è¯‘åéƒ¨ç½² |
| æ„¿æ„å­¦ä¹  1-2 å°æ—¶ Docker | Docker éƒ¨ç½² |
| åªéƒ¨ç½²ä¸€æ¬¡ï¼Œå¾ˆå°‘æ›´æ–° | ç¼–è¯‘åéƒ¨ç½² |
| ç»å¸¸æ›´æ–°ä»£ç  | Docker éƒ¨ç½² |
| å•æœåŠ¡å™¨ | ç¼–è¯‘åéƒ¨ç½² |
| å¤šæœåŠ¡å™¨æˆ–éœ€è¦æ‰©å±• | Docker éƒ¨ç½² |
| ä¸ªäººé¡¹ç›® | ç¼–è¯‘åéƒ¨ç½² |
| å›¢é˜Ÿé¡¹ç›® | Docker éƒ¨ç½² |

---

## ğŸš€ æˆ‘çš„å»ºè®®

### çŸ­æœŸï¼ˆç°åœ¨ï¼‰
**ä½¿ç”¨ç¼–è¯‘åéƒ¨ç½²**
- å¿«é€Ÿä¸Šçº¿
- ä¸éœ€è¦å­¦ä¹ æ–°ä¸œè¥¿
- æ»¡è¶³åŸºæœ¬éœ€æ±‚

### é•¿æœŸï¼ˆæœªæ¥ï¼‰
**è¿ç§»åˆ° Docker**
- èŠ± 1-2 å°æ—¶å­¦ä¹  Docker åŸºç¡€
- é…ç½®å¥½ Dockerfile å’Œ docker-compose.yml
- äº«å—ä¸€é”®éƒ¨ç½²çš„ä¾¿åˆ©

### å­¦ä¹ è·¯å¾„
```
1. å…ˆç”¨ç¼–è¯‘åéƒ¨ç½²ä¸Šçº¿ï¼ˆ1 å¤©ï¼‰
   â†“
2. ç³»ç»Ÿç¨³å®šè¿è¡Œåï¼Œå­¦ä¹  Dockerï¼ˆ1-2 å°æ—¶ï¼‰
   â†“
3. åœ¨æµ‹è¯•ç¯å¢ƒå°è¯• Docker éƒ¨ç½²ï¼ˆåŠå¤©ï¼‰
   â†“
4. è¿ç§»ç”Ÿäº§ç¯å¢ƒåˆ° Dockerï¼ˆ1 å°æ—¶ï¼‰
```

---

## ğŸ’¡ å®é™…å¯¹æ¯”

### åœºæ™¯ï¼šä¿®å¤ä¸€ä¸ª Bug å¹¶éƒ¨ç½²

**ç¼–è¯‘åéƒ¨ç½²ï¼š**
```bash
# 1. ä¿®æ”¹ä»£ç 
vim server/src/xxx.ts

# 2. æœ¬åœ°ç¼–è¯‘
cd server && npm run build

# 3. å¤‡ä»½æœåŠ¡å™¨
ssh user@server "cp -r /var/www/app/server/dist /var/www/app/server/dist.backup"

# 4. ä¸Šä¼ 
scp -r server/dist user@server:/var/www/app/server/

# 5. é‡å¯
ssh user@server "pm2 restart geo-backend"

# 6. æ£€æŸ¥æ—¥å¿—
ssh user@server "pm2 logs geo-backend --lines 50"

# æ€»è€—æ—¶ï¼š10-15 åˆ†é’Ÿ
```

**Docker éƒ¨ç½²ï¼š**
```bash
# 1. ä¿®æ”¹ä»£ç 
vim server/src/xxx.ts

# 2. æäº¤ä»£ç 
git add . && git commit -m "fix: xxx"

# 3. éƒ¨ç½²
ssh user@server "cd /var/www/app && git pull && docker-compose up -d --build backend"

# 4. æ£€æŸ¥æ—¥å¿—
ssh user@server "docker logs geo-backend --tail 50"

# æ€»è€—æ—¶ï¼š3-5 åˆ†é’Ÿ
```

---

## ğŸ“ æ€»ç»“

| ç»´åº¦ | ç¼–è¯‘åéƒ¨ç½² | Docker éƒ¨ç½² |
|------|-----------|------------|
| **å­¦ä¹ æˆæœ¬** | ä½ | ä¸­ |
| **é¦–æ¬¡éƒ¨ç½²** | éº»çƒ¦ | ä¸­ç­‰ |
| **æ—¥å¸¸æ›´æ–°** | éº»çƒ¦ | ç®€å• |
| **å›æ»š** | å¾ˆéº»çƒ¦ | è¶…ç®€å• |
| **é•¿æœŸç»´æŠ¤** | éº»çƒ¦ | ç®€å• |
| **å›¢é˜Ÿåä½œ** | éº»çƒ¦ | ç®€å• |

**ç»“è®ºï¼š**
- **ç°åœ¨æƒ³å¿«é€Ÿä¸Šçº¿** â†’ ç¼–è¯‘åéƒ¨ç½²
- **é•¿æœŸè€ƒè™‘** â†’ Docker éƒ¨ç½²ï¼ˆå€¼å¾—å­¦ä¹ ï¼‰
- **æœ€ä½³æ–¹æ¡ˆ** â†’ å…ˆç¼–è¯‘åéƒ¨ç½²ä¸Šçº¿ï¼Œç„¶åå­¦ä¹  Docker å¹¶è¿ç§»

Docker çœ‹èµ·æ¥å¤æ‚ï¼Œä½†é…ç½®å¥½åï¼Œæ—¥å¸¸ä½¿ç”¨æ¯”ç¼–è¯‘åéƒ¨ç½²ç®€å•å¾—å¤šï¼
