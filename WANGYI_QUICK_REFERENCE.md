# ç½‘æ˜“å·é€‚é…å™¨ - å¿«é€Ÿå‚è€ƒ

## åŸºæœ¬ä¿¡æ¯

| é¡¹ç›® | å€¼ |
|------|-----|
| å¹³å°åç§° | ç½‘æ˜“å· |
| Platform ID | `wangyi` |
| é€‚é…å™¨ç±» | `WangyiAdapter` |
| æ–‡ä»¶ä½ç½® | `server/src/services/adapters/WangyiAdapter.ts` |
| ç™»å½• URL | https://mp.163.com/login.html |
| å‘å¸ƒ URL | https://mp.163.com/subscribe_v4/index.html#/ |
| çŠ¶æ€ | âœ… å·²å®Œæˆ |

## å…³é”®é€‰æ‹©å™¨

```typescript
// ç™»å½•çŠ¶æ€æ£€æµ‹
'.topBar__user'                                    // ç”¨æˆ·åŒºåŸŸ

// å‘å¸ƒæµç¨‹é€‰æ‹©å™¨
'button'                                           // ç¬¬ä¸€ä¸ªæŒ‰é’®
'text=æ–‡ç« '                                        // æ–‡ç« æŒ‰é’®
'textbox[name="è¯·è¾“å…¥æ ‡é¢˜ (5~30ä¸ªå­—)"]'            // æ ‡é¢˜è¾“å…¥
'.public-DraftStyleDefault-block'                  // æ­£æ–‡ç¼–è¾‘å™¨
'button[name="è¯·è¾“å…¥æ­£æ–‡"] textbox'                // æ­£æ–‡è¾“å…¥æ¡†
'button[name="å›¾ç‰‡"]'                              // å›¾ç‰‡æŒ‰é’®
'div:has-text("è¯·ä¸Šä¼ å¤§äº160x160çš„å›¾ç‰‡")'          // ä¸Šä¼ åŒºåŸŸ
'button[name="ç¡®å®š(1)"]'                           // ç¡®å®šæŒ‰é’®
'radio[name="å•å›¾"]'                               // å•å›¾é€‰é¡¹
'.cover-picture__item-img'                         // å°é¢å›¾ç‰‡
'.box-trigger.custom-switcher'                     // å£°æ˜å¼€å…³
'text=é€‰æ‹©å£°æ˜å†…å®¹'                                // å£°æ˜é€‰æ‹©
'text=ä¸ªäººåŸåˆ›ï¼Œä»…ä¾›å‚è€ƒ'                          // åŸåˆ›é€‰é¡¹
'button[name="å‘å¸ƒ"][exact]'                       // å‘å¸ƒæŒ‰é’®
```

## å‘å¸ƒæµç¨‹ï¼ˆ15æ­¥ï¼‰

```
1. ç‚¹å‡»æŒ‰é’®
   â†“
2. ç‚¹å‡»"æ–‡ç« "
   â†“
3. è¾“å…¥æ ‡é¢˜
   â†“
4. è¾“å…¥æ­£æ–‡
   â†“
5. ç‚¹å‡»"å›¾ç‰‡"æŒ‰é’®
   â†“
6. ä¸Šä¼ å›¾ç‰‡ âš ï¸ å¿…é¡»ï¼ˆ6ç§’ç­‰å¾…ï¼‰
   â†“
7. ç‚¹å‡»"ç¡®å®š(1)"
   â†“
8. é€‰æ‹©"å•å›¾"
   â†“
9. ç‚¹å‡»"ä¸Šä¼ å›¾ç‰‡"
   â†“
10. é€‰æ‹©å·²ä¸Šä¼ çš„å›¾ç‰‡
   â†“
11. ç‚¹å‡»"ç¡®è®¤"
   â†“
12. ç‚¹å‡»å£°æ˜å¼€å…³
   â†“
13. ç‚¹å‡»"é€‰æ‹©å£°æ˜å†…å®¹"
   â†“
14. é€‰æ‹©"ä¸ªäººåŸåˆ›ï¼Œä»…ä¾›å‚è€ƒ"
   â†“
15. ç‚¹å‡»"å‘å¸ƒ"
```

## å¿«é€Ÿæµ‹è¯•

```bash
# æ–¹æ³•1ï¼šæµ‹è¯•è„šæœ¬
node scripts/test-wangyi-adapter.js

# æ–¹æ³•2ï¼šAPI æµ‹è¯•
curl -X POST http://localhost:3000/api/publishing/publish \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer TOKEN" \
  -d '{"articleId": 123, "platformAccountIds": [456]}'
```

## é‡è¦æç¤º

âš ï¸ **å¿…é¡»åŒ…å«å›¾ç‰‡**
- ç½‘æ˜“å·å¼ºåˆ¶è¦æ±‚ä¸Šä¼ å°é¢å›¾ç‰‡
- æ–‡ç« ä¸­è‡³å°‘è¦æœ‰ä¸€å¼ å›¾ç‰‡
- æ ¼å¼ï¼š`![æè¿°](uploads/image.jpg)`

â±ï¸ **æ“ä½œé—´éš”**
- æ¯æ¬¡æ“ä½œé—´éš” 3-5 ç§’ï¼ˆéšæœºï¼‰
- æ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¡Œä¸º
- ä¸å»ºè®®ä¿®æ”¹

ğŸ” **Cookie ç™»å½•**
- ä¼˜å…ˆä½¿ç”¨ Cookie ç™»å½•
- Cookie å¤±æ•ˆæ—¶éœ€è¦é‡æ–°ç™»å½•
- å»ºè®®æ¯å‘¨æ›´æ–°ä¸€æ¬¡

## å¸¸ç”¨ä»£ç ç‰‡æ®µ

### æ£€æŸ¥ç™»å½•çŠ¶æ€
```typescript
const isLoggedIn = await page.locator('.topBar__user')
  .isVisible({ timeout: 3000 })
  .catch(() => false);
```

### äººæ€§åŒ–ç‚¹å‡»
```typescript
await this.randomWait(3000, 5000);
await locator.click();
await this.randomWait(3000, 5000);
```

### ä¸Šä¼ å›¾ç‰‡
```typescript
const fileChooserPromise = page.waitForEvent('filechooser');
await page.getByRole('button', { name: 'ä¸Šä¼ å°é¢' }).click();
const fileChooser = await fileChooserPromise;
await fileChooser.setFiles(imagePath);
```

## é”™è¯¯å¤„ç†

| é”™è¯¯ | åŸå›  | è§£å†³æ–¹æ³• |
|------|------|---------|
| Cookie ç™»å½•å¤±è´¥ | Cookie å·²å¤±æ•ˆ | é‡æ–°ç™»å½• |
| æ–‡ç« å¿…é¡»ä¸Šä¼ å›¾ç‰‡ | æ–‡ç« ä¸­æ²¡æœ‰å›¾ç‰‡ | æ·»åŠ å›¾ç‰‡åˆ°æ–‡ç«  |
| å›¾ç‰‡æ–‡ä»¶ä¸å­˜åœ¨ | å›¾ç‰‡è·¯å¾„é”™è¯¯ | æ£€æŸ¥å›¾ç‰‡è·¯å¾„ |
| å‘å¸ƒè¶…æ—¶ | ç½‘ç»œé—®é¢˜ | é‡è¯•å‘å¸ƒ |

## å‚è€ƒæ–‡æ¡£

- ğŸ“– [è¯¦ç»†å®ç°æŒ‡å—](./WANGYI_PUBLISH_GUIDE.md)
- ğŸ“˜ [ä½¿ç”¨è¯´æ˜](./WANGYI_USAGE.md)
- ğŸ”§ [æµ‹è¯•è„šæœ¬](./scripts/test-wangyi-adapter.js)

## æˆåŠŸæ¡ˆä¾‹å‚è€ƒ

ç½‘æ˜“å·é€‚é…å™¨å‚è€ƒäº†ä»¥ä¸‹æˆåŠŸå®ç°ï¼š
- âœ… ç™¾å®¶å·é€‚é…å™¨ï¼ˆBaijiahaoAdapterï¼‰
- âœ… å¤´æ¡å·é€‚é…å™¨ï¼ˆToutiaoAdapterï¼‰
- âœ… å°çº¢ä¹¦é€‚é…å™¨ï¼ˆXiaohongshuAdapterï¼‰

## ç‰ˆæœ¬ä¿¡æ¯

- **åˆ›å»ºæ—¥æœŸ**: 2025-01-03
- **æœ€åæ›´æ–°**: 2025-01-03
- **ç‰ˆæœ¬**: 1.0.0
- **çŠ¶æ€**: ç”Ÿäº§å°±ç»ª âœ…
