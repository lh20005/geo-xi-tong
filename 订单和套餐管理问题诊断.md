# 订单和套餐管理页面问题诊断

## 问题描述
- 点击订单管理页面，显示"获取订单列表失败"
- 点击套餐管理页面，显示"获取套餐列表失败"

## 问题分析

### 1. API路由配置正确
后端路由已正确配置：
- 订单管理：`/api/admin/orders` ✅
- 套餐管理：`/api/admin/products` ✅
- 路由已在 `server/src/routes/admin.ts` 中正确注册

### 2. 前端API调用
前端页面使用的API端点：
- **OrderManagementPage**: `${API_BASE_URL}/api/admin/orders`
- **ProductManagementPage**: `${API_BASE_URL}/api/admin/products`

### 3. 可能的原因

#### 原因1: 认证令牌问题
- 管理员路由需要认证和管理员权限
- 检查 localStorage 中的 `auth_token` 是否有效
- 检查当前用户是否具有管理员权限

#### 原因2: CORS或网络问题
- 前端运行在 `http://localhost:5173`
- 后端运行在 `http://localhost:3000`
- 检查浏览器控制台是否有CORS错误

#### 原因3: API_BASE_URL配置问题
- 前端配置：`http://localhost:3000/api`
- 实际请求应该是：`http://localhost:3000/api/admin/orders`

## 诊断步骤

### 步骤1: 检查浏览器控制台
打开浏览器开发者工具（F12），查看：
1. **Console标签页**: 查看是否有JavaScript错误
2. **Network标签页**: 查看API请求的详细信息
   - 请求URL是否正确
   - 响应状态码（401未授权、403禁止访问、404未找到、500服务器错误）
   - 响应内容

### 步骤2: 验证认证状态
在浏览器控制台执行：
```javascript
// 检查令牌
console.log('Token:', localStorage.getItem('auth_token'));

// 检查用户信息
console.log('User:', localStorage.getItem('user'));
```

### 步骤3: 手动测试API
使用提供的测试脚本：
```bash
# 获取你的认证令牌（从浏览器localStorage中）
# 然后运行测试脚本
./test-admin-apis.sh <your_auth_token>
```

### 步骤4: 检查用户权限
确认当前登录用户是否为管理员：
```bash
# 在数据库中查询
sqlite3 server/data/database.db "SELECT id, username, role FROM users WHERE username='你的用户名';"
```

## 快速修复方案

### 方案1: 重新登录
1. 退出当前账号
2. 使用管理员账号重新登录
3. 再次访问订单管理和套餐管理页面

### 方案2: 检查服务器日志
查看服务器终端输出，看是否有错误信息：
- 认证失败
- 权限不足
- 数据库查询错误

### 方案3: 添加详细日志
如果问题仍然存在，我可以帮你在前端页面添加详细的错误日志，以便更好地诊断问题。

## 测试管理员账号

根据项目文档，测试管理员账号：
- 用户名: `admin`
- 密码: `admin123`（或查看 TEST_ACCOUNTS.md）

## 下一步操作

请执行以下操作并告诉我结果：

1. **打开浏览器控制台**，访问订单管理页面，截图或复制错误信息
2. **检查Network标签页**，查看失败的API请求详情
3. **运行测试脚本**：
   ```bash
   # 首先获取你的token
   # 在浏览器控制台执行: localStorage.getItem('auth_token')
   # 然后运行:
   ./test-admin-apis.sh <your_token>
   ```

根据这些信息，我可以提供更精确的解决方案。
