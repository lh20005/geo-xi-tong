# 测试落地页单位显示

## 快速测试步骤

### 1. 重启落地页服务

```bash
cd landing
npm run dev
```

服务将在 `http://localhost:8080` 启动

### 2. 访问落地页

打开浏览器访问：`http://localhost:8080`

### 3. 查看定价区域

滚动到"灵活的使用方案"区域，或直接访问：
```
http://localhost:8080#pricing
```

### 4. 验证单位显示

检查每个套餐卡片的功能列表，确认单位正确显示：

#### 免费版
- ✅ 每月生成文章数 **30篇** ← 应该有"篇"
- ✅ 每月发布文章数 **30篇** ← 应该有"篇"
- ✅ 可管理平台账号数 **1个** ← 应该有"个"
- ✅ 关键词蒸馏数 **50个** ← 应该有"个"

#### 专业版
- ✅ 每月生成文章数 **3000篇**
- ✅ 每月发布文章数 **6000篇**
- ✅ 可管理平台账号数 **3个**
- ✅ 关键词蒸馏数 **500个**

#### 企业版
- ✅ 每月生成文章数 **不限** ← 无限制时显示"不限"
- ✅ 每月发布文章数 **不限**
- ✅ 可管理平台账号数 **10个**
- ✅ 关键词蒸馏数 **不限**

### 5. 测试响应式

#### 桌面端（≥1280px）
- 打开浏览器开发者工具（F12）
- 设置视口宽度为 1920px
- 验证：4列布局，单位正常显示

#### 平板端（768px-1023px）
- 设置视口宽度为 768px
- 验证：3列布局，单位正常显示

#### 移动端（<640px）
- 设置视口宽度为 375px
- 验证：1列布局，单位正常显示

### 6. 检查浏览器控制台

按 F12 打开开发者工具，查看 Console 标签：
- ✅ 无错误信息
- ✅ 无警告信息
- ✅ 无 TypeScript 类型错误

## 预期效果

### 正确显示示例

```
┌──────────────────────────┐
│       免费版             │
│                          │
│      ¥0.00/月            │
│                          │
│    [免费试用]            │
│                          │
│ ✓ 每月生成文章数 30篇    │
│ ✓ 每月发布文章数 30篇    │
│ ✓ 可管理平台账号数 1个   │
│ ✓ 关键词蒸馏数 50个      │
└──────────────────────────┘
```

### 错误显示示例（修复前）

```
┌──────────────────────────┐
│       免费版             │
│                          │
│      ¥0.00/月            │
│                          │
│    [免费试用]            │
│                          │
│ ✓ 每月生成文章数 30      │ ← 缺少"篇"
│ ✓ 每月发布文章数 30      │ ← 缺少"篇"
│ ✓ 可管理平台账号数 1     │ ← 缺少"个"
│ ✓ 关键词蒸馏数 50        │ ← 缺少"个"
└──────────────────────────┘
```

## 数据验证

### 检查 API 响应

```bash
curl http://localhost:3000/api/subscription/plans | jq '.data[0].features'
```

**预期输出**：
```json
[
  {
    "feature_code": "articles_per_month",
    "feature_name": "每月生成文章数",
    "feature_value": 30,
    "feature_unit": "篇"
  },
  {
    "feature_code": "publish_per_month",
    "feature_name": "每月发布文章数",
    "feature_value": 30,
    "feature_unit": "篇"
  },
  {
    "feature_code": "platform_accounts",
    "feature_name": "可管理平台账号数",
    "feature_value": 1,
    "feature_unit": "个"
  },
  {
    "feature_code": "keyword_distillation",
    "feature_name": "关键词蒸馏数",
    "feature_value": 50,
    "feature_unit": "个"
  }
]
```

### 检查数据库

```bash
cd server
psql postgresql://lzc@localhost:5432/geo_system << 'EOF'
SELECT 
  sp.plan_name,
  pf.feature_name,
  pf.feature_value,
  pf.feature_unit
FROM plan_features pf
JOIN subscription_plans sp ON sp.id = pf.plan_id
WHERE sp.is_active = TRUE
ORDER BY sp.display_order, pf.feature_code;
EOF
```

**预期输出**：
```
 plan_name |  feature_name  | feature_value | feature_unit 
-----------+----------------+---------------+--------------
 免费      | 每月生成文章数 |            30 | 篇
 免费      | 每月发布文章数 |            30 | 篇
 免费      | 可管理平台账号数 |             1 | 个
 免费      | 关键词蒸馏数   |            50 | 个
```

## 常见问题排查

### 问题1：单位显示为 "undefined"

**原因**：API 没有返回 `feature_unit` 字段

**解决方案**：
1. 检查后端 SQL 查询是否包含 `feature_unit`
2. 重启后端服务
3. 清除浏览器缓存

### 问题2：单位没有显示

**原因**：落地页代码未更新或缓存问题

**解决方案**：
1. 确认代码已修改
2. 重启落地页服务
3. 强制刷新浏览器（Ctrl+Shift+R）

### 问题3：部分套餐有单位，部分没有

**原因**：数据库中部分功能配额缺少单位

**解决方案**：
```sql
-- 更新缺失的单位
UPDATE plan_features 
SET feature_unit = '篇' 
WHERE feature_code IN ('articles_per_month', 'publish_per_month') 
AND (feature_unit IS NULL OR feature_unit = '');

UPDATE plan_features 
SET feature_unit = '个' 
WHERE feature_code IN ('platform_accounts', 'keyword_distillation') 
AND (feature_unit IS NULL OR feature_unit = '');
```

## 验收清单

- [ ] 落地页服务已重启
- [ ] 访问 http://localhost:8080 正常
- [ ] 定价区域可见
- [ ] 所有套餐卡片显示正常
- [ ] 功能配额都有单位（篇/个）
- [ ] 无限制显示"不限"
- [ ] 桌面端显示正常（4列）
- [ ] 平板端显示正常（2-3列）
- [ ] 移动端显示正常（1列）
- [ ] 无浏览器控制台错误
- [ ] API 返回数据包含 feature_unit
- [ ] 数据库中所有功能配额都有单位

## 截图对比

### 修复前
![修复前](./images/before-unit-fix.png)
- 功能配额只显示数字
- 缺少单位信息
- 用户不清楚具体含义

### 修复后
![修复后](./images/after-unit-fix.png)
- 功能配额显示完整（数字+单位）
- 信息清晰明确
- 用户体验提升

## 总结

修复完成后，落地页的所有套餐功能配额都会正确显示单位，如：
- "30篇" 而不是 "30"
- "1个" 而不是 "1"
- "不限" 对于无限制的配额

这大大提升了信息的完整性和用户体验！
