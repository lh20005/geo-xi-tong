# 商品管理系统测试指南

## 🎯 测试目标

验证商品管理系统的完整功能，包括：
1. 落地页动态套餐展示
2. 管理员套餐管理
3. 用户配额实时显示
4. 配额使用和告警

## 📋 测试前准备

### 1. 确保服务运行
```bash
# 检查后端服务
curl http://localhost:3000/api/subscription/plans

# 检查前端服务
curl http://localhost:5173

# 检查落地页服务
curl http://localhost:8080
```

### 2. 准备测试账号
- 管理员账号：用于测试套餐管理
- 普通用户账号：用于测试配额使用

## 🧪 测试场景

### 场景1：落地页套餐展示（已完成 ✅）

**测试步骤：**
1. 访问落地页：http://localhost:8080
2. 滚动到"价格方案"部分
3. 验证套餐信息

**预期结果：**
- ✅ 显示3个套餐（体验版、专业版、企业版）
- ✅ 价格从API动态获取（¥0.00、¥0.01、¥0.01）
- ✅ 功能配额正确显示
- ✅ 免费版显示"免费试用"按钮
- ✅ 付费版显示"点击购买"按钮

**API验证：**
```bash
curl -s http://localhost:3000/api/subscription/plans | jq '.data[] | {name: .plan_name, price: .price}'
```

**预期输出：**
```json
{
  "name": "体验版",
  "price": "0.00"
}
{
  "name": "专业版",
  "price": "0.01"
}
{
  "name": "企业版",
  "price": "0.01"
}
```

---

### 场景2：管理员套餐管理

**测试步骤：**
1. 使用管理员账号登录
2. 访问：http://localhost:5173/products
3. 查看套餐列表

**预期结果：**
- ✅ 显示所有套餐卡片
- ✅ 每个卡片显示套餐名称、价格、功能配额
- ✅ 显示"创建新套餐"按钮
- ✅ 每个卡片有"编辑"和"删除"按钮

**测试创建套餐：**
1. 点击"创建新套餐"
2. 填写表单：
   - 套餐名称：测试套餐
   - 套餐代码：test
   - 价格：99.00
   - 计费周期：monthly
   - 描述：测试用套餐
3. 配置功能配额：
   - 每日生成文章数：50
   - 每日发布文章数：100
   - 平台账号数：5
   - 关键词蒸馏数：200
4. 点击"创建"

**预期结果：**
- ✅ 创建成功提示
- ✅ 套餐列表自动刷新
- ✅ 新套餐出现在列表中

**测试编辑套餐：**
1. 点击某个套餐的"编辑"按钮
2. 修改价格为 199.00
3. 点击"保存"

**预期结果：**
- ✅ 保存成功提示
- ✅ 价格更新显示

**测试删除套餐：**
1. 点击测试套餐的"删除"按钮
2. 确认删除

**预期结果：**
- ✅ 删除成功提示
- ✅ 套餐从列表中移除

---

### 场景3：用户中心配额显示

**测试步骤：**
1. 使用普通用户账号登录
2. 访问：http://localhost:5173/user-center
3. 查看"订阅管理"标签页

**预期结果：**
- ✅ 显示当前订阅信息（套餐名称、到期时间、状态）
- ✅ 显示使用统计卡片
- ✅ 每个功能显示进度条（已用/总量）
- ✅ 进度条颜色根据使用率变化：
  - 绿色：< 70%
  - 橙色：70% - 90%
  - 红色：≥ 90%

**测试配额刷新：**
1. 点击"刷新"按钮
2. 观察数据更新

**预期结果：**
- ✅ 数据重新加载
- ✅ 显示最新配额信息

---

### 场景4：配额使用和告警

**测试步骤：**
1. 登录用户账号
2. 生成文章直到配额接近上限

**方法1：通过界面操作**
1. 访问文章生成页面
2. 多次生成文章
3. 观察配额变化

**方法2：通过API测试**
```bash
# 获取当前配额
TOKEN="your_auth_token"
curl -H "Authorization: Bearer $TOKEN" \
  http://localhost:3000/api/usage/overview

# 模拟使用（需要实际生成文章）
# 访问 http://localhost:5173/article-generation
```

**预期结果：**
- ✅ 每次生成后配额减少
- ✅ 达到80%时显示警告提示
- ✅ 达到95%时显示严重警告
- ✅ 达到100%时禁止继续生成
- ✅ WebSocket实时更新配额显示

**测试告警记录：**
1. 访问用户中心
2. 查看告警提示

**预期结果：**
- ✅ 显示告警消息
- ✅ 显示"立即升级"按钮
- ✅ 点击按钮跳转到套餐选择

---

### 场景5：套餐升级流程

**测试步骤：**
1. 在用户中心点击"升级套餐"
2. 选择更高级的套餐
3. 点击"立即升级"

**预期结果：**
- ✅ 显示套餐对比
- ✅ 当前套餐标记为"当前套餐"
- ✅ 更高级套餐显示"立即升级"
- ✅ 更低级套餐显示"已购买"（如果已有更高级套餐）
- ✅ 点击升级跳转到支付页面

---

### 场景6：WebSocket实时通知

**测试步骤：**
1. 打开两个浏览器窗口
2. 窗口1：用户中心页面
3. 窗口2：生成文章或发布文章

**预期结果：**
- ✅ 窗口1实时显示配额变化
- ✅ 无需刷新页面
- ✅ 显示"配额已更新"提示

**测试WebSocket连接：**
```bash
# 查看浏览器控制台
# 应该看到类似的日志：
# [UserCenter] WebSocket 连接成功
# Quota updated: {...}
```

---

## 🔍 API测试

### 1. 获取套餐列表
```bash
curl http://localhost:3000/api/subscription/plans | jq
```

### 2. 获取配额概览（需要登录）
```bash
TOKEN="your_auth_token"
curl -H "Authorization: Bearer $TOKEN" \
  http://localhost:3000/api/usage/overview | jq
```

### 3. 检查配额（需要登录）
```bash
TOKEN="your_auth_token"
curl -H "Authorization: Bearer $TOKEN" \
  http://localhost:3000/api/usage/quota/articles_per_day | jq
```

### 4. 获取使用记录（需要登录）
```bash
TOKEN="your_auth_token"
curl -H "Authorization: Bearer $TOKEN" \
  "http://localhost:3000/api/usage/records?page=1&pageSize=10" | jq
```

### 5. 获取告警记录（需要登录）
```bash
TOKEN="your_auth_token"
curl -H "Authorization: Bearer $TOKEN" \
  http://localhost:3000/api/usage/alerts | jq
```

---

## ✅ 测试检查清单

### 落地页
- [ ] 套餐数据从API加载
- [ ] 显示加载状态
- [ ] 价格正确显示
- [ ] 功能配额正确显示
- [ ] 购买按钮正常工作

### 管理员界面
- [ ] 套餐列表正确显示
- [ ] 创建套餐功能正常
- [ ] 编辑套餐功能正常
- [ ] 删除套餐功能正常
- [ ] 表单验证正常

### 用户中心
- [ ] 订阅信息正确显示
- [ ] 配额实时更新
- [ ] 进度条颜色正确
- [ ] 告警提示正常
- [ ] 升级引导正常

### 配额系统
- [ ] 配额检查正常
- [ ] 使用量记录正常
- [ ] 告警触发正常
- [ ] WebSocket通知正常

### 实时通信
- [ ] WebSocket连接成功
- [ ] 配额更新推送
- [ ] 订阅更新推送
- [ ] 自动重连机制

---

## 🐛 常见问题

### 1. 落地页不显示套餐
**原因：** API请求失败或数据格式错误
**解决：**
```bash
# 检查API是否正常
curl http://localhost:3000/api/subscription/plans

# 检查浏览器控制台错误
```

### 2. 配额不更新
**原因：** WebSocket连接失败
**解决：**
```bash
# 检查WebSocket服务
# 查看浏览器控制台是否有连接错误
# 检查后端WebSocket服务是否运行
```

### 3. 告警不触发
**原因：** 配额计算错误或告警阈值未达到
**解决：**
```bash
# 检查配额使用率
curl -H "Authorization: Bearer $TOKEN" \
  http://localhost:3000/api/usage/overview | jq '.[] | {feature: .featureCode, percentage: .usagePercentage}'
```

---

## 📊 测试报告模板

```markdown
# 商品管理系统测试报告

**测试日期：** 2026-01-04
**测试人员：** [姓名]
**测试环境：** 开发环境

## 测试结果

| 测试场景 | 状态 | 备注 |
|---------|------|------|
| 落地页套餐展示 | ✅ 通过 | |
| 管理员套餐管理 | ✅ 通过 | |
| 用户中心配额显示 | ✅ 通过 | |
| 配额使用和告警 | ✅ 通过 | |
| 套餐升级流程 | ✅ 通过 | |
| WebSocket实时通知 | ✅ 通过 | |

## 发现的问题

1. [问题描述]
   - 严重程度：高/中/低
   - 复现步骤：...
   - 预期结果：...
   - 实际结果：...

## 总体评价

系统功能完整，运行稳定，可以投入使用。
```

---

## 🎉 测试完成

完成所有测试后，系统应该：
- ✅ 落地页正确显示套餐信息
- ✅ 管理员可以管理套餐
- ✅ 用户可以查看配额
- ✅ 配额系统正常工作
- ✅ 告警系统正常触发
- ✅ WebSocket实时通知正常

**系统状态：** 🚀 可以投入使用
