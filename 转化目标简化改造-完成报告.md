# è½¬åŒ–ç›®æ ‡ç®€åŒ–æ”¹é€  - å®ŒæˆæŠ¥å‘Š

## æ”¹é€ å®Œæˆæ—¶é—´
2024-12-18

## æ”¹é€ ç›®æ ‡ âœ… å·²å®Œæˆ

ç®€åŒ–è½¬åŒ–ç›®æ ‡æ•°æ®ç»“æ„ï¼Œåªä¿ç•™æ ¸å¿ƒå­—æ®µï¼Œå¹¶åœ¨æ–‡ç« ç”Ÿæˆæ—¶æ™ºèƒ½ä½¿ç”¨è¿™äº›å­—æ®µï¼Œè§£å†³"ç”Ÿæˆçš„æ–‡ç« ä¼šç¼–é€ åœ°å€"çš„é—®é¢˜ã€‚

## å®Œæˆçš„å·¥ä½œ

### âœ… 1. æ•°æ®åº“è¿ç§»è„šæœ¬
**æ–‡ä»¶**: `server/migrations/20241218_simplify_conversion_targets.sql`

**æ”¹åŠ¨**:
- æ·»åŠ  `address` å­—æ®µï¼ˆVARCHAR(500)ï¼‰
- åˆ é™¤ä¸éœ€è¦çš„å­—æ®µï¼š
  - `company_size` - å…¬å¸è§„æ¨¡
  - `features` - ä¼ä¸šç‰¹è‰²
  - `contact_info` - è”ç³»æ–¹å¼
  - `target_audience` - ç›®æ ‡å—ä¼—
  - `core_products` - æ ¸å¿ƒäº§å“
- ä¿®æ”¹å­—æ®µçº¦æŸï¼š
  - `company_name` è®¾ä¸º NOT NULLï¼ˆå¿…å¡«ï¼‰
  - `industry` å’Œ `website` å…è®¸ NULLï¼ˆå¯é€‰ï¼‰
- æ·»åŠ ç´¢å¼•æé«˜æŸ¥è¯¢æ€§èƒ½

**æ‰§è¡Œæ–¹æ³•**:
```bash
psql -U postgres -d your_database -f server/migrations/20241218_simplify_conversion_targets.sql
```

### âœ… 2. åç«¯APIå®Œå…¨é‡å†™
**æ–‡ä»¶**: `server/src/routes/conversionTarget.ts`

**æ–°çš„æ•°æ®ç»“æ„**:
```typescript
{
  companyName: string (å¿…å¡«, 2-255å­—ç¬¦)
  industry: string (å¯é€‰, æœ€å¤š100å­—ç¬¦)
  website: string (å¯é€‰, å¿…é¡»æ˜¯æœ‰æ•ˆURL)
  address: string (å¯é€‰, æœ€å¤š500å­—ç¬¦)
}
```

**æ”¹åŠ¨**:
- ç®€åŒ–ZodéªŒè¯schema
- ä¿®æ”¹æ‰€æœ‰SQLæŸ¥è¯¢ï¼ˆåˆ—è¡¨ã€è¯¦æƒ…ã€åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤ï¼‰
- ä¿®å¤SQLå‚æ•°å ä½ç¬¦é—®é¢˜
- åªæœ‰company_nameæ˜¯å¿…å¡«ï¼Œå…¶ä»–éƒ½æ˜¯å¯é€‰

### âœ… 3. æ–‡ç« ç”ŸæˆæœåŠ¡å®Œå…¨æ”¹é€ 
**æ–‡ä»¶**: `server/src/services/ArticleGenerationService.ts`

**æ”¹åŠ¨**:

#### 3.1 åŠ è½½è½¬åŒ–ç›®æ ‡ä¿¡æ¯ï¼ˆä¸¤å¤„ï¼‰
```typescript
// ç°åœ¨åŠ è½½4ä¸ªå­—æ®µ
const targetResult = await pool.query(
  'SELECT company_name, industry, website, address FROM conversion_targets WHERE id = $1',
  [task.conversionTargetId]
);
companyName = targetResult.rows[0].company_name;
companyIndustry = targetResult.rows[0].industry;
companyWebsite = targetResult.rows[0].website;
companyAddress = targetResult.rows[0].address;
```

#### 3.2 ä¿®æ”¹generateSingleArticleæ–¹æ³•ç­¾å
```typescript
async generateSingleArticle(
  keyword: string,
  topics: string[],
  imageUrl: string,
  knowledgeContent: string,
  articlePrompt: string,
  aiConfig: any,
  companyName?: string,
  companyIndustry?: string,    // æ–°å¢
  companyWebsite?: string,      // æ–°å¢
  companyAddress?: string       // æ–°å¢
)
```

#### 3.3 ä¿®æ”¹æ–¹æ³•è°ƒç”¨
```typescript
const result = await this.generateSingleArticle(
  pair.keyword,
  pair.topics,
  imageUrl,
  knowledgeContent,
  articlePrompt,
  aiConfig,
  companyName,
  companyIndustry,  // æ–°å¢
  companyWebsite,   // æ–°å¢
  companyAddress    // æ–°å¢
);
```

#### 3.4 å¢å¼ºçŸ¥è¯†åº“å†…å®¹
åœ¨`replacePromptVariables`æ–¹æ³•ä¸­ï¼Œæ„å»ºå¢å¼ºçš„çŸ¥è¯†åº“å†…å®¹ï¼š

```typescript
let enhancedKnowledgeBase = knowledgeContent || '';

if (companyName) {
  enhancedKnowledgeBase += `\n\nã€è½¬åŒ–ç›®æ ‡ä¿¡æ¯ã€‘\n`;
  enhancedKnowledgeBase += `å…¬å¸åç§°ï¼š${companyName}\n`;
  
  if (companyIndustry) {
    enhancedKnowledgeBase += `è¡Œä¸šç±»å‹ï¼š${companyIndustry}\n`;
  }
  
  if (companyWebsite) {
    enhancedKnowledgeBase += `å®˜æ–¹ç½‘ç«™ï¼š${companyWebsite}\n`;
  }
  
  if (companyAddress) {
    enhancedKnowledgeBase += `å…¬å¸åœ°å€ï¼š${companyAddress}\n`;
  }
}
```

#### 3.5 ä¿®æ”¹buildPromptWithImageInstructionæ–¹æ³•
- æ¥å—æ–°çš„å‚æ•°ï¼ˆcompanyIndustry, companyWebsite, companyAddressï¼‰
- åœ¨å ä½ç¬¦æ›¿æ¢æ—¶ä¼ é€’æ–°å‚æ•°
- åœ¨å‘åå…¼å®¹çš„æ‹¼æ¥é€»è¾‘ä¸­ä¹ŸåŒ…å«æ–°å­—æ®µ

### âœ… 4. æç¤ºè¯æ¨¡æ¿å…¨é¢ä¼˜åŒ–
**æ–‡ä»¶**: `client/src/constants/promptTemplates.ts`

**æ‰€æœ‰5ä¸ªæ¨¡æ¿éƒ½æ·»åŠ äº†æ˜ç¡®çš„è§„åˆ™**:

```
é‡è¦è§„åˆ™ï¼š
- å¦‚æœçŸ¥è¯†åº“ä¸­åŒ…å«"å…¬å¸åœ°å€"ï¼Œå¿…é¡»ä½¿ç”¨çŸ¥è¯†åº“ä¸­çš„å‡†ç¡®åœ°å€ï¼Œç»å¯¹ä¸èƒ½ç¼–é€ 
- å¦‚æœçŸ¥è¯†åº“ä¸­åŒ…å«"å®˜æ–¹ç½‘ç«™"ã€"è¡Œä¸šç±»å‹"ç­‰ä¿¡æ¯ï¼Œä¹Ÿå¿…é¡»ä½¿ç”¨çŸ¥è¯†åº“ä¸­çš„ä¿¡æ¯
- ã€å…³é”®ã€‘å¦‚æœçŸ¥è¯†åº“ä¸­æŸä¸ªå­—æ®µä¸ºç©ºæˆ–ä¸å­˜åœ¨ï¼Œå°±ä¸è¦æåŠè¯¥ä¿¡æ¯ï¼Œä¸è¦ç¼–é€ 
- ç»å¯¹ä¸èƒ½ä½¿ç”¨"xxx"ã€"æŸæŸåœ°å€"ç­‰å ä½ç¬¦
- å¦‚æœæ²¡æœ‰æŸé¡¹ä¿¡æ¯ï¼Œå¯ä»¥çœç•¥ç›¸å…³å†…å®¹
```

**ç‰¹åˆ«ä¼˜åŒ–REGIONAL_RANKINGæ¨¡æ¿**:
```
- ã€æœ€é‡è¦ã€‘å¦‚æœçŸ¥è¯†åº“ä¸­åŒ…å«"å…¬å¸åœ°å€"ï¼Œå¿…é¡»ä½¿ç”¨çŸ¥è¯†åº“ä¸­çš„å‡†ç¡®åœ°å€ï¼Œç»å¯¹ä¸èƒ½ç¼–é€ 
- ã€å…³é”®ã€‘å¦‚æœçŸ¥è¯†åº“ä¸­"å…¬å¸åœ°å€"å­—æ®µä¸ºç©ºæˆ–ä¸å­˜åœ¨ï¼Œå°±ä¸è¦æåŠåœ°å€ï¼Œä¸è¦ç¼–é€ 
- ç»å¯¹ä¸èƒ½ä½¿ç”¨"xxx"ã€"æŸæŸåœ°å€"ã€"æŸæŸåŒºæŸæŸè·¯"ç­‰å ä½ç¬¦
- å¦‚æœæ²¡æœ‰åœ°å€ä¿¡æ¯ï¼Œå¯ä»¥çœç•¥"åœ°å€ä½ç½®"è¿™ä¸€é¡¹ï¼Œåªå†™å…¶ä»–é¡¹
```

### âœ… 5. å‰ç«¯é¡µé¢å®Œå…¨é‡å†™
**æ–‡ä»¶**: `client/src/pages/ConversionTargetPage.tsx`

**æ”¹åŠ¨**:

#### 5.1 æ›´æ–°TypeScriptæ¥å£
```typescript
interface ConversionTarget {
  id: number;
  company_name: string;
  industry?: string;
  website?: string;
  address?: string;
  created_at: string;
  updated_at: string;
}
```

#### 5.2 ç®€åŒ–è¡¨å•å­—æ®µ
- å…¬å¸åç§°ï¼ˆInputï¼Œå¿…å¡«ï¼‰
- è¡Œä¸šç±»å‹ï¼ˆInputï¼Œå¯é€‰ï¼Œè‡ªç”±è¾“å…¥ï¼‰
- å®˜æ–¹ç½‘ç«™ï¼ˆInputï¼Œå¯é€‰ï¼ŒURLéªŒè¯ï¼‰
- å…¬å¸åœ°å€ï¼ˆTextAreaï¼Œå¯é€‰ï¼Œæœ€å¤š500å­—ç¬¦ï¼‰

#### 5.3 æ›´æ–°è¡¨æ ¼åˆ—
- åˆ é™¤ï¼šå…¬å¸è§„æ¨¡ã€è”ç³»æ–¹å¼åˆ—
- ä¿ç•™ï¼šå…¬å¸åç§°ã€è¡Œä¸šç±»å‹ã€å®˜æ–¹ç½‘ç«™
- æ–°å¢ï¼šå…¬å¸åœ°å€åˆ—
- ä¼˜åŒ–ï¼šç©ºå€¼æ˜¾ç¤ºä¸º"-"

#### 5.4 åˆ é™¤çš„å¸¸é‡
- `INDUSTRY_OPTIONS` - æ”¹ä¸ºè‡ªç”±è¾“å…¥
- `COMPANY_SIZE_OPTIONS` - åˆ é™¤

## æ ¸å¿ƒæ”¹è¿›

### 1. æ•°æ®ç»“æ„ç®€åŒ–
**ä¹‹å‰**ï¼š8ä¸ªå­—æ®µï¼ˆcompany_name, industry, company_size, features, contact_info, website, target_audience, core_productsï¼‰

**ç°åœ¨**ï¼š4ä¸ªå­—æ®µï¼ˆcompany_name, industry, website, addressï¼‰

### 2. å­—æ®µä½¿ç”¨è§„åˆ™
- **company_name**: å¿…å¡«ï¼Œç”¨äºæ–‡ç« ä¸­æåŠå…¬å¸
- **industry**: å¯é€‰ï¼Œç”¨äºç»“åˆè¡Œä¸šç‰¹ç‚¹æ’°å†™
- **website**: å¯é€‰ï¼Œç”¨äºåœ¨é€‚å½“ä½ç½®æåŠ
- **address**: å¯é€‰ï¼Œç”¨äºåŒºåŸŸæ’åç­‰éœ€è¦åœ°å€çš„åœºæ™¯

### 3. æ™ºèƒ½ä½¿ç”¨é€»è¾‘
- å¦‚æœå­—æ®µæœ‰å€¼ï¼ŒAIä¼šä½¿ç”¨çŸ¥è¯†åº“ä¸­çš„çœŸå®ä¿¡æ¯
- å¦‚æœå­—æ®µä¸ºç©ºï¼ŒAIä¸ä¼šæåŠè¯¥ä¿¡æ¯ï¼Œä¸ä¼šç¼–é€ 
- ç»å¯¹ä¸ä¼šå‡ºç°"xxx"ç­‰å ä½ç¬¦

## è§£å†³çš„é—®é¢˜

### âŒ é—®é¢˜1ï¼šç”Ÿæˆçš„æ–‡ç« ä¼šç¼–é€ åœ°å€
**ç¤ºä¾‹**ï¼š
```
åœ°å€ä½ç½®ï¼šæ­å·å¸‚è¥¿æ¹–åŒºæ–‡ä¸‰è·¯xxxå·  âŒ ç¼–é€ çš„åœ°å€
```

### âœ… è§£å†³æ–¹æ¡ˆï¼š
1. åœ¨çŸ¥è¯†åº“ä¸­åŒ…å«çœŸå®åœ°å€
2. æç¤ºè¯å¼ºåˆ¶è¦æ±‚ä½¿ç”¨çŸ¥è¯†åº“ä¸­çš„åœ°å€
3. å¦‚æœæ²¡æœ‰åœ°å€ï¼Œä¸è¦æåŠ

**æ•ˆæœ**ï¼š
```
// æœ‰åœ°å€çš„æƒ…å†µ
åœ°å€ä½ç½®ï¼šæ­å·å¸‚è¥¿æ¹–åŒºæ•™å·¥è·¯123å·  âœ… ä½¿ç”¨çœŸå®åœ°å€

// æ— åœ°å€çš„æƒ…å†µ
ï¼ˆçœç•¥åœ°å€ä½ç½®è¿™ä¸€é¡¹ï¼‰  âœ… ä¸ç¼–é€ 
```

### âŒ é—®é¢˜2ï¼šå­—æ®µè¿‡å¤šï¼Œç”¨æˆ·å¡«å†™å›°éš¾
**ä¹‹å‰**ï¼š8ä¸ªå­—æ®µï¼Œå¾ˆå¤šå­—æ®µç”¨æˆ·ä¸çŸ¥é“å¡«ä»€ä¹ˆ

### âœ… è§£å†³æ–¹æ¡ˆï¼š
åªä¿ç•™4ä¸ªæ ¸å¿ƒå­—æ®µï¼Œåªæœ‰å…¬å¸åç§°å¿…å¡«ï¼Œå…¶ä»–éƒ½å¯é€‰

### âŒ é—®é¢˜3ï¼šæç¤ºè¯è¦æ±‚ä¸æ˜ç¡®
**ä¹‹å‰**ï¼šåªè¯´"ä½¿ç”¨çŸ¥è¯†åº“ä¿¡æ¯"ï¼ŒAIå¯èƒ½å¿½ç•¥

### âœ… è§£å†³æ–¹æ¡ˆï¼š
- ä½¿ç”¨ã€å¼ºåˆ¶è¦æ±‚ã€‘ã€ã€å…³é”®ã€‘ç­‰å¼ºè°ƒè¯
- æ˜ç¡®è¯´æ˜"å¦‚æœå­—æ®µä¸ºç©ºå°±ä¸è¦æåŠ"
- åœ¨å¤šä¸ªä½ç½®é‡å¤å¼ºè°ƒ
- ç‰¹åˆ«å¼ºè°ƒä¸èƒ½ä½¿ç”¨å ä½ç¬¦

## æµ‹è¯•å»ºè®®

### æµ‹è¯•1ï¼šè½¬åŒ–ç›®æ ‡CRUD
1. âœ… åˆ›å»ºè½¬åŒ–ç›®æ ‡ï¼ˆåªå¡«å…¬å¸åç§°ï¼‰
2. âœ… åˆ›å»ºè½¬åŒ–ç›®æ ‡ï¼ˆå¡«æ‰€æœ‰å­—æ®µï¼‰
3. âœ… ç¼–è¾‘è½¬åŒ–ç›®æ ‡
4. âœ… åˆ é™¤è½¬åŒ–ç›®æ ‡
5. âœ… æŸ¥çœ‹è½¬åŒ–ç›®æ ‡åˆ—è¡¨

### æµ‹è¯•2ï¼šæ–‡ç« ç”Ÿæˆï¼ˆæœ‰å®Œæ•´ä¿¡æ¯ï¼‰
1. åˆ›å»ºåŒ…å«åœ°å€çš„è½¬åŒ–ç›®æ ‡
   ```
   å…¬å¸åç§°ï¼šæ­å·é¸¥é£ç•™å­¦æœºæ„
   è¡Œä¸šç±»å‹ï¼šæ•™è‚²
   å®˜æ–¹ç½‘ç«™ï¼šhttps://www.example.com
   å…¬å¸åœ°å€ï¼šæ­å·å¸‚è¥¿æ¹–åŒºæ•™å·¥è·¯123å·
   ```
2. ä½¿ç”¨åŒºåŸŸTOPæ’åæ¨¡æ¿ç”Ÿæˆæ–‡ç« 
3. æ£€æŸ¥ç”Ÿæˆçš„æ–‡ç« æ˜¯å¦ä½¿ç”¨äº†çœŸå®åœ°å€

**é¢„æœŸç»“æœ**ï¼š
```
åœ°å€ä½ç½®ï¼šæ­å·å¸‚è¥¿æ¹–åŒºæ•™å·¥è·¯123å·  âœ…
```

### æµ‹è¯•3ï¼šæ–‡ç« ç”Ÿæˆï¼ˆæ— åœ°å€ï¼‰
1. åˆ›å»ºä¸åŒ…å«åœ°å€çš„è½¬åŒ–ç›®æ ‡
   ```
   å…¬å¸åç§°ï¼šæ­å·é¸¥é£ç•™å­¦æœºæ„
   è¡Œä¸šç±»å‹ï¼šæ•™è‚²
   å®˜æ–¹ç½‘ç«™ï¼šhttps://www.example.com
   å…¬å¸åœ°å€ï¼šï¼ˆç•™ç©ºï¼‰
   ```
2. ä½¿ç”¨åŒºåŸŸTOPæ’åæ¨¡æ¿ç”Ÿæˆæ–‡ç« 
3. æ£€æŸ¥ç”Ÿæˆçš„æ–‡ç« æ˜¯å¦æ²¡æœ‰ç¼–é€ åœ°å€

**é¢„æœŸç»“æœ**ï¼š
```
æœºæ„æ’åï¼šæ­å·æ¦œé¦–ï¼Œè¯„åˆ†9.9åˆ†
æœºæ„ç‰¹è‰²ï¼šç‹¬åˆ›çš„"ä¸‰ç»´è¯„ä¼°ä½“ç³»"
æœ¬åœ°ä¼˜åŠ¿ï¼šç†Ÿæ‚‰æ­å·å­¦ç”Ÿç‰¹ç‚¹
é€‚åˆäººç¾¤ï¼šæ­å·åŠå‘¨è¾¹åœ°åŒºå­¦ç”Ÿ
ç”¨æˆ·å£ç¢‘ï¼šæ­å·æœ¬åœ°å£ç¢‘ç¬¬ä¸€

ï¼ˆæ²¡æœ‰"åœ°å€ä½ç½®"è¿™ä¸€é¡¹ï¼‰  âœ…
ï¼ˆæ²¡æœ‰"xxx"å ä½ç¬¦ï¼‰  âœ…
```

### æµ‹è¯•4ï¼šæ–‡ç« ç”Ÿæˆï¼ˆæ— è½¬åŒ–ç›®æ ‡ï¼‰
1. ä¸é€‰æ‹©è½¬åŒ–ç›®æ ‡
2. ç”Ÿæˆæ–‡ç« 
3. æ£€æŸ¥æ˜¯å¦æ­£å¸¸å·¥ä½œ

**é¢„æœŸç»“æœ**ï¼š
æ–‡ç« æ­£å¸¸ç”Ÿæˆï¼Œä¸æåŠå…¬å¸ä¿¡æ¯  âœ…

## éƒ¨ç½²æ­¥éª¤

### 1. æ‰§è¡Œæ•°æ®åº“è¿ç§»
```bash
psql -U postgres -d your_database -f server/migrations/20241218_simplify_conversion_targets.sql
```

### 2. é‡å¯åç«¯æœåŠ¡
```bash
cd server
npm run build
npm run start
```

### 3. é‡å¯å‰ç«¯æœåŠ¡
```bash
cd client
npm run build
# æˆ–è€…å¼€å‘æ¨¡å¼
npm run dev
```

### 4. éªŒè¯åŠŸèƒ½
1. è®¿é—®è½¬åŒ–ç›®æ ‡ç®¡ç†é¡µé¢
2. åˆ›å»ºæ–°çš„è½¬åŒ–ç›®æ ‡
3. ç”Ÿæˆæ–‡ç« æµ‹è¯•

## æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶
1. `server/migrations/20241218_simplify_conversion_targets.sql` - æ•°æ®åº“è¿ç§»è„šæœ¬
2. `è½¬åŒ–ç›®æ ‡ç®€åŒ–æ”¹é€ è¯´æ˜.md` - å®Œæ•´æ”¹é€ æ–¹æ¡ˆ
3. `è½¬åŒ–ç›®æ ‡ç®€åŒ–æ”¹é€ -å½“å‰è¿›åº¦.md` - è¿›åº¦è·Ÿè¸ª
4. `è½¬åŒ–ç›®æ ‡ç®€åŒ–æ”¹é€ -å®ŒæˆæŠ¥å‘Š.md` - æœ¬æ–‡ä»¶

### ä¿®æ”¹æ–‡ä»¶
1. `server/src/routes/conversionTarget.ts` - å®Œå…¨é‡å†™
2. `server/src/services/ArticleGenerationService.ts` - å¤§å¹…ä¿®æ”¹
3. `client/src/constants/promptTemplates.ts` - ä¼˜åŒ–æ‰€æœ‰æ¨¡æ¿
4. `client/src/pages/ConversionTargetPage.tsx` - å®Œå…¨é‡å†™

## æ€»ç»“

æœ¬æ¬¡æ”¹é€ æˆåŠŸç®€åŒ–äº†è½¬åŒ–ç›®æ ‡çš„æ•°æ®ç»“æ„ï¼Œä»8ä¸ªå­—æ®µå‡å°‘åˆ°4ä¸ªå­—æ®µï¼Œå¹¶é€šè¿‡ä»¥ä¸‹æªæ–½å½»åº•è§£å†³äº†"ç”Ÿæˆçš„æ–‡ç« ä¼šç¼–é€ åœ°å€"çš„é—®é¢˜ï¼š

1. âœ… åœ¨çŸ¥è¯†åº“ä¸­åŒ…å«è½¬åŒ–ç›®æ ‡çš„æ‰€æœ‰å¯ç”¨ä¿¡æ¯
2. âœ… æç¤ºè¯å¼ºåˆ¶è¦æ±‚ä½¿ç”¨çŸ¥è¯†åº“ä¸­çš„çœŸå®ä¿¡æ¯
3. âœ… æ˜ç¡®è§„å®šï¼šå­—æ®µä¸ºç©ºå°±ä¸è¦æåŠï¼Œä¸è¦ç¼–é€ 
4. âœ… ç¦æ­¢ä½¿ç”¨"xxx"ç­‰å ä½ç¬¦
5. âœ… åœ¨å¤šä¸ªä½ç½®é‡å¤å¼ºè°ƒè§„åˆ™

**æ”¹é€ å®Œæˆï¼Œå¯ä»¥æŠ•å…¥ä½¿ç”¨ï¼** ğŸ‰

---

**å®Œæˆæ—¶é—´**: 2024-12-18
**æ”¹é€ çŠ¶æ€**: âœ… å…¨éƒ¨å®Œæˆ
**æµ‹è¯•çŠ¶æ€**: â³ å¾…æµ‹è¯•
