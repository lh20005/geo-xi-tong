# å¤´æ¡å·è‡ªåŠ¨å‘å¸ƒè¯¦ç»†æµç¨‹å’Œè°ƒè¯•æŒ‡å—

## ğŸ“‹ å®Œæ•´å‘å¸ƒæµç¨‹ï¼ˆ6æ­¥ï¼‰

### æ­¥éª¤1ï¼šç¡®ä¿åœ¨å‘å¸ƒé¡µé¢
**ç›®æ ‡URLï¼š** `https://mp.toutiao.com/profile_v4/graphic/publish`

**æ“ä½œï¼š**
1. æ£€æŸ¥å½“å‰URLæ˜¯å¦åŒ…å« `/graphic/publish`
2. å¦‚æœä¸åœ¨å‘å¸ƒé¡µé¢ï¼Œç‚¹å‡»å·¦ä¾§èœå•"å‘å¸ƒæ–‡ç« "
3. ç­‰å¾…é¡µé¢åŠ è½½ï¼ˆ8ç§’ï¼‰

**é€‰æ‹©å™¨ï¼š**
```typescript
const publishMenuSelector = '#masterRoot > div > div.pgc-content > section > aside > div > div > div > div.byte-menu-inline.base_creation_tab > div.byte-menu-inline-content > div:nth-child(1) > span > a';
```

**å¯èƒ½å¤±è´¥ç‚¹ï¼š**
- âŒ èœå•é€‰æ‹©å™¨å¤±æ•ˆï¼ˆé¡µé¢ç»“æ„å˜åŒ–ï¼‰
- âŒ é¡µé¢åŠ è½½è¶…æ—¶
- âŒ è´¦å·æœªç™»å½•æˆ–ç™»å½•å¤±æ•ˆ

---

### æ­¥éª¤2ï¼šå¡«å†™æ–‡ç« æ ‡é¢˜
**ç›®æ ‡ï¼š** åœ¨æ ‡é¢˜è¾“å…¥æ¡†ä¸­è¾“å…¥æ–‡ç« æ ‡é¢˜

**æ“ä½œï¼š**
1. æŸ¥æ‰¾æ ‡é¢˜è¾“å…¥æ¡†ï¼ˆtextareaå…ƒç´ ï¼‰
2. ç‚¹å‡»è¾“å…¥æ¡†è·å–ç„¦ç‚¹
3. æ¸…ç©ºç°æœ‰å†…å®¹
4. ä½¿ç”¨ `page.evaluate()` ç›´æ¥è®¾ç½®valueï¼ˆå…¼å®¹é™é»˜æ¨¡å¼ï¼‰
5. å¤‡ç”¨æ–¹æ¡ˆï¼šä½¿ç”¨ `keyboard.type()` è¾“å…¥
6. éªŒè¯æ ‡é¢˜æ˜¯å¦æ­£ç¡®è¾“å…¥

**é€‰æ‹©å™¨ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰ï¼š**
```typescript
// ç²¾ç¡®é€‰æ‹©å™¨
'#root > div > div.left-column > div > div.publish-editor > div.publish-editor-title-wrapper > div > div > div.title-wrapper > div > div > div > textarea'

// å¤‡ç”¨é€‰æ‹©å™¨
'textarea'
'.title-wrapper textarea'
'div.publish-editor-title-wrapper textarea'
```

**å…³é”®ä»£ç ï¼š**
```typescript
// æ–¹æ³•1ï¼ševaluateï¼ˆæ¨èï¼Œå…¼å®¹é™é»˜æ¨¡å¼ï¼‰
const titleSetSuccess = await page.evaluate((el, val) => {
  (el as HTMLTextAreaElement).value = val;
  el.dispatchEvent(new Event('input', { bubbles: true }));
  el.dispatchEvent(new Event('change', { bubbles: true }));
  return true;
}, titleInput, title);

// æ–¹æ³•2ï¼škeyboard.typeï¼ˆå¤‡ç”¨ï¼‰
await page.keyboard.type(title, { delay: 80 });
```

**å¯èƒ½å¤±è´¥ç‚¹ï¼š**
- âŒ æ ‡é¢˜è¾“å…¥æ¡†é€‰æ‹©å™¨å¤±æ•ˆ
- âŒ æ ‡é¢˜è¿‡é•¿ï¼ˆè¶…è¿‡30å­—ï¼‰
- âŒ è¾“å…¥æ³•å¹²æ‰°ï¼ˆé™é»˜æ¨¡å¼ä¸‹ä¸ä¼šå‘ç”Ÿï¼‰
- âŒ ç„¦ç‚¹æœªæ­£ç¡®è·å–

---

### æ­¥éª¤3ï¼šå¡«å†™æ­£æ–‡å†…å®¹ï¼ˆå…ˆæ–‡å­—åå›¾ç‰‡ï¼‰

#### 3.1 å†…å®¹é¢„å¤„ç†
**æ“ä½œï¼š**
1. ä»æ–‡ç« contentä¸­ç§»é™¤æ ‡é¢˜ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
2. æå–çº¯æ–‡å­—å†…å®¹ï¼ˆç§»é™¤Markdownå›¾ç‰‡æ ‡è®°ï¼‰
3. æå–æ‰€æœ‰å›¾ç‰‡è·¯å¾„å¹¶è½¬æ¢ä¸ºç»å¯¹è·¯å¾„

**å…³é”®ä»£ç ï¼š**
```typescript
// ç§»é™¤æ ‡é¢˜
if (firstLine.includes(article.title)) {
  cleanContent = contentLines.slice(1).join('\n').trim();
}

// æå–çº¯æ–‡å­—
const textOnly = this.cleanArticleContent(cleanContent);

// æå–å›¾ç‰‡è·¯å¾„
const imageRegex = /!\[([^\]]*)\]\(([^)]+)\)/g;
while ((match = imageRegex.exec(cleanContent)) !== null) {
  const imageUrl = match[2];
  let imagePath = imageUrl;
  
  // è½¬æ¢ä¸ºç»å¯¹è·¯å¾„
  if (imagePath.startsWith('/uploads/')) {
    imagePath = path.join(process.cwd(), 'server', imagePath);
  } else if (!imagePath.startsWith('http') && !imagePath.startsWith('/')) {
    imagePath = path.join(process.cwd(), 'server', 'uploads', imagePath);
  }
  
  if (fs.existsSync(imagePath)) {
    imagePaths.push(imagePath);
  }
}
```

#### 3.2 æ’å…¥æ–‡å­—å†…å®¹
**ç›®æ ‡ï¼š** å°†æ‰€æœ‰æ–‡å­—å†…å®¹æ’å…¥åˆ°ProseMirrorç¼–è¾‘å™¨

**é€‰æ‹©å™¨ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰ï¼š**
```typescript
// ç²¾ç¡®é€‰æ‹©å™¨
'#root > div > div.left-column > div > div.publish-editor > div.syl-editor-wrap > div > div.ProseMirror > p'

// å¤‡ç”¨é€‰æ‹©å™¨
'.ProseMirror'
'.ProseMirror > p'
'div.syl-editor-wrap .ProseMirror'
'[contenteditable="true"]'
```

**å…³é”®ä»£ç ï¼š**
```typescript
// æ–¹æ³•1ï¼ševaluateç›´æ¥è®¾ç½®innerHTMLï¼ˆæ¨èï¼‰
const setContentSuccess = await page.evaluate((text) => {
  const editor = document.querySelector('.ProseMirror');
  if (editor) {
    // å°†æ–‡æœ¬è½¬æ¢ä¸ºHTMLæ®µè½
    const paragraphs = text.split('\n').filter(p => p.trim());
    const html = paragraphs.map(p => `<p>${p}</p>`).join('');
    
    editor.innerHTML = html;
    editor.dispatchEvent(new Event('input', { bubbles: true }));
    editor.dispatchEvent(new Event('change', { bubbles: true }));
    return true;
  }
  return false;
}, textOnly);

// æ–¹æ³•2ï¼škeyboard.typeåˆ†æ‰¹è¾“å…¥ï¼ˆå¤‡ç”¨ï¼‰
const batchSize = 500;
for (let i = 0; i < textOnly.length; i += batchSize) {
  const batch = textOnly.substring(i, Math.min(i + batchSize, textOnly.length));
  await page.keyboard.type(batch, { delay: 20 });
  await new Promise(resolve => setTimeout(resolve, 100));
}
```

**å¯èƒ½å¤±è´¥ç‚¹ï¼š**
- âŒ ç¼–è¾‘å™¨é€‰æ‹©å™¨å¤±æ•ˆ
- âŒ æ–‡å­—å†…å®¹è¿‡é•¿å¯¼è‡´è¶…æ—¶
- âŒ evaluateæ–¹æ³•åœ¨é™é»˜æ¨¡å¼ä¸‹è¶…æ—¶
- âŒ ç¼–è¾‘å™¨æœªæ­£ç¡®è¯†åˆ«å†…å®¹å˜åŒ–

#### 3.3 ä¸Šä¼ å›¾ç‰‡ï¼ˆé€ä¸ªä¸Šä¼ ï¼‰
**ç›®æ ‡ï¼š** å°†æ‰€æœ‰å›¾ç‰‡é€ä¸ªä¸Šä¼ åˆ°ç¼–è¾‘å™¨

**å®Œæ•´æµç¨‹ï¼ˆæ¯å¼ å›¾ç‰‡ï¼‰ï¼š**

##### 3.3.1 ç‚¹å‡»ä¸Šä¼ å›¾ç‰‡æŒ‰é’®
**é€‰æ‹©å™¨ï¼š**
```typescript
// ç²¾ç¡®é€‰æ‹©å™¨
'#root > div > div.left-column > div > div.publish-editor > div.syl-editor-toolbar.visible.inline > div > div.syl-toolbar-tool.image.static > div > button > svg'

// å¤‡ç”¨é€‰æ‹©å™¨
'button[aria-label*="å›¾ç‰‡"]'
'button[title*="å›¾ç‰‡"]'
'.syl-toolbar-tool.image button'
'div.image button'
```

**æ“ä½œï¼š**
```typescript
await page.waitForSelector(uploadButtonSelector, { timeout: 5000 });
const uploadButton = await page.$(uploadButtonSelector);
await uploadButton.click();
await new Promise(resolve => setTimeout(resolve, 8000)); // ç­‰å¾…å¯¹è¯æ¡†æ‰“å¼€
```

**å¯èƒ½å¤±è´¥ç‚¹ï¼š**
- âŒ ä¸Šä¼ æŒ‰é’®é€‰æ‹©å™¨å¤±æ•ˆ
- âŒ æŒ‰é’®ä¸å¯ç‚¹å‡»ï¼ˆè¢«é®æŒ¡æˆ–disabledï¼‰
- âŒ å¯¹è¯æ¡†æ‰“å¼€è¶…æ—¶

##### 3.3.2 æŸ¥æ‰¾æ–‡ä»¶è¾“å…¥æ¡†
**é€‰æ‹©å™¨ï¼ˆæŒ‰ä¼˜å…ˆçº§å°è¯•ï¼‰ï¼š**
```typescript
const fileInputSelectors = [
  'body > div:nth-child(46) > div.byte-drawer.primary-drawer.mp-ic-img-drawer.is-first.slideRight-enter-done > div > div > div.byte-drawer-content.byte-drawer-content-nofooter > div > div.byte-tabs-content.byte-tabs-content-horizontal > div > div.byte-tabs-content-item.byte-tabs-content-item-active > div > div > div > div.btn-upload-scand.is-empty > div > button:nth-child(1) > div > input[type=file]',
  'input[type=file]',
  '.byte-drawer input[type=file]',
  '.mp-ic-img-drawer input[type=file]'
];
```

**æ“ä½œï¼š**
```typescript
let fileInput = null;
for (const selector of fileInputSelectors) {
  try {
    await page.waitForSelector(selector, { timeout: 3000 });
    fileInput = await page.$(selector);
    if (fileInput) break;
  } catch (e) {
    // ç»§ç»­å°è¯•ä¸‹ä¸€ä¸ª
  }
}
```

**å¯èƒ½å¤±è´¥ç‚¹ï¼š**
- âŒ æ‰€æœ‰é€‰æ‹©å™¨éƒ½å¤±æ•ˆ
- âŒ å¯¹è¯æ¡†æœªæ­£ç¡®æ‰“å¼€
- âŒ é¡µé¢ç»“æ„å˜åŒ–

##### 3.3.3 ä¸Šä¼ æ–‡ä»¶
**æ“ä½œï¼š**
```typescript
// éªŒè¯æ–‡ä»¶å­˜åœ¨
if (!fs.existsSync(imagePath)) {
  throw new Error(`å›¾ç‰‡æ–‡ä»¶ä¸å­˜åœ¨: ${imagePath}`);
}

// ä¸Šä¼ æ–‡ä»¶
await fileInput.uploadFile(imagePath);
await new Promise(resolve => setTimeout(resolve, 20000)); // ç­‰å¾…ä¸Šä¼ å®Œæˆ
```

**å¯èƒ½å¤±è´¥ç‚¹ï¼š**
- âŒ æ–‡ä»¶è·¯å¾„é”™è¯¯ï¼ˆå·²ä¿®å¤ï¼šæ·»åŠ server/å‰ç¼€ï¼‰
- âŒ æ–‡ä»¶ä¸å­˜åœ¨
- âŒ æ–‡ä»¶è¿‡å¤§ï¼ˆ>5MBï¼‰
- âŒ ç½‘ç»œä¸Šä¼ è¶…æ—¶
- âŒ uploadFileæ–¹æ³•å¤±è´¥

##### 3.3.4 å…³é—­ä¸Šä¼ å¯¹è¯æ¡†
**æ“ä½œï¼š**
```typescript
// æ–¹æ³•1ï¼šé€šè¿‡æ–‡æœ¬æŸ¥æ‰¾"ç¡®å®š"æŒ‰é’®
const confirmClicked = await page.evaluate(() => {
  const buttons = Array.from(document.querySelectorAll('button'));
  for (const btn of buttons) {
    const text = (btn.textContent || '').trim();
    if (text === 'ç¡®å®š' || text === 'ç¡®è®¤') {
      btn.click();
      return true;
    }
  }
  return false;
});

// æ–¹æ³•2ï¼šä½¿ç”¨ç²¾ç¡®é€‰æ‹©å™¨
const confirmButtonSelector = 'body > div:nth-child(46) > div.byte-drawer.primary-drawer.mp-ic-img-drawer.is-first.slideRight-enter-done > div > div > div.byte-drawer-content.byte-drawer-content-nofooter > div > div.byte-tabs-content.byte-tabs-content-horizontal > div > div.byte-tabs-content-item.byte-tabs-content-item-active > div > div > div > div.footer > div.confirm-btns > button.byte-btn.byte-btn-primary.byte-btn-size-large.byte-btn-shape-square > span';
```

**å¯èƒ½å¤±è´¥ç‚¹ï¼š**
- âŒ ç¡®å®šæŒ‰é’®é€‰æ‹©å™¨å¤±æ•ˆ
- âŒ å¯¹è¯æ¡†æœªæ­£ç¡®å…³é—­
- âŒ å›¾ç‰‡æœªæˆåŠŸæ’å…¥ç¼–è¾‘å™¨

#### 3.4 å†…å®¹éªŒè¯
**æ“ä½œï¼š**
```typescript
const finalResult = await page.evaluate(() => {
  const editor = document.querySelector('.ProseMirror');
  if (editor) {
    const images = editor.querySelectorAll('img');
    const text = editor.textContent || '';
    return {
      imageCount: images.length,
      textLength: text.length,
      cleanTextLength: text.replace(/\s+/g, '').length
    };
  }
  return { imageCount: 0, textLength: 0, cleanTextLength: 0 };
});

// éªŒè¯
const imageCountMatch = finalResult.imageCount === expectedImageCount;
const hasEnoughText = finalResult.cleanTextLength >= expectedTextLength * 0.7;
```

**å¯èƒ½å¤±è´¥ç‚¹ï¼š**
- âŒ å›¾ç‰‡æ•°é‡ä¸åŒ¹é…
- âŒ æ–‡å­—é•¿åº¦ä¸è¶³
- âŒ ç¼–è¾‘å™¨å†…å®¹æœªæ­£ç¡®æ¸²æŸ“

---

### æ­¥éª¤4ï¼šç‚¹å‡»å¿…éœ€é€‰é¡¹æŒ‰é’®
**ç›®æ ‡ï¼š** é€‰æ‹©æ–‡ç« çš„å¿…éœ€é€‰é¡¹ï¼ˆå¦‚åŸåˆ›å£°æ˜ç­‰ï¼‰

**é€‰æ‹©å™¨ï¼š**
```typescript
const optionButtonSelector = '#root > div > div.left-column > div > div.form-wrap > div.form-container > div.source-wrap > div > div.edit-input > div > div > span > span:nth-child(4) > label > span > div';
```

**æ“ä½œï¼š**
```typescript
await page.waitForSelector(optionButtonSelector, { timeout: 5000 });
const optionButton = await page.$(optionButtonSelector);
await optionButton.click();
await new Promise(resolve => setTimeout(resolve, 3000));
```

**å¯èƒ½å¤±è´¥ç‚¹ï¼š**
- âŒ é€‰é¡¹æŒ‰é’®é€‰æ‹©å™¨å¤±æ•ˆ
- âŒ é€‰é¡¹ä¸å¯ç‚¹å‡»
- âŒ é€‰é¡¹æœªæ­£ç¡®é€‰ä¸­

---

### æ­¥éª¤5ï¼šç‚¹å‡»"é¢„è§ˆå¹¶å‘å¸ƒ"æŒ‰é’®
**ç›®æ ‡ï¼š** è§¦å‘å‘å¸ƒæµç¨‹

**é€‰æ‹©å™¨ï¼š**
```typescript
// ç²¾ç¡®é€‰æ‹©å™¨
'#root > div > div.left-column > div > div.publish-footer.inline-editor > div > button.byte-btn.byte-btn-primary.byte-btn-size-large.byte-btn-shape-square.publish-btn.publish-btn-last > span'
```

**æ“ä½œï¼ˆé€šè¿‡æ–‡æœ¬æŸ¥æ‰¾ï¼Œæœ€å¯é ï¼‰ï¼š**
```typescript
const clicked = await page.evaluate(() => {
  const buttons = Array.from(document.querySelectorAll('button'));
  
  // ç¬¬ä¸€ä¼˜å…ˆçº§ï¼šç²¾ç¡®åŒ¹é…"é¢„è§ˆå¹¶å‘å¸ƒ"
  for (const btn of buttons) {
    const text = (btn.textContent || '').trim();
    if (text === 'é¢„è§ˆå¹¶å‘å¸ƒ') {
      // æ»šåŠ¨åˆ°æŒ‰é’®ä½ç½®
      btn.scrollIntoView({ behavior: 'auto', block: 'center' });
      
      // ç­‰å¾…æ»šåŠ¨å®Œæˆåç‚¹å‡»
      setTimeout(() => {
        btn.click();
      }, 2000);
      return true;
    }
  }
  
  // å¤‡ç”¨ï¼šåŒ…å«"é¢„è§ˆ"å’Œ"å‘å¸ƒ"
  for (const btn of buttons) {
    const text = (btn.textContent || '').trim();
    if (text.includes('é¢„è§ˆ') && text.includes('å‘å¸ƒ')) {
      btn.scrollIntoView({ behavior: 'auto', block: 'center' });
      setTimeout(() => btn.click(), 2000);
      return true;
    }
  }
  
  return false;
});
```

**å¯èƒ½å¤±è´¥ç‚¹ï¼š**
- âŒ å‘å¸ƒæŒ‰é’®æœªæ‰¾åˆ°
- âŒ æŒ‰é’®ä¸åœ¨å¯è§†åŒºåŸŸï¼ˆéœ€è¦æ»šåŠ¨ï¼‰
- âŒ æŒ‰é’®è¢«ç¦ç”¨ï¼ˆå†…å®¹ä¸å®Œæ•´ï¼‰
- âŒ ç‚¹å‡»åæ— å“åº”

---

### æ­¥éª¤6ï¼šç¡®è®¤å‘å¸ƒ
**ç›®æ ‡ï¼š** åœ¨ç¡®è®¤å¯¹è¯æ¡†ä¸­ç‚¹å‡»"ç¡®è®¤å‘å¸ƒ"

**æ“ä½œï¼š**
```typescript
await new Promise(resolve => setTimeout(resolve, 5000)); // ç­‰å¾…å¯¹è¯æ¡†å‡ºç°

const confirmClicked = await page.evaluate(() => {
  const buttons = Array.from(document.querySelectorAll('button'));
  for (const btn of buttons) {
    const text = (btn.textContent || '').trim();
    if (text === 'ç¡®è®¤å‘å¸ƒ' || text === 'å‘å¸ƒ' || text === 'ç¡®å®š') {
      btn.click();
      return true;
    }
  }
  return false;
});
```

**å¯èƒ½å¤±è´¥ç‚¹ï¼š**
- âŒ ç¡®è®¤å¯¹è¯æ¡†æœªå‡ºç°
- âŒ ç¡®è®¤æŒ‰é’®æœªæ‰¾åˆ°
- âŒ å‘å¸ƒå¤±è´¥ï¼ˆæœåŠ¡å™¨é”™è¯¯ï¼‰

---

## ğŸ” å›¾ç‰‡ä¸Šä¼ å¤±è´¥çš„å¸¸è§åŸå› 

### 1. æ–‡ä»¶è·¯å¾„é—®é¢˜ âœ… å·²ä¿®å¤
**é—®é¢˜ï¼š** å›¾ç‰‡æ–‡ä»¶åœ¨ `server/uploads/` ä½†ä»£ç åœ¨ `uploads/` æŸ¥æ‰¾

**è§£å†³ï¼š** å·²åœ¨æ‰€æœ‰é€‚é…å™¨ä¸­æ·»åŠ  `server/` å‰ç¼€

### 2. é€‰æ‹©å™¨å¤±æ•ˆ
**é—®é¢˜ï¼š** å¤´æ¡å·é¡µé¢ç»“æ„å˜åŒ–å¯¼è‡´é€‰æ‹©å™¨å¤±æ•ˆ

**è¯Šæ–­ï¼š**
```bash
# æŸ¥çœ‹æœ€æ–°æ—¥å¿—
tail -100 server.log | grep "å¤´æ¡.*âŒ"
```

**è§£å†³ï¼š** éœ€è¦æ›´æ–°é€‰æ‹©å™¨

### 3. ä¸Šä¼ è¶…æ—¶
**é—®é¢˜ï¼š** å›¾ç‰‡æ–‡ä»¶è¿‡å¤§æˆ–ç½‘ç»œæ…¢å¯¼è‡´ä¸Šä¼ è¶…æ—¶

**å½“å‰ç­‰å¾…æ—¶é—´ï¼š** 20ç§’/å›¾ç‰‡

**è§£å†³ï¼š** 
- å‹ç¼©å›¾ç‰‡æ–‡ä»¶
- å¢åŠ ç­‰å¾…æ—¶é—´
- æ£€æŸ¥ç½‘ç»œè¿æ¥

### 4. å¯¹è¯æ¡†æœªæ­£ç¡®æ‰“å¼€
**é—®é¢˜ï¼š** ç‚¹å‡»ä¸Šä¼ æŒ‰é’®åå¯¹è¯æ¡†æœªæ‰“å¼€

**è¯Šæ–­ï¼š**
```typescript
// æ£€æŸ¥å¯¹è¯æ¡†æ˜¯å¦å­˜åœ¨
const dialogExists = await page.$('.byte-drawer');
```

**è§£å†³ï¼š**
- å¢åŠ ç­‰å¾…æ—¶é—´
- æ£€æŸ¥æŒ‰é’®æ˜¯å¦å¯ç‚¹å‡»
- å°è¯•å¤‡ç”¨é€‰æ‹©å™¨

### 5. æ–‡ä»¶è¾“å…¥æ¡†æœªæ‰¾åˆ°
**é—®é¢˜ï¼š** æ‰€æœ‰é€‰æ‹©å™¨éƒ½å¤±æ•ˆ

**è¯Šæ–­ï¼š**
```typescript
// åˆ—å‡ºæ‰€æœ‰æ–‡ä»¶è¾“å…¥æ¡†
const allFileInputs = await page.$$('input[type=file]');
console.log(`é¡µé¢ä¸Šå…±æœ‰ ${allFileInputs.length} ä¸ªæ–‡ä»¶è¾“å…¥æ¡†`);
```

**è§£å†³ï¼š** ä½¿ç”¨ç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„æ–‡ä»¶è¾“å…¥æ¡†

### 6. uploadFileæ–¹æ³•å¤±è´¥
**é—®é¢˜ï¼š** Puppeteerçš„uploadFileæ–¹æ³•è°ƒç”¨å¤±è´¥

**å¯èƒ½åŸå› ï¼š**
- æ–‡ä»¶è·¯å¾„åŒ…å«ç‰¹æ®Šå­—ç¬¦
- æ–‡ä»¶æƒé™é—®é¢˜
- Puppeteerç‰ˆæœ¬é—®é¢˜

**è§£å†³ï¼š**
```bash
# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la server/uploads/gallery/

# ä¿®å¤æƒé™
chmod 644 server/uploads/gallery/*
```

---

## ğŸ› ï¸ è°ƒè¯•å·¥å…·å’Œæ–¹æ³•

### 1. å®æ—¶æŸ¥çœ‹æ—¥å¿—
```bash
# æŸ¥çœ‹å¤´æ¡å·ç›¸å…³æ—¥å¿—
tail -f server.log | grep "å¤´æ¡"

# æŸ¥çœ‹å›¾ç‰‡ä¸Šä¼ æ—¥å¿—
tail -f server.log | grep "å¤´æ¡.*å›¾ç‰‡\|å¤´æ¡.*uploadFile"

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f server.log | grep "å¤´æ¡.*âŒ"
```

### 2. æ£€æŸ¥å›¾ç‰‡æ–‡ä»¶
```bash
# åˆ—å‡ºæ‰€æœ‰å›¾ç‰‡
ls -la server/uploads/gallery/

# æ£€æŸ¥ç‰¹å®šå›¾ç‰‡
ls -la server/uploads/gallery/1767076787694-*.png

# æ£€æŸ¥æ–‡ä»¶æƒé™
stat server/uploads/gallery/xxx.png
```

### 3. æµ‹è¯•è·¯å¾„è½¬æ¢
```bash
# è¿è¡Œæµ‹è¯•è„šæœ¬
node test-toutiao-image-path-fix.js
```

### 4. æ‰‹åŠ¨æµ‹è¯•ä¸Šä¼ 
åœ¨æµè§ˆå™¨ä¸­æ‰‹åŠ¨æµ‹è¯•ï¼š
1. æ‰“å¼€å¤´æ¡å·å‘å¸ƒé¡µé¢
2. ç‚¹å‡»å›¾ç‰‡ä¸Šä¼ æŒ‰é’®
3. é€‰æ‹©æ–‡ä»¶
4. è§‚å¯Ÿä¸Šä¼ è¿‡ç¨‹

### 5. æˆªå›¾è°ƒè¯•
åœ¨ä»£ç ä¸­æ·»åŠ æˆªå›¾ï¼š
```typescript
// åœ¨å…³é”®æ­¥éª¤æ·»åŠ æˆªå›¾
await page.screenshot({ path: 'debug-step1.png' });
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. å‡å°‘ç­‰å¾…æ—¶é—´
å½“å‰ç­‰å¾…æ—¶é—´è¾ƒé•¿ï¼Œå¯ä»¥æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ï¼š
- å¯¹è¯æ¡†æ‰“å¼€ï¼š8ç§’ â†’ 5ç§’
- å›¾ç‰‡ä¸Šä¼ ï¼š20ç§’ â†’ 15ç§’ï¼ˆå¦‚æœç½‘ç»œå¿«ï¼‰
- æŒ‰é’®ç‚¹å‡»ï¼š3ç§’ â†’ 2ç§’

### 2. å¹¶è¡Œå¤„ç†
ç›®å‰å›¾ç‰‡æ˜¯é€ä¸ªä¸Šä¼ ï¼Œå¯ä»¥è€ƒè™‘ï¼š
- æ‰¹é‡ä¸Šä¼ ï¼ˆå¦‚æœå¹³å°æ”¯æŒï¼‰
- å¼‚æ­¥å¤„ç†

### 3. æ™ºèƒ½ç­‰å¾…
ä½¿ç”¨ `waitForSelector` ä»£æ›¿å›ºå®šç­‰å¾…ï¼š
```typescript
// ä¸å¥½
await new Promise(resolve => setTimeout(resolve, 5000));

// æ›´å¥½
await page.waitForSelector('.upload-success', { timeout: 5000 });
```

---

## âœ… æ£€æŸ¥æ¸…å•

å‘å¸ƒå‰æ£€æŸ¥ï¼š
- [ ] æœåŠ¡å·²é‡å¯
- [ ] å›¾ç‰‡æ–‡ä»¶å­˜åœ¨äº `server/uploads/gallery/`
- [ ] å›¾ç‰‡è·¯å¾„æ ¼å¼æ­£ç¡®ï¼ˆ`/uploads/gallery/xxx.png`ï¼‰
- [ ] å¤´æ¡å·è´¦å·å·²ç™»å½•
- [ ] æ–‡ç« æ ‡é¢˜ä¸è¶…è¿‡30å­—
- [ ] æ–‡ç« å†…å®¹ä¸ä¸ºç©º
- [ ] å›¾ç‰‡æ–‡ä»¶å¤§å° < 5MB

å‘å¸ƒåæ£€æŸ¥ï¼š
- [ ] æ—¥å¿—æ˜¾ç¤º"å›¾ç‰‡æ–‡ä»¶å­˜åœ¨"
- [ ] æ—¥å¿—æ˜¾ç¤º"uploadFileæ–¹æ³•è°ƒç”¨æˆåŠŸ"
- [ ] æ—¥å¿—æ˜¾ç¤º"æ‰€æœ‰å›¾ç‰‡ä¸Šä¼ å®Œæˆ"
- [ ] æ—¥å¿—æ˜¾ç¤º"å·²ç‚¹å‡»ç¡®è®¤å‘å¸ƒæŒ‰é’®"
- [ ] å‘å¸ƒä»»åŠ¡çŠ¶æ€ä¸º"completed"
- [ ] å¤´æ¡å·åå°å¯ä»¥çœ‹åˆ°æ–‡ç« 

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** 1.0  
**æœ€åæ›´æ–°ï¼š** 2024-12-30  
**çŠ¶æ€ï¼š** å›¾ç‰‡è·¯å¾„é—®é¢˜å·²ä¿®å¤ï¼Œç­‰å¾…æµ‹è¯•éªŒè¯
