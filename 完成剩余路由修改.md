# å‰©ä½™è·¯ç”±å¿«é€Ÿä¿®æ”¹æŒ‡å—

## âœ… å·²å®Œæˆ
- gallery.ts âœ…
- knowledgeBase.ts âœ…

## ğŸ”„ å¾…ä¿®æ”¹åˆ—è¡¨

ç”±äºæ‰€æœ‰è·¯ç”±çš„ä¿®æ”¹æ¨¡å¼å®Œå…¨ç›¸åŒï¼Œä»¥ä¸‹æ˜¯å¿«é€Ÿä¿®æ”¹æŒ‡å—ï¼š

### 1. article.ts - æ–‡ç« ç®¡ç†
### 2. articleGeneration.ts - æ–‡ç« ç”Ÿæˆ  
### 3. distillation.ts - å…³é”®è¯è’¸é¦
### 4. conversionTarget.ts - è½¬åŒ–ç›®æ ‡
### 5. articleSettings.ts - æ–‡ç« è®¾ç½®
### 6. platformAccounts.ts - å¹³å°è´¦å·
### 7. config.ts - APIé…ç½®

## ğŸ“ ç»Ÿä¸€ä¿®æ”¹æ­¥éª¤

### æ­¥éª¤1ï¼šæ·»åŠ å¯¼å…¥ï¼ˆæ–‡ä»¶é¡¶éƒ¨ï¼‰
```typescript
import { authenticate } from '../middleware/adminAuth';
import { setTenantContext, requireTenantContext, getCurrentTenantId } from '../middleware/tenantContext';
```

### æ­¥éª¤2ï¼šæ·»åŠ ä¸­é—´ä»¶ï¼ˆrouterå®šä¹‰åï¼‰
```typescript
router.use(authenticate);
router.use(setTenantContext);
router.use(requireTenantContext);
```

### æ­¥éª¤3ï¼šä¿®æ”¹æ¯ä¸ªç«¯ç‚¹

#### GET åˆ—è¡¨
```typescript
// æ·»åŠ è¿™è¡Œ
const userId = getCurrentTenantId(req);

// ä¿®æ”¹SQLçš„WHEREå­å¥
WHERE table_name.user_id = $1

// æˆ–è€…æ·»åŠ åˆ°ç°æœ‰WHERE
WHERE existing_condition AND table_name.user_id = $X
```

#### POST åˆ›å»º
```typescript
// æ·»åŠ è¿™è¡Œ
const userId = getCurrentTenantId(req);

// ä¿®æ”¹INSERTè¯­å¥
INSERT INTO table_name (field1, field2, user_id) VALUES ($1, $2, $3)

// æ·»åŠ userIdåˆ°å‚æ•°æ•°ç»„
[value1, value2, userId]
```

#### GET/:id è¯¦æƒ…
```typescript
// æ·»åŠ è¿™è¡Œ
const userId = getCurrentTenantId(req);

// ä¿®æ”¹WHEREå­å¥
WHERE id = $1 AND user_id = $2

// ä¿®æ”¹å‚æ•°
[id, userId]

// ä¿®æ”¹é”™è¯¯æ¶ˆæ¯
'èµ„æºä¸å­˜åœ¨æˆ–æ— æƒè®¿é—®'
```

#### PUT/PATCH/:id æ›´æ–°
```typescript
// æ·»åŠ è¿™è¡Œ
const userId = getCurrentTenantId(req);

// ä¿®æ”¹WHEREå­å¥
WHERE id = $X AND user_id = $Y

// æ·»åŠ userIdåˆ°å‚æ•°æ•°ç»„æœ«å°¾
[...otherParams, id, userId]

// ä¿®æ”¹é”™è¯¯æ¶ˆæ¯
'èµ„æºä¸å­˜åœ¨æˆ–æ— æƒè®¿é—®'
```

#### DELETE/:id åˆ é™¤
```typescript
// æ·»åŠ è¿™è¡Œ
const userId = getCurrentTenantId(req);

// ä¿®æ”¹WHEREå­å¥
WHERE id = $1 AND user_id = $2

// ä¿®æ”¹å‚æ•°
[id, userId]

// ä¿®æ”¹é”™è¯¯æ¶ˆæ¯
'èµ„æºä¸å­˜åœ¨æˆ–æ— æƒè®¿é—®'
```

## ğŸ¯ ç‰¹æ®Šæƒ…å†µå¤„ç†

### å…³è”æŸ¥è¯¢
å¦‚æœSQLåŒ…å«JOINï¼Œç¡®ä¿ä¸»è¡¨æœ‰user_idè¿‡æ»¤ï¼š

```typescript
// ä¿®æ”¹å‰
SELECT a.*, b.name 
FROM table_a a
JOIN table_b b ON a.b_id = b.id
WHERE a.id = $1

// ä¿®æ”¹å
const userId = getCurrentTenantId(req);
SELECT a.*, b.name 
FROM table_a a
JOIN table_b b ON a.b_id = b.id
WHERE a.id = $1 AND a.user_id = $2
```

### å­æŸ¥è¯¢
ç¡®ä¿å­æŸ¥è¯¢ä¹ŸåŒ…å«user_idè¿‡æ»¤ï¼š

```typescript
// ä¿®æ”¹å‰
SELECT * FROM table_a 
WHERE id IN (SELECT a_id FROM table_b WHERE condition)

// ä¿®æ”¹å
const userId = getCurrentTenantId(req);
SELECT * FROM table_a 
WHERE user_id = $1 AND id IN (
  SELECT a_id FROM table_b 
  WHERE condition AND user_id = $1
)
```

### äº‹åŠ¡å¤„ç†
åœ¨äº‹åŠ¡ä¸­ä¹Ÿè¦æ·»åŠ user_idï¼š

```typescript
const userId = getCurrentTenantId(req);
const client = await pool.connect();
try {
  await client.query('BEGIN');
  
  // æ‰€æœ‰æŸ¥è¯¢éƒ½æ·»åŠ user_idè¿‡æ»¤
  await client.query(
    'INSERT INTO table (name, user_id) VALUES ($1, $2)',
    [name, userId]
  );
  
  await client.query('COMMIT');
} catch (error) {
  await client.query('ROLLBACK');
  throw error;
} finally {
  client.release();
}
```

## âœ… éªŒè¯æ¸…å•

ä¿®æ”¹å®Œæ¯ä¸ªæ–‡ä»¶åï¼Œæ£€æŸ¥ï¼š

- [ ] å·²æ·»åŠ å¯¼å…¥è¯­å¥
- [ ] å·²æ·»åŠ ä¸­é—´ä»¶
- [ ] æ‰€æœ‰GETåˆ—è¡¨æŸ¥è¯¢æ·»åŠ äº†user_idè¿‡æ»¤
- [ ] æ‰€æœ‰POSTåˆ›å»ºæ·»åŠ äº†user_id
- [ ] æ‰€æœ‰GET/:idæ·»åŠ äº†user_idéªŒè¯
- [ ] æ‰€æœ‰UPDATEæ·»åŠ äº†user_idéªŒè¯
- [ ] æ‰€æœ‰DELETEæ·»åŠ äº†user_idéªŒè¯
- [ ] é”™è¯¯æ¶ˆæ¯æ”¹ä¸º"æ— æƒè®¿é—®"
- [ ] JOINæŸ¥è¯¢æ·»åŠ äº†user_idè¿‡æ»¤
- [ ] å­æŸ¥è¯¢æ·»åŠ äº†user_idè¿‡æ»¤

## ğŸš€ å¿«é€Ÿå®Œæˆ

é¢„è®¡æ¯ä¸ªæ–‡ä»¶10-15åˆ†é’Ÿï¼Œ7ä¸ªæ–‡ä»¶çº¦1.5-2å°æ—¶å³å¯å®Œæˆã€‚

å»ºè®®é¡ºåºï¼š
1. article.tsï¼ˆæœ€é‡è¦ï¼‰
2. articleGeneration.tsï¼ˆæœ€é‡è¦ï¼‰
3. distillation.tsï¼ˆé‡è¦ï¼‰
4. conversionTarget.ts
5. articleSettings.ts
6. platformAccounts.ts
7. config.ts

å®Œæˆåè¿è¡Œæµ‹è¯•éªŒè¯åŠŸèƒ½ï¼
