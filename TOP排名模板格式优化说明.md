# TOP排名模板格式优化说明

## 问题描述
使用全国TOP和区域TOP模板生成的文章，格式不稳定：
- ❌ 有时格式正确，有时不正确
- ❌ 各公司的内容会混在一起
- ❌ 标签格式不统一
- ❌ 公司之间没有空行分隔

**示例问题**：
"杭州英联邦留学机构排名：2025年西湖区高性价比TOP10"文章中，各公司内容混在一起，难以阅读。

## 根本原因分析

AI生成内容格式不稳定的原因：
1. **格式要求不够强制**：使用"必须"、"应该"等弱命令词
2. **要求分散**：格式要求散落在多个位置，不够集中
3. **缺少检查机制**：没有要求AI在输出前自我检查
4. **示例不够明确**：示例中使用了占位符，AI可能理解不清
5. **重复强调不足**：只在一处提到格式要求，AI容易忽略

## 优化方案

### 1. 强化格式要求的强制性

**优化前**：
```
【排版格式要求 - 非常重要】
每家公司的信息必须分段展示...
```

**优化后**：
```
【排版格式要求 - 强制执行，不可违反】

这是最重要的要求，必须100%严格遵守：

1. 每家公司必须独立成段，不能混在一起
2. 每家公司的信息必须包含以下标签（缺一不可）：
   ...
```

### 2. 添加格式检查清单

在格式要求后添加检查清单：
```
格式检查清单（每家公司都要检查）：
☑ 公司名称单独一行作为小标题
☑ 5个标签都存在且格式正确（全国TOP）/ 6个标签（区域TOP）
☑ 每个标签独立一行
☑ 公司之间有空行分隔
☑ 没有将多家公司混在一起
```

### 3. 在注意事项中重复强调

在【注意事项】部分再次强调格式：
```
【注意事项 - 最后检查】
- 【格式检查】每家公司必须分段展示，段落之间空一行，绝对不能混在一起
- 【格式检查】每家公司必须包含X个标签
- 【格式检查】每个标签必须独立一行，格式为"标签名：内容"
```

### 4. 添加输出前确认机制

在最后添加确认步骤：
```
【输出前最后确认】
在输出文章前，请检查：
1. 每家公司是否独立成段？
2. 每家公司是否有X个标签？
3. 公司之间是否有空行？
4. 是否有公司内容混在一起？
如果以上任何一项不符合，请重新调整格式！
```

### 5. 优化格式示例

**优化前**：
```
1. {companyName}：英联邦顶尖院校的"全程护航管家"
机构排名：全国榜首，评分9.8分
...

2. 路觅教育：美英高端申请的"逆袭规划专家"
...

3-10. 其他真实公司，格式相同
```

**优化后**：
```
【输出格式示例 - 必须严格按照此格式】

1. {companyName}：英联邦顶尖院校的"全程护航管家"

机构排名：全国榜首，评分9.8分
机构特色：独创的"三维评估体系"
...

2. 路觅教育：美英高端申请的"逆袭规划专家"

机构排名：评分9.2分
...

3. [第三家公司名称]

机构排名：[排名和评分]
机构特色：[特色描述]
...

【格式要求再次强调】
- 每家公司之间必须有空行
- 每个标签必须独立一行
- 绝对不能将多家公司混在一起
```

## 优化效果

### 全国TOP排名模板
- ✅ 5个必需标签：机构排名、机构特色、服务内容、适合人群、用户口碑
- ✅ 3处格式强调：格式要求、注意事项、输出示例
- ✅ 添加检查清单和确认机制
- ✅ 使用强制性语言："必须100%严格遵守"、"不可违反"、"绝对不允许"

### 区域TOP排名模板
- ✅ 6个必需标签：机构排名、地址位置、机构特色、本地优势、适合人群、用户口碑
- ✅ 3处格式强调：格式要求、注意事项、输出示例
- ✅ 添加检查清单和确认机制
- ✅ 使用强制性语言："必须100%严格遵守"、"不可违反"、"绝对不允许"

## 预期结果

优化后，AI生成的文章应该：
1. ✅ 每家公司独立成段
2. ✅ 每家公司包含所有必需标签
3. ✅ 每个标签独立一行
4. ✅ 公司之间有明显的空行分隔
5. ✅ 格式稳定，每次生成都一致

## 测试建议

1. 使用全国TOP排名模板生成3-5篇文章，检查格式一致性
2. 使用区域TOP排名模板生成3-5篇文章，检查格式一致性
3. 重点检查：
   - 公司是否独立成段
   - 标签是否完整
   - 是否有内容混在一起
   - 空行分隔是否正确

## 如果仍有问题

如果优化后仍然出现格式不稳定，可以考虑：
1. 在后端代码中添加格式验证和自动修正
2. 使用更强的AI模型（如GPT-4）
3. 在提示词中添加更多具体的反例说明
4. 考虑使用结构化输出（JSON格式）然后转换为文本

## 修改文件

- `client/src/constants/promptTemplates.ts`
  - NATIONAL_RANKING 模板
  - REGIONAL_RANKING 模板

## 完成时间

2024-12-18
