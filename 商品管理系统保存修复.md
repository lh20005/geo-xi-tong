# å•†å“ç®¡ç†ç³»ç»Ÿä¿å­˜ä¿®å¤

## ğŸ› é—®é¢˜æè¿°

1. **æ— æ³•ä¿å­˜å¥—é¤ä¿¡æ¯** - APIè·¯å¾„é”™è¯¯
2. **Ant Designè­¦å‘Š** - InputNumberçš„addonAfterå·²åºŸå¼ƒ

## ğŸ” é—®é¢˜åˆ†æ

### é—®é¢˜1ï¼šAPIè·¯å¾„ä¸åŒ¹é…

**å‰ç«¯è°ƒç”¨ï¼š**
```typescript
await axios.put(`/api/admin/products/${currentPlan.id}`, values)
```

**åç«¯è·¯ç”±ï¼š**
```typescript
// è·¯ç”±æ³¨å†Œï¼š/admin/products
router.put('/plans/:id', ...)  // å®Œæ•´è·¯å¾„ï¼š/api/admin/products/plans/:id
```

**ç»“æœï¼š** 404 Not Found

### é—®é¢˜2ï¼šInputNumber addonAfteråºŸå¼ƒ

**æ—§ä»£ç ï¼š**
```typescript
<InputNumber 
  addonAfter={<span>å•ä½</span>}
/>
```

**è­¦å‘Šä¿¡æ¯ï¼š**
```
Warning: [antd: InputNumber] `addonAfter` is deprecated. 
Please use `Space.Compact` instead.
```

## âœ… ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤1ï¼šç»Ÿä¸€APIè·¯å¾„

#### æ›´æ–°å¥—é¤
```typescript
// ä¿®æ”¹å‰
await axios.put(`/api/admin/products/${currentPlan.id}`, values, {
  headers: { Authorization: `Bearer ${token}` }
});

// ä¿®æ”¹å
await axios.put(`/api/admin/products/plans/${currentPlan.id}`, values, {
  headers: { Authorization: `Bearer ${token}` }
});
```

#### åˆ é™¤å¥—é¤
```typescript
// ä¿®æ”¹å‰
await axios.delete(`/api/admin/products/${planId}`, {
  headers: { Authorization: `Bearer ${token}` }
});

// ä¿®æ”¹å
await axios.delete(`/api/admin/products/plans/${planId}`, {
  headers: { Authorization: `Bearer ${token}` }
});
```

### ä¿®å¤2ï¼šä½¿ç”¨Space.Compactæ›¿ä»£addonAfter

```typescript
// ä¿®æ”¹å‰
<Form.Item name={[name, 'featureValue']}>
  <InputNumber 
    placeholder="é…é¢å€¼" 
    min={-1}
    addonAfter={
      <Form.Item name={[name, 'featureUnit']} noStyle>
        <span>å•ä½</span>
      </Form.Item>
    }
  />
</Form.Item>

// ä¿®æ”¹å
<Space.Compact style={{ width: 150 }}>
  <Form.Item
    name={[name, 'featureValue']}
    style={{ marginBottom: 0, flex: 1 }}
  >
    <InputNumber 
      placeholder="é…é¢å€¼" 
      min={-1}
      style={{ width: '100%' }}
    />
  </Form.Item>
  <Form.Item
    name={[name, 'featureUnit']}
    style={{ marginBottom: 0 }}
    noStyle
  >
    <Input 
      placeholder="å•ä½" 
      style={{ width: 60 }}
      disabled
    />
  </Form.Item>
</Space.Compact>
```

## ğŸ“‹ å®Œæ•´çš„APIè·¯å¾„åˆ—è¡¨

| åŠŸèƒ½ | æ–¹æ³• | å‰ç«¯è·¯å¾„ | åç«¯è·¯ç”± | å®Œæ•´è·¯å¾„ |
|-----|------|---------|---------|---------|
| è·å–å¥—é¤åˆ—è¡¨ | GET | `/api/admin/products` | `/` | `/api/admin/products` |
| è·å–å¥—é¤è¯¦æƒ… | GET | `/api/admin/products/plans/:id` | `/plans/:id` | `/api/admin/products/plans/:id` |
| åˆ›å»ºå¥—é¤ | POST | `/api/admin/products/plans` | `/plans` | `/api/admin/products/plans` |
| æ›´æ–°å¥—é¤ | PUT | `/api/admin/products/plans/:id` | `/plans/:id` | `/api/admin/products/plans/:id` |
| åˆ é™¤å¥—é¤ | DELETE | `/api/admin/products/plans/:id` | `/plans/:id` | `/api/admin/products/plans/:id` |
| æ›´æ–°åŠŸèƒ½é…é¢ | PUT | `/api/admin/products/plans/:id/features` | `/plans/:id/features` | `/api/admin/products/plans/:id/features` |
| è·å–é…ç½®å†å² | GET | `/api/admin/products/history` | `/history` | `/api/admin/products/history` |

## ğŸ§ª æµ‹è¯•éªŒè¯

### 1. æµ‹è¯•ä¿å­˜å¥—é¤

```bash
# ç™»å½•è·å–token
TOKEN="your_admin_token"

# æµ‹è¯•æ›´æ–°å¥—é¤
curl -X PUT \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "planName": "ä¸“ä¸šç‰ˆ",
    "price": 99.00,
    "billingCycle": "monthly",
    "description": "é€‚åˆä¸ªäººåˆ›ä½œè€…",
    "displayOrder": 2,
    "isActive": true,
    "features": [
      {
        "featureCode": "articles_per_day",
        "featureValue": 100,
        "featureUnit": "ç¯‡"
      }
    ]
  }' \
  http://localhost:3000/api/admin/products/plans/2
```

### 2. æµ‹è¯•å‰ç«¯ç•Œé¢

1. **ç™»å½•ç®¡ç†å‘˜è´¦å·**
   ```
   http://localhost:5173/login
   ```

2. **è®¿é—®å•†å“ç®¡ç†é¡µé¢**
   ```
   http://localhost:5173/products
   ```

3. **æµ‹è¯•ç¼–è¾‘åŠŸèƒ½**
   - ç‚¹å‡»æŸä¸ªå¥—é¤çš„"ç¼–è¾‘"æŒ‰é’®
   - ä¿®æ”¹å¥—é¤ä¿¡æ¯
   - ç‚¹å‡»"ä¿å­˜"
   - éªŒè¯æ˜¯å¦æˆåŠŸä¿å­˜

4. **éªŒè¯è­¦å‘Šæ¶ˆå¤±**
   - æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°
   - ç¡®è®¤æ²¡æœ‰InputNumberçš„addonAfterè­¦å‘Š

## ğŸ¯ ä¿®å¤ç»“æœ

### ä¿®å¤å‰
- âŒ ä¿å­˜å¥—é¤å¤±è´¥ï¼ˆ404é”™è¯¯ï¼‰
- âš ï¸ æ§åˆ¶å°æ˜¾ç¤ºaddonAfteråºŸå¼ƒè­¦å‘Š
- âŒ åˆ é™¤å¥—é¤å¤±è´¥ï¼ˆ404é”™è¯¯ï¼‰

### ä¿®å¤å
- âœ… ä¿å­˜å¥—é¤æˆåŠŸ
- âœ… æ— è­¦å‘Šä¿¡æ¯
- âœ… åˆ é™¤å¥—é¤æˆåŠŸ
- âœ… æ‰€æœ‰APIè°ƒç”¨æ­£å¸¸

## ğŸ“ ä»£ç æ”¹è¿›å»ºè®®

### 1. åˆ›å»ºAPIå¸¸é‡

```typescript
// src/constants/api.ts
export const ADMIN_API = {
  PRODUCTS: {
    LIST: '/api/admin/products',
    DETAIL: (id: number) => `/api/admin/products/plans/${id}`,
    CREATE: '/api/admin/products/plans',
    UPDATE: (id: number) => `/api/admin/products/plans/${id}`,
    DELETE: (id: number) => `/api/admin/products/plans/${id}`,
    FEATURES: (id: number) => `/api/admin/products/plans/${id}/features`,
    HISTORY: '/api/admin/products/history'
  }
};
```

### 2. ä½¿ç”¨APIå¸¸é‡

```typescript
// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
import { ADMIN_API } from '@/constants/api';

const handleSave = async () => {
  const token = localStorage.getItem('auth_token');
  await axios.put(
    ADMIN_API.PRODUCTS.UPDATE(currentPlan.id), 
    values,
    { headers: { Authorization: `Bearer ${token}` } }
  );
};
```

### 3. ç»Ÿä¸€é”™è¯¯å¤„ç†

```typescript
const handleSave = async () => {
  try {
    const values = await form.validateFields();
    if (!currentPlan) return;

    const token = localStorage.getItem('auth_token');
    await axios.put(
      ADMIN_API.PRODUCTS.UPDATE(currentPlan.id),
      values,
      { headers: { Authorization: `Bearer ${token}` } }
    );
    
    message.success('å¥—é¤æ›´æ–°æˆåŠŸ');
    setEditModalVisible(false);
    loadPlans();
  } catch (error: any) {
    console.error('ä¿å­˜å¤±è´¥:', error);
    
    // ç»Ÿä¸€é”™è¯¯å¤„ç†
    if (error.response) {
      const { status, data } = error.response;
      if (status === 401) {
        message.error('æœªæˆæƒï¼Œè¯·é‡æ–°ç™»å½•');
        // è·³è½¬åˆ°ç™»å½•é¡µ
      } else if (status === 403) {
        message.error('æƒé™ä¸è¶³');
      } else if (status === 404) {
        message.error('å¥—é¤ä¸å­˜åœ¨');
      } else {
        message.error(data.message || 'æ›´æ–°å¤±è´¥');
      }
    } else if (error.request) {
      message.error('ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿æ¥');
    } else {
      message.error('æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
    }
  }
};
```

## ğŸ”„ åç»­ä¼˜åŒ–

1. **åˆ›å»ºç»Ÿä¸€çš„axioså®ä¾‹**
   - è‡ªåŠ¨æ·»åŠ Authorization header
   - ç»Ÿä¸€é”™è¯¯å¤„ç†
   - è¯·æ±‚/å“åº”æ‹¦æˆªå™¨

2. **æ·»åŠ åŠ è½½çŠ¶æ€**
   - ä¿å­˜æ—¶æ˜¾ç¤ºloading
   - ç¦ç”¨è¡¨å•é˜²æ­¢é‡å¤æäº¤

3. **æ·»åŠ è¡¨å•éªŒè¯**
   - ä»·æ ¼èŒƒå›´éªŒè¯
   - é…é¢å€¼éªŒè¯
   - å¥—é¤ä»£ç å”¯ä¸€æ€§éªŒè¯

4. **ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ**
   - ä¿å­˜æˆåŠŸåæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
   - å¤±è´¥æ—¶ä¿ç•™è¡¨å•æ•°æ®
   - æ·»åŠ ç¡®è®¤å¯¹è¯æ¡†

---

**ä¿®å¤æ—¶é—´**: 2026-01-04
**ä¿®å¤çŠ¶æ€**: âœ… å·²å®Œæˆ
**æµ‹è¯•çŠ¶æ€**: å¾…éªŒè¯
