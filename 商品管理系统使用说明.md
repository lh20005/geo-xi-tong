# 商品管理系统使用说明

## 📖 系统概述

商品管理系统是GEO优化系统的核心模块，提供完整的套餐管理、配额追踪和告警功能。

### 核心功能
- 🎯 **套餐管理**：管理员可创建、编辑、删除套餐
- 📊 **配额追踪**：实时追踪用户功能使用情况
- ⚠️ **智能告警**：配额不足时自动提醒
- 🔄 **实时同步**：WebSocket实时更新数据
- 💰 **灵活定价**：支持多种计费周期和价格

## 🚀 快速开始

### 1. 访问入口

#### 用户端
- **落地页**：http://localhost:8080
  - 查看套餐信息
  - 选择购买套餐
  
- **用户中心**：http://localhost:5173/user-center
  - 查看当前订阅
  - 查看配额使用
  - 升级套餐

#### 管理员端
- **商品管理**：http://localhost:5173/products
  - 管理套餐
  - 配置价格和配额

### 2. 功能配额说明

系统支持4种功能配额：

| 功能代码 | 功能名称 | 重置周期 | 说明 |
|---------|---------|---------|------|
| `articles_per_day` | 每日生成文章数 | 每日 | 每天0点重置 |
| `publish_per_day` | 每日发布文章数 | 每日 | 每天0点重置 |
| `platform_accounts` | 平台账号数 | 永久 | 不重置 |
| `keyword_distillation` | 关键词蒸馏数 | 永久 | 不重置 |

**配额值说明：**
- 正整数：具体配额数量
- `-1`：无限制

## 👨‍💼 管理员操作指南

### 创建新套餐

1. **访问商品管理页面**
   ```
   http://localhost:5173/products
   ```

2. **点击"创建新套餐"按钮**

3. **填写套餐信息**
   - **套餐名称**：如"专业版"
   - **套餐代码**：如"professional"（唯一标识，不可重复）
   - **价格**：如 99.00
   - **计费周期**：monthly（月付）或 yearly（年付）
   - **描述**：如"适合个人创作者"
   - **显示顺序**：数字越小越靠前
   - **是否启用**：勾选后用户可见

4. **配置功能配额**
   - 每日生成文章数：如 100
   - 每日发布文章数：如 200
   - 平台账号数：如 3
   - 关键词蒸馏数：如 500
   - 使用 `-1` 表示无限制

5. **点击"创建"按钮**

**注意事项：**
- 套餐代码一旦创建不可修改
- 价格支持小数点后2位
- 配额值必须是整数或-1

### 编辑套餐

1. **找到要编辑的套餐卡片**

2. **点击"编辑"按钮**

3. **修改信息**
   - 可修改：名称、价格、描述、配额
   - 不可修改：套餐代码

4. **点击"保存"按钮**

**提示：**
- 修改价格会影响新订单，不影响已有订阅
- 修改配额会影响新订阅，不影响已有订阅

### 删除套餐

1. **找到要删除的套餐卡片**

2. **点击"删除"按钮**

3. **确认删除操作**

**警告：**
- 删除套餐不会影响已有订阅
- 删除后用户无法再购买该套餐
- 建议使用"禁用"而不是删除

### 禁用/启用套餐

1. **编辑套餐**

2. **取消勾选"是否启用"**

3. **保存**

**效果：**
- 禁用后用户无法购买
- 已有订阅不受影响
- 可随时重新启用

## 👤 用户操作指南

### 查看套餐信息

#### 方式1：落地页
1. 访问 http://localhost:8080
2. 滚动到"价格方案"部分
3. 查看各套餐详情

#### 方式2：用户中心
1. 登录系统
2. 访问用户中心
3. 点击"升级套餐"按钮

### 购买套餐

1. **选择套餐**
   - 在落地页或用户中心选择套餐
   - 点击"点击购买"或"立即升级"

2. **登录账号**
   - 如未登录，跳转到登录页
   - 登录后自动返回

3. **确认订单**
   - 查看订单详情
   - 确认价格和功能

4. **完成支付**
   - 扫描二维码支付
   - 等待支付成功

5. **自动开通**
   - 支付成功后自动创建订阅
   - 配额自动分配
   - 可立即使用

### 查看配额使用

1. **访问用户中心**
   ```
   http://localhost:5173/user-center
   ```

2. **查看"订阅管理"标签页**
   - 当前套餐信息
   - 到期时间
   - 自动续费状态

3. **查看"使用统计"卡片**
   - 每个功能的使用情况
   - 进度条显示使用率
   - 剩余配额数量

**进度条颜色说明：**
- 🟢 绿色（< 70%）：配额充足
- 🟠 橙色（70% - 90%）：配额偏紧
- 🔴 红色（≥ 90%）：配额即将用完

### 配额告警

当配额使用达到一定比例时，系统会自动提醒：

#### 告警级别

1. **警告（80%）**
   - 提示：配额即将用完
   - 建议：考虑升级套餐

2. **严重（95%）**
   - 提示：配额严重不足
   - 建议：立即升级套餐

3. **耗尽（100%）**
   - 提示：配额已用完
   - 限制：无法继续使用该功能
   - 操作：必须升级套餐

#### 查看告警

1. 用户中心会显示告警提示
2. 点击"立即升级"跳转到套餐选择
3. 选择更高级套餐完成升级

### 升级套餐

1. **点击"升级套餐"按钮**
   - 在用户中心
   - 或在告警提示中

2. **选择目标套餐**
   - 查看套餐对比
   - 当前套餐标记为"当前套餐"
   - 更高级套餐显示"立即升级"

3. **确认升级**
   - 点击"立即升级"
   - 系统自动计算差价
   - 按剩余天数比例计算

4. **完成支付**
   - 支付差价
   - 立即生效

**升级规则：**
- 只能升级到更高级套餐
- 按剩余天数计算差价
- 升级后配额立即增加
- 到期时间不变

## 🔄 实时同步

系统使用WebSocket实现实时数据同步：

### 自动更新场景

1. **配额变化**
   - 生成文章后
   - 发布文章后
   - 配额自动更新

2. **订阅变化**
   - 购买套餐后
   - 升级套餐后
   - 订阅信息自动更新

3. **订单状态**
   - 支付成功后
   - 订单状态自动更新

### 连接状态

- ✅ 已连接：数据实时同步
- ⚠️ 连接中：正在建立连接
- ❌ 断开：自动重连中

**注意：**
- WebSocket断开不影响功能使用
- 系统会自动重连
- 可手动刷新获取最新数据

## 📊 使用记录

### 查看使用记录

1. **访问用户中心**

2. **切换到"订单记录"标签页**

3. **查看历史记录**
   - 订单号
   - 套餐名称
   - 金额
   - 状态
   - 创建时间
   - 支付时间

### 订单状态说明

| 状态 | 说明 | 操作 |
|-----|------|------|
| 待支付 | 订单已创建，等待支付 | 完成支付 |
| 已支付 | 支付成功，订阅已开通 | 无需操作 |
| 已关闭 | 订单已取消或超时 | 重新下单 |
| 已退款 | 订单已退款 | 联系客服 |

## 🎯 最佳实践

### 管理员

1. **套餐设计**
   - 提供3-4个套餐选项
   - 价格梯度合理
   - 功能差异明显
   - 突出推荐套餐

2. **配额设置**
   - 根据用户需求设置
   - 留有一定余量
   - 企业版使用无限制（-1）
   - 定期评估调整

3. **价格策略**
   - 免费版吸引用户
   - 专业版满足大多数需求
   - 企业版提供完整功能
   - 年付提供折扣

### 用户

1. **选择套餐**
   - 评估实际需求
   - 从低级套餐开始
   - 根据使用情况升级
   - 关注配额使用率

2. **配额管理**
   - 定期查看使用情况
   - 注意告警提示
   - 提前规划升级
   - 合理分配使用

3. **成本优化**
   - 选择合适的套餐
   - 避免配额浪费
   - 考虑年付优惠
   - 关注促销活动

## 🔧 故障排除

### 问题1：套餐不显示

**症状：**
- 落地页不显示套餐
- 用户中心不显示套餐

**原因：**
- API请求失败
- 网络连接问题
- 后端服务未启动

**解决方法：**
```bash
# 1. 检查后端服务
curl http://localhost:3000/api/subscription/plans

# 2. 检查浏览器控制台
# 查看是否有错误信息

# 3. 刷新页面
```

### 问题2：配额不更新

**症状：**
- 使用功能后配额不变
- 配额显示不准确

**原因：**
- WebSocket连接断开
- 缓存问题
- 数据同步延迟

**解决方法：**
```bash
# 1. 点击刷新按钮
# 2. 检查WebSocket连接状态
# 3. 重新登录
# 4. 清除浏览器缓存
```

### 问题3：告警不触发

**症状：**
- 配额用完但没有提示
- 告警消息不显示

**原因：**
- 告警阈值未达到
- WebSocket未连接
- 浏览器通知被禁用

**解决方法：**
```bash
# 1. 检查配额使用率
# 2. 确认WebSocket连接
# 3. 允许浏览器通知
# 4. 刷新页面
```

### 问题4：无法购买套餐

**症状：**
- 点击购买无反应
- 支付页面打不开

**原因：**
- 未登录
- 套餐已禁用
- 网络问题

**解决方法：**
```bash
# 1. 确认已登录
# 2. 检查套餐状态
# 3. 检查网络连接
# 4. 联系管理员
```

## 📞 技术支持

### 获取帮助

1. **查看文档**
   - 阅读本使用说明
   - 查看API文档
   - 参考测试指南

2. **检查日志**
   - 浏览器控制台
   - 后端服务日志
   - 数据库日志

3. **联系支持**
   - 提交工单
   - 发送邮件
   - 在线客服

### 反馈问题

提供以下信息：
- 问题描述
- 复现步骤
- 错误截图
- 浏览器版本
- 操作系统

## 🎉 总结

商品管理系统提供了完整的套餐管理和配额追踪功能：

- ✅ 管理员可灵活管理套餐
- ✅ 用户可实时查看配额
- ✅ 智能告警及时提醒
- ✅ WebSocket实时同步
- ✅ 完整的购买流程

**开始使用：**
1. 管理员：访问 http://localhost:5173/products
2. 用户：访问 http://localhost:8080 或 http://localhost:5173/user-center

祝您使用愉快！🚀
