# 修复发布任务 400 错误 - 快速指南

## 🔴 问题

创建发布任务时出现错误：
```
创建发布任务失败：Request failed with status code 400
```

## ✅ 原因

数据库中缺少发布系统相关的表。

## 🚀 快速修复（3步）

### 步骤1：运行数据库迁移

```bash
./run-publishing-migration.sh
```

### 步骤2：重启服务器

```bash
# 停止当前服务器（Ctrl+C）
# 然后重新启动
npm run dev
```

### 步骤3：测试功能

1. 打开应用
2. 进入"平台登录"页面
3. 绑定一个平台账号
4. 进入"文章管理"页面
5. 点击"发布到平台"
6. 创建发布任务

应该可以成功创建任务了！

## 📋 详细说明

### 迁移做了什么？

创建了4个表：

1. **platform_accounts** - 存储平台账号和Cookie
2. **publishing_tasks** - 存储发布任务
3. **publishing_logs** - 存储执行日志
4. **platforms_config** - 存储平台配置（12个平台）

### 如果脚本运行失败？

手动运行迁移：

```bash
# 1. 确保 .env 文件存在并配置了 DATABASE_URL
cat .env | grep DATABASE_URL

# 2. 手动运行SQL
source .env
psql "$DATABASE_URL" -f server/src/db/migrations/006_add_publishing_system.sql
```

### 验证迁移成功

```bash
# 连接数据库
source .env
psql "$DATABASE_URL"

# 在psql中运行
\dt platform*
\dt publishing*

# 应该看到4个表
```

## 🔍 其他可能的问题

### 问题1：参数错误

如果迁移成功但仍然报错，检查前端发送的参数：

后端期望的参数：
- `article_id` (必需)
- `account_id` (必需)
- `platform_id` (必需)
- `config` (可选，默认为 {})
- `scheduled_time` 或 `scheduled_at` (可选)

### 问题2：账号不存在

确保已经绑定了平台账号：
1. 进入"平台登录"页面
2. 点击"浏览器登录"
3. 完成登录流程

### 问题3：文章不存在

确保文章ID有效：
1. 进入"文章管理"页面
2. 确认文章存在
3. 使用正确的文章ID

## 📞 需要帮助？

查看详细文档：
- `发布系统数据库迁移说明.md` - 完整迁移说明
- `自动登录发布功能实现完成.md` - 功能说明
- `README-自动登录发布功能.md` - 使用指南

---

**快速修复完成后，就可以使用自动登录发布功能了！** 🎉
