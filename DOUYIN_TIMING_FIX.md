# 抖音自动发布操作间隔修复

## 问题描述

抖音自动发布时，每个操作之间的间隔时间不统一，有些操作间隔太短（0.3-1.5秒），容易被平台识别为机器人操作。

### 原有问题
- `humanClick()` 方法：点击前等待 0.3-0.8秒，点击后等待 0.5-1.2秒
- `humanType()` 方法：输入前等待 0.5-1秒，输入后等待 0.8-1.5秒
- 部分操作使用 `randomWait(2500, 3500)` 等不统一的时间
- 间隔时间过短，不够自然

## 修复方案

统一所有操作的间隔时间为 **3-5秒**，更接近真实人类操作。

### 修改内容

1. **新增 `standardWait()` 方法**
   ```typescript
   private async standardWait(): Promise<void> {
     await this.randomWait(3000, 5000); // 3-5秒
   }
   ```

2. **修改 `humanClick()` 方法**
   ```typescript
   // 修改前
   await this.randomWait(300, 800);   // 点击前 0.3-0.8秒
   await locator.click();
   await this.randomWait(500, 1200);  // 点击后 0.5-1.2秒
   
   // 修改后
   await this.standardWait();         // 点击前 3-5秒
   await locator.click();
   await this.standardWait();         // 点击后 3-5秒
   ```

3. **修改 `humanType()` 方法**
   ```typescript
   // 修改前
   await this.randomWait(500, 1000);  // 输入前 0.5-1秒
   await locator.fill(text);
   await this.randomWait(800, 1500);  // 输入后 0.8-1.5秒
   
   // 修改后
   await this.standardWait();         // 输入前 3-5秒
   await locator.fill(text);
   await this.standardWait();         // 输入后 3-5秒
   ```

4. **统一所有操作的等待时间**
   - 页面加载后：3-5秒
   - 点击按钮前后：3-5秒
   - 输入内容前后：3-5秒
   - 上传图片后：3-5秒 + 额外3-5秒（等待上传完成）
   - 话题选择：3-5秒
   - 按ESC键：3-5秒

## 修复后的操作流程

每个步骤之间都有 **3-5秒** 的随机间隔：

1. 导航到发布页面 → **等待 3-5秒**
2. 点击"高清发布" → **等待 3-5秒** → 点击完成 → **等待 3-5秒**
3. 点击"发布图文" → **等待 3-5秒** → 点击完成 → **等待 3-5秒**
4. 准备图片 → **等待 3-5秒**
5. 点击"上传图文" → **等待 3-5秒** → 上传完成 → **等待 3-5秒** → 额外等待 3-5秒
6. 点击标题框 → **等待 3-5秒** → 输入标题 → **等待 3-5秒**
7. 点击正文框 → **等待 3-5秒** → 输入正文 → **等待 3-5秒**
8. 点击话题按钮 → **等待 3-5秒** → 点击完成 → **等待 3-5秒**
9. 输入关键词 → **等待 3-5秒** → 输入完成 → **等待 3-5秒**
10. 选择话题 → **等待 3-5秒** → 点击话题 → **等待 3-5秒**
11. 点击"添加声明" → **等待 3-5秒** → 点击完成 → **等待 3-5秒**
12. 选择"AI生成" → **等待 3-5秒** → 点击完成 → **等待 3-5秒**
13. 点击"确定" → **等待 3-5秒** → 点击完成 → **等待 3-5秒**
14. 点击"发布" → **等待 3-5秒** → 点击完成 → **等待 3-5秒**

## 预期效果

- ✅ 所有操作间隔统一为 3-5秒
- ✅ 更接近真实人类操作速度
- ✅ 降低被平台识别为机器人的风险
- ✅ 提高发布成功率
- ✅ 操作更加稳定可靠

## 时间估算

单个抖音发布任务预计耗时：
- 14个主要步骤
- 每步平均等待 4秒（3-5秒的中间值）
- 总等待时间：约 56秒
- 加上实际操作时间：约 **60-80秒**

## 影响范围

- ✅ 只影响抖音适配器（`DouyinAdapter.ts`）
- ✅ 不影响其他平台的发布流程
- ✅ 向后兼容，不需要修改前端代码

## 部署步骤

1. 停止服务器
2. 拉取最新代码
3. 编译：`cd server && npm run build`
4. 启动服务器
5. 测试抖音发布功能

## 相关文件

- `server/src/services/adapters/DouyinAdapter.ts` - 抖音适配器（已修复）

## 测试建议

1. 测试单个抖音发布任务
2. 观察日志中的等待时间
3. 验证每个操作之间都有 3-5秒间隔
4. 检查发布成功率是否提高
