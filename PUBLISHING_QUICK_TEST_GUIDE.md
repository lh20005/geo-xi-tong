# 多平台发布系统 - 快速测试指南

## 🚀 快速开始

### 1. 启动系统

```bash
# 启动后端服务器
cd server
npm run dev

# 启动前端（新终端）
cd client
npm run dev
```

### 2. 访问系统
- 前端: http://localhost:5173
- 后端: http://localhost:3000

---

## 📝 测试步骤

### 步骤1: 绑定平台账号

1. 访问 **平台登录管理** 页面
2. 选择一个平台（建议先测试知乎）
3. 点击平台卡片
4. 填写账号信息：
   - 账号名称: `测试账号`
   - 用户名: `your_username`
   - 密码: `your_password`
5. 点击"确定"绑定

**预期结果**:
- ✅ 提示"账号绑定成功"
- ✅ 平台卡片显示绿色边框和对勾
- ✅ 显示"已绑定 1 个账号"

### 步骤2: 创建测试文章

1. 访问 **生成文章** 页面
2. 选择关键词和话题
3. 生成一篇测试文章
4. 等待文章生成完成

### 步骤3: 发布文章

1. 访问 **文章管理** 页面
2. 勾选要发布的文章
3. 点击"发布到平台"按钮
4. 在弹出的对话框中：
   - 选择平台: `知乎`
   - 选择账号: `测试账号`
   - 发布时间: `立即发布`
   - （可选）填写自定义标题、分类、标签
5. 点击"创建发布任务"

**预期结果**:
- ✅ 提示"成功创建 1 个发布任务"
- ✅ 选择状态自动清除

### 步骤4: 查看发布记录

1. 访问 **发布记录** 页面
2. 查看任务列表
3. 观察任务状态变化：
   - `等待中` → `执行中` → `成功` 或 `失败`

**预期结果**:
- ✅ 可以看到刚创建的任务
- ✅ 状态统计卡片显示正确数字
- ✅ 任务在1分钟内开始执行

### 步骤5: 查看执行日志

1. 在发布记录页面
2. 点击任务的"日志"按钮
3. 查看详细执行日志

**预期日志内容**:
```
[INFO] 开始执行发布任务
[INFO] 使用适配器: 知乎
[INFO] 启动浏览器
[INFO] 开始登录
[INFO] 登录成功
[INFO] 导航到发布页面
[INFO] 开始发布文章
[INFO] ✅ 文章发布成功
```

---

## 🧪 测试场景

### 场景1: 单篇文章发布
- 选择1篇文章
- 发布到1个平台
- 验证发布成功

### 场景2: 批量发布
- 选择多篇文章（3-5篇）
- 发布到同一平台
- 验证所有任务创建成功

### 场景3: 多平台发布
- 绑定多个平台账号
- 选择1篇文章
- 分别发布到不同平台
- 验证各平台发布结果

### 场景4: 定时发布
- 创建发布任务
- 选择"定时发布"
- 设置未来5分钟的时间
- 等待任务自动执行

### 场景5: 失败重试
- 使用错误的账号密码
- 创建发布任务
- 等待任务失败
- 点击"重试"按钮
- 验证重试功能

### 场景6: 多账号管理
- 为同一平台绑定多个账号
- 设置默认账号
- 发布时选择不同账号
- 验证账号切换功能

---

## 🔍 调试技巧

### 1. 查看浏览器自动化过程

修改 `server/src/services/BrowserAutomationService.ts`:
```typescript
async launchBrowser(options: BrowserOptions = {}): Promise<void> {
  this.browser = await puppeteer.launch({
    headless: false,  // 改为 false 可以看到浏览器
    // ...
  });
}
```

### 2. 查看后端日志

后端控制台会显示详细日志：
```
✅ 注册平台适配器: 知乎
✅ 任务调度器已启动
✅ 知乎登录成功
✅ 知乎文章发布成功
```

### 3. 检查数据库

```sql
-- 查看发布任务
SELECT * FROM publishing_tasks ORDER BY created_at DESC LIMIT 10;

-- 查看任务日志
SELECT * FROM publishing_logs WHERE task_id = 1 ORDER BY created_at;

-- 查看绑定的账号
SELECT * FROM platform_accounts;
```

### 4. 调整选择器

如果发布失败，可能是选择器不匹配。修改对应平台的适配器：

```typescript
// 例如：server/src/services/adapters/ZhihuAdapter.ts
getPublishSelectors(): PublishSelectors {
  return {
    titleInput: 'input[placeholder="请输入标题"]',  // 根据实际页面调整
    contentEditor: '.public-DraftEditor-content',
    publishButton: 'button.PublishPanel-stepTwoButton',
    successIndicator: '.SuccessPanel'
  };
}
```

---

## ⚠️ 常见问题

### Q1: 任务一直处于"等待中"状态
**原因**: 任务调度器可能未启动  
**解决**: 
1. 检查后端日志是否有"任务调度器已启动"
2. 重启后端服务器
3. 检查 `server/src/index.ts` 中是否调用了 `taskScheduler.start()`

### Q2: 登录失败
**原因**: 选择器不匹配或凭证错误  
**解决**:
1. 设置 `headless: false` 查看浏览器
2. 检查用户名和密码是否正确
3. 访问平台登录页面，检查实际的表单元素
4. 调整适配器中的选择器

### Q3: 发布失败
**原因**: 发布页面选择器不匹配  
**解决**:
1. 查看任务日志中的错误信息
2. 手动访问平台发布页面
3. 使用浏览器开发者工具检查元素
4. 更新适配器中的选择器

### Q4: 验证码问题
**原因**: 平台要求验证码验证  
**解决**:
1. 当前版本暂不支持自动验证码识别
2. 可以尝试使用已登录的Cookie
3. 或集成2captcha等验证码识别服务

### Q5: 微信公众号扫码超时
**原因**: 60秒内未完成扫码  
**解决**:
1. 增加等待时间（修改 `WechatAdapter.ts` 中的 timeout）
2. 提前准备好微信扫码
3. 或实现Cookie持久化，避免每次扫码

---

## 📊 测试检查清单

### 基础功能
- [ ] 可以绑定平台账号
- [ ] 可以查看已绑定账号
- [ ] 可以编辑账号信息
- [ ] 可以删除账号
- [ ] 可以设置默认账号

### 发布功能
- [ ] 可以选择文章
- [ ] 可以打开发布配置对话框
- [ ] 只显示已绑定的平台
- [ ] 可以选择账号
- [ ] 可以选择立即/定时发布
- [ ] 可以填写自定义配置
- [ ] 可以创建发布任务

### 记录查看
- [ ] 可以查看任务列表
- [ ] 统计卡片显示正确
- [ ] 可以筛选任务状态
- [ ] 可以查看任务日志
- [ ] 可以重试失败任务
- [ ] 可以立即执行等待任务

### 自动化执行
- [ ] 立即发布任务自动执行
- [ ] 定时任务到时自动执行
- [ ] 失败任务自动重试
- [ ] 执行过程记录日志
- [ ] 任务状态正确更新

---

## 🎯 性能测试

### 1. 并发测试
- 同时创建10个发布任务
- 观察系统处理能力
- 检查是否有资源泄漏

### 2. 长时间运行
- 让系统运行24小时
- 定期创建发布任务
- 检查内存和CPU使用

### 3. 大批量测试
- 选择50篇文章
- 批量发布到多个平台
- 验证所有任务正确执行

---

## 📞 获取帮助

如果遇到问题：
1. 查看后端控制台日志
2. 查看任务执行日志
3. 检查数据库记录
4. 参考 `PUBLISHING_SYSTEM_SUMMARY.md`
5. 查看适配器源代码

---

**祝测试顺利！** 🎉
