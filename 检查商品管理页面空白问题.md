# 商品管理页面空白问题诊断

## 问题现象
点击商品管理页面显示空白

## 可能的原因

### 1. 权限检查失败
`AdminRoute`组件检查用户是否为管理员，如果不是则重定向到首页。

### 2. localStorage数据问题
检查localStorage中是否有正确的用户信息。

## 诊断步骤

### 步骤1: 检查浏览器控制台
打开浏览器开发者工具（F12），查看：
1. **Console标签页**: 是否有JavaScript错误或警告
2. **Network标签页**: 是否有API请求失败

### 步骤2: 检查localStorage数据
在浏览器控制台执行以下命令：

```javascript
// 检查所有存储的数据
console.log('=== localStorage 数据 ===');
console.log('auth_token:', localStorage.getItem('auth_token'));
console.log('refresh_token:', localStorage.getItem('refresh_token'));
console.log('user_info:', localStorage.getItem('user_info'));

// 解析用户信息
try {
  const userInfo = JSON.parse(localStorage.getItem('user_info') || '{}');
  console.log('=== 用户信息 ===');
  console.log('用户名:', userInfo.username);
  console.log('角色:', userInfo.role);
  console.log('是否管理员:', userInfo.role === 'admin');
} catch (e) {
  console.error('解析用户信息失败:', e);
}
```

### 步骤3: 检查权限验证
在浏览器控制台执行：

```javascript
// 检查isAdmin函数
function getCurrentUser() {
  try {
    const userInfoStr = localStorage.getItem('user_info');
    if (!userInfoStr) return null;
    return JSON.parse(userInfoStr);
  } catch (error) {
    console.error('解析用户信息失败:', error);
    return null;
  }
}

function isAdmin() {
  const user = getCurrentUser();
  return user?.role === 'admin';
}

console.log('当前用户:', getCurrentUser());
console.log('是否管理员:', isAdmin());
```

### 步骤4: 检查页面渲染
在浏览器控制台执行：

```javascript
// 检查页面是否被渲染
console.log('页面元素:', document.querySelector('[style*="padding: 24"]'));
console.log('Card元素:', document.querySelector('.ant-card'));
```

## 快速修复方案

### 方案1: 重新登录（推荐）
1. 清除localStorage
2. 重新登录

在浏览器控制台执行：
```javascript
// 清除所有数据
localStorage.clear();

// 重新登录
window.location.href = '/login';
```

### 方案2: 手动设置用户信息
如果你确定已经登录，但用户信息丢失，可以手动设置：

```javascript
// 重新登录获取用户信息
fetch('http://localhost:3000/api/auth/login', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    username: 'admin',
    password: 'admin123'
  })
})
.then(res => res.json())
.then(data => {
  if (data.success) {
    localStorage.setItem('auth_token', data.data.token);
    localStorage.setItem('refresh_token', data.data.refreshToken);
    localStorage.setItem('user_info', JSON.stringify(data.data.user));
    console.log('✅ 用户信息已更新');
    console.log('用户:', data.data.user);
    location.reload();
  }
});
```

### 方案3: 检查API响应
在浏览器控制台执行：

```javascript
// 测试商品管理API
const token = localStorage.getItem('auth_token');
fetch('http://localhost:3000/api/admin/products', {
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  }
})
.then(res => res.json())
.then(data => {
  console.log('API响应:', data);
  if (data.success) {
    console.log('✅ API正常，套餐数量:', data.data.length);
  } else {
    console.error('❌ API失败:', data.message);
  }
})
.catch(err => console.error('❌ 请求失败:', err));
```

## 常见问题

### Q1: 页面空白，控制台显示"您没有权限访问此页面"
**原因**: 用户不是管理员或用户信息丢失

**解决**: 
1. 检查localStorage中的user_info
2. 确认role字段是否为'admin'
3. 重新登录

### Q2: 页面空白，控制台没有任何错误
**原因**: 可能是React渲染错误被捕获

**解决**:
1. 检查浏览器控制台的所有标签页（Console、Network、Elements）
2. 查看是否有API请求失败
3. 检查React DevTools

### Q3: API返回401或403错误
**原因**: Token过期或无效

**解决**: 重新登录

## 预期的正常状态

### localStorage应该包含：
```javascript
{
  "auth_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user_info": "{\"id\":1,\"username\":\"admin\",\"role\":\"admin\",...}"
}
```

### 用户信息应该包含：
```javascript
{
  "id": 1,
  "username": "admin",
  "email": "admin@local.system",
  "role": "admin",
  "invitationCode": "xr2w8q",
  "isTempPassword": false
}
```

### API响应应该是：
```javascript
{
  "success": true,
  "data": [
    {
      "id": 1,
      "plan_name": "体验版",
      "price": "0.00",
      ...
    },
    ...
  ]
}
```

## 下一步

请按照以下顺序操作：

1. **打开浏览器开发者工具（F12）**
2. **切换到Console标签页**
3. **执行步骤2中的诊断命令**
4. **将结果告诉我**

根据诊断结果，我可以提供更精确的解决方案。

## 临时解决方案

如果你现在就想访问商品管理页面，最快的方法是：

```javascript
// 在浏览器控制台执行
localStorage.clear();
window.location.href = '/login';
```

然后使用管理员账号重新登录：
- 用户名: `admin`
- 密码: `admin123`
