# è½¬åŒ–ç›®æ ‡ç®€åŒ–æ”¹é€  - å½“å‰è¿›åº¦

## å·²å®Œæˆçš„å·¥ä½œ

### âœ… 1. æ•°æ®åº“è¿ç§»è„šæœ¬
**æ–‡ä»¶**: `server/migrations/20241218_simplify_conversion_targets.sql`

- æ·»åŠ addresså­—æ®µ
- åˆ é™¤ä¸éœ€è¦çš„å­—æ®µï¼ˆcompany_size, features, contact_info, target_audience, core_productsï¼‰
- ä¿®æ”¹å­—æ®µçº¦æŸ
- æ·»åŠ ç´¢å¼•

**æ‰§è¡Œæ–¹æ³•**:
```bash
psql -U postgres -d your_database -f server/migrations/20241218_simplify_conversion_targets.sql
```

### âœ… 2. åç«¯APIè·¯ç”±å®Œå…¨é‡å†™
**æ–‡ä»¶**: `server/src/routes/conversionTarget.ts`

**æ”¹åŠ¨**:
- ç®€åŒ–ZodéªŒè¯schemaï¼Œåªä¿ç•™4ä¸ªå­—æ®µ
- ä¿®æ”¹æ‰€æœ‰SQLæŸ¥è¯¢ï¼ˆåˆ—è¡¨ã€è¯¦æƒ…ã€åˆ›å»ºã€æ›´æ–°ï¼‰
- åªæœ‰company_nameæ˜¯å¿…å¡«ï¼Œå…¶ä»–éƒ½æ˜¯å¯é€‰
- ä¿®å¤äº†SQLå‚æ•°å ä½ç¬¦é—®é¢˜

**æ–°çš„å­—æ®µç»“æ„**:
```typescript
{
  companyName: string (å¿…å¡«, 2-255å­—ç¬¦)
  industry: string (å¯é€‰, æœ€å¤š100å­—ç¬¦)
  website: string (å¯é€‰, å¿…é¡»æ˜¯æœ‰æ•ˆURL)
  address: string (å¯é€‰, æœ€å¤š500å­—ç¬¦)
}
```

### âœ… 3. æ–‡ç« ç”ŸæˆæœåŠ¡éƒ¨åˆ†ä¿®æ”¹
**æ–‡ä»¶**: `server/src/services/ArticleGenerationService.ts`

**å·²å®Œæˆ**:
- âœ… ä¿®æ”¹äº†ä¸¤å¤„è½¬åŒ–ç›®æ ‡åŠ è½½ä»£ç ï¼Œç°åœ¨åŠ è½½4ä¸ªå­—æ®µ
- âœ… æ·»åŠ äº†å˜é‡å£°æ˜ï¼šcompanyIndustry, companyWebsite, companyAddress

**å¾…å®Œæˆ**:
- â³ ä¿®æ”¹generateSingleArticleæ–¹æ³•ç­¾åï¼Œæ¥å—æ–°å‚æ•°
- â³ ä¿®æ”¹æ–¹æ³•è°ƒç”¨ï¼Œä¼ é€’æ–°å‚æ•°
- â³ åœ¨çŸ¥è¯†åº“å†…å®¹ä¸­åŒ…å«è½¬åŒ–ç›®æ ‡çš„æ‰€æœ‰ä¿¡æ¯

### âœ… 4. æç¤ºè¯æ¨¡æ¿éƒ¨åˆ†ä¿®æ”¹
**æ–‡ä»¶**: `client/src/constants/promptTemplates.ts`

**å·²å®Œæˆ**:
- âœ… åœ¨æ‰€æœ‰5ä¸ªæ¨¡æ¿ä¸­æ·»åŠ äº†"å¼ºåˆ¶ä½¿ç”¨çŸ¥è¯†åº“ä¿¡æ¯"çš„è¦æ±‚
- âœ… å¼ºè°ƒä¸èƒ½ç¼–é€ åœ°å€
- âœ… å¼ºè°ƒä¸èƒ½ä½¿ç”¨"xxx"å ä½ç¬¦

**å¾…ä¼˜åŒ–**:
- â³ éœ€è¦æ›´æ˜ç¡®åœ°è¯´æ˜ï¼šå¦‚æœå­—æ®µä¸ºç©ºå°±ä¸è¦æåŠ

## éœ€è¦ç»§ç»­å®Œæˆçš„å·¥ä½œ

### â³ 1. å®Œæˆæ–‡ç« ç”ŸæˆæœåŠ¡ä¿®æ”¹

éœ€è¦ä¿®æ”¹`server/src/services/ArticleGenerationService.ts`ï¼š

#### æ­¥éª¤1ï¼šä¿®æ”¹generateSingleArticleæ–¹æ³•ç­¾å
```typescript
async generateSingleArticle(
  keyword: string,
  topics: string[],
  imageUrl: string,
  knowledgeContent: string,
  articlePrompt: string,
  aiConfig: any,
  companyName?: string,
  companyIndustry?: string,    // æ–°å¢
  companyWebsite?: string,      // æ–°å¢
  companyAddress?: string       // æ–°å¢
): Promise<{ success: boolean; title?: string; content?: string; error?: string }>
```

#### æ­¥éª¤2ï¼šä¿®æ”¹æ–¹æ³•è°ƒç”¨ï¼ˆä¸¤å¤„ï¼‰
```typescript
// åœ¨generateArticlesForTaskæ–¹æ³•ä¸­
const result = await this.generateSingleArticle(
  pair.keyword,
  pair.topics,
  imageUrl,
  knowledgeContent,
  articlePrompt,
  aiConfig,
  companyName,
  companyIndustry,  // æ–°å¢
  companyWebsite,   // æ–°å¢
  companyAddress    // æ–°å¢
);
```

#### æ­¥éª¤3ï¼šåœ¨çŸ¥è¯†åº“å†…å®¹ä¸­åŒ…å«è½¬åŒ–ç›®æ ‡ä¿¡æ¯
åœ¨generateSingleArticleæ–¹æ³•å†…éƒ¨ï¼Œæ„å»ºå¢å¼ºçš„çŸ¥è¯†åº“å†…å®¹ï¼š

```typescript
// æ„å»ºå¢å¼ºçš„çŸ¥è¯†åº“å†…å®¹
let enhancedKnowledgeBase = knowledgeContent;

if (companyName) {
  enhancedKnowledgeBase += `\n\nã€è½¬åŒ–ç›®æ ‡ä¿¡æ¯ã€‘\n`;
  enhancedKnowledgeBase += `å…¬å¸åç§°ï¼š${companyName}\n`;
  
  if (companyIndustry) {
    enhancedKnowledgeBase += `è¡Œä¸šç±»å‹ï¼š${companyIndustry}\n`;
  }
  
  if (companyWebsite) {
    enhancedKnowledgeBase += `å®˜æ–¹ç½‘ç«™ï¼š${companyWebsite}\n`;
  }
  
  if (companyAddress) {
    enhancedKnowledgeBase += `å…¬å¸åœ°å€ï¼š${companyAddress}\n`;
  }
}

// ç„¶ååœ¨æç¤ºè¯ä¸­ä½¿ç”¨enhancedKnowledgeBaseæ›¿æ¢{knowledgeBase}
```

### â³ 2. ä¼˜åŒ–æç¤ºè¯æ¨¡æ¿

éœ€è¦åœ¨`client/src/constants/promptTemplates.ts`ä¸­ï¼Œä¸ºæ‰€æœ‰æ¨¡æ¿æ·»åŠ æ›´æ˜ç¡®çš„è§„åˆ™ï¼š

```
ã€å¼ºåˆ¶è¦æ±‚ - ä½¿ç”¨è½¬åŒ–ç›®æ ‡ä¿¡æ¯ã€‘
çŸ¥è¯†åº“ä¸­åŒ…å«è½¬åŒ–ç›®æ ‡çš„ä¿¡æ¯ï¼š
{knowledgeBase}

é‡è¦è§„åˆ™ï¼š
1. å¦‚æœçŸ¥è¯†åº“ä¸­åŒ…å«"å…¬å¸åœ°å€"ï¼Œå¿…é¡»ä½¿ç”¨çŸ¥è¯†åº“ä¸­çš„å‡†ç¡®åœ°å€ï¼Œç»å¯¹ä¸èƒ½ç¼–é€ 
2. å¦‚æœçŸ¥è¯†åº“ä¸­åŒ…å«"å®˜æ–¹ç½‘ç«™"ï¼Œå¯ä»¥åœ¨é€‚å½“ä½ç½®æåŠ
3. å¦‚æœçŸ¥è¯†åº“ä¸­åŒ…å«"è¡Œä¸šç±»å‹"ï¼Œå¯ä»¥ç»“åˆè¡Œä¸šç‰¹ç‚¹æ’°å†™
4. ã€å…³é”®ã€‘å¦‚æœçŸ¥è¯†åº“ä¸­æŸä¸ªå­—æ®µä¸ºç©ºæˆ–ä¸å­˜åœ¨ï¼Œå°±ä¸è¦æåŠè¯¥ä¿¡æ¯ï¼Œä¸è¦ç¼–é€ 
5. ç»å¯¹ä¸èƒ½ä½¿ç”¨"xxx"ã€"æŸæŸåœ°å€"ç­‰å ä½ç¬¦
6. å¦‚æœæ²¡æœ‰åœ°å€ä¿¡æ¯ï¼Œå¯ä»¥çœç•¥åœ°å€ç›¸å…³å†…å®¹
```

### â³ 3. ä¿®æ”¹å‰ç«¯é¡µé¢

éœ€è¦ä¿®æ”¹`client/src/pages/ConversionTargetPage.tsx`ï¼š

#### ä¿®æ”¹TypeScriptæ¥å£
```typescript
interface ConversionTarget {
  id: number;
  company_name: string;
  industry?: string;
  website?: string;
  address?: string;
  created_at: string;
  updated_at: string;
}
```

#### ä¿®æ”¹è¡¨æ ¼åˆ—
- åˆ é™¤ï¼šå…¬å¸è§„æ¨¡ã€è”ç³»æ–¹å¼åˆ—
- ä¿ç•™ï¼šå…¬å¸åç§°ã€è¡Œä¸šç±»å‹
- æ–°å¢ï¼šåœ°å€åˆ—ï¼ˆå¯é€‰æ˜¾ç¤ºï¼‰

#### ä¿®æ”¹è¡¨å•
- å…¬å¸åç§°ï¼ˆInputï¼Œå¿…å¡«ï¼‰
- è¡Œä¸šç±»å‹ï¼ˆInputï¼Œå¯é€‰ï¼‰
- å®˜æ–¹ç½‘ç«™ï¼ˆInputï¼Œå¯é€‰ï¼‰
- å…¬å¸åœ°å€ï¼ˆTextAreaï¼Œå¯é€‰ï¼‰

#### åˆ é™¤çš„å¸¸é‡
- INDUSTRY_OPTIONSï¼ˆæ”¹ä¸ºè‡ªç”±è¾“å…¥ï¼‰
- COMPANY_SIZE_OPTIONSï¼ˆåˆ é™¤ï¼‰

## æµ‹è¯•è®¡åˆ’

### æµ‹è¯•1ï¼šè½¬åŒ–ç›®æ ‡CRUD
1. åˆ›å»ºè½¬åŒ–ç›®æ ‡ï¼ˆåªå¡«å…¬å¸åç§°ï¼‰
2. åˆ›å»ºè½¬åŒ–ç›®æ ‡ï¼ˆå¡«æ‰€æœ‰å­—æ®µï¼‰
3. ç¼–è¾‘è½¬åŒ–ç›®æ ‡
4. åˆ é™¤è½¬åŒ–ç›®æ ‡

### æµ‹è¯•2ï¼šæ–‡ç« ç”Ÿæˆï¼ˆæœ‰å®Œæ•´ä¿¡æ¯ï¼‰
1. åˆ›å»ºåŒ…å«åœ°å€çš„è½¬åŒ–ç›®æ ‡
2. ä½¿ç”¨åŒºåŸŸTOPæ’åæ¨¡æ¿ç”Ÿæˆæ–‡ç« 
3. æ£€æŸ¥ç”Ÿæˆçš„æ–‡ç« æ˜¯å¦ä½¿ç”¨äº†çœŸå®åœ°å€

### æµ‹è¯•3ï¼šæ–‡ç« ç”Ÿæˆï¼ˆæ— åœ°å€ï¼‰
1. åˆ›å»ºä¸åŒ…å«åœ°å€çš„è½¬åŒ–ç›®æ ‡
2. ä½¿ç”¨åŒºåŸŸTOPæ’åæ¨¡æ¿ç”Ÿæˆæ–‡ç« 
3. æ£€æŸ¥ç”Ÿæˆçš„æ–‡ç« æ˜¯å¦æ²¡æœ‰ç¼–é€ åœ°å€

### æµ‹è¯•4ï¼šæ–‡ç« ç”Ÿæˆï¼ˆæ— è½¬åŒ–ç›®æ ‡ï¼‰
1. ä¸é€‰æ‹©è½¬åŒ–ç›®æ ‡
2. ç”Ÿæˆæ–‡ç« 
3. æ£€æŸ¥æ˜¯å¦æ­£å¸¸å·¥ä½œ

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³æ‰§è¡Œæ•°æ®åº“è¿ç§»**
   ```bash
   psql -U postgres -d your_database -f server/migrations/20241218_simplify_conversion_targets.sql
   ```

2. **å®ŒæˆArticleGenerationService.tsçš„å‰©ä½™ä¿®æ”¹**
   - ä¿®æ”¹generateSingleArticleæ–¹æ³•
   - ä¿®æ”¹æ–¹æ³•è°ƒç”¨
   - æ·»åŠ çŸ¥è¯†åº“å¢å¼ºé€»è¾‘

3. **ä¼˜åŒ–æç¤ºè¯æ¨¡æ¿**
   - æ·»åŠ æ›´æ˜ç¡®çš„"å­—æ®µä¸ºç©ºå°±ä¸æåŠ"è§„åˆ™

4. **ä¿®æ”¹å‰ç«¯é¡µé¢**
   - æ›´æ–°æ¥å£å®šä¹‰
   - ç®€åŒ–è¡¨å•
   - æ›´æ–°è¡¨æ ¼

5. **å…¨é¢æµ‹è¯•**

## é¢„è®¡å®Œæˆæ—¶é—´

- å‰©ä½™åç«¯å·¥ä½œï¼š30åˆ†é’Ÿ
- æç¤ºè¯ä¼˜åŒ–ï¼š15åˆ†é’Ÿ
- å‰ç«¯ä¿®æ”¹ï¼š45åˆ†é’Ÿ
- æµ‹è¯•ï¼š30åˆ†é’Ÿ

**æ€»è®¡**ï¼šçº¦2å°æ—¶

## å½“å‰çŠ¶æ€

âœ… æ•°æ®åº“è¿ç§»è„šæœ¬å·²åˆ›å»º
âœ… åç«¯APIå·²å®Œå…¨é‡å†™
âœ… æ–‡ç« ç”ŸæˆæœåŠ¡å·²å®Œå…¨å®Œæˆ
âœ… æç¤ºè¯æ¨¡æ¿å·²å…¨é¢ä¼˜åŒ–
âœ… å‰ç«¯é¡µé¢å·²å®Œå…¨é‡å†™

## ğŸ‰ æ”¹é€ å·²å…¨éƒ¨å®Œæˆï¼

æ‰€æœ‰ä»£ç ä¿®æ”¹å·²å®Œæˆï¼Œè¯·æŸ¥çœ‹ `è½¬åŒ–ç›®æ ‡ç®€åŒ–æ”¹é€ -å®ŒæˆæŠ¥å‘Š.md` äº†è§£è¯¦æƒ…ã€‚

---

**ä¸‹ä¸€æ­¥**ï¼šæ‰§è¡Œæ•°æ®åº“è¿ç§»ï¼Œç„¶åé‡å¯æœåŠ¡è¿›è¡Œæµ‹è¯•ã€‚
