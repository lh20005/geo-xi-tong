# 🚀 立即执行：重启服务

## 当前状态

✅ **所有代码修改已完成**
- 文章预览格式修复
- 文章字数控制
- 法律风险规避
- 所有平台内容清理统一

⚠️ **需要重启服务才能生效**

## 立即执行

### 步骤1: 停止当前服务

在运行服务的终端窗口中按：

```
Ctrl + C
```

### 步骤2: 重新启动服务

```bash
npm run dev
```

### 步骤3: 等待服务启动

看到以下信息表示启动成功：

```
Server running on port 3001
Frontend running on port 3000
```

## 验证修复

### 1. 测试头条号发布（验证HTML标签问题）

```bash
1. 打开浏览器: http://localhost:3000
2. 进入"发布任务"页面
3. 创建新的头条号发布任务
4. 选择文章
5. 点击"执行发布"
6. 查看控制台日志中的"文字预览"
```

**预期结果**: 文字预览中不应包含 `<p>`, `</p>`, `<br>` 等HTML标签

### 2. 测试文章生成（验证字数控制）

```bash
1. 进入"文章生成"页面
2. 生成新文章
3. 查看文章内容长度
```

**预期结果**: 文章字数应在700-800字符之间

### 3. 查看控制台日志

发布任务时，应该看到类似的日志：

```
[头条号] 📝 步骤1：提取所有文字内容...
[头条号] 📏 纯文字长度: 756 个字符
[头条号] 📝 文字预览: "随着科技的发展，人工智能..."
```

**注意**: 预览中不应有HTML标签

## 如果问题仍然存在

### 清除缓存并重启

```bash
# 删除缓存
rm -rf node_modules/.cache

# 重新启动
npm run dev
```

### 检查代码是否正确

打开 `server/src/services/adapters/ToutiaoAdapter.ts`，查找第347行：

```typescript
const textOnly = this.cleanArticleContent(cleanContent);
```

应该使用 `this.cleanArticleContent()` 方法。

## 抖音AI声明问题（可选）

如果需要使用抖音发布功能，需要手动修复AI声明选择问题。

**参考文档**: `抖音滑动页自主声明修复指南.md`

**修复位置**: `server/src/services/adapters/DouyinAdapter.ts` 第435-500行

**关键改进**:
- 等待时间从3秒增加到7秒（5+2）
- 使用XPath精确查找元素
- 添加多种备用方案

## 完成后

✅ 所有平台发布应该不再出现HTML标签
✅ 文章字数应该控制在700-800字符
✅ 提示词模板已规避法律风险

---

**现在就执行**: `Ctrl+C` 然后 `npm run dev`
