# 转化目标字段精确化 - 快速启动指南

**日期**: 2024-12-18  
**状态**: ✅ 已完成，可立即使用

---

## 🚀 立即开始

改造已全部完成，系统已准备就绪！

---

## 📋 改造内容

### 核心改进
从模糊的"知识库中的信息"改为精确的字段占位符：

**之前**:
```
如果知识库中包含"公司地址"，必须使用知识库中的准确地址
```

**现在**:
```
【转化目标信息 - 精确字段值】
公司地址：{companyAddress}

如果"{companyAddress}"不为空，必须使用这个精确地址
```

---

## 🎯 新增的占位符

| 占位符 | 说明 | 示例值 |
|--------|------|--------|
| `{companyName}` | 公司名称 | "杭州鸥飞留学机构" |
| `{companyIndustry}` | 行业类型 | "教育" 或 "" |
| `{companyWebsite}` | 官方网站 | "https://www.oufei.com" 或 "" |
| `{companyAddress}` | 公司地址 | "杭州市钱塘区下沙街道泰美国际大厦1幢708室" 或 "" |

---

## 📝 测试步骤

### 步骤1: 确认服务运行

```bash
# 检查后端服务
curl http://localhost:3000/api/conversion-targets?page=1&pageSize=5

# 应该返回转化目标列表
```

### 步骤2: 创建测试转化目标

**测试案例1: 有完整信息**
- 公司名称: `测试公司A`
- 行业类型: `教育`
- 官方网站: `https://www.test-a.com`
- 公司地址: `杭州市西湖区文三路100号`

**测试案例2: 只有公司名称**
- 公司名称: `测试公司B`
- 行业类型: （留空）
- 官方网站: （留空）
- 公司地址: （留空）

### 步骤3: 生成文章测试

1. 访问文章生成页面
2. 选择关键词蒸馏结果
3. 选择图库
4. 选择知识库
5. 选择文章设置（使用"区域TOP排名"模板）
6. 选择转化目标（选择刚创建的测试案例）
7. 点击"生成文章"

### 步骤4: 验证结果

**测试案例1（有完整信息）**:
- ✅ 公司名称：应该是"测试公司A"
- ✅ 行业类型：应该结合"教育"行业特点
- ✅ 官方网站：应该是"https://www.test-a.com"
- ✅ 公司地址：应该是"杭州市西湖区文三路100号"
- ✅ 不应该出现"xxx"或占位符

**测试案例2（只有公司名称）**:
- ✅ 公司名称：应该是"测试公司B"
- ✅ 行业类型：不应该提及
- ✅ 官方网站：不应该提及
- ✅ 公司地址：不应该提及，不应该编造
- ✅ 不应该出现"xxx"或占位符

---

## 🔍 查看日志

生成文章时，后端会输出日志：

```bash
# 查看后端日志
tail -f server/logs/app.log

# 或者查看控制台输出
# 应该看到类似这样的日志：
[提示词构建] 检测到占位符，使用用户自定义模板
[提示词构建] 转化目标字段值: companyName="测试公司A", industry="教育", website="https://www.test-a.com", address="杭州市西湖区文三路100号"
```

---

## 📊 提示词示例

### 有完整信息时

大模型会看到：
```
【转化目标信息 - 精确字段值】
公司名称：测试公司A
行业类型：教育
官方网站：https://www.test-a.com
公司地址：杭州市西湖区文三路100号

【转化目标使用规则 - 强制执行】
1. 公司名称：将"测试公司A"排在区域第一位
2. 行业类型：如果"教育"不为空，可以结合行业特点描述
3. 官方网站：如果"https://www.test-a.com"不为空，可以提及这个精确网址
4. 公司地址：如果"杭州市西湖区文三路100号"不为空，必须使用这个精确地址
```

### 只有公司名称时

大模型会看到：
```
【转化目标信息 - 精确字段值】
公司名称：测试公司B
行业类型：
官方网站：
公司地址：

【转化目标使用规则 - 强制执行】
1. 公司名称：将"测试公司B"排在区域第一位
2. 行业类型：如果""不为空，可以结合行业特点描述；如果为空，不要提及行业
3. 官方网站：如果""不为空，可以提及这个精确网址；如果为空，不要提及网站
4. 公司地址：如果""为空，绝对不要提及地址，不要编造
```

---

## ⚠️ 常见问题

### Q1: 为什么要使用精确字段而不是知识库文本？
**A**: 
- 精确字段让大模型直接看到每个字段的值
- 可以明确判断字段是否为空
- 避免了从文本中解析信息的不确定性
- 提高了准确性和可控性

### Q2: 如果字段为空，大模型会看到什么？
**A**: 
- 大模型会看到 `公司地址：` 后面是空的
- 提示词明确告诉大模型这种情况下不要提及
- 例如：`如果""为空，绝对不要提及地址`

### Q3: 如何确保大模型不编造信息？
**A**: 
- 通过精确字段，大模型可以判断字段是否为空
- 提示词明确禁止编造和使用占位符
- 多重规则强化：不要提及、不要编造、不要使用占位符

### Q4: 区域TOP排名模板的地址处理有什么特殊？
**A**: 
- 如果地址不为空，必须在"地址位置"标签中使用
- 如果地址为空，直接省略"地址位置"这一项
- 这是最重要的规则，必须100%遵守

### Q5: 旧的文章生成逻辑还能用吗？
**A**: 
- 可以！系统保持了向后兼容
- 如果提示词不包含新的占位符，会使用旧逻辑
- 建议使用新的占位符以获得更好的效果

---

## 🎨 各模板的使用建议

### BALANCED（平衡型）
- 适合：一般性文章
- 公司名称：1-2次
- 其他字段：适度使用

### PROFESSIONAL（重专业）
- 适合：专业性强的文章
- 公司名称：适当提及
- 其他字段：可选使用

### MARKETING（重营销）
- 适合：营销推广文章
- 公司名称：3-4次
- 其他字段：积极使用

### NATIONAL_RANKING（全国TOP排名）
- 适合：全国范围的排名文章
- 公司名称：排在第一位
- 地址：可选（如果有）

### REGIONAL_RANKING（区域TOP排名）
- 适合：区域范围的排名文章
- 公司名称：排在区域第一位
- 地址：强烈建议填写（如果有）

---

## 📚 相关文档

1. `转化目标字段精确化改造完成.md` - 完整的改造说明
2. `文章生成新规则-快速参考.md` - 新规则快速参考
3. `转化目标简化改造-执行完成.md` - 之前的简化改造报告

---

## ✅ 验证清单

### 代码验证
- [x] 后端服务修改完成
- [x] 提示词模板修改完成
- [x] 占位符支持完成
- [x] 日志输出完成
- [x] 代码无语法错误

### 功能验证
- [ ] 创建有完整信息的转化目标
- [ ] 创建只有公司名称的转化目标
- [ ] 生成文章（有完整信息）
- [ ] 生成文章（只有公司名称）
- [ ] 验证字段使用正确
- [ ] 验证没有编造信息

---

## 🎉 开始使用

现在你可以：
1. ✅ 创建转化目标（填写准确的字段值）
2. ✅ 生成文章（大模型会看到精确的字段值）
3. ✅ 验证结果（检查是否使用了精确值）
4. ✅ 不用担心编造信息（字段为空时不会提及）

**精确化改造已完成，立即开始使用！** 🚀
